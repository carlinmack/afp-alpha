<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Session Word_Lib - Archive of Formal Proofs</title><meta property="og:title" content="Session Word_Lib"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/entries/word_lib/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories"><meta property="og:site_name" content="Archive of Formal Proofs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/afp.png"><meta name=twitter:title content="Session Word_Lib"><meta name=twitter:description content><link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css><link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script><script src=/js/header-search.js></script></head><body class=mathjax_ignore><aside><div><div><a href=/><img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo></a><ul><a href=/entries/word_lib><li>Return to entry</li></a></ul><hr><ul><a href=#More_Arithmetic><li>More_Arithmetic</li></a><a href=#More_Divides><li>More_Divides</li></a><a href=#More_Word><li>More_Word</li></a><a href=#Signed_Words><li>Signed_Words</li></a><a href=#Traditional_Infix_Syntax><li>Traditional_Infix_Syntax</li></a><a href=#Word_EqI><li>Word_EqI</li></a><a href=#Bit_Comprehension><li>Bit_Comprehension</li></a><a href=#Bits_Int><li>Bits_Int</li></a><a href=#Typedef_Morphisms><li>Typedef_Morphisms</li></a><a href=#Aligned><li>Aligned</li></a><a href=#Least_significant_bit><li>Least_significant_bit</li></a><a href=#Most_significant_bit><li>Most_significant_bit</li></a><a href=#Even_More_List><li>Even_More_List</li></a><a href=#Reversed_Bit_Lists><li>Reversed_Bit_Lists</li></a><a href=#Ancient_Numeral><li>Ancient_Numeral</li></a><a href=#Bitwise><li>Bitwise</li></a><a href=#Bitwise_Signed><li>Bitwise_Signed</li></a><a href=#Enumeration><li>Enumeration</li></a><a href=#Enumeration_Word><li>Enumeration_Word</li></a><a href=#Generic_set_bit><li>Generic_set_bit</li></a><a href=#Hex_Words><li>Hex_Words</li></a><a href=#More_Sublist><li>More_Sublist</li></a><a href=#More_Misc><li>More_Misc</li></a><a href=#Strict_part_mono><li>Strict_part_mono</li></a><a href=#Legacy_Aliases><li>Legacy_Aliases</li></a><a href=#Next_and_Prev><li>Next_and_Prev</li></a><a href=#Norm_Words><li>Norm_Words</li></a><a href=#Rsplit><li>Rsplit</li></a><a href=#Type_Syntax><li>Type_Syntax</li></a><a href=#Signed_Division_Word><li>Signed_Division_Word</li></a><a href=#Word_Lemmas><li>Word_Lemmas</li></a><a href=#Word_8><li>Word_8</li></a><a href=#Word_16><li>Word_16</li></a><a href=#Word_Syntax><li>Word_Syntax</li></a><a href=#Word_Names><li>Word_Names</li></a><a href=#More_Word_Operations><li>More_Word_Operations</li></a><a href=#Word_32><li>Word_32</li></a><a href=#Many_More><li>Many_More</li></a><a href=#Word_Lib_Sumo><li>Word_Lib_Sumo</li></a><a href=#Word_64><li>Word_64</li></a><a href=#Guide><li>Guide</li></a><a href=#Examples><li>Examples</li></a></ul></div><ul><a href=https://www.isa-afp.org/browser_info/current/AFP/Word_Lib/outline.pdf><li>Proof
outline</li></a><a href=https://www.isa-afp.org/browser_info/current/AFP/Word_Lib/document.pdf><li>Proof
document</li></a><a href=https://www.isa-afp.org/browser_info/current/AFP/Word_Lib/session_graph.pdf><li>Theory dependencies</li></a></ul></div></aside><div class="content theories"><header><form action=/%20search><div class=form-container><input id=searchInput type=search size=31 maxlength=255><button id=searchButton type=button><img src=/images/search.svg alt=Search></button><div id=searchInputautocomplete-list style=display:none><div></div></div></div></form><h1><span class=first>S</span>ession <span class=first>W</span>ord_<span class=first>L</span>ib</h1><div></div></header><div><main><div id=More_Arithmetic><div class=head><h1>Theory More_Arithmetic</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Arithmetic lemmas›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Arithmetic
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Type_Length.html>HOL-Library.Type_Length</a>"</span> <span class=quoted>"<a href=../../HOL/HOL-Library/Bit_Operations.html>HOL-Library.Bit_Operations</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>declare</span></span> iszero_0 <span class=main>[</span><span class=operator>intro</span><span class=main>]</span>

<span class=keyword1><span class=command>declare</span></span> min.absorb1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> min.absorb2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> n_less_equal_power_2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> less_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> min_pm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"min <span class=free>a</span> <span class=free>b</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> min_pm1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>+</span> min <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> rev_min_pm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"min <span class=free>b</span> <span class=free>a</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> rev_min_pm1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>+</span> min <span class=free>b</span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> min_minus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"min <span class=free>m</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> min_minus' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"min <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> nat_less_power_trans<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>assumes</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> mult_less_mono2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> nv zero_less_power<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> nv kv
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_le_power_trans<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_add_diff_inverse mult_le_mono2 semiring_normalization_rules<span class=main><span class=main>(</span></span>26<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_add_offset_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>assumes</span></span> yv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     mn<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> mn<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> yv <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>qy</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>+</span> <span class=skolem>qy</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>qy</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_imp_add_positive<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> xv
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> mult_le_mono1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_power_less_diff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lt
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> ih<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>n</span> <span class=main>*</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=bound>m</span> <span class=main>-</span> <span class=skolem>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> prem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> Suc <span class=skolem>n</span> <span class=main>*</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>m</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> 0
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> Suc <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m'</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> prem
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> ih<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> power_2_mult_step_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n'</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n'</span> <span class=main>*</span> <span class=free>k'</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n'</span> <span class=main>*</span> <span class=main>(</span><span class=free>k'</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n'</span><span class=main>=</span><span class=free>n</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Suc_leI le_refl mult_Suc_right mult_le_mono semiring_normalization_rules<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> le_neq_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> <span class=free>n'</span> <span class=main>+</span> <span class=bound>m</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_Suc_ex<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Suc_leI mult.assoc mult_Suc_right nat_mult_le_cancel_disj<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_mult_power_less_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>^</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mult_less_cancel2<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> m <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span><span class=main>]</span>
        mult_less_cancel2<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> m<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> nat_minus_add_max<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> nat_minus_add_max <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> max_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> diff_diff_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span> <span class=main>::</span> nat<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> small_powers_of_2<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≥</span> <span class=numeral>3</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>nat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>=</span> <span class=free>x</span> <span class=main>-</span> <span class=numeral>3</span>›</span></span>
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>=</span> <span class=skolem>m</span> <span class=main>+</span> <span class=numeral>3</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>+</span> <span class=numeral>3</span> <span class=main>&lt;</span> <span class=numeral>4</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>m</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>m</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=More_Divides><div class=head><h1>Theory More_Divides</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Lemmas on division›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Divides
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>declare</span></span> div_eq_dividend_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> int_div_same_is_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=main>⟷</span> <span class=free>b</span> <span class=main>=</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>a</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> div_by_1 abs_ge_zero abs_of_pos int_div_less_self neq_iff
            nonneg1_imp_zdiv_pos_iff zabs_less_one_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_div_minus_is_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>=</span> <span class=main>-</span> <span class=free>a</span> <span class=main>⟷</span> <span class=free>b</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&gt;</span> <span class=free>a</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> div_minus_right equation_minus_iff int_div_same_is_1 neg_0_less_iff_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_div_eq_Suc_0_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> Suc <span class=main>0</span> <span class=main>⟷</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>using</span></span> div_greater_zero_iff <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def div_greater_zero_iff dividend_less_div_times mult.right_neutral mult_Suc mult_numeral_1 numeral_2_eq_2 zero_less_numeral<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_nat_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> diff_mod_le<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span> <span class=main>-</span> <span class=free>b</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>&lt;</span> <span class=free>d</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=keyword1>dvd</span> <span class=free>d</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>d</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> minus_mod_eq_mult_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dvd_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>≤</span> <span class=improper>k</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=improper>k</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq_le <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=improper>k</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>b</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> div_mult_self1_is_m<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> le_less_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> div_times_less_eq_dividend<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span><span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=improper>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>erule</span> le_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mult_distrib2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> one_mod_exp_eq_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> power_gt1 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> mod_pos_pos_trivial<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_mod_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mod_pos_pos_trivial<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> <span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> subst<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> int_mod_ge'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>+</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_less_same_cancel2 int_mod_ge mod_add_self2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_mod_le'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>-</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>-</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> minus_mod_self2 zmod_le_nonneg_dividend<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> emep1<span class=main>:</span> <span class=quoted><span class=quoted>"even <span class=free>n</span> <span class=main>⟹</span> even <span class=free>d</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>d</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>d</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=free>d</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span> <span class=free>d</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> pos_zmod_mult_2 add.commute dvd_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> m1mod2k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>1</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> zmod_minus1<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sb_inc_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>k</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> int_mod_ge' <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sb_inc_lem'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>k</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>k</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> sb_inc_lem<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sb_dec_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=main>+</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=main>+</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> int_mod_le'<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>Suc <span class=free>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sb_dec_lem'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span> <span class=main>+</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> sb_dec_lem<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> mod_2_neq_1_eq_eq_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>⟷</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> not_mod_2_eq_1_eq_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> z1pmod2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>b</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> p1mod22k'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pos_zmod_mult_2<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> p1mod22k<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>b</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> p1mod22k' add.commute<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> pos_mod_sign2<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> pos_mod_bound2<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>&lt;</span> <span class=numeral>2</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nmod2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> eme1p<span class=main>:</span>
  <span class=quoted><span class=quoted>"even <span class=free>n</span> <span class=main>⟹</span> even <span class=free>d</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>d</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>d</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>d</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span> <span class=free>d</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> emep1 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>d</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> m1mod22k<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>1</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_minus1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> z1pdiv2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>b</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> zdiv_le_dividend<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> div_by_1 int_one_le_iff_zero_less zdiv_mono2 zero_less_one<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> axxmod2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>x</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=main>0</span> <span class=main>+</span> <span class=free>x</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> axxdiv2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>x</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>0</span> <span class=main>+</span> <span class=free>x</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemmas</span></span> rdmods <span class=main>=</span>
  mod_minus_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_diff_left_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_diff_right_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_add_left_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_add_right_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_mult_right_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_mult_left_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> mod_plus_right<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>m</span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_Suc<span class=main><span class=keyword3>,</span></span> <span class=operator>arith</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_minus_mod<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> nat_minus_mod_plus_right <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> nat_minus_mod mod_0 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>,</span>
    <span class=operator>THEN</span> mod_plus_right <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> push_mods' <span class=main>=</span> mod_add_eq
  mod_mult_eq mod_diff_eq
  mod_minus_eq

<span class=keyword1><span class=command>lemmas</span></span> push_mods <span class=main>=</span> push_mods' <span class=main>[</span><span class=operator>THEN</span> eq_reflection<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> pull_mods <span class=main>=</span> push_mods <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> rdmods <span class=main>[</span><span class=operator>THEN</span> eq_reflection<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> nat_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> nat_mod_eq' <span class=main>=</span> refl <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main>[</span></span>2<span class=main><span class=main>]</span></span> nat_mod_eq<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> nat_mod_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> nat_mod_eq'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> mod_less_divisor<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mod_nat_add<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>z</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>z</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>z</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=keyword1>else</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>-</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_mod_eq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_mod_geq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_mod_eq'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mod_nat_sub<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>z</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=main>-</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat_mod_eq'<span class=main>)</span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> int_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mod_pos_pos_trivial<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> zmde<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>b</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span><span class=main>{</span>group_add<span class=main>,</span>semiring_modulo<span class=main>}</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> mult_div_mod_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_diff_eq<span class=main>)</span>

<span class=comment1>(* already have this for naturals, div_mult_self1/2, but not for ints *)</span>
<span class=keyword1><span class=command>lemma</span></span> zdiv_mult_self<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>m</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> mod_power_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&gt;</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_eq_0_iff_dvd le_imp_power_dvd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nonneg_mod_div<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>b</span><span class=main>)</span> <span class=main>∧</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> pos_imp_zdiv_nonneg_iff <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mod_exp_less_eq_exp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pos_mod_bound<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> div_mult_le<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>*</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> div_times_less_eq_dividend<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> power_sub<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     av<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> nat_mult_eq_cancel1 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>using</span></span> av <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword1><span class=command>from</span></span> lt <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> mv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=skolem>q</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>*</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span>  div_mult_mod_eq <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mod_eq_0_iff_dvd<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> dvd_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> exI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>a</span></span></span> <span class=main><span class=main><span class=main>^</span></span></span> <span class=skolem><span class=skolem><span class=skolem>q</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
      <span class=main>(</span><span class=operator>subst</span> power_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mv<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> refl<span class=main>)</span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>*</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>a</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> lt
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> mod_lemma<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[|</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>c</span><span class=main>;</span> <span class=free>r</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>|]</span> <span class=main>==&gt;</span> <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>q</span> <span class=keyword1>mod</span> <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=free>r</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> m <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>q</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>c</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> mod_less_divisor<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> m <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=keyword1>mod</span> <span class=free>c</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> less_imp_Suc_add<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> P <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>%</span><span class=bound>x</span><span class=main>.</span> <span class=skolem>lhs</span> <span class=main>&lt;</span> <span class=skolem>rhs</span> <span class=bound>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=skolem>lhs</span> <span class=skolem>rhs</span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ssubst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_mult_distrib2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_two_pow_divD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>⟧</span>
    <span class=main>⟹</span> <span class=free>n</span> <span class=main>≥</span> <span class=free>m</span> <span class=main>∧</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> context_conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_strict_increasing<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_sub<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_two_pow_divI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_sub<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> m2pths <span class=main>=</span> pos_mod_sign mod_exp_less_eq_exp

<span class=keyword1><span class=command>lemmas</span></span> int_mod_eq' <span class=main>=</span> mod_pos_pos_trivial <span class=comment1>(* FIXME delete *)</span>

<span class=keyword1><span class=command>lemmas</span></span> int_mod_le <span class=main>=</span> zmod_le_nonneg_dividend <span class=comment1>(* FIXME: delete *)</span>

<span class=keyword1><span class=command>lemma</span></span> power_mod_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?LHS</span> <span class=main>=</span> <span class=var>?RHS</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?LHS</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_less<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=var>?RHS</span>"</span></span> <span class=keyword1><span class=command>using</span></span> True
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_imp_Suc_add<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>+</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add mod_mult2_eq<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?LHS</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_add1_eq<span class=main>)</span>

  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=var>?RHS</span>"</span></span> <span class=keyword1><span class=command>using</span></span> nv
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> mod_mod_power<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=numeral><span class=numeral>2</span></span> <span class=main><span class=main>^</span></span> <span class=free><span class=free>n</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>mod</span>  <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> True <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> md<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=skolem>d</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_imp_add_positive<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>+</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_mult2_eq power_add<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_left_eq<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> False
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> mod_div_equality_div_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>*</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> zmod_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>+</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=main>+</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute mod_add_right_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_div_sub_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>≥</span> <span class=main>1</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_cancel_right<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> left_diff_distrib <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_div_equality_div_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dvd_eq_mod_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_minus1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> diff_add_cancel<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_add_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_pos_pos_trivial<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add_0_right<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_mono<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> zmod_helper<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>m</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> zless_imp_add1_zle<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> power_minus_is_div<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>^</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> le_SucE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>Suc_diff_le le_iff_add power_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> two_pow_div_gt_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> less_two_pow_divD<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_gal_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_mult_imp_div_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> div_le_mono div_mult_self_is_m leD leI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> td_gal<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span>  <span class=main>⟷</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>c</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> not_le td_gal_lt<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=More_Word><div class=head><h1>Theory More_Word</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Lemmas on words›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Word
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=More_Arithmetic.html>More_Arithmetic</a>
    <a href=More_Divides.html>More_Divides</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_power_lower <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unat_p2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> unat_power_lower<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_div_lt_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_div_eq_1_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>≥</span> <span class=free>m</span> <span class=main>∧</span> unat <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>*</span> unat <span class=main>(</span><span class=free>m</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_arith_nat_defs word_le_nat_alt word_of_nat_eq_iff <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> nat_div_eq_Suc_0_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> unat_div unsigned_take_bit_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_power<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>shiftl1 <span class=main>^^</span> <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span> <span class=main>*</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl1_2t<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> AND_twice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>m</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> and.right_idem<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_combine_masks<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=free>m</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=free>m'</span> <span class=main>=</span> <span class=free>z'</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>m</span> <span class=keyword1>OR</span> <span class=free>m'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=keyword1>OR</span> <span class=free>z'</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=free>m</span> <span class=free>m'</span> <span class=free>z</span> <span class=free>z'</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit.conj_disj_distrib<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> p2_gt_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_gt_0 not_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> uint_2p_alt<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> uint <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> p2_gt_0 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tvar>?'a</span> <span class=main><span class=main>=</span></span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> p2_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> exp_eq_zero_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> p2len<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_is_div<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> push_bit_eq_mult drop_bit_eq_div<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_is_div'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>w</span> <span class=keyword1>div</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> neg_mask_is_div<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_arith<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> word_size <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> push_bit_eq_mult drop_bit_eq_div<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_arith'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> and_mask_arith<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_2pm1<span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> add_mask_fold<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_mask_le_2pm1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_2pm1<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_and_le1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_AND_less_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>⟹</span> <span class=free>u</span> <span class=keyword1>AND</span> <span class=free>v</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>u</span> <span class=free>v</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> le_shiftr1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹shiftr1 <span class=free>u</span> <span class=main>≤</span> shiftr1 <span class=free>v</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≤</span> <span class=free>v</span>›</span></span>
<span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=skolem>l</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>k</span> <span class=main>≤</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>l</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>drop_bit <span class=main>1</span> <span class=main>(</span>take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span>
    <span class=main>≤</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>drop_bit <span class=main>1</span> <span class=main>(</span>take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>l</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit min_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_eq_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>k</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>
    <span class=main>≤</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>l</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_eq_div<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_eq_iff_le_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>≤</span> mask <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le min_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_exp_minus_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> take_bit_int_less_exp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> min_def nat_less_le take_bit_int_eq_self_iff take_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_eq_mask_iff_take_bit_eq_self<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟷</span> take_bit <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_mask_eq_iff_le_mask take_bit_eq_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> NOT_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> x <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_add_not<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> add.commute <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> eq_diff_eq <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> NOT_mask<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> NOT_eq mask_2pm1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_m1_iff_lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>uint_arith</span>

<span class=keyword1><span class=command>lemma</span></span> gt0_iff_gem1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=free>x</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral diff_add_cancel less_irrefl measure_unat unat_arith_simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> word_neq_0_conv word_sub_less_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> power_2_ge_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> gt0_iff_gem1 p2_gt_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> le_mask_iff_lt_2n<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mask_2pm1 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> p2_gt_0 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> sym<span class=main><span class=main>]</span></span> le_m1_iff_lt<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_lt_2pn<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> mask <span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_exp_minus_1 power_2_ge_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_unat_power<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_mono_maybe<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> xlt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> of_nat <span class=free>y</span> <span class=main>&lt;</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ xlt<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less <span class=main><span class=main>[</span></span><span class=operator>OF</span> xlt<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_and_max_word<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> max_word <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_full_mask_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=skolem>n</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> Bit_Operations.mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=skolem>n</span> <span class=main>⟷</span> bit <span class=free>x</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_and_iff bit_mask_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> of_int_uint<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_int <span class=main>(</span>uint <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> word_of_int_uint<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> word_plus_and_or_coroll<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_plus_and_or<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> word_plus_and_or_coroll2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>w</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bit.conj_disj_distrib<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹nat <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> mask <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_eq_iff of_nat_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹unat <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> mask <span class=main>(</span>min <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_mono_left<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>y</span> <span class=main>≤</span> <span class=free>z</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>z</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>+</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>+</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> less_Suc_unat_less_bound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> Suc <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> order_less_le_trans <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Suc_leI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> up_ucast_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> ucast_up_inj <span class=main>=</span> up_ucast_inj

<span class=keyword1><span class=command>lemma</span></span> up_ucast_inj_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> up_ucast_inj<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> no_plus_overflow_neg<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=main>-</span><span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_minus_eq_add less_imp_le sub_wrap_lt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>::</span><span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>;</span>
     <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'c</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=free>x</span> <span class=main>=</span> ucast <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'c</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_0_I<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_offset_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> yv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     mnv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    xv'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     mn<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> mn<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> mnv mn <span class=keyword1><span class=command>have</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> mv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> uy<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> yv<span class=main><span class=main>]</span></span> order_eq_refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
        <span class=operator>rule</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> ux<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> xv<span class=main><span class=main>]</span></span> order_eq_refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
        <span class=operator>rule</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> mv<span class=main><span class=main>]</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> ux uy nv mnv xv'
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> xv'<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_add_offset_less<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mn<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mn mnv<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> nat_add_offset_less<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_less_power_trans<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     mv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> nv kv mv
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=tfree><span class=quoted><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> unat_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span>  word_less_power_trans2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> word_less_power_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Suc_unat_diff_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> unat <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> y <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> unat_1 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
        <span class=operator>rule</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> word_le_nat_alt lt<span class=main><span class=main>]</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> unat_sub <span class=main><span class=main>[</span></span><span class=operator>OF</span> lt<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span>  unat_1<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_eq_unatI<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>v</span> <span class=main>=</span> <span class=free>w</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹unat <span class=free>v</span> <span class=main>=</span> unat <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_div_sub<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> yx<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     y0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eq_unatI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_sub <span class=main><span class=main>[</span></span><span class=operator>OF</span> yx<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_sub<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_le_nat_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_div<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> le_div_geq<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> y0<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_le_nat_alt <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> yx<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> le_div_geq <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> word_le_nat_alt yx<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> y0<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_less_mono1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ij<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    knz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> ij ujk knz <span class=keyword1><span class=command>have</span></span> jk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_less_subst2 <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> mult_less_mono1<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> ujk knz ij
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_less_dest<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ij<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> uik ujk ij
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> mult_less_mono1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_less_cancel<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> knz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iffI <span class=main><span class=main>[</span></span><span class=operator>OF</span> word_mult_less_dest <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ uik ujk<span class=main><span class=main>]</span></span> word_mult_less_mono1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ knz ujk<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Suc_div_unat_helper<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>   usszv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>us</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>sz</span> <span class=main>-</span> <span class=free>us</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>note</span></span> usv <span class=main>=</span> order_le_less_trans <span class=main>[</span><span class=operator>OF</span> usszv szv<span class=main>]</span>

  <span class=keyword1><span class=command>from</span></span> usszv <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> qv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=free>us</span> <span class=main>+</span> <span class=skolem>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>unat <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span> <span class=main>+</span> unat <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_div unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> usv<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> div_add_self1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span>"</span></span> <span class=keyword1><span class=command>using</span></span> szv
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_minus_one<span class=main>)</span>

  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> qv<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> div_mult_self2<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>sz</span> <span class=main>-</span> <span class=free>us</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> qv <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> enum_word_nth_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>Enum.enum <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word list<span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> word_of_nat <span class=free>n</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_enum_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹length <span class=main>(</span>Enum.enum <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word list<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_lt2p <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹unat <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_unat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"of_nat <span class=main>∘</span> unat <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Suc_unat_minus_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> Suc <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_diff_1 unat_gt_0 unat_minus_one<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_le_dest<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> uik ujk le
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_add_lem<span class=main><span class=main>]</span></span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> add_le_mono1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_le_mono1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ij<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> ij ujk <span class=keyword1><span class=command>have</span></span> jk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> order_le_less_subst2 <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> add_le_mono1<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> ujk ij
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_add_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_le_mono2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>i</span> <span class=main>≤</span> <span class=free>j</span><span class=main>;</span> unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>+</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>+</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_add_le_mono1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_le_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>≤</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_add_le_mono1<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_add_le_dest<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_less_mono1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ij<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> ij ujk <span class=keyword1><span class=command>have</span></span> jk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> order_le_less_subst2 <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> add_less_mono1<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> ujk ij
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_add_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_less_dest<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> uik ujk le
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_add_lem<span class=main><span class=main>]</span></span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> add_less_mono1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_less_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_add_less_mono1<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_add_less_dest<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_less_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> knz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_mult_less_cancel<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_imp_diff_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> unat_sub word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_imp_diff_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> unat_sub word_less_nat_alt
             <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> less_imp_diff_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_le_mono1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ij<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    knz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> ij ujk knz <span class=keyword1><span class=command>have</span></span> jk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> order_le_less_subst2 <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> mult_le_mono1<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> ujk knz ij
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_le_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> knz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     uik<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>i</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ujk<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>j</span> <span class=main>*</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>i</span> <span class=main>≤</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_mult_le_mono1<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> unat <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> knz <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>using</span></span> p
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem uik<span class=main><span class=main>]</span></span>
      iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem ujk<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_diff_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_sub<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_increasing<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p</span> <span class=main>+</span> <span class=free>w</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>p</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> <span class=free>w</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_random<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> <span class=free>x'</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_sub_mono<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span><span class=main>;</span> <span class=free>d</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=free>c</span> <span class=main>-</span> <span class=free>d</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟧</span>
    <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>d</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> power_not_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> p2_gt_0 word_neq_0_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_gt_a_gt_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_neq_0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_power_less_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_minus_one<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sub_1_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> no_ulen_sub<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"uint <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_0_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> uint_ge_0<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> push_bit_word_eq_nonzero<span class=main>:</span>
  <span class=quoted><span class=quoted>‹push_bit <span class=free>n</span> <span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_neq_0_conv word_less_nat_alt
                    mod_0 unat_word_ariths
                    unat_power_lower word_le_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add_diff_cancel_right' gr0I gr_implies_not0 less_or_eq_imp_le min_def push_bit_eq_0_iff take_bit_nat_eq_self_iff take_bit_push_bit take_bit_take_bit unsigned_push_bit_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_power<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     kv<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> szv unat_mono <span class=main>[</span><span class=operator>OF</span> kv<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unat_mult_power_lem<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=free>sz</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> of_nat <span class=free>k</span> <span class=main>::</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths take_bit_eq_mod <span class=dynamic><span class=dynamic>mod_simps</span></span><span class=main>)</span>
      <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_nat_eq_self_iff nat_less_power_trans <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_mcs_4<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>v</span> <span class=main>+</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>+</span> <span class=free>x</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>v</span> <span class=main>+</span> <span class=free>x</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>≤</span> <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>uint_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_mcs_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>v</span> <span class=main>≤</span> <span class=free>w</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>+</span> <span class=free>x</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>+</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>+</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_minus_one_leq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>metis</span> le_less_trans less_irrefl take_bit_decr_eq take_bit_nonnegative zle_diff1_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_sub_le<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> le_less_trans word_le_minus_one_leq nv power_2_ge_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_len<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> unat <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_nat_eq_self_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> unat <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> unat_of_nat_len<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_eq_of_nat<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> of_nat <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_of_nat nat_eq_iff take_bit_nat_eq_self_iff <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> sym<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_div_helper<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xk<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> of_nat <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>   anz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> of_nat <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> kn<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=free>k</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>*</span> unat <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> xk kv sz
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat_eq<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> unat <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=main>=</span> unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> unat <span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_mult_mod_eq<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≠</span> unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz anz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_arith_simps<span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz anz
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_eq_dividend<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_neq_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> div_mult_le<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> xk le <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> of_nat <span class=free>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> sz kv
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_mult_less_dest <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ kn<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> div_mult_le<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_out_sub_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>-</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> word_plus_and_or_coroll2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> subtract_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>-</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>-</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> word_plus_and_or_coroll2<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> take_bit_word_eq_self_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>‹take_bit <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>w</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> take_bit_int_eq_self_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span> <span class=quasi_keyword>fixing</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word_power_increasing<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>using</span></span> x
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> mask_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>m</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> plus_one_helper<span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt word_le_nat_alt <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unatSuc<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> plus_one_helper2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt word_le_nat_alt <span class=dynamic><span class=dynamic>field_simps</span></span>
                unatSuc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> less_x_plus_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> max_word <span class=main>⟹</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjCI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> plus_one_helper<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> plus_one_helper2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> order_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> max_word_wrap<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_Suc_leq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> max_word <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>+</span> <span class=main>1</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> less_x_plus_1 word_le_less_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word_Suc_le<span class=main>:</span>
   <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> max_word <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> not_less word_Suc_leq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_lessThan_Suc_atMost<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>{..&lt;</span> <span class=free>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>=</span> <span class=main>{..</span><span class=free>k</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lessThan_def atMost_def word_Suc_leq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_atLeastLessThan_Suc_atLeastAtMost<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=free>l</span> <span class=main>..&lt;</span> <span class=free>u</span> <span class=main>+</span> <span class=main>1</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>l</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeastAtMost_def atLeastLessThan_def word_lessThan_Suc_atMost<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_atLeastAtMost_Suc_greaterThanAtMost<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>m</span> <span class=main>+</span> <span class=main>1</span><span class=main>..</span><span class=free>u</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> greaterThanAtMost_def greaterThan_def atLeastAtMost_def atLeast_def word_Suc_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_atLeastLessThan_Suc_atLeastAtMost_union<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>l</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≠</span> max_word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≤</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>u</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>m</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=free>m</span><span class=main>+</span><span class=main>1</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> ivl_disj_un_two<span class=main>(</span>8<span class=main>)</span><span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>m</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>u</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_atLeastAtMost_Suc_greaterThanAtMost<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> max_word_less_eq_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> word_order.extremum_unique<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_or_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> or_eq_0_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_2p_mult_inc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> suc_n<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>^</span><span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> suc_n le_less_trans lessI nat_less_le nat_mult_less_cancel_disj p2_gt_0
          power_Suc power_Suc unat_power_lower word_less_nat_alt x<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> power_overflow<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> extra_sle_sless_unfolds <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span><span class=main>]</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span><span class=main>]</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span>
    word_sle_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span>
    word_sless_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span>

<span class=keyword1><span class=command>lemma</span></span> word_sint_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>-</span><span class=main>1</span> <span class=keyword1>else</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_of_nat<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span>
    <span class=main>⟹</span> ucast <span class=main>(</span>of_nat <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>n</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> scast_1'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>scast <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
   <span class=main>(</span>word_of_int <span class=main>(</span>signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> scast_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>scast <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>-</span><span class=main>1</span> <span class=keyword1>else</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_minus_one_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mask_eq_exp_minus_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_minus_one_eq_mask nat_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_diff_ls'' <span class=main>=</span> word_diff_ls <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xa<span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span></span></span> x<span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span></span></span> <span class=free><span class=free><span class=free><span class=free>x</span></span></span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word_diff_ls' <span class=main>=</span> word_diff_ls'' <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_l_diffs' <span class=main>=</span> word_l_diffs <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xa<span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span></span></span> x<span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span></span></span> <span class=free><span class=free><span class=free><span class=free>x</span></span></span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word_l_diffs <span class=main>=</span> word_l_diffs' <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> two_power_increasing<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_leq_le_minus_one<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt word_le_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_minus_one<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_eq_zero<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_combine<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>a</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=main>(</span>max <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=main>(</span>max <span class=free>n</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> multiple_mask_trivia<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"mask <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_plus_and_or_coroll2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bw_assocs word_bw_comms word_bw_lcs neg_mask_twice
                   max_absorb2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_of_nat_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> unat <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> of_nat <span class=free>n</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>n</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> min.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp not_less min_def  <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_sub_if_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_sub_if_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_over_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Suc_2p_unat_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> Suc <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> unat <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span><span class=main>+</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sint_of_nat_ge_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟹</span> sint <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_iff_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_eq_sint<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟹</span> sint <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> int <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> signed_take_bit_int_eq_self<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> negative_zle numeral_power_eq_of_nat_cancel_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_of_nat_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span>
   <span class=main>⟹</span> sint <span class=main>(</span>of_nat <span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> sint <span class=main>(</span>of_nat <span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_eq_if_positive<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_take_bit_iff nat_less_le order_less_le_trans take_bit_nat_eq_self_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_eq_if_positive<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_take_bit_iff nat_less_le take_bit_nat_eq_self_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> of_nat_take_bit <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_nat_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_le_not_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span><span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> less_is_non_zero_p1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> contrapos_pn<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> max_word_wrap<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_add_lem'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> unat_add_lem<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_two_pow_divI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> div_le_dividend<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_sub<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_less_two_pow_divD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=free>n</span> <span class=main>≥</span> <span class=free>m</span> <span class=main>∧</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_word_ariths<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> mod_less<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> div_le_dividend<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> less_two_pow_divD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_div_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow word_div_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_less_two_pow_div_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>}</span>
      <span class=main>=</span> of_nat <span class=main>`</span> <span class=main>{</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_less_two_pow_divD less_two_pow_divD
             <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_less_two_pow_divI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"unat <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_sub<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=tfree><span class=quoted><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> unat_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_unat_power<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_mono_maybe<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_strict_increasing<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
   <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_range_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>⟹</span>
   range <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> ucast_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"ucast <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_take_bit_iff less_mask_eq not_less take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_power_less_diff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>m</span><span class=main>;</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_power_less_diff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nat_less_power_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_less_sub_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> word_le_minus_one_leq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_sub_mono2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>+</span> <span class=free>d</span><span class=main>;</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>;</span> <span class=free>d</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>+</span> <span class=free>d</span> <span class=main>⟧</span>
    <span class=main>⟹</span> <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=free>d</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_sub_mono<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_not_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> word_subset_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>{</span><span class=free>x</span> <span class=main>..</span> <span class=free>x</span> <span class=main>+</span> <span class=free>r</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>y</span> <span class=main>..</span> <span class=free>y</span> <span class=main>+</span> <span class=free>s</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span><span class=main>;</span>
     <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>r</span> <span class=main>-</span> <span class=main>1</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>+</span> <span class=main>(</span><span class=free>s</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>;</span>
     <span class=free>s</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> subsetD<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> c<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> subsetD<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> c<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>x</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>r</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> add_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_sub_mono2<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> olen_add_eqv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_le_minus_cancel<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> uint_power_lower<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> uint <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> uint_2p_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> power_le_mono<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> uint_arith_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> uint_power_lower<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> two_power_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_antisym<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_le_mono<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> of_nat <span class=free>n</span> <span class=main>⟹</span> unat <span class=free>x</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_uint_less_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"nat <span class=main>(</span>uint <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> nat <span class=main>(</span>uint <span class=free>x</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_eq_nat_uint <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_eq_nat_uint <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_mono<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>of_nat <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> unat_of_nat_len<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> div_to_mult_word_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> <span class=free>y</span> <span class=keyword1>div</span> <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_neq_0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_mult_le_mono1<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_div<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> div_mult_le<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_div_mult_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>(</span>ucast <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=main>(</span>len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_len<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> ucast <span class=main>(</span>ucast <span class=free>x</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_ucast_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> less_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span> ucast <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ucast_up_ucast_id <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_up_def source_size_def target_size_def word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span> <span class=keyword1>mod</span> nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> nat_mod_distrib take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_less_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span>
   <span class=main>(</span>ucast <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt unat_ucast<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_lt2p<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_lt2p<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>― ‹This weaker version was previously called <span class=antiquoted><span class=antiquote>@{</span><span class=operator>text</span> <span class=raw_text>ucast_less_ucast</span><span class=antiquote>}</span></span>. We retain it to
    support existing proofs.›</span>
<span class=keyword1><span class=command>lemmas</span></span> ucast_less_ucast_weak <span class=main>=</span> ucast_less_ucast<span class=main>[</span><span class=operator>OF</span> order.strict_implies_order<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> unat_Suc2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> unatSuc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> eq_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minus_equation_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_div_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>div</span> <span class=main>1</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bits_div_by_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_minus_one_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> word_order.extremum_unique<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> up_scast_inj<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=main>⟦</span> scast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>y</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>;</span> size <span class=free>x</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span>
         <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> order_refl take_bit_signed_take_bit take_bit_tightened<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> up_scast_inj_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span>scast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> up_scast_inj <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_add<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> of_nat <span class=bound>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> exI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"unat <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>y</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=free><span class=free><span class=free>x</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_mcs_4'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>+</span> <span class=free>v</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>w</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>v</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>≤</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_mcs_4<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_eq_1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹unat <span class=free>x</span> <span class=main>=</span> Suc <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> unsigned_word_eqI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tvar>?'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted>nat</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_unat_Rep_inject1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹unat <span class=free>x</span> <span class=main>=</span> unat <span class=main>1</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_eq_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_not_mask_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span>max <span class=free>m</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_less_sub_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_imp_less_or_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_and_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=free>a</span> <span class=keyword1>AND</span> mask <span class=free>b</span> <span class=main>=</span> <span class=main>(</span>mask <span class=main>(</span>min <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq_0_eq_x<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>w</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_plus_and_or_coroll2<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq_x_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>w</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_plus_and_or_coroll2<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> compl_of_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> not_one<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> split_word_eq_on_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>m</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_FF_is_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>0xFF</span> <span class=main>=</span> <span class=main>(</span>mask <span class=numeral>8</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_1FF_is_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>0x1FF</span> <span class=main>=</span> <span class=main>(</span>mask <span class=numeral>9</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_of_nat_small<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_of_nat min_def not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> linorder_not_less min_def take_bit_nat_eq_self take_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_le_make_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>y</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> plus_one_helper2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> finite_word <span class=main>=</span> finite <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_to_1_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> word_leq_minus_one_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>y</span> <span class=main>≠</span> <span class=main>0</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> le_m1_iff_lt word_neq_0_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> word_count_from_top<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>{</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_le_minus_one_leq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjCI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_leq_minus_one_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_minus_one_le_leq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt word_le_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_minus_one<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_eq_zero<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_div_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_mono word_arith_nat_defs<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_must_wrap<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> dual_order.trans sub_wrap word_less_1 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> range_subset_card<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>{</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>..</span> <span class=free>b</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>c</span> <span class=main>..</span> <span class=free>d</span><span class=main>}</span><span class=main>;</span> <span class=free>b</span> <span class=main>≥</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>d</span> <span class=main>≥</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>d</span> <span class=main>-</span> <span class=free>c</span> <span class=main>≥</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_sub_le word_sub_mono <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> less_1_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> <span class=main>(</span><span class=free>m</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_power_mod_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_arith_nat_div unat_mod power_mod_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_arith_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_mod_power min.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_range_minus_1'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>&lt;..</span><span class=free>b</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> greaterThanAtMost_def atLeastAtMost_def greaterThan_def atLeast_def less_1_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_range_minus_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>..&lt;</span><span class=free>b</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeastLessThan_def atLeastAtMost_def atMost_def lessThan_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=main><span class=main>{</span></span><span class=free><span class=free>a</span></span><span class=main><span class=main>..}</span></span> <span class=main><span class=main>∩</span></span> <span class=bound><span class=bound>x</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>rule</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> contrapos_pp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less linorder_not_le word_must_wrap<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_le_minus_one_leq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_sub_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_nat_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_nat <span class=main>(</span>unat <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> overflow_plus_one_self<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>p</span> <span class=main>≤</span> <span class=free>p</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>rule</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> plus_one_helper2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> plus_1_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> plus_one_helper2<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> order_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> pos_mult_pos_ge<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[|</span><span class=free>x</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span><span class=main>;</span> <span class=free>n</span><span class=main>&gt;=</span><span class=main>0</span> <span class=main>|]</span> <span class=main>==&gt;</span> <span class=free>n</span> <span class=main>*</span> <span class=free>x</span> <span class=main>&gt;=</span> <span class=free>n</span><span class=main>*</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_left_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_strict_mono_right<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>y</span> <span class=main>&lt;</span> <span class=free>z</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>z</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_div_mult<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> classical<span class=main>)</span>
     <span class=main>(</span><span class=operator>use</span> div_to_mult_word_lt <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span></span></span><span class=main><span class=main>]</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span>
      <span class=quoted>‹<span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main>:</span> word_less_nat_alt word_le_nat_alt unat_div›</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_power_trans_ofnat<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> of_nat <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_less_power_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt less_le_trans take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_1_le_power<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inc_le<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> i<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> iffD2<span class=main><span class=main>[</span></span><span class=operator>OF</span> p2_gt_0<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_1_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> unat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> x_less_2_0_1'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>1</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add.right_neutral even_two_times_div_two mod_div_trivial mod_pos_pos_trivial mult.commute mult_zero_left not_less not_take_bit_negative odd_two_times_div_two_succ<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_add_le_iff2 <span class=main>=</span> word_add_le_iff <span class=main>[</span><span class=operator>folded</span> no_olen_add_nat<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_power<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> of_nat <span class=free>p</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_mono_maybe<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> power_strict_increasing<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_unat_power <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> of_nat_power<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_n_less_equal_power_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span>of_nat <span class=free>n</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> of_nat_power n_less_equal_power_2 of_nat_Suc power_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> eq_mask_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> eqm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>      sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> eqm<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> and_mask_less' <span class=main><span class=main>[</span></span><span class=operator>OF</span> sz<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_mono_maybe'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> xlt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ylt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>y</span> <span class=main>&lt;</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ylt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xlt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_mono_maybe_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>y</span> <span class=main>≤</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disj_cong<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_mono_maybe'<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>using</span></span> of_nat_inj <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_AND_NOT_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> AND_NOT_mask_plus_AND_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_eqI<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> m1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     m2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>=</span> <span class=skolem>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=keyword1>OR</span> <span class=skolem>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> assms * <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> * <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> neq_0_no_wrap<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword1><span class=command>lemma</span></span> unatSuc2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute unatSuc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_of_nat_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> unat <span class=free>x</span> <span class=main>⟹</span> of_nat <span class=free>n</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt unat_of_nat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_unat_less_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> of_nat <span class=free>b</span> <span class=main>⟹</span> unat <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_iff le_cases le_unat_uoi word_of_nat_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_Suc_0 <span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bool_mask'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_one_eq mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_add<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
    ucast <span class=main>(</span>ucast <span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> ucast <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> take_bit_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_bit_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> lt1_neq0<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>≤</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_one_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> lt1_neq0 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> olen_add_eqv <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_random<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lt1_neq0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sub_plus_one_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n'</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n'</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>n'</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> lt1_neq0 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> olen_add_eqv <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_random <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x' <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n'</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_sub_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lt1_neq0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_le_minus_mono_right<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>-</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>-</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_sub_mono<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_sub_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_sub_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_0_sle_from_less<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=keyword1>≤s</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_take_bit_iff min_def nat_less_le not_less_eq take_bit_int_eq_self_iff take_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_sub_ucast<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> T<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>-</span> ucast <span class=free>y</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> T
  <span class=keyword1><span class=command>have</span></span> P<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"unat <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_lt2p<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_arith_simps unat_ucast assms<span class=main><span class=main>[</span></span><span class=operator>simplified</span> unat_arith_simps<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_1_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>a</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> of_nat <span class=free>x</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> take_bit_incr_eq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_less_eq<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> take_bit_int_less_exp le_less_trans <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_less<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> unat <span class=free>b</span> <span class=main>=</span> <span class=free>c</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> of_nat <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_plus_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>+</span> <span class=free>n</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>+</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>+</span> <span class=free>a</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_plus<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>;</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> order_less_imp_le word_random<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sint_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> signed_take_bit_eq_iff_take_bit_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>x</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_eq_0_iff<span class=main>)</span>

<span class=comment1>(* It is not always that case that "sint 1 = 1", because of 1-bit word sizes.
 * This lemma produces the different cases. *)</span>
<span class=keyword1><span class=command>lemma</span></span> sint_1_cases<span class=main>:</span>
  <span class=quoted><span class=free>P</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>⟦</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>=</span> <span class=main>1</span><span class=main>;</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> sint <span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>›</span></span>
     <span class=quoted><span class=quoted>‹<span class=main>⟦</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span><span class=main>;</span> <span class=free>a</span> <span class=main>=</span> <span class=main>1</span><span class=main>;</span> sint <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>›</span></span>
     <span class=quoted><span class=quoted>‹<span class=main>⟦</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span><span class=main>;</span> sint <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>a</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>with</span></span> True that <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_le Suc_le_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_int_min<span class=main>:</span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_int_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_int_max_plus_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_of_int_2p <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> int_word_sint<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> uint_range'<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> uint <span class=free>x</span> <span class=main>∧</span> uint <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sint_of_int_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> sint <span class=main>(</span>of_int <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_int_eq_self<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_int_sint<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_int <span class=main>(</span>sint <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sint_ucast_eq_uint<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>¬</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>⟧</span>
            <span class=main>⟹</span> sint <span class=main>(</span><span class=main>(</span>ucast <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_less_nowrapI'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>-</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>uint_arith</span>

<span class=keyword1><span class=command>lemma</span></span> mask_plus_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_inj<span class=main>:</span> <span class=quoted><span class=quoted>"inj unat"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_iff injI word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_upcast<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_up <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word<span class=main>)</span>
      <span class=main>⟹</span> unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ucast_eq unat_eq_nat_uint
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_mono<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>(</span>ucast <span class=free>y</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> ucast_nat_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_mono_maybe<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_mono_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> ucast <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> ucast_nat_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> of_nat_mono_maybe_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_mono_le'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> unat <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟧</span>
   <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span>ucast <span class=free>y</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_less_nat_alt <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ucast_mono_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_add_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>OR</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mask_2pm1 <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_word<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>i</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>i</span> <span class=main>=</span> <span class=free>n</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>;</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_word_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≤</span>  <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>y</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> word_le_less_eq<span class=main><span class=keyword3>,</span></span>
      <span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span>
      <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_minus_one_leq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> NOT_mask_AND_mask<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp Parity.bit_eq_iff bit_and_iff bit_not_iff bit_mask_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_and_not<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>AND</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_bw_assocs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ex_mask_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>mask_eq_decr_exp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> not_switch<span class=main>:</span><span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=free>a</span> <span class=main>=</span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Signed_Words><div class=head><h1>Theory Signed_Words</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Signed Words"</span></span>

<span class=keyword1><span class=command>theory</span></span> Signed_Words
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Signed words as separate (isomorphic) word length class. Useful for tagging words in C.›</span></span>

<span class=keyword1><span class=command>typedef</span></span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span><span class=quoted>len0</span><span class=main>)</span> signed <span class=main>=</span> <span class=quoted><span class=quoted>"UNIV <span class=main>::</span> <span class=tfree>'a</span> set"</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>lemma</span></span> card_signed <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>CARD</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len0<span class=main>)</span> signed<span class=main>)</span> <span class=main>=</span> <span class=keyword1>CARD</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> type_definition.card <span class=main>[</span><span class=operator>OF</span> type_definition_signed<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>instantiation</span></span> signed <span class=main>::</span> <span class=main>(</span><span class=quoted>len0</span><span class=main>)</span> <span class=quoted>len0</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  len_signed <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"len_of <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len0 signed itself<span class=main>)</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>instance</span></span> signed <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>len</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro_classes</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_scast_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>scast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> signed word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>scast <span class=free>y</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_up scast_up_scast_id<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_scast_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span>scast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_signed_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_of_nat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_signed_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_signed_take_bit<span class=main>)</span> 

<span class=keyword1><span class=command>lemma</span></span> scast_eq_scast_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> scast <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ucast_scast_id<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_eq_ucast_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_ucast_id<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_norm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> scast <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span> <span class=main>=</span> ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> scast <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_ucast_id ucast_scast_id<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_2_power <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"scast <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>^</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_nat_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_nat <span class=main>(</span>unat <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>::</span> len<span class=main>)</span> signed word<span class=main>)</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> of_nat_unat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> zero_sle_ucast_up<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> signed word<span class=main>)</span> <span class=main>⟹</span>
          <span class=main>(</span><span class=main>0</span> <span class=keyword1>&lt;=s</span> <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> signed word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_ucast_sless<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
    <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>::</span> len<span class=main>)</span> signed word<span class=main>)</span> <span class=keyword1>&lt;s</span> ucast <span class=main>(</span><span class=free>y</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute mask_eq_exp_minus_1 mask_eq_take_bit_minus_one take_bit_incr_eq zle_add1_eq_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> zero_sle_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=keyword1>&lt;=s</span> <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> signed word<span class=main>)</span><span class=main>)</span>
                <span class=main>=</span> <span class=main>(</span>uint <span class=free>b</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc_from_most <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> disjunctive_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=tfree>'a</span> sword <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> signed word"</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Traditional_Infix_Syntax><div class=head><h1>Theory Traditional_Infix_Syntax</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson, NICTA *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Operation variants with traditional syntax›</span></span>

<span class=keyword1><span class=command>theory</span></span> Traditional_Infix_Syntax
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span> <a href=More_Word.html>More_Word</a> <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>class</span></span> semiring_bit_syntax <span class=main>=</span> semiring_bit_shifts
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>test_bit</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> bool›</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>!!</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> test_bit_eq_bit<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>test_bit</span> <span class=main>=</span> bit›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>shiftl</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span>›</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>&lt;&lt;</span>"</span> 55<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> shiftl_eq_push_bit<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main><span class=free>&lt;&lt;</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> push_bit <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span>›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>shiftr</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span>›</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>&gt;&gt;</span>"</span> 55<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> shiftr_eq_drop_bit<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main><span class=free>&gt;&gt;</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> drop_bit <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span>›</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>instance</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>semiring_bit_syntax</span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>includes</span></span> lifting_syntax
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_word_transfer <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>pcr_word <span class=main>===&gt;</span> <span class=main>(=)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=bound>k</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span>test_bit <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> test_bit_eq_bit<span class=main>)</span> <span class=operator>transfer_prover</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_word_transfer <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>pcr_word <span class=main>===&gt;</span> <span class=main>(=)</span> <span class=main>===&gt;</span> pcr_word<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span> <span class=bound>n</span><span class=main>.</span> push_bit <span class=bound>n</span> <span class=bound>k</span><span class=main>)</span> shiftl›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> shiftl_eq_push_bit<span class=main>)</span> <span class=operator>transfer_prover</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_word_transfer <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>pcr_word <span class=main>===&gt;</span> <span class=main>(=)</span> <span class=main>===&gt;</span> pcr_word<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span> <span class=bound>n</span><span class=main>.</span> <span class=main>(</span>drop_bit <span class=bound>n</span> <span class=main>∘</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=bound>k</span><span class=main>)</span> <span class=main>(</span>shiftr <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_eq_drop_bit<span class=main>)</span> <span class=operator>transfer_prover</span>

<span class=keyword2><span class=keyword>end</span></span>


<span class=keyword1><span class=command>lemma</span></span> test_bit_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹test_bit <span class=main>=</span> <span class=main>(</span>bit <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> test_bit_eq_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=free>w</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftl_eq_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> drop_bit <span class=free>n</span> <span class=free>w</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftr_eq_drop_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"test_bit <span class=free>u</span> <span class=main>=</span> test_bit <span class=free>v</span> <span class=main>⟷</span> <span class=free>u</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>u</span> <span class=free>v</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff test_bit_eq_bit fun_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_size<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n</span></span><span class=main>&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>.</span> <span class=free>x</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=var>?P</span> <span class=main>⟷</span> <span class=var>?Q</span>›</span></span><span class=main>)</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_eqI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> size <span class=free>u</span> <span class=main>⟶</span> <span class=free>u</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>v</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>u</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>u</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size word_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_eqD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> <span class=free>v</span> <span class=main>⟹</span> <span class=free>u</span> <span class=main>!!</span> <span class=free>x</span> <span class=main>=</span> <span class=free>v</span> <span class=main>!!</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>u</span> <span class=free>v</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_bin'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> bit <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> test_bit_bin <span class=main>=</span> test_bit_bin' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_test_bit_def<span class=main>:</span>
  <span class=quoted><span class=quoted>‹test_bit <span class=free>a</span> <span class=main>=</span> bit <span class=main>(</span>uint <span class=free>a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> test_bit_def' <span class=main>=</span> word_test_bit_def <span class=main>[</span><span class=operator>THEN</span> fun_cong<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_test_bit_transfer <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>rel_fun pcr_word <span class=main>(</span>rel_fun <span class=main>(=)</span> <span class=main>(=)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=bound>x</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span>test_bit <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span> <span class=operator>transfer_prover</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_wi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_ops_nth_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>x</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>|</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>≠</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_or_iff bit_and_iff bit_xor_iff bit_not_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_ao_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>|</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_or_iff bit_and_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> msb0 <span class=main>=</span> len_gt_0 <span class=main>[</span><span class=operator>THEN</span> diff_Suc_less<span class=main>,</span> <span class=operator>THEN</span> word_ops_nth_size <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> word_size<span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> msb1 <span class=main>=</span> msb0 <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> i <span class=main><span class=main>=</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span>
    <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> int<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>rule</span> refl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_neg_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span>
    <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span> <span class=main>::</span> int<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>rule</span> refl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_1 <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_1_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nth_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl1_code <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹shiftl1 <span class=free>w</span> <span class=main>=</span> push_bit <span class=main>1</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> uint_shiftr_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹uint <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> drop_bit_eq_div <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit min_def le_less less_diff_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_code <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹shiftr1 <span class=free>w</span> <span class=main>=</span> drop_bit <span class=main>1</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_def<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>shiftl1 <span class=main>^^</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹push_bit <span class=skolem>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>(*)</span> <span class=numeral>2</span> <span class=main>^^</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>::</span> int <span class=main>⇒</span> int<span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>n</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff funpow_swap1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_def<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>shiftr1 <span class=main>^^</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹shiftr1 <span class=main>^^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>drop_bit <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> shiftr1_eq_div_2 <span class=main><span class=main>[</span></span><span class=operator>abs_def</span><span class=main><span class=main>]</span></span> drop_bit_eq_div <span class=main><span class=main>[</span></span><span class=operator>abs_def</span><span class=main><span class=main>]</span></span> funpow_Suc_right<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>use</span> div_exp_eq <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span><span class=main><span class=main>,</span></span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tvar>?'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted>‹<span class=tfree><span class=tfree>'a</span></span> word›</span></span></span><span class=main><span class=main>]</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bit_shiftl_word_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_word_eq bit_push_bit_iff not_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bit_shiftr_word_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_word_eq bit_drop_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> sshiftr <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>‹<span class=keyword1>&gt;&gt;&gt;</span>›</span> 55<span class=main>)</span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span> <span class=bound>n</span><span class=main>.</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>drop_bit <span class=bound>n</span> <span class=main>(</span>signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> signed_take_bit_decr_length_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_eq <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> signed_drop_bit <span class=free>n</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_eq_funpow_sshiftr1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>sshiftr1 <span class=main>^^</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sshiftr1_eq_signed_drop_bit_Suc_0 sshiftr_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> uint_sshiftr_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹uint <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>sint <span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span>  <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> drop_bit_eq_div<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sshift1_code <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹sshiftr1 <span class=free>w</span> <span class=main>=</span> signed_drop_bit <span class=main>1</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_n1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bit_sshiftr_word_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=main>(</span><span class=keyword1>if</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>then</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff bit_drop_bit_eq bit_signed_take_bit_iff min_def not_le <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_sshiftr <span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span> <span class=main>≥</span> size <span class=free>w</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff bit_drop_bit_eq bit_signed_take_bit_iff min_def not_le <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>numeral <span class=free>k</span> <span class=main>&gt;&gt;&gt;</span> numeral <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    word_of_int <span class=main>(</span>drop_bit <span class=main>(</span>numeral <span class=free>n</span><span class=main>)</span> <span class=main>(</span>signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size bit_drop_bit_eq nth_sshiftr bit_signed_take_bit_iff min_def not_le not_less less_Suc_eq_le <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>setup</span></span> <span class=quoted>‹
  Context.theory_map <span class=main>(</span>fold <span class=entity>SMT_Word.add_word_shift'</span> <span class=main>[</span>
    <span class=main>(</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹shiftl <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span>›</span></span><span class=main>,</span> <span class=inner_quoted>"bvshl"</span><span class=main>)</span><span class=main>,</span>
    <span class=main>(</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹shiftr <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span>›</span></span><span class=main>,</span> <span class=inner_quoted>"bvlshr"</span><span class=main>)</span><span class=main>,</span>
    <span class=main>(</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹sshiftr <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=main>_</span>›</span></span><span class=main>,</span> <span class=inner_quoted>"bvashr"</span><span class=main>)</span>
  <span class=main>]</span><span class=main>)</span>
›</span>

<span class=keyword1><span class=command>lemma</span></span> revcast_down_us <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>rc</span> <span class=main>=</span> revcast <span class=main>⟹</span> source_size <span class=free>rc</span> <span class=main>=</span> target_size <span class=free>rc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=free>w</span> <span class=main>=</span> ucast <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_ucast_iff bit_sshiftr_word_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> revcast_down_ss <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>rc</span> <span class=main>=</span> revcast <span class=main>⟹</span> source_size <span class=free>rc</span> <span class=main>=</span> target_size <span class=free>rc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=free>w</span> <span class=main>=</span> scast <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_word_scast_iff bit_sshiftr_word_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_div_2n<span class=main>:</span> <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> sint <span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> sint_signed_drop_bit_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_eq_div sshiftr_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> lsb0 <span class=main>=</span> len_gt_0 <span class=main>[</span><span class=operator>THEN</span> word_ops_nth_size <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> word_size<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> nth_sint<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>≡</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bit <span class=main>(</span>sint <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>l</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>l</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sint_uint l_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bit_signed_take_bit_iff word_test_bit_def not_less min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_2p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_exp_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_w2p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_exp_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bang_is_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xtrans<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> y <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> le_word_or2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_ao_nth nth_w2p word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_exp_minus_1 push_bit_of_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nth_shiftl1<span class=main>:</span> <span class=quoted><span class=quoted>"shiftl1 <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_double_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_shiftl'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&gt;=</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_push_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> nth_shiftl <span class=main>=</span> nth_shiftl' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> nth_shiftr1<span class=main>:</span> <span class=quoted><span class=quoted>"shiftr1 <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> Suc <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=quoted>"<span class=free>m</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_shiftr1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_sshiftr1<span class=main>:</span> <span class=quoted><span class=quoted>"sshiftr1 <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> size <span class=free>w</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff bit_signed_take_bit_iff min_def <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>using</span></span> le_less_Suc_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_div_2n<span class=main>:</span> <span class=quoted><span class=quoted>"uint <span class=main>(</span>shiftr <span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> uint_shiftr_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_rev<span class=main>:</span> <span class=quoted><span class=quoted>"shiftl <span class=free>w</span> <span class=free>n</span> <span class=main>=</span> word_reverse <span class=main>(</span>shiftr <span class=main>(</span>word_reverse <span class=free>w</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_def shiftr_def shiftl1_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rev_shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"word_reverse <span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> word_reverse <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_rev<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> word_reverse <span class=main>(</span>word_reverse <span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_shiftl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rev_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"word_reverse <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> word_reverse <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹numeral <span class=free>k</span> <span class=main>&lt;&lt;</span> numeral <span class=free>l</span> <span class=main>=</span> <span class=main>(</span>push_bit <span class=main>(</span>numeral <span class=free>l</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftl_word_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_zero_size<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_push_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_t2n<span class=main>:</span> <span class=quoted><span class=quoted>"shiftl <span class=free>w</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> shiftl_def shiftl1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>numeral <span class=free>k</span> <span class=main>&gt;&gt;</span> numeral <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> drop_bit <span class=main>(</span>numeral <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftr_word_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_numeral_Suc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>numeral <span class=free>k</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> drop_bit <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftr_word_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_bit_numeral_bit0_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹drop_bit <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span>word_of_int <span class=main>(</span>drop_bit <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>(</span>take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Word_eq_word_of_int drop_bit_word.abs_eq of_int_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>i</span> <span class=main>&lt;</span> size <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_word_eq word_size Word.bit_mask_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> slice_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"slice <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> ucast <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_slice_iff bit_ucast_iff bit_shiftr_word_iff <span class=dynamic><span class=dynamic>ac_simps</span></span>
    <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_slice<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>slice <span class=free>n</span> <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice_shiftr nth_ucast nth_shiftr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> revcast_down_uu <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>rc</span> <span class=main>=</span> revcast <span class=main>⟹</span> source_size <span class=free>rc</span> <span class=main>=</span> target_size <span class=free>rc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=free>w</span> <span class=main>=</span> ucast <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_ucast_iff bit_shiftr_word_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> revcast_down_su <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>rc</span> <span class=main>=</span> revcast <span class=main>⟹</span> source_size <span class=free>rc</span> <span class=main>=</span> target_size <span class=free>rc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=free>w</span> <span class=main>=</span> scast <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_word_scast_iff bit_shiftr_word_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> cast_down_rev <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>uc</span> <span class=main>=</span> ucast <span class=main>⟹</span> source_size <span class=free>uc</span> <span class=main>=</span> target_size <span class=free>uc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>uc</span> <span class=free>w</span> <span class=main>=</span> revcast <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_word_ucast_iff bit_shiftl_word_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> revcast_up <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>rc</span> <span class=main>=</span> revcast <span class=main>⟹</span> source_size <span class=free>rc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>=</span> target_size <span class=free>rc</span> <span class=main>⟹</span>
    <span class=free>rc</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> source_size_def target_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_revcast_iff bit_word_ucast_iff bit_shiftl_word_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add_diff_cancel_right<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> diff_add_inverse2 diff_diff_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> rc1 <span class=main>=</span> revcast_up <span class=main>[</span><span class=operator>THEN</span>
  revcast_rev_ucast <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> trans<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> word_rev_gal<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rc2 <span class=main>=</span> revcast_down_uu <span class=main>[</span><span class=operator>THEN</span>
  revcast_rev_ucast <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> trans<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> word_rev_gal<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> ucast_up <span class=main>=</span>
  rc1 <span class=main>[</span><span class=operator>simplified</span> rev_shiftr <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> revcast_ucast <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> ucast_down <span class=main>=</span>
  rc2 <span class=main>[</span><span class=operator>simplified</span> rev_shiftr revcast_ucast <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=comment1>― ‹problem posed by TPHOLs referee:
      criterion for overflow of addition of signed integers›</span>

<span class=keyword1><span class=command>lemma</span></span> sofl_test<span class=main>:</span>
  <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span>
    <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>(</span>size <span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> n<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> Suc <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=skolem>n</span> <span class=main>&gt;</span> signed_take_bit <span class=skolem>n</span> <span class=main>(</span>sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span><span class=main>)</span> <span class=main>⟹</span> sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span> <span class=main>≥</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=skolem>n</span><span class=main>)</span>›</span></span>
    <span class=quoted><span class=quoted>‹signed_take_bit <span class=skolem>n</span> <span class=main>(</span>sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span><span class=main>)</span> <span class=main>&gt;</span> sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=skolem>n</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>n</span> <span class=main>&gt;</span> sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> signed_take_bit_int_greater_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span>›</span></span> <span class=quoted><span class=skolem>n</span></span><span class=main>]</span> signed_take_bit_int_less_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>n</span></span> <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span>
    <span class=main>(</span>sint <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> sint <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span>
    <span class=main>(</span>sint <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> sint <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> sint_less <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> sint_greater_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> sint_less <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> sint_greater_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    signed_take_bit_int_eq_self <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=quoted><span class=quoted>‹sint <span class=free>x</span> <span class=main>+</span> sint <span class=free>y</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> sint_word_ariths<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_int_eq_self<span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 4
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_int_eq_self<span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 7
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_int_eq_self<span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 10
             <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_int_eq_self<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_int_eq_self signed_take_bit_eq_take_bit_minus take_bit_Suc_from_most n not_less <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> One_nat_def word_size shiftr_word_eq drop_bit_eq_zero_iff_not_bit_last bit_and_iff bit_xor_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_last_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_zero_size<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_shiftr <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> test_bit_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_cat <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>wc</span> <span class=main>=</span> word_cat <span class=free>a</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>wc</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> size <span class=free>wc</span> <span class=main>∧</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>b</span> <span class=keyword1>then</span> <span class=free>b</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>a</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> size <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size not_less<span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_concat_bit_iff bit_take_bit_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>― ‹keep quantifiers for use in simplification›</span>
<span class=keyword1><span class=command>lemma</span></span> test_bit_split'<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_split <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟶</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>n</span> <span class=bound>m</span><span class=main>.</span>
      <span class=free>b</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>=</span> <span class=main>(</span><span class=bound>n</span> <span class=main>&lt;</span> size <span class=free>b</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>∧</span>
      <span class=free>a</span> <span class=main>!!</span> <span class=bound>m</span> <span class=main>=</span> <span class=main>(</span><span class=bound>m</span> <span class=main>&lt;</span> size <span class=free>a</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=main>(</span><span class=bound>m</span> <span class=main>+</span> size <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_split_bin' test_bit_bin bit_unsigned_iff word_size bit_drop_bit_eq <span class=dynamic><span class=dynamic>ac_simps</span></span>
           <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_split <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>.</span> <span class=free>b</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>⟷</span> <span class=bound>n</span> <span class=main>&lt;</span> size <span class=free>b</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>::</span>nat<span class=main>.</span> <span class=free>a</span> <span class=main>!!</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=bound>m</span> <span class=main>&lt;</span> size <span class=free>a</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=main>(</span><span class=bound>m</span> <span class=main>+</span> size <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_split'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_split_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_split <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟷</span>
    <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>.</span> <span class=free>b</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>=</span> <span class=main>(</span><span class=bound>n</span> <span class=main>&lt;</span> size <span class=free>b</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span>
     <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>::</span>nat<span class=main>.</span> <span class=free>a</span> <span class=main>!!</span> <span class=bound>m</span> <span class=main>=</span> <span class=main>(</span><span class=bound>m</span> <span class=main>&lt;</span> size <span class=free>a</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>!!</span> <span class=main>(</span><span class=bound>m</span> <span class=main>+</span> size <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> conjI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> test_bit_split <span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct1<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> test_bit_split <span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct2<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"word_split <span class=free>c</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> test_bit_split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_eqI <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_rcat<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sw</span> <span class=main>=</span> size <span class=main>(</span>hd <span class=free>wl</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=main>=</span> word_rcat <span class=free>wl</span> <span class=main>⟹</span> <span class=free>rc</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> size <span class=free>rc</span> <span class=main>∧</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>sw</span> <span class=main>&lt;</span> size <span class=free>wl</span> <span class=main>∧</span> <span class=main>(</span>rev <span class=free>wl</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>sw</span><span class=main>)</span> <span class=main>!!</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=free>sw</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>wl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word list"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size word_rcat_def foldl_map rev_map bit_horner_sum_uint_exp_iff<span class=main>)</span>
    <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> test_bit_cong <span class=main>=</span> arg_cong <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"test_bit"</span></span><span class=main>,</span> <span class=operator>THEN</span> fun_cong<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> max_test_bit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>max_word<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> nth_minus1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_x_0 <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_x_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> shiftr_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_nth_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>(!!)</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> replicate <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>!!</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>_</span> word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_and_iff test_bit_eq_bit bit_1_iff <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> gr0I<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_1' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> shiftl_x_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_ops_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
  word_or_nth<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  word_and_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  word_xor_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>≠</span> <span class=free>y</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>x</span>"</span></span><span class=main><span class=keyword3>,</span></span>
      <span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> test_bit_size <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ops_nth_size word_size<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> and_not_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_ops_nth_size word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> nth_shiftr nth_shiftl<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_ops_nth_size word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> nth_shiftr nth_shiftl<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> nth_w2p_same<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> nth_w2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_div_2n_w<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>div</span> <span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_div_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_2p_alt word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> uint_shiftr_eq word_of_int_uint<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> le_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≤</span> <span class=free>v</span> <span class=main>⟹</span> <span class=free>u</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=free>n</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>v</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>n</span></span>"</span></span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> le_shiftr1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_mask_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;=</span> <span class=free>m</span> <span class=main>⟹</span> mask <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size nth_shiftr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹mask <span class=free>m</span> <span class=main>&gt;&gt;</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> shiftr_mask_le<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_leI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>n</span><span class=main>.</span>  <span class=main>⟦</span><span class=bound>n</span> <span class=main>&lt;</span> size <span class=main>(</span><span class=free>u</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=free>u</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>v</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>u</span> <span class=main>&lt;=</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xtrans<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_and_le2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_ao_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> asm_rl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> le_mask_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>≤</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_le_0_iff <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xtrans<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> le_shiftr<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_leI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=improper>n'</span> <span class=main>-</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_eqD<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> nth_shiftr word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;=</span> <span class=improper>n'</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_eq_iff_shiftr_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> test_bit_eq_iff <span class=main><span class=main>[</span></span><span class=operator>THEN</span> sym<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> ext<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_ao_nth nth_shiftr<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iffD2<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_ao_nth<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_size test_bit_bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add_diff_inverse_nat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_shiftl_decompose<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=free>m</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> mask <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_eqI <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> and_not_mask nth_shiftl nth_shiftr word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bang_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>!!</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> test_bit_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_over_and_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>AND</span> <span class=free>b</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_ao_nth nth_shiftl<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_over_and_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nth_shiftr word_ao_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_over_and_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>b</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nth_sshiftr word_ao_nth word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_over_or_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nth_shiftl word_ao_nth<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_over_or_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nth_shiftr word_ao_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sshiftr_over_or_dist<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>b</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>nth_sshiftr word_ao_nth word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> shift_over_ao_dists <span class=main>=</span>
  shiftl_over_or_dist shiftr_over_or_dist
  sshiftr_over_or_dist shiftl_over_and_dist
  shiftr_over_and_dist sshiftr_over_and_dist

<span class=keyword1><span class=command>lemma</span></span> shiftl_shiftl<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span> <span class=main>=</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>word_size nth_shiftl add.commute add.left_commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_shiftr<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>word_size nth_shiftr add.left_commute add.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_shiftr1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>nth_shiftr nth_shiftl word_size word_ao_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_shiftr2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>nth_shiftr nth_shiftl word_size word_ao_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_shiftl1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>nth_shiftr nth_shiftl word_size word_ops_nth_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_shiftl2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>nth_shiftr nth_shiftl word_size word_ops_nth_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> multi_shift_simps <span class=main>=</span>
  shiftl_shiftl shiftr_shiftr
  shiftl_shiftr1 shiftl_shiftr2
  shiftr_shiftl1 shiftr_shiftl2

<span class=keyword1><span class=command>lemma</span></span> shiftr_mask2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>m</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> mask <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_shiftr word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_shiftl_add_distrib<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n ring_distribs<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_and_iff bit_not_iff bit_shiftr_word_iff bit_mask_iff not_le<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> bit_imp_le_length <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_div_2n'<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> unat_eq_nat_uint<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftr_div_2n<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nat_div_distrib<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_power_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_shiftr_id<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eq_unatI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftr_div_2n'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> xv<span class=main><span class=main>]</span></span> order_eq_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_power_lower<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> nv<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_shiftl_eq_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> ucast <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_shift_nonzero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_neq_0_conv word_less_nat_alt
                    shiftl_t2n mod_0 unat_word_ariths
                    unat_power_lower word_le_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> mult_le_mono2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_strict_increasing<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_shiftr_lt<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftr_div_2n'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> drop_bit_eq_div <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_nat_eq drop_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_test_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_le nth_mask test_bit_bin word_ops_nth_size word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upper_bits_unset_is_l2p<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>p</span> <span class=main>!!</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>p</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=var>?P</span> <span class=main>⟷</span> <span class=var>?Q</span>›</span></span><span class=main>)</span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?Q</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> bang_is_le le_less_trans not_le word_power_increasing<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=free>n</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span>take_bit <span class=free>n</span> <span class=free>p</span><span class=main>)</span> <span class=skolem>q</span> <span class=main>⟷</span> bit <span class=free>p</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≤</span> <span class=skolem>q</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=var>?P</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> bit <span class=free>p</span> <span class=skolem>q</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?Q</span></span></span>
    <span class=keyword1><span class=command>using</span></span> take_bit_word_eq_self_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>p</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> less_2p_is_upper_bits_unset<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>p</span> <span class=main>!!</span> <span class=bound>n'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_less_trans le_mask_iff_lt_2n upper_bits_unset_is_l2p word_zero_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_over<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> size <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> le_mask_high_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=main>∈</span> <span class=main>{</span><span class=free>n</span> <span class=main>..&lt;</span> size <span class=free>w</span><span class=main>}</span><span class=main>.</span> <span class=main>¬</span> <span class=free>w</span> <span class=main>!!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size and_mask_eq_iff_le_mask<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_conj_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>using</span></span> test_bit_bin <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> neg_test_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_over word_ops_nth_size word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_less_t2n'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size mask_eq_iff_w2p <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_less_t2n<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> shiftr_less_t2n'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> less_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> p2_eq_0<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> shiftr_less_t2n'<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>w</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lt2p_lem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_not_mask_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span><span class=main>+</span><span class=free>m</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_less_t2n<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size mask_eq_iff_w2p <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_push_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_less_t2n'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>m</span><span class=main>+</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> shiftl_less_t2n<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> nth_w2p_scast <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span><span class=main>)</span>
         <span class=main>⟷</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len  word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_bit_test <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
    <span class=quoted><span class=quoted>"scast <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len signed word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> signed_shift_guard_to_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟧</span>
    <span class=main>⟹</span> <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> nat_mult_power_less_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> shiftl_shiftr1<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> less_mask_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> power_increasing<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_mult_power_less_eq word_less_nat_alt word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> shiftl_shiftr2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_bounded<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less test_bit_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> bit_imp_le_length bit_uint_iff less_2p_is_upper_bits_unset test_bit_bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_mask_is_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_eq_push_bit take_bit_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rshift_sub_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> shiftl_shiftr2<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> c<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"size <span class=free>a</span> <span class=main>-</span> <span class=free>b</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> size <span class=free>a</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less mask_eq_decr_exp word_size
                   p2_eq_0<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_shiftr3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=free>c</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_shiftr1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_shiftr2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_shiftr_comm<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> size <span class=free>w</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=free>m</span><span class=main>-</span><span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_mask shiftr_shiftr<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size shiftl_shiftr3<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_shiftl_comm<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span><span class=main>+</span><span class=free>n</span> <span class=main>≤</span> size <span class=free>w</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=free>m</span><span class=main>+</span><span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_mask word_size shiftl_shiftl<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_shiftr1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_mask_shiftl_le_mask<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>m</span> <span class=main>≤</span> mask <span class=free>s</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_mask_iff shiftl_shiftr3<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_1_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_and_1_shiftls'
    <span class=main>=</span> word_and_1_shiftl<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span>
      word_and_1_shiftl<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>
      word_and_1_shiftl<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>2</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_and_1_shiftls <span class=main>=</span> word_and_1_shiftls' <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_mask_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shift_times_fold<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>m</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n <span class=dynamic><span class=dynamic>ac_simps</span></span> power_add<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bool_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_bool <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>v</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_word_eq shiftr_word_eq bit_eq_iff<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_1_iff bit_and_iff bit_drop_bit_eq <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ccontr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span>size <span class=free>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_mask_eq'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>(</span>size <span class=free>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>m</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_eq_0_is_nth<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> u<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_eqD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_w2p<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> and_neq_0_is_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_is_and_neq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> and_neq_0_is_nth<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span> refl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_shift_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span><span class=main>^</span><span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> word_shift_nonzero<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_shift_and_negate<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp Parity.bit_eq_iff bit_and_iff bit_not_iff shiftl_word_eq bit_push_bit_iff<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_EqI><div class=head><h1>Theory Word_EqI</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Solving Word Equalities"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_EqI
  <span class=keyword2><span class=keyword>imports</span></span>
    <a href=More_Word.html>More_Word</a>
    <a href=Traditional_Infix_Syntax.html>Traditional_Infix_Syntax</a>
    <span class=quoted>"<a href=../../HOL/HOL-Eisbach/Eisbach_Tools.html>HOL-Eisbach.Eisbach_Tools</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Some word equalities can be solved by considering the problem bitwise for all
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>prop</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>n</span></span> <span class=main><span class=main>&lt;</span></span> <span class=keyword1><span class=keyword1>LENGTH</span></span><span class=main><span class=main>(</span></span><span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len<span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, which is different to running <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>text</span></span> <span class=raw_text><span class=raw_text>word_bitwise</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  and expanding into an explicit list of bits.
›</span></span>

<span class=keyword1><span class=command>named_theorems</span></span> word_eqI_simps

<span class=keyword1><span class=command>lemmas</span></span> <span class=main>[</span><span class=operator>word_eqI_simps</span><span class=main>]</span> <span class=main>=</span>
  word_ops_nth_size
  word_size
  word_or_zero
  neg_mask_test_bit
  nth_ucast
  nth_w2p nth_shiftl
  nth_shiftr
  less_2p_is_upper_bits_unset
  le_mask_high_bits
  bang_eq
  neg_test_bit
  is_up
  is_down

<span class=keyword1><span class=command>lemmas</span></span> word_eqI_rule <span class=main>=</span> word_eqI <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_lenD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> test_bit_size <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>method</span></span> word_eqI <span class=keyword2><span class=keyword>uses</span></span> simp simp_del split split_del cong flip <span class=main>=</span>
  <span class=main>(</span><span class=comment1>(* reduce conclusion to test_bit: *)</span>
   <span class=operator>rule</span> word_eqI_rule<span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* make sure we're in clarsimp normal form: *)</span>
   <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>flip</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split_del</span></span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>cong</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* turn x &lt; 2^n assumptions into mask equations: *)</span>
   <span class=main>(</span><span class=main>(</span><span class=operator>drule</span> less_mask_eq<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* expand and distribute test_bit everywhere: *)</span>
   <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>word_eqI_simps</span></span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>flip</span></span>
             <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split_del</span></span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>cong</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* add any additional word size constraints to new indices: *)</span>
   <span class=main>(</span><span class=main>(</span><span class=operator>drule</span> test_bit_lenD<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* try to make progress (can't use +, would loop): *)</span>
   <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>word_eqI_simps</span></span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>flip</span></span>
             <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split_del</span></span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>cong</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
   <span class=comment1>(* helps sometimes, rarely: *)</span>
   <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp</span></span> test_bit_conj_lt <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>flip</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>split_del</span></span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>cong</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main>)</span>

<span class=keyword1><span class=command>method</span></span> word_eqI_solve <span class=keyword2><span class=keyword>uses</span></span> simp simp_del split split_del cong flip <span class=main>=</span>
  <span class=operator>solves</span> <span class=quoted>‹<span class=operator>word_eqI</span> <span class=quasi_keyword>simp</span><span class=main>:</span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>simp_del</span><span class=main>:</span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>split</span><span class=main>:</span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split_del</span><span class=main>:</span> <span class=dynamic><span class=dynamic>split_del</span></span>
                   <span class=quasi_keyword>cong</span><span class=main>:</span> <span class=dynamic><span class=dynamic>cong</span></span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>flip</span><span class=main>:</span> <span class=dynamic><span class=dynamic>flip</span></span><span class=keyword3>;</span>
          (<span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main>:</span> test_bit_size <span class=quasi_keyword>simp</span><span class=main>:</span> <span class=dynamic><span class=dynamic>word_eqI_simps</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main>:</span> <span class=dynamic><span class=dynamic>flip</span></span>
                     <span class=quasi_keyword>simp</span><span class=main>:</span> <span class=dynamic><span class=dynamic>simp</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main>:</span> <span class=dynamic><span class=dynamic>simp_del</span></span> <span class=quasi_keyword>split</span><span class=main>:</span> <span class=dynamic><span class=dynamic>split</span></span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main>:</span> <span class=dynamic><span class=dynamic>split_del</span></span> <span class=quasi_keyword>cong</span><span class=main>:</span> <span class=dynamic><span class=dynamic>cong</span></span>)<span class=keyword3>?</span>›</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Bit_Comprehension><div class=head><h1>Theory Bit_Comprehension</h1></div><pre class=source><span class=comment1>(*
 * Copyright Brian Huffman, PSU; Jeremy Dawson and Gerwin Klein, NICTA
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Comprehension syntax for bit expressions›</span></span>

<span class=keyword1><span class=command>theory</span></span> Bit_Comprehension
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>class</span></span> bit_comprehension <span class=main>=</span> ring_bit_operations <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>set_bits</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=main>(</span>nat <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span>›</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>binder</span></span> <span class=quoted>‹<span class=keyword1><span class=keyword1><span class=keyword1>BITS</span></span></span> ›</span> 10<span class=main>)</span>
  <span class=keyword2><span class=keyword>assumes</span></span> set_bits_bit_eq<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>set_bits</span> <span class=main>(</span>bit <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>›</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> set_bits_False_eq <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>BITS</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> set_bits_bit_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bot_fun_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>instantiation</span></span> int <span class=main>::</span> <span class=quoted>bit_comprehension</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>‹set_bits <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> <span class=main>(</span>
      <span class=keyword1>if</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>m</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>n</span> <span class=keyword1>then</span>
      <span class=keyword1>let</span> <span class=bound>n</span> <span class=main>=</span> <span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>m</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>n</span>
      <span class=keyword1>in</span> signed_take_bit <span class=bound>n</span> <span class=main>(</span>horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>Suc <span class=bound>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>
     <span class=keyword1>else</span> <span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>from</span></span> int_bit_bound <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>n</span> <span class=main>≤</span> <span class=bound>m</span> <span class=main>⟹</span> bit <span class=skolem>k</span> <span class=bound>m</span> <span class=main>⟷</span> bit <span class=skolem>k</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> bit <span class=skolem>k</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>≠</span> bit <span class=skolem>k</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> bit <span class=skolem>k</span> <span class=bound>n'</span> <span class=main>⟷</span> bit <span class=skolem>k</span> <span class=bound>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>meson</span>
  <span class=keyword1><span class=command>have</span></span> l<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>q</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>q</span><span class=main>.</span> bit <span class=skolem>k</span> <span class=bound>m</span> <span class=main>⟷</span> bit <span class=skolem>k</span> <span class=bound>q</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_equality<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> * <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted>"**"</span> One_nat_def Suc_pred le_cases le0 neq0_conv not_less_eq_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹set_bits <span class=main>(</span>bit <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> *** set_bits_int_def horner_sum_bit_eq_take_bit l<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_signed_take_bit_iff min_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le bit_take_bit_iff <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bits_K_False <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>BITS</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bits_K_True <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>BITS</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_def<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>bit_comprehension</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> word_set_bits_def<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>BITS</span> <span class=bound>n</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>standard</span>
  <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_set_bits_def horner_sum_bit_eq_take_bit<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> bit_set_bits_word_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span>set_bits <span class=free>P</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>P</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_set_bits_def bit_horner_sum_bit_word_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> set_bits_K_False <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹set_bits <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_set_bits_word_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> set_bits_int_unfold'<span class=main>:</span>
  <span class=quoted><span class=quoted>‹set_bits <span class=free>f</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span> <span class=keyword1>then</span>
      <span class=keyword1>let</span> <span class=bound>n</span> <span class=main>=</span> <span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span>
      <span class=keyword1>in</span> horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=free>f</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>n</span><span class=main>]</span><span class=main>)</span>
     <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span> <span class=keyword1>then</span>
      <span class=keyword1>let</span> <span class=bound>n</span> <span class=main>=</span> <span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span>
      <span class=keyword1>in</span> signed_take_bit <span class=bound>n</span> <span class=main>(</span>horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=free>f</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=bound>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span>True<span class=main>]</span><span class=main>)</span><span class=main>)</span>
     <span class=keyword1>else</span> <span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=bound>n</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> q<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=skolem>q</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>n</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=bound>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=skolem>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> n_def
    <span class=keyword1><span class=command>using</span></span> q <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> LeastI <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>q</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> n<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>n</span> <span class=main>≤</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>from</span></span> n_def <span class=keyword1><span class=command>have</span></span> n_eq<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>q</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=bound>q</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Least_equality Least_le <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound><span class=bound>m</span></span><span class=main>≥</span><span class=skolem>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>m</span> <span class=main>=</span> <span class=free>f</span> <span class=skolem>n</span>›</span></span> dual_order.refl le_refl n order_refl<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>f</span> <span class=skolem>n</span>›</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>with</span></span> n <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> False n_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> * False <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_def n_def <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> ** <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.upt_Suc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_horner_sum_bit_eq
      bit_horner_sum_bit_iff take_map
      signed_take_bit_def set_bits_int_def
      horner_sum_bit_eq_take_bit <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.upt_Suc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>with</span></span> n <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> * nat_le_linear <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> True n_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> * *** True <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_def n_def <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> ** <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.upt_Suc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_horner_sum_bit_eq
      bit_horner_sum_bit_iff take_map
      signed_take_bit_def set_bits_int_def
      horner_sum_bit_eq_take_bit nth_append <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.upt_Suc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>inductive</span></span> <span class=entity>wf_set_bits_int</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>f</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  zeros<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span> <span class=main>⟹</span> <span class=free>wf_set_bits_int</span> <span class=free>f</span>"</span></span>
<span class=main>|</span> ones<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span> <span class=main>⟹</span> <span class=free>wf_set_bits_int</span> <span class=free>f</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> wf_set_bits_int_simps<span class=main>:</span> <span class=quoted><span class=quoted>"wf_set_bits_int <span class=free>f</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_set_bits_int.simps<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> wf_set_bits_int_const <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"wf_set_bits_int <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> wf_set_bits_int.intros<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> wf_set_bits_int_fun_upd <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_set_bits_int <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> wf_set_bits_int <span class=free>f</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>⟷</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span><span class=skolem>n'</span><span class=main>.</span> <span class=main>¬</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=bound>n''</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span><span class=skolem>n'</span><span class=main>.</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=bound>n''</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_set_bits_int_simps<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span>max <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=skolem>n'</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n''</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span>max <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=skolem>n'</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n''</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> wf_set_bits_int_simps<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span><span class=skolem>n'</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n''</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n''</span></span><span class=main>≥</span><span class=skolem>n'</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n''</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?wf</span> <span class=free>f</span> <span class=skolem>n'</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_set_bits_int_simps<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?wf</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>max <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=skolem>n'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> wf_set_bits_int_simps<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> wf_set_bits_int_Suc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wf_set_bits_int <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> wf_set_bits_int <span class=free>f</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>⟷</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_set_bits_int_simps <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_SucI <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Suc_le_D<span class=main>)</span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>f</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wff<span class=main>:</span> <span class=quoted><span class=quoted>"wf_set_bits_int <span class=free>f</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bits_unfold_BIT<span class=main>:</span>
  <span class=quoted><span class=quoted>"set_bits <span class=free>f</span> <span class=main>=</span> of_bool <span class=main>(</span><span class=free>f</span> <span class=main>0</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>*</span> set_bits <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> Suc<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> wff <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>zeros <span class=skolem>n</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> False<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> True <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_def<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=skolem>n'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>with</span></span> zeros <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span>Suc <span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Least_Suc<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span>Suc <span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Suc_le_D<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> zeros <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=skolem>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> zeros
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_simp</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_unfold' exI
        <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.upt_Suc <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> map_map <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> map_Suc_upt upt_conv_Cons<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>ones <span class=skolem>n</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> True <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_def<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>n'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>f</span> <span class=skolem>n'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>with</span></span> ones <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span>Suc <span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Least_Suc<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span>Suc <span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Suc_le_D<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> ones <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=skolem>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> ones <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=bound>n'</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
      <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> exI<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"max <span class=skolem>n</span> <span class=skolem>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span> <span class=skolem>n</span> <span class=skolem>m</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> max_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=bound>n</span><span class=main>.</span> <span class=main>¬</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False"</span></span>
      <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> allE<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"Suc <span class=skolem>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span> <span class=skolem>n</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Suc_le_D<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> ones
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_simp</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bits_int_unfold' exI <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def hd_map map_tl<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> map_map<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> map_Suc_upt upt_conv_Cons signed_take_bit_Suc
        not_le <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> map_map<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_set_bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span>set_bits <span class=free>f</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> int_set_bits_unfold_BIT<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_set_bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set_bits <span class=free>f</span> <span class=keyword1>div</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> set_bits <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> Suc<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> int_set_bits_unfold_BIT<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_set_bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bit <span class=main>(</span>set_bits <span class=free>f</span> <span class=main>::</span> int<span class=main>)</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>f</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> wff <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>f</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_Comprehension.bin_last_set_bits<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> Suc
  <span class=keyword1><span class=command>from</span></span> Suc.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>f</span> <span class=main>∘</span> Suc"</span></span><span class=main>]</span> Suc.prems <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_Comprehension.bin_rest_set_bits comp_def bit_Suc<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Bits_Int><div class=head><h1>Theory Bits_Int</h1></div><pre class=source><span class=comment1>(*
 * Copyright Brian Huffman, PSU; Jeremy Dawson and Gerwin Klein, NICTA
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Bitwise Operations on integers›</span></span>

<span class=keyword1><span class=command>theory</span></span> Bits_Int
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Traditional_Infix_Syntax.html>Traditional_Infix_Syntax</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Implicit bit representation of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>bin_last</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_last</span> <span class=main>≡</span> odd"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_last <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> odd_iff_mod_2_eq_one<span class=main>)</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>bin_rest</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_rest</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=keyword1>div</span> <span class=numeral>2</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_numeral_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> odd <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span>Numeral1 <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> odd <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> odd <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_numeral_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest Numeral1 <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rl_eqI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span>bin_rest <span class=free>x</span> <span class=main>=</span> bin_rest <span class=free>y</span><span class=main>;</span> odd <span class=free>x</span> <span class=main>=</span> odd <span class=free>y</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> oddE<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> bin_rest_lt0<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>  bin_rest_ge_0<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=free>i</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_gt_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>&gt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Bit projection›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>bin_nth</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹int <span class=main>⇒</span> nat <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>bin_nth</span> <span class=main>≡</span> bit›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=free>x</span> <span class=main>=</span> bin_nth <span class=free>y</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff fun_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_eqI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> bin_nth <span class=free>x</span> <span class=bound>n</span> <span class=main>⟷</span> bin_nth <span class=free>y</span> <span class=bound>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> that bin_nth_eq_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> bin_nth <span class=free>x</span> <span class=bound>n</span> <span class=main>=</span> bin_nth <span class=free>y</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> bin_nth <span class=main>0</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>1</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_numeral<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span> bin_nth <span class=free>x</span> <span class=main>(</span>numeral <span class=free>n</span><span class=main>)</span> <span class=main>=</span> bin_nth <span class=free>y</span> <span class=main>(</span>pred_numeral <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_nth_numeral_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  bin_nth_numeral <span class=main>[</span><span class=operator>OF</span> bin_rest_numeral_simps<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_nth_simps <span class=main>=</span>
  bit_0 bit_Suc bin_nth_zero bin_nth_minus1
  bin_nth_numeral_simps

<span class=keyword1><span class=command>lemma</span></span> nth_2p_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=comment1>― ‹for use when simplifying with <span class=antiquoted><span class=raw_text><span class=operator>‹</span>bin_nth_Bit›</span></span>›</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_exp_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rest_power_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=main>(</span>bin_rest <span class=main>^^</span> <span class=free>k</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> bin_nth <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> bit_Suc <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> add_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_numeral_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> bin_nth <span class=main>(</span>numeral <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟶</span> bin_nth <span class=main>(</span>numeral <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Truncating›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_sign</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_sign</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>≥</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span><span class=main>-</span> numeral <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_rest <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bin_rest <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_sign <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>bintrunc</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹nat <span class=main>⇒</span> int <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>bintrunc</span> <span class=main>≡</span> take_bit›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_mod2p<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> take_bit_eq_mod<span class=main>)</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>sbintrunc</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹nat <span class=main>⇒</span> int <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>sbintrunc</span> <span class=main>≡</span> signed_take_bit›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>norm_sint</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹nat <span class=main>⇒</span> int <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>norm_sint</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> signed_take_bit <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_mod2p<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bintrunc_mod2p signed_take_bit_eq_take_bit_shift<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_eq_take_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>‹sbintrunc <span class=free>n</span> <span class=free>k</span> <span class=main>=</span> take_bit <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>k</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_take_bit_eq_take_bit_shift<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_bintr<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_n_0<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> take_bit_of_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_n_0<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_take_bit_of_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_n_minus1<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_take_bit_of_minus_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_Suc_numeral<span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_0_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>0</span> <span class=main>1</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>0</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>0</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>0</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>0</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_Suc_numeral<span class=main>:</span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>bin_sign <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> bit <span class=free>bin</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_bintr<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>∧</span> bin_nth <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_sbintr<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>sbintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> bin_nth <span class=free>w</span> <span class=free>n</span> <span class=keyword1>else</span> bin_nth <span class=free>w</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_signed_take_bit_iff min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_Bit0<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span>
    <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> bin_nth <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bit_double_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹numeral <span class=free>w</span> <span class=main>::</span> int›</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> exI <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>-</span> <span class=main>1</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_Bit1<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span>
    <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> bin_nth <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> even_bit_succ_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> numeral <span class=free>w</span> <span class=main>::</span> int›</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span>
    bit_double_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹numeral <span class=free>w</span> <span class=main>::</span> int›</span></span> <span class=quoted><span class=free>n</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_bintrunc_l<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> bintrunc <span class=free>m</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_sbintrunc_l<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> sbintrunc <span class=free>m</span> <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_bintrunc_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bin_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_bintrunc_min <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> take_bit_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_sbintrunc_min <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>m</span> <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> signed_take_bit_signed_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Suc_Pls <span class=main>=</span>
  signed_take_bit_Suc <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>0</span><span class=main>::</span>int"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_numeral_simps bin_rest_numeral_simps<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Suc_Min <span class=main>=</span>
  signed_take_bit_Suc <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span><span class=main>::</span>int"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_numeral_simps bin_rest_numeral_simps<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Sucs <span class=main>=</span> sbintrunc_Suc_Pls sbintrunc_Suc_Min
  sbintrunc_Suc_numeral

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Pls <span class=main>=</span>
  signed_take_bit_0 <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>0</span><span class=main>::</span>int"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_numeral_simps bin_rest_numeral_simps<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Min <span class=main>=</span>
  signed_take_bit_0 <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span><span class=main>::</span>int"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_numeral_simps bin_rest_numeral_simps<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_0_simps <span class=main>=</span>
  sbintrunc_Pls sbintrunc_Min

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_simps <span class=main>=</span> sbintrunc_0_simps sbintrunc_Sucs

<span class=keyword1><span class=command>lemma</span></span> bintrunc_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bintrunc <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> sbintrunc <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_minus_simps <span class=main>=</span>
  sbintrunc_Sucs <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span></span></span>2<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span></span></span> sbintrunc_minus <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>,</span></span></span></span></span></span></span></span> <span class=operator><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>THEN</span></span></span></span></span></span></span> trans<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_BIT_I<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
  sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span>
  sbintrunc <span class=free>n</span> <span class=main>0</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>y</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_Suc_Is<span class=main>:</span>
  <span class=quoted><span class=quoted>‹sbintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span>
  sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>y</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_Suc_lem<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>=</span> Suc <span class=free>n</span> <span class=main>⟹</span> sbintrunc <span class=free>m</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ssubst<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Suc_Ialts <span class=main>=</span>
  sbintrunc_Suc_Is <span class=main>[</span><span class=operator>THEN</span> sbintrunc_Suc_lem<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_bintrunc_lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&gt;</span> <span class=free>n</span> <span class=main>⟹</span> sbintrunc <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bin_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_sbintr nth_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_sbintrunc_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> Suc <span class=free>n</span> <span class=main>⟹</span> bintrunc <span class=free>m</span> <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>m</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> take_bit_signed_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bintrunc_sbintrunc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> order_refl <span class=main>[</span><span class=operator>THEN</span> bintrunc_sbintrunc_le<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_bintrunc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> lessI <span class=main>[</span><span class=operator>THEN</span> sbintrunc_bintrunc_lt<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> bintrunc_bintrunc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> order_refl <span class=main>[</span><span class=operator>THEN</span> bintrunc_bintrunc_l<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_sbintrunc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> order_refl <span class=main>[</span><span class=operator>THEN</span> sbintrunc_sbintrunc_l<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_sbintrunc' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=main>(</span>sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_bintrunc' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sbin_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>y</span> <span class=main>⟷</span> sbintrunc <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> box_equals <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ sbintrunc_bintrunc sbintrunc_bintrunc<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> box_equals <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ bintrunc_sbintrunc bintrunc_sbintrunc<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_sbin_eq_iff'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>y</span> <span class=main>⟷</span> sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sbin_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bintrunc_sbintruncS0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> bintrunc_sbintrunc' <span class=main>[</span><span class=operator>unfolded</span> One_nat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_bintruncS0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> sbintrunc_bintrunc' <span class=main>[</span><span class=operator>unfolded</span> One_nat_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> bintrunc_bintrunc_l' <span class=main>=</span> le_add1 <span class=main>[</span><span class=operator>THEN</span> bintrunc_bintrunc_l<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_sbintrunc_l' <span class=main>=</span> le_add1 <span class=main>[</span><span class=operator>THEN</span> sbintrunc_sbintrunc_l<span class=main>]</span>

<span class=comment1>(* although bintrunc_minus_simps, if added to default simpset,
  tends to get applied where it's not wanted in developing the theories,
  we get a version for when the word length is given literally *)</span>

<span class=keyword1><span class=command>lemmas</span></span> nat_non0_gr <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> iszero_def <span class=main><span class=main>[</span></span><span class=operator>THEN</span> Not_eq_iff <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span> refl<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_numeral<span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> of_bool <span class=main>(</span>odd <span class=free>x</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc take_bit_Suc mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_numeral<span class=main>:</span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> of_bool <span class=main>(</span>odd <span class=free>x</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc signed_take_bit_Suc mod2_eq_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_numeral_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bintrunc_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_numeral_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> sbintrunc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sbintrunc_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> no_bintr_alt1<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=bound>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> bintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> range_bintrunc<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span>bintrunc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod image_iff<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> mod_pos_pos_trivial<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> no_sbintr_alt2<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=main>(</span><span class=bound>w</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> sbintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> range_sbintrunc<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span>sbintrunc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹surj <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>k</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> surjI <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>‹<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>λ</span></span></span><span class=bound><span class=bound><span class=bound>k</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=bound><span class=bound><span class=bound>k</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=numeral><span class=numeral><span class=numeral>2</span></span></span> <span class=main><span class=main><span class=main>^</span></span></span> <span class=free><span class=free><span class=free>n</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>›</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹sbintrunc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>∘</span> take_bit <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>∘</span> <span class=main>(</span><span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sbintrunc_eq_take_bit fun_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> fun.set_map range_bintrunc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>presburger</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_inc<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span> <span class=main>≤</span> sbintrunc <span class=free>n</span> <span class=free>k</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>&lt;</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_take_bit_int_greater_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_dec<span class=main>:</span>
  <span class=quoted><span class=quoted>‹sbintrunc <span class=free>n</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> signed_take_bit_int_less_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_ge0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_lt2p<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=free>w</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_Min<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> stable_imp_take_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintr_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> sbintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sbintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintr_lt<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=free>w</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sbintrunc_mod2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_Pls_ge_0<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=free>bin</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>bin</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>bin</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_Min_lt_0<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=free>bin</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟷</span> <span class=free>bin</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>bin</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_trunc<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>bin_rest <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_rec <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>bin</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_power_trunc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>bin_rest <span class=main>^^</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>bin_rest <span class=main>^^</span> <span class=free>k</span><span class=main>)</span> <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_rest_trunc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_trunc_i<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bin_rest <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=main>(</span>bintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_strunc<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>sbintrunc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=main>(</span>bin_rest <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_rest <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bin_rest <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bin</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_rest <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>(</span>bin_rest <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bin</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_Suc mod2_eq_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_rest'<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>∘</span> bin_rest <span class=main>∘</span> bintrunc <span class=free>n</span> <span class=main>=</span> bin_rest <span class=main>∘</span> bintrunc <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_rest'<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>∘</span> bin_rest <span class=main>∘</span> sbintrunc <span class=free>n</span> <span class=main>=</span> bin_rest <span class=main>∘</span> sbintrunc <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> rco_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>∘</span> <span class=main>(</span><span class=free>g</span> <span class=main>∘</span> <span class=free>f</span><span class=main>)</span> <span class=main>^^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>^^</span> <span class=free>n</span> <span class=main>∘</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> fun_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> o_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> rco_bintr <span class=main>=</span> bintrunc_rest'
  <span class=main>[</span><span class=operator>THEN</span> rco_lem <span class=main><span class=main>[</span></span><span class=operator>THEN</span> fun_cong<span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>unfolded</span> o_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rco_sbintr <span class=main>=</span> sbintrunc_rest'
  <span class=main>[</span><span class=operator>THEN</span> rco_lem <span class=main><span class=main>[</span></span><span class=operator>THEN</span> fun_cong<span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>unfolded</span> o_def<span class=main>]</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Splitting and concatenation›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_split</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹nat <span class=main>⇒</span> int <span class=main>⇒</span> int <span class=main>×</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>bin_split</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>=</span> <span class=main>(</span>drop_bit <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>,</span> take_bit <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_split <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span> <span class=main>=</span> bin_split <span class=free>n</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=keyword1>in</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> of_bool <span class=main>(</span>odd <span class=free>w</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>w2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bin_split <span class=main>0</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_Suc take_bit_Suc mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>bin_cat</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹int <span class=main>⇒</span> nat <span class=main>⇒</span> int <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>bin_cat</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>≡</span> concat_bit <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>k</span></span></span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_eq_push_bit_add_take_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_cat <span class=free>k</span> <span class=free>n</span> <span class=free>l</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=free>k</span> <span class=main>+</span> take_bit <span class=free>n</span> <span class=free>l</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> concat_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_cat<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bin_cat <span class=free>x</span> <span class=free>n</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> bin_sign <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> pos_mod_bound <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_le<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zdiv_zminus1_eq_if<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> zdiv_mono1 zero_less_numeral zero_less_power <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>with</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def not_le not_less bin_cat_eq_push_bit_add_take_bit push_bit_eq_mult take_bit_eq_mod<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_assoc<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=main>(</span>bin_cat <span class=free>x</span> <span class=free>m</span> <span class=free>y</span><span class=main>)</span> <span class=free>n</span> <span class=free>z</span> <span class=main>=</span> bin_cat <span class=free>x</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>bin_cat <span class=free>y</span> <span class=free>n</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> concat_bit_assoc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_assoc_sym<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>x</span> <span class=free>m</span> <span class=main>(</span>bin_cat <span class=free>y</span> <span class=free>n</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=main>(</span>bin_cat <span class=free>x</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>y</span><span class=main>)</span> <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> concat_bit_assoc_sym<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_rcat</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹nat <span class=main>⇒</span> int list <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>bin_rcat</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> horner_sum <span class=main>(</span>take_bit <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=main>∘</span> rev›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rcat_eq_foldl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_rcat <span class=free>n</span> <span class=main>=</span> foldl <span class=main>(</span><span class=main>λ</span><span class=bound>u</span> <span class=bound>v</span><span class=main>.</span> bin_cat <span class=bound>u</span> <span class=free>n</span> <span class=bound>v</span><span class=main>)</span> <span class=main>0</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ks</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹int list›</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bin_rcat <span class=free>n</span> <span class=skolem>ks</span> <span class=main>=</span> foldl <span class=main>(</span><span class=main>λ</span><span class=bound>u</span> <span class=bound>v</span><span class=main>.</span> bin_cat <span class=bound>u</span> <span class=free>n</span> <span class=bound>v</span><span class=main>)</span> <span class=main>0</span> <span class=skolem>ks</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>ks</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main>)</span>
      <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rcat_def concat_bit_eq push_bit_eq_mult<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>bin_rsplit_aux</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>⇒</span> int <span class=main>⇒</span> int list <span class=main>⇒</span> int list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_rsplit_aux</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=free><span class=bound><span class=entity>bs</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>bs</span></span></span>
     <span class=keyword1>else</span>
      <span class=keyword1>let</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>)</span> <span class=main>=</span> bin_split <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span>
      <span class=keyword1>in</span> <span class=free>bin_rsplit_aux</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=bound>a</span> <span class=main>(</span><span class=bound>b</span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>bs</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_rsplit</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>×</span> int <span class=main>⇒</span> int list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_rsplit</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> bin_rsplit_aux <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>[]</span>"</span></span>

<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>‹bin_rsplit <span class=numeral>1705</span> <span class=main>(</span><span class=numeral>3</span><span class=main>,</span> <span class=numeral>88</span><span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>bin_rsplitl_aux</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>⇒</span> int <span class=main>⇒</span> int list <span class=main>⇒</span> int list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_rsplitl_aux</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=free><span class=bound><span class=entity>bs</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>bs</span></span></span>
     <span class=keyword1>else</span>
      <span class=keyword1>let</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>)</span> <span class=main>=</span> bin_split <span class=main>(</span>min <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>c</span></span></span>
      <span class=keyword1>in</span> <span class=free>bin_rsplitl_aux</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=bound>a</span> <span class=main>(</span><span class=bound>b</span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>bs</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_rsplitl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>×</span> int <span class=main>⇒</span> int list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_rsplitl</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> bin_rsplitl_aux <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>[]</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> bin_rsplit_aux.simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> bin_rsplitl_aux.simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>bin_cat <span class=free>x</span> <span class=free>k</span> <span class=free>y</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=keyword1>then</span> bin_nth <span class=free>y</span> <span class=free>n</span> <span class=keyword1>else</span> bin_nth <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_concat_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_drop_bit_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_nth <span class=main>(</span>drop_bit <span class=free>n</span> <span class=free>c</span><span class=main>)</span> <span class=free>k</span> <span class=main>⟷</span> bin_nth <span class=free>c</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_drop_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_take_bit_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_nth <span class=main>(</span>take_bit <span class=free>n</span> <span class=free>c</span><span class=main>)</span> <span class=free>k</span> <span class=main>⟷</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> bin_nth <span class=free>c</span> <span class=free>k</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>k</span><span class=main>.</span> bin_nth <span class=free>a</span> <span class=bound>k</span> <span class=main>=</span> bin_nth <span class=free>c</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>k</span><span class=main>.</span> bin_nth <span class=free>b</span> <span class=bound>k</span> <span class=main>=</span> <span class=main>(</span><span class=bound>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> bin_nth <span class=free>c</span> <span class=bound>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_drop_bit_iff bin_nth_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=main>0</span> <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_eq_push_bit_add_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_cat1<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span><span class=free>k</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=main>(</span>bintrunc <span class=free>k</span> <span class=free>a</span><span class=main>)</span> <span class=free>n</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bin_cat_assoc bin_cat_zero<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_cat<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=main>(</span>bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span>
    bin_cat <span class=main>(</span>bintrunc <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>a</span><span class=main>)</span> <span class=free>n</span> <span class=main>(</span>bintrunc <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>b</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bin_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_nth_cat nth_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_cat_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> bintr_cat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> cat_bintr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>a</span> <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_eq_push_bit_add_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> split_bintrunc<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_split<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=free>u</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>=</span> bin_cat <span class=free>u</span> <span class=free>n</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_eq_push_bit_add_take_bit bits_ident<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_bit_bin_cat_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹drop_bit <span class=free>n</span> <span class=main>(</span>bin_cat <span class=free>v</span> <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>v</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_drop_bit_eq bit_concat_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> take_bit_bin_cat_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹take_bit <span class=free>n</span> <span class=main>(</span>bin_cat <span class=free>v</span> <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> take_bit <span class=free>n</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_concat_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_cat<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=main>(</span>bin_cat <span class=free>v</span> <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>v</span><span class=main>,</span> bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_bin_cat_eq take_bit_bin_cat_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>,</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_trunc<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_split <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span>
    bin_split <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>bintrunc <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rest_trunc Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def drop_bit_Suc take_bit_Suc mod_2_eq_odd <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_trunc1<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span>
    bin_split <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>bintrunc <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>a</span><span class=main>,</span> bintrunc <span class=free>m</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rest_trunc Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def drop_bit_Suc take_bit_Suc mod_2_eq_odd <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_num<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> bintrunc <span class=free>n</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_eq_push_bit_add_take_bit push_bit_eq_mult<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_num<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>,</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_eq_div take_bit_eq_mod<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_rsplit_aux_simps <span class=main>=</span> bin_rsplit_aux.simps bin_rsplitl_aux.simps
<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_simps <span class=main>=</span> bin_rsplit_aux_simps

<span class=keyword1><span class=command>lemmas</span></span> th_if_simp1 <span class=main>=</span> if_split <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>(=)</span> <span class=free>l</span>"</span></span><span class=main>,</span> <span class=operator>THEN</span> iffD1<span class=main>,</span> <span class=operator>THEN</span> conjunct1<span class=main>,</span> <span class=operator>THEN</span> mp<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>l</span>
<span class=keyword1><span class=command>lemmas</span></span> th_if_simp2 <span class=main>=</span> if_split <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>(=)</span> <span class=free>l</span>"</span></span><span class=main>,</span> <span class=operator>THEN</span> iffD1<span class=main>,</span> <span class=operator>THEN</span> conjunct2<span class=main>,</span> <span class=operator>THEN</span> mp<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>l</span>

<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_simp1s <span class=main>=</span> rsplit_aux_simps <span class=main>[</span><span class=operator>THEN</span> th_if_simp1<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_simp2ls <span class=main>=</span> rsplit_aux_simps <span class=main>[</span><span class=operator>THEN</span> th_if_simp2<span class=main>]</span>
<span class=comment1>― ‹these safe to <span class=antiquoted><span class=raw_text><span class=operator>‹</span>[simp add]›</span></span> as require calculating <span class=antiquoted><span class=raw_text><span class=operator>‹</span>m - n›</span></span>›</span>
<span class=keyword1><span class=command>lemmas</span></span> bin_rsplit_aux_simp2s <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> rsplit_aux_simp2ls <span class=main>[</span><span class=operator>unfolded</span> Let_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rbscl <span class=main>=</span> bin_rsplit_aux_simp2s <span class=main>(</span>2<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_0_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  rsplit_aux_simp1s <span class=main>[</span><span class=operator>OF</span> disjI1<span class=main>]</span> rsplit_aux_simp1s <span class=main>[</span><span class=operator>OF</span> disjI2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_aux_append<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rsplit_aux <span class=free>n</span> <span class=free>m</span> <span class=free>c</span> <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span> bin_rsplit_aux <span class=free>n</span> <span class=free>m</span> <span class=free>c</span> <span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_rsplit_aux.induct<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplit_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplit_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplitl_aux_append<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rsplitl_aux <span class=free>n</span> <span class=free>m</span> <span class=free>c</span> <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span> bin_rsplitl_aux <span class=free>n</span> <span class=free>m</span> <span class=free>c</span> <span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_rsplitl_aux.induct<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplitl_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplitl_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_apps <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> bs <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>[]</span></span>"</span></span></span><span class=main>]</span> <span class=main>=</span>
  bin_rsplit_aux_append bin_rsplitl_aux_append

<span class=keyword1><span class=command>lemmas</span></span> rsplit_def_auxs <span class=main>=</span> bin_rsplit_def bin_rsplitl_def

<span class=keyword1><span class=command>lemmas</span></span> rsplit_aux_alts <span class=main>=</span> rsplit_aux_apps
  <span class=main>[</span><span class=operator>unfolded</span> append_Nil rsplit_def_auxs <span class=main><span class=main><span class=main>[</span></span></span><span class=operator><span class=operator>symmetric</span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_split <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> bin_split <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_pred_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> numeral <span class=free>bin</span> <span class=main>⟹</span>
    bin_split <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span> <span class=main>=</span> bin_split <span class=main>(</span>numeral <span class=free>bin</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>bin_rest <span class=free>w</span><span class=main>)</span>
       <span class=keyword1>in</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> of_bool <span class=main>(</span>odd <span class=free>w</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>w2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_rec drop_bit_rec mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_aux_simp_alt<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_rsplit_aux <span class=free>n</span> <span class=free>m</span> <span class=free>c</span> <span class=free>bs</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free>bs</span>
     <span class=keyword1>else</span> <span class=keyword1>let</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>)</span> <span class=main>=</span> bin_split <span class=free>n</span> <span class=free>c</span> <span class=keyword1>in</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>,</span> <span class=bound>a</span><span class=main>)</span> <span class=main>@</span> <span class=bound>b</span> <span class=main>#</span> <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rsplit_aux.simps <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>bs</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rsplit_aux_alts<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rsplit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> bin_rsplit_simp_alt <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> bin_rsplit_def bin_rsplit_aux_simp_alt<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> bthrs <span class=main>=</span> bin_rsplit_simp_alt <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main>[</span></span>2<span class=main><span class=main>]</span></span> trans<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_size_sign' <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> rev <span class=free>sw</span> <span class=main>=</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>w</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>v</span><span class=main>∈</span>set <span class=free>sw</span><span class=main>.</span> bintrunc <span class=free>n</span> <span class=bound>v</span> <span class=main>=</span> <span class=bound>v</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>sw</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>nw</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> bthrs<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_use</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> bin_rsplit_size_sign <span class=main>=</span> bin_rsplit_size_sign' <span class=main>[</span><span class=operator>OF</span> asm_rl
  rev_rev_ident <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span> set_rev <span class=main><span class=main>[</span></span><span class=operator>THEN</span> equalityD2 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> subsetD<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_rsplit <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span> <span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
    <span class=main>∀</span><span class=bound>w</span> <span class=bound>k</span> <span class=bound>nw</span><span class=main>.</span>
      rev <span class=free>sw</span> <span class=main>=</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=bound>nw</span><span class=main>,</span> <span class=bound>w</span><span class=main>)</span> <span class=main>⟶</span>
      <span class=bound>k</span> <span class=main>&lt;</span> size <span class=free>sw</span> <span class=main>⟶</span> bin_nth <span class=main>(</span><span class=free>sw</span> <span class=main>!</span> <span class=bound>k</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> bin_nth <span class=bound>w</span> <span class=main>(</span><span class=bound>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>sw</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> bthrs<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_use</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> impE<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>k</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> allE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> impE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_drop_bit_eq <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_all<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>nw</span> <span class=main>⟹</span> <span class=free>nw</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_rsplit_def rsplit_aux_simp2ls <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> split_bintrunc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_l <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>bin</span><span class=main>.</span> bin_rsplitl <span class=free>n</span> <span class=main>(</span><span class=free>m</span><span class=main>,</span> <span class=bound>bin</span><span class=main>)</span> <span class=main>=</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>m</span><span class=main>,</span> bintrunc <span class=free>m</span> <span class=bound>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> a <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> wf_less_than <span class=main><span class=main>[</span></span><span class=operator>THEN</span> wf_induct<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rsplitl_def bin_rsplit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> allI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplitl_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplit_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rsplit_aux_alts<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rsplit_aux_alts<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>unfolding</span></span> bin_rsplit_def bin_rsplitl_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>‹<span class=improper>x</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less min_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_rcat <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟶</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>n</span> <span class=main>*</span> size <span class=free>ws</span><span class=main>,</span> bin_rcat <span class=free>n</span> <span class=free>ws</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span>bintrunc <span class=free>n</span><span class=main>)</span> <span class=free>ws</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_rsplit_def bin_rcat_eq_foldl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> xs <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>ws</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> rev_induct<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rsplit_aux_alts<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_bin_cat_eq take_bit_bin_cat_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_aux_len_le <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span> <span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ws</span> <span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟶</span> <span class=bound>ws</span> <span class=main>=</span> bin_rsplit_aux <span class=free>n</span> <span class=free>nw</span> <span class=free>w</span> <span class=free>bs</span> <span class=main>⟶</span>
    length <span class=bound>ws</span> <span class=main>≤</span> <span class=bound>m</span> <span class=main>⟷</span> <span class=free>nw</span> <span class=main>+</span> length <span class=free>bs</span> <span class=main>*</span> <span class=free>n</span> <span class=main>≤</span> <span class=bound>m</span> <span class=main>*</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=skolem>R</span></span>
    <span class=keyword2><span class=keyword>if</span></span> d<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>≤</span> <span class=skolem>j</span> <span class=main>∨</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=skolem>j'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> R1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>*</span> <span class=skolem>k</span> <span class=main>≤</span> <span class=skolem>j</span> <span class=main>*</span> <span class=skolem>k</span> <span class=main>⟹</span> <span class=skolem>R</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> R2<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=skolem>m</span> <span class=main>*</span> <span class=skolem>k'</span> <span class=main>≤</span> <span class=skolem>j'</span> <span class=main>*</span> <span class=skolem>k'</span> <span class=main>⟹</span> <span class=skolem>R</span>"</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>i</span> <span class=skolem>j</span> <span class=skolem>j'</span> <span class=skolem>k</span> <span class=skolem>k'</span> <span class=skolem>m</span> <span class=main>::</span> <span class=quoted>nat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>R</span>
    <span class=keyword1><span class=command>using</span></span> d
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> R1<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> mult_le_mono1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> R2<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> Suc_le_eq <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> mult_le_mono1<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>sc</span> <span class=main>⟹</span> <span class=skolem>sc</span> <span class=main>-</span> <span class=skolem>n</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>+</span> <span class=skolem>lb</span> <span class=main>*</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>≤</span> <span class=skolem>m</span> <span class=main>*</span> <span class=skolem>n</span> <span class=main>⟷</span> <span class=skolem>sc</span> <span class=main>+</span> <span class=skolem>lb</span> <span class=main>*</span> <span class=skolem>n</span> <span class=main>≤</span> <span class=skolem>m</span> <span class=main>*</span> <span class=skolem>n</span>"</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>sc</span> <span class=skolem>m</span> <span class=skolem>n</span> <span class=skolem>lb</span> <span class=main>::</span> <span class=quoted>nat</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=skolem>sc</span> <span class=main>≥</span> <span class=skolem>n</span>"</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> linorder_le_less_linear <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>m</span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>lb</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k'<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> *<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>nw</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_rsplit_aux.induct<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplit_aux.simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ** Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_len_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟶</span> <span class=free>ws</span> <span class=main>=</span> bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>w</span><span class=main>)</span> <span class=main>⟶</span> length <span class=free>ws</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>nw</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_rsplit_def bin_rsplit_aux_len_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_aux_len<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> length <span class=main>(</span>bin_rsplit_aux <span class=free>n</span> <span class=free>nw</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>nw</span> <span class=main>+</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>+</span> length <span class=free>cs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>nw</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>cs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_rsplit_aux.induct<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bin_rsplit_aux.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> thin_rl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>m</span> <span class=main>≤</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_add_self2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_len<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> length <span class=main>(</span>bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>nw</span> <span class=main>+</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_rsplit_def bin_rsplit_aux_len<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_aux_len_indep<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> length <span class=free>bs</span> <span class=main>=</span> length <span class=free>cs</span> <span class=main>⟹</span>
    length <span class=main>(</span>bin_rsplit_aux <span class=free>n</span> <span class=free>nw</span> <span class=free>v</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span>
    length <span class=main>(</span>bin_rsplit_aux <span class=free>n</span> <span class=free>nw</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>nw</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>cs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_rsplit_aux.induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>1 <span class=skolem>n</span> <span class=skolem>m</span> <span class=skolem>w</span> <span class=skolem>cs</span> <span class=skolem>v</span> <span class=skolem>bs</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹length <span class=skolem>bs</span> <span class=main>=</span> length <span class=skolem>cs</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>from</span></span> <span class=quoted>"1.hyps"</span> <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹bin_split <span class=skolem>n</span> <span class=skolem>w</span>›</span></span> <span class=quoted><span class=quoted>‹drop_bit <span class=skolem>n</span> <span class=skolem>w</span>›</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=skolem>n</span> <span class=skolem>w</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>have</span></span> hyp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>v</span> <span class=bound>bs</span><span class=main>.</span> length <span class=bound>bs</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=skolem>cs</span><span class=main>)</span> <span class=main>⟹</span>
      length <span class=main>(</span>bin_rsplit_aux <span class=skolem>n</span> <span class=main>(</span><span class=skolem>m</span> <span class=main>-</span> <span class=skolem>n</span><span class=main>)</span> <span class=bound>v</span> <span class=bound>bs</span><span class=main>)</span> <span class=main>=</span>
      length <span class=main>(</span>bin_rsplit_aux <span class=skolem>n</span> <span class=main>(</span><span class=skolem>m</span> <span class=main>-</span> <span class=skolem>n</span><span class=main>)</span> <span class=main>(</span>drop_bit <span class=skolem>n</span> <span class=skolem>w</span><span class=main>)</span> <span class=main>(</span>take_bit <span class=skolem>n</span> <span class=skolem>w</span> <span class=main>#</span> <span class=skolem>cs</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> bin_rsplit_aux_len <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹length <span class=skolem>bs</span> <span class=main>=</span> length <span class=skolem>cs</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_rsplit_aux_simp_alt Let_def bin_rsplit_len <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rsplit_len_indep<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> length <span class=main>(</span>bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> length <span class=main>(</span>bin_rsplit <span class=free>n</span> <span class=main>(</span><span class=free>nw</span><span class=main>,</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_rsplit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> bin_rsplit_aux_len_indep<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Logical operations›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>bin_sc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> bool <span class=main>⇒</span> int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    Z<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bin_sc</span> <span class=main>0</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> of_bool <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bin_rest <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
  <span class=main>|</span> Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bin_sc</span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> of_bool <span class=main>(</span>odd <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>bin_sc</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_sc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bit <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_sc_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> <span class=free>c</span> <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_sc <span class=free>n</span> <span class=free>c</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_sc_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≠</span> <span class=free>n</span> <span class=main>⟹</span> bin_sc <span class=free>m</span> <span class=free>c</span> <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_sc <span class=free>n</span> <span class=free>b</span> <span class=main>(</span>bin_sc <span class=free>m</span> <span class=free>c</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> <span class=quoted><span class=improper><span class=quoted><span class=improper>m</span></span></span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_sc_gen<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>b</span> <span class=keyword1>else</span> bin_nth <span class=free>w</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_sc <span class=free>n</span> False <span class=main>=</span> unset_bit <span class=free>n</span>›</span></span>
  <span class=quoted><span class=quoted>‹bin_sc <span class=free>n</span> True <span class=main>=</span> Bit_Operations.set_bit <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff bit_eq_iff<span class=main>)</span>
    <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_sc_gen bit_set_bit_iff bit_unset_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> <span class=main>(</span>bin_nth <span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_sc_gen<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_sc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_sign <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span> <span class=main>(</span><span class=operator>use</span> bin_rest_ge_0 <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> Suc <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=skolem>w</span> <span class=keyword1>div</span> <span class=numeral>2</span>›</span></span><span class=main>]</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_bintr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>x</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>m</span> <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>x</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq bit_eq_iff<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff bit_set_bit_iff bit_unset_bit_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_clr_le<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> False <span class=free>w</span> <span class=main>≤</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq unset_bit_less_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_set_ge<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> True <span class=free>w</span> <span class=main>≥</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq set_bit_greater_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_bin_clr_le<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bin_sc <span class=free>m</span> False <span class=free>w</span><span class=main>)</span> <span class=main>≤</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq take_bit_unset_bit_eq unset_bit_less_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintr_bin_set_ge<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bin_sc <span class=free>m</span> True <span class=free>w</span><span class=main>)</span> <span class=main>≥</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq take_bit_set_bit_eq set_bit_greater_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_FP <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> False <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_TM <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> True <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_sc_simps <span class=main>=</span> bin_sc.Z bin_sc.Suc bin_sc_TM bin_sc_FP

<span class=keyword1><span class=command>lemma</span></span> bin_sc_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_sc <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>b</span> <span class=free>w</span> <span class=main>=</span> bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_sc_Suc_minus <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> bin_sc_minus <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> bin_sc.Suc<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sc_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sc <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=free>b</span> <span class=free>w</span> <span class=main>=</span>
    of_bool <span class=main>(</span>odd <span class=free>w</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> bin_sc <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=free>b</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_sc_minus_simps <span class=main>=</span>
  bin_sc_simps <span class=main>(</span>2<span class=main>,</span>3<span class=main>,</span>4<span class=main>)</span> <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main><span class=main><span class=main>[</span></span></span></span>2<span class=main><span class=main><span class=main><span class=main>]</span></span></span></span> trans<span class=main>,</span> <span class=operator>OF</span> bin_sc_minus <span class=main><span class=main><span class=main><span class=main>[</span></span></span></span><span class=operator><span class=operator><span class=operator>THEN</span></span></span> sym<span class=main><span class=main><span class=main><span class=main>]</span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>instance</span></span> int <span class=main>::</span> <span class=quoted>semiring_bit_syntax</span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_int_def <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> bin_nth <span class=free>i</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_int_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"shiftl <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> push_bit_int_def shiftl_eq_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_int_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"shiftr <span class=free>x</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_int_def shiftr_eq_drop_bit<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic simplification rules›</span></span>

<span class=keyword1><span class=command>lemmas</span></span> int_not_def <span class=main>=</span> not_int_def

<span class=keyword1><span class=command>lemma</span></span> int_not_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=numeral>2</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> numeral <span class=main>(</span>Num.BitM <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_not_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.double_compl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.conj_zero_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_m1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.conj_one_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.disj_zero_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.disj_one_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>XOR</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.xor_zero_left<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Binary destructors›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_NOT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>bin_rest <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> not_int_div_2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_NOT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>¬</span> bin_last <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_AND <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=free>x</span> <span class=keyword1>AND</span> bin_rest <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> and_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_AND <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> bin_last <span class=free>x</span> <span class=main>∧</span> bin_last <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> and_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_OR <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=free>x</span> <span class=keyword1>OR</span> bin_rest <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> or_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_OR <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> bin_last <span class=free>x</span> <span class=main>∨</span> bin_last <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> or_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_XOR <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=free>x</span> <span class=keyword1>XOR</span> bin_rest <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> xor_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_XOR <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span>bin_last <span class=free>x</span> <span class=main>∨</span> bin_last <span class=free>y</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>(</span>bin_last <span class=free>x</span> <span class=main>∧</span> bin_last <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> xor_int_rec<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_ops<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> bin_nth <span class=main>(</span><span class=bound>x</span> <span class=keyword1>AND</span> <span class=bound>y</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> bin_nth <span class=bound>x</span> <span class=free>n</span> <span class=main>∧</span> bin_nth <span class=bound>y</span> <span class=free>n</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> bin_nth <span class=main>(</span><span class=bound>x</span> <span class=keyword1>OR</span> <span class=bound>y</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> bin_nth <span class=bound>x</span> <span class=free>n</span> <span class=main>∨</span> bin_nth <span class=bound>y</span> <span class=free>n</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> bin_nth <span class=main>(</span><span class=bound>x</span> <span class=keyword1>XOR</span> <span class=bound>y</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> bin_nth <span class=bound>x</span> <span class=free>n</span> <span class=main>≠</span> bin_nth <span class=bound>y</span> <span class=free>n</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> bin_nth <span class=main>(</span><span class=keyword1>NOT</span> <span class=bound>x</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=main>¬</span> bin_nth <span class=bound>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_and_iff bit_or_iff bit_xor_iff bit_not_iff<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Derived properties›</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=keyword1>XOR</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.xor_one_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_extra_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>XOR</span> <span class=main>0</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>XOR</span> <span class=main>-</span><span class=main>1</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_extra_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>OR</span> <span class=main>0</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>OR</span> <span class=main>-</span><span class=main>1</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_extra_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=main>-</span><span class=main>1</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Commutativity of the above.›</span></span>
<span class=keyword1><span class=command>lemma</span></span> bin_ops_comm<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> int_and_comm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=free>x</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> int_or_comm<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>OR</span> <span class=free>x</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> int_xor_comm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_ops_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_log_esimps <span class=main>=</span>
  int_and_extra_simps  int_or_extra_simps  int_xor_extra_simps
  int_and_0 int_and_m1 int_or_zero int_or_minus1 int_xor_zero int_xor_minus1


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic properties of logical (bit-wise) operations›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bbw_ao_absorb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bbw_ao_absorbs_other<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∧</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bbw_ao_absorbs <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> bbw_ao_absorb bbw_ao_absorbs_other

<span class=keyword1><span class=command>lemma</span></span> int_xor_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=free>y</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>∧</span> <span class=free>x</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_assoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_assoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_assoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bbw_assocs <span class=main>=</span> int_and_assoc int_or_assoc int_xor_assoc

<span class=comment1>(* BH: Why are these declared as simp rules??? *)</span>
<span class=keyword1><span class=command>lemma</span></span> bbw_lcs <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bbw_not_dist<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bbw_oa_dist<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bbw_ao_dist<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_eq_iff bin_nth_ops<span class=main>)</span>

<span class=comment1>(*
Why were these declared simp???
declare bin_ops_comm [simp] bbw_assocs [simp]
*)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Simplification with numerals›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Cases for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>0›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>-1›</span></span></span></span> are already covered by other simp rules.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_neg_numeral_BitM <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.BitM <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_neg_numeral_BitM <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>Num.BitM <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Interactions with arithmetic›</span></span>

<span class=keyword1><span class=command>lemma</span></span> le_int_or<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def or_greater_eq <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> int_and_le <span class=main>=</span>
  xtrans<span class=main>(</span>3<span class=main>)</span> <span class=main>[</span><span class=operator>OF</span> bbw_ao_absorbs <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> <span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct2<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span> le_int_or<span class=main>]</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Interaction between bit-wise and arithmetic: good example of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>bin_induction›</span></span></span></span>.›</span></span>
<span class=keyword1><span class=command>lemma</span></span> bin_add_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=keyword1>NOT</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> AND_mod<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mod <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mask mask_eq_exp_minus_1<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Truncating results of bit-wise operations›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_trunc_ao<span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=free>x</span> <span class=keyword1>AND</span> bintrunc <span class=free>n</span> <span class=free>y</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=free>x</span> <span class=keyword1>OR</span> bintrunc <span class=free>n</span> <span class=free>y</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_trunc_xor<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>x</span> <span class=keyword1>XOR</span> bintrunc <span class=free>n</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_trunc_not<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>n</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> take_bit_not_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Want theorems of the form of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>bin_trunc_xor›</span></span></span></span>.›</span></span>
<span class=keyword1><span class=command>lemma</span></span> bintr_bintr_i<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>y</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_trunc_and <span class=main>=</span> bin_trunc_ao<span class=main>(</span>1<span class=main>)</span> <span class=main>[</span><span class=operator>THEN</span> bintr_bintr_i<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> bin_trunc_or <span class=main>=</span> bin_trunc_ao<span class=main>(</span>2<span class=main>)</span> <span class=main>[</span><span class=operator>THEN</span> bintr_bintr_i<span class=main>]</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹More lemmas›</span></span>

<span class=keyword1><span class=command>lemma</span></span> not_int_cmp_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=keyword1>NOT</span> <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=keyword1>NOT</span> <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=free>i</span> <span class=main>≤</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> int_not_def<span class=main>)</span> <span class=operator>arith</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> bbw_ao_dist2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>OR</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.conj_disj_distrib<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> int_and_ac <span class=main>=</span> bbw_lcs<span class=main>(</span>1<span class=main>)</span> int_and_comm int_and_assoc

<span class=keyword1><span class=command>lemma</span></span> int_nand_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> int_nand_same_middle<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff bit_and_iff bit_not_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_xor_dist<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>XOR</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bit.conj_xor_distrib<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_lt0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> and_negative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_ge0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> and_nonnegative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_1<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> and_one_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_1_and<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> one_and_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_lt0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> or_negative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_ge0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> or_nonnegative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_lt0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> xor_negative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_ge0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>x</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>y</span> <span class=main>≥</span> <span class=main>0</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> xor_nonnegative_int_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> even_conv_AND<span class=main>:</span>
  <span class=quoted><span class=quoted>‹even <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_one_eq mod2_eq_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_conv_AND<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_last <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_one_eq mod2_eq_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bitval_bin_last<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_bool <span class=main>(</span>bin_last <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span> <span class=keyword1>AND</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_one_eq mod2_eq_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_and<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span><span class=free>i</span> <span class=keyword1>AND</span> <span class=free>j</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span>bin_sign <span class=free>i</span> <span class=main>*</span> bin_sign <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_not_neg_numeral<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Num.sub <span class=free>n</span> num.One <span class=main>::</span> int<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> int_not_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_neg_numeral_pOne_conv_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> numeral <span class=main>(</span><span class=free>n</span> <span class=main>+</span> num.One<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>numeral <span class=free>n</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> int_not_def<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Setting and clearing bits›</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftl_BIT<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> int_shiftl0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> int_shiftl_Suc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;&lt;</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_0_shiftl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> bin_last <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span><span class=main>(</span><span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>else</span> bin_rest <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span><span class=main>(</span><span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_shiftl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>∧</span> bin_nth <span class=free>x</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_push_bit_iff_int shiftl_eq_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit bit_iff_odd_drop_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_shiftr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> Suc <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff shiftr_eq_drop_bit drop_bit_Suc bit_drop_bit_eq drop_bit_half<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_shiftr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> bin_nth <span class=free>x</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit bit_drop_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_conv_AND<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"bin_nth <span class=free>x</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_eq_push_bit bit_and_iff bit_push_bit_iff bit_exp_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftl_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;&lt;</span> numeral <span class=free>w'</span> <span class=main>=</span> numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>&lt;&lt;</span> pred_numeral <span class=free>w'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;&lt;</span> numeral <span class=free>w'</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>&lt;&lt;</span> pred_numeral <span class=free>w'</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc shiftl_int_def<span class=main>)</span>
  <span class=main>(</span><span class=operator>metis</span> add_One mult_inc semiring_norm<span class=main><span class=main>(</span></span>11<span class=main><span class=main>)</span></span> semiring_norm<span class=main><span class=main>(</span></span>13<span class=main><span class=main>)</span></span> semiring_norm<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> semiring_norm<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span> semiring_norm<span class=main><span class=main>(</span></span>87<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftl_One_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;&lt;</span> numeral <span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>&lt;&lt;</span> pred_numeral <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> int_shiftl_numeral <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>Num.One</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>w</span></span></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_ge_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_lt_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> not_le shiftl_ge_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftl_test_bit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>i</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>m</span> <span class=main>≥</span> <span class=free>i</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>!!</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> int_0shiftr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_minus1_shiftr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_int_def div_eq_minus1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftr_ge_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftr_lt_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> int_shiftr_ge_0 not_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftr_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral num.One <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> numeral <span class=free>w</span> <span class=main>&gt;&gt;</span> pred_numeral <span class=free>w'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> numeral <span class=free>w</span> <span class=main>&gt;&gt;</span> pred_numeral <span class=free>w'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=free>w</span> <span class=main>&gt;&gt;</span> pred_numeral <span class=free>w'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> numeral <span class=free>w'</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span>Num.inc <span class=free>w</span><span class=main>)</span> <span class=main>&gt;&gt;</span> pred_numeral <span class=free>w'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit numeral_eq_Suc add_One drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftr_numeral_Suc0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral num.One <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=free>w</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span>Num.inc <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit drop_bit_Suc add_One<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_minus_p2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sign<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> m<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> bin_nth <span class=free>x</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> sign y x <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≥</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def shiftl_eq_push_bit push_bit_eq_mult <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=free>x</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>x</span> <span class=free>m</span> <span class=main>⟷</span> bit <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=free>m</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> 0
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>=</span> <span class=skolem>n</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> n<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>=</span> Suc <span class=skolem>q</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>x</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=skolem>q</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=skolem>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> Suc.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=keyword1>div</span> <span class=numeral>2</span>›</span></span> <span class=quoted><span class=skolem>q</span></span><span class=main>]</span> Suc.prems
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=skolem>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=skolem>m</span> <span class=main>⟷</span> bit <span class=main>(</span><span class=skolem>x</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span><span class=main>)</span> <span class=skolem>m</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> n<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc n<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_clr_conv_NAND<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> False <span class=free>i</span> <span class=main>=</span> <span class=free>i</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> bin_rl_eqI<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_set_conv_OR<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sc <span class=free>n</span> True <span class=free>i</span> <span class=main>=</span> <span class=free>i</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>i</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> bin_rl_eqI<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹More lemmas on words›</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rcat_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_rcat <span class=free>ws</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_rcat <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span> <span class=main>(</span>map uint <span class=free>ws</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ws</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word list›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rcat_def bin_rcat_def rev_map<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> horner_sum_foldr foldr_map comp_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sign_uint_Pls <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>uint <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_Pls_ge_0<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_log_bintrs <span class=main>=</span> bin_trunc_not bin_trunc_xor bin_trunc_and bin_trunc_or

<span class=comment1>― ‹following definitions require both arithmetic and bit-wise word operations›</span>

<span class=comment1>― ‹to get <span class=antiquoted><span class=raw_text><span class=operator>‹</span>word_no_log_defs›</span></span> from <span class=antiquoted><span class=raw_text><span class=operator>‹</span>word_log_defs›</span></span>, using <span class=antiquoted><span class=raw_text><span class=operator>‹</span>bin_log_bintrs›</span></span>›</span>
<span class=keyword1><span class=command>lemmas</span></span> wils1 <span class=main>=</span> bin_log_bintrs <span class=main>[</span><span class=operator>THEN</span> word_of_int_eq_iff <span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator>THEN</span></span></span></span> iffD2<span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span><span class=main>,</span>
  <span class=operator>folded</span> uint_word_of_int_eq<span class=main>,</span> <span class=operator>THEN</span> eq_reflection<span class=main>]</span>

<span class=comment1>― ‹the binary operations only›</span>  <span class=comment1>(* BH: why is this needed? *)</span>
<span class=keyword1><span class=command>lemmas</span></span> word_log_binary_defs <span class=main>=</span>
  word_and_def word_or_def word_xor_def

<span class=keyword1><span class=command>lemma</span></span> setBit_no <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"setBit <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> True <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> clearBit_no <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"clearBit <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> False <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sc_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> eq_mod_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>⟷</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>metis</span> pos_mod_conj<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> split_uint_lem<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=free>a</span> <span class=main>=</span> take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=comment1>― ‹limited hom result›</span>
<span class=keyword1><span class=command>lemma</span></span> word_cat_hom<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'c</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span>word_cat <span class=main>(</span>word_of_int <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span>
    word_of_int <span class=main>(</span>bin_cat <span class=free>w</span> <span class=main>(</span>size <span class=free>b</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_concat_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"take_bit <span class=free>n</span> <span class=main>(</span><span class=free>m</span> <span class=main>&lt;&lt;</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> take_bit <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>i</span><span class=main>)</span> <span class=free>m</span> <span class=main>&lt;&lt;</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>m</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> uint_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"uint <span class=main>(</span><span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> take_bit <span class=main>(</span>size <span class=free>n</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> push_bit_take_bit shiftl_eq_push_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_mask_conv_pow2<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> mask_eq_exp_minus_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_mask_ge0<span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>≥</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> mask_nonnegative_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_bin_mask_conv_mod<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mod <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_mask_numeral<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=main>(</span>numeral <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> mask <span class=main>(</span>pred_numeral <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> mask_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bit <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span> <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_mask_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def bin_mask_conv_pow2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_mask_p1_conv_shift<span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_mask_conv_pow2 shiftl_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_eq_in_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> range <span class=main>(</span>sbintrunc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> range <span class=main>(</span>sbintrunc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> sbintrunc_sbintrunc<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_If<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=numeral>3</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>3</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>
    <span class=main>⟹</span> sbintrunc <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>
        <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free>x</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> no_sbintr_alt2<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_pos_geq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_add_self1<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_range'<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> sint <span class=free>x</span> <span class=main>∧</span> sint <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command>using</span></span> sbintr_ge sbintr_lt <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> signed_arith_eq_checks_to_ord<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=keyword1>&lt;=s</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=keyword1>&lt;=s</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>0</span> <span class=keyword1>&lt;=s</span> <span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>&lt;=s</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> sint <span class=free>a</span> <span class=main>=</span> sint <span class=main>(</span><span class=main>-</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=keyword1>&lt;=s</span> <span class=main>(</span><span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>&lt;=s</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> sint_range'<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span><span class=main>]</span> sint_range'<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>b</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sint_word_ariths word_sle_eq word_sless_alt sbintrunc_If<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> signed_mult_eq_checks_double_size<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> mult_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=numeral>2</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>^</span> <span class=main>(</span>len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>^</span> <span class=main>(</span>len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>*</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>
       <span class=main>=</span> <span class=main>(</span>scast <span class=free>a</span> <span class=main>*</span> scast <span class=free>b</span> <span class=main>=</span> <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> P<span class=main>:</span> <span class=quoted><span class=quoted>"sbintrunc <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span><span class=main>)</span> <span class=main>∈</span> range <span class=main>(</span>sbintrunc <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> abs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>!!</span> <span class=bound>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>.</span> abs <span class=main>(</span>sint <span class=bound>x</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> sint_range'<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_le_iff word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>have</span></span> abs_ab<span class=main>:</span> <span class=quoted><span class=quoted>"abs <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> abs_mult_less<span class=main>[</span><span class=operator>OF</span> abs<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>a</span></span><span class=main><span class=main>]</span></span> abs<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span><span class=main>]</span> mult_le
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_mult power2_eq_square word_size<span class=main>)</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> Suc <span class=skolem>r</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> Suc <span class=skolem>s</span>›</span></span>
    <span class=quoted><span class=quoted>‹size <span class=free>a</span> <span class=main>=</span> Suc <span class=skolem>r</span>›</span></span> <span class=quoted><span class=quoted>‹size <span class=free>b</span> <span class=main>=</span> Suc <span class=skolem>r</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> P<span class=main>[</span><span class=operator>unfolded</span> range_sbintrunc<span class=main>]</span> abs_ab le
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span> <span class=quasi_keyword>fixing</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>r</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_int_eq_self <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> signed_take_bit_eq_iff_take_bit_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>code_identifier</span></span>
  <span class=keyword2><span class=keyword>code_module</span></span> Bits_Int <span class=main>⇀</span>
  <span class=main>(</span>SML<span class=main>)</span> Bit_Operations <span class=keyword2><span class=keyword>and</span></span> <span class=main>(</span>OCaml<span class=main>)</span> Bit_Operations <span class=keyword2><span class=keyword>and</span></span> <span class=main>(</span>Haskell<span class=main>)</span> Bit_Operations <span class=keyword2><span class=keyword>and</span></span> <span class=main>(</span>Scala<span class=main>)</span> Bit_Operations

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Typedef_Morphisms><div class=head><h1>Theory Typedef_Morphisms</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(*
  Author: Jeremy Dawson and Gerwin Klein, NICTA

  Consequences of type definition theorems, and of extended type definition.
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Type Definition Theorems›</span></span>

<span class=keyword1><span class=command>theory</span></span> Typedef_Morphisms
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span> <a href=Bit_Comprehension.html>Bit_Comprehension</a> <a href=Bits_Int.html>Bits_Int</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"More lemmas about normal type definitions"</span></span>

<span class=keyword1><span class=command>lemma</span></span> tdD1<span class=main>:</span> <span class=quoted><span class=quoted>"type_definition <span class=free>Rep</span> <span class=free>Abs</span> <span class=free>A</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>Rep</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> tdD2<span class=main>:</span> <span class=quoted><span class=quoted>"type_definition <span class=free>Rep</span> <span class=free>Abs</span> <span class=free>A</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>Abs</span> <span class=main>(</span><span class=free>Rep</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=bound>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> tdD3<span class=main>:</span> <span class=quoted><span class=quoted>"type_definition <span class=free>Rep</span> <span class=free>Abs</span> <span class=free>A</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟶</span> <span class=free>Rep</span> <span class=main>(</span><span class=free>Abs</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=bound>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> type_definition_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_nat_int<span class=main>:</span> <span class=quoted><span class=quoted>"type_definition int nat <span class=main>(</span>Collect <span class=main>(</span><span class=main>(≤)</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> type_definition_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>context</span></span> type_definition
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>declare</span></span> Rep <span class=main>[</span><span class=operator>iff</span><span class=main>]</span> Rep_inverse <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> Rep_inject <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> Abs_eqD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=free>x</span> <span class=main>=</span> <span class=free>Abs</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Abs_inject<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Abs_inverse'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>Abs</span> <span class=free>r</span> <span class=main>=</span> <span class=free>a</span> <span class=main>⟹</span> <span class=free>Rep</span> <span class=free>a</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> Abs_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Rep_comp_inverse<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⟹</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Rep_inverse <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> Rep_eqD <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main>!</span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=free>x</span> <span class=main>=</span> <span class=free>Rep</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> Rep_inverse'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=free>a</span> <span class=main>=</span> <span class=free>r</span> <span class=main>⟹</span> <span class=free>Abs</span> <span class=free>r</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> Rep_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> comp_Abs_inverse<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⟹</span> <span class=free>g</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Rep_inverse <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> set_Rep<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> range <span class=free>Rep</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟷</span> <span class=skolem>x</span> <span class=main>∈</span> range <span class=free>Rep</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Abs_inverse <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> set_Rep_Abs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> range <span class=main>(</span><span class=free>Rep</span> <span class=main>∘</span> <span class=free>Abs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟷</span> <span class=skolem>x</span> <span class=main>∈</span> range <span class=main>(</span><span class=free>Rep</span> <span class=main>∘</span> <span class=free>Abs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Abs_inverse <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> Abs_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=free>Abs</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Abs_inject <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> image<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> UNIV"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> Abs_image<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> td_thm <span class=main>=</span> type_definition_axioms

<span class=keyword1><span class=command>lemma</span></span> fns1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>∨</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟹</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>=</span> <span class=free>fa</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Rep_comp_inverse <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> comp_Abs_inverse <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> o_assoc<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> fns1a <span class=main>=</span> disjI1 <span class=main>[</span><span class=operator>THEN</span> fns1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> fns1b <span class=main>=</span> disjI2 <span class=main>[</span><span class=operator>THEN</span> fns1<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> fns4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>⟹</span> <span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>∧</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>interpretation</span></span> nat_int<span class=main>:</span> type_definition <span class=quoted>int</span> <span class=quoted>nat</span> <span class=quoted><span class=quoted>"Collect <span class=main>(</span><span class=main>(≤)</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> td_nat_int<span class=main>)</span>

<span class=keyword1><span class=command>declare</span></span>
  nat_int.Rep_cases <span class=main>[</span><span class=operator>cases</span> <span class=quasi_keyword>del</span><span class=main>]</span>
  nat_int.Abs_cases <span class=main>[</span><span class=operator>cases</span> <span class=quasi_keyword>del</span><span class=main>]</span>
  nat_int.Rep_induct <span class=main>[</span><span class=operator>induct</span> <span class=quasi_keyword>del</span><span class=main>]</span>
  nat_int.Abs_induct <span class=main>[</span><span class=operator>induct</span> <span class=quasi_keyword>del</span><span class=main>]</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Extended form of type definition predicate"</span></span>

<span class=keyword1><span class=command>lemma</span></span> td_conds<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>norm</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span> <span class=main>⟹</span>
    <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟷</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>∧</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_assoc<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> fn_comm_power<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>fa</span> <span class=main>∘</span> <span class=free>tr</span> <span class=main>=</span> <span class=free>tr</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟹</span> <span class=free>fa</span> <span class=main>^^</span> <span class=free>n</span> <span class=main>∘</span> <span class=free>tr</span> <span class=main>=</span> <span class=free>tr</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>^^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> fun_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> fn_comm_power' <span class=main>=</span>
  ext <span class=main>[</span><span class=operator>THEN</span> fn_comm_power<span class=main>,</span> <span class=operator>THEN</span> fun_cong<span class=main>,</span> <span class=operator>unfolded</span> o_def<span class=main>]</span>


<span class=keyword1><span class=command>locale</span></span> td_ext <span class=main>=</span> type_definition <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>norm</span>
  <span class=keyword2><span class=keyword>assumes</span></span> eq_norm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>Rep</span> <span class=main>(</span><span class=free>Abs</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>norm</span> <span class=bound>x</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> Abs_norm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=main>(</span><span class=free>norm</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>Abs</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> eq_norm <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> Rep_inverse'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_th<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>g</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>Rep</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> comp_Abs_inverse <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> eq_norm'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>norm</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> eq_norm<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> norm_Rep <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>norm</span> <span class=main>(</span><span class=free>Rep</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>Rep</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> eq_norm' <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> td_th<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> td <span class=main>=</span> td_thm

<span class=keyword1><span class=command>lemma</span></span> set_iff_norm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> <span class=free>norm</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_Rep_Abs eq_norm' eq_norm <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> inverse_norm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=main>⟷</span> <span class=free>Rep</span> <span class=free>w</span> <span class=main>=</span> <span class=free>norm</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_norm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_norm' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> norm_eq_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>norm</span> <span class=free>x</span> <span class=main>=</span> <span class=free>norm</span> <span class=free>y</span> <span class=main>⟷</span> <span class=free>Abs</span> <span class=free>x</span> <span class=main>=</span> <span class=free>Abs</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_norm' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> norm_comps<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>Abs</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>norm</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>=</span> <span class=free>Rep</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>norm</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> eq_norm' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> o_def<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> norm_norm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> norm_comps

<span class=keyword1><span class=command>lemma</span></span> fns5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>⟹</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∧</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>=</span> <span class=free>fr</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fold</span> eq_norm'<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  following give conditions for converses to <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>td_fns1›</span></span></span></span>
  <span class=antiquoted><span class=antiquoted>▪</span></span> the condition <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>norm ∘ fr ∘ norm = fr ∘ norm›</span></span></span></span> says that
    <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fr›</span></span></span></span> takes normalised arguments to normalised results
  <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>norm ∘ fr ∘ norm = norm ∘ fr›</span></span></span></span> says that <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fr›</span></span></span></span>
    takes norm-equivalent arguments to norm-equivalent results
  <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fr ∘ norm = fr›</span></span></span></span> says that <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fr›</span></span></span></span>
    takes norm-equivalent arguments to the same result
  <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>norm ∘ fr = fr›</span></span></span></span> says that <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fr›</span></span></span></span> takes any argument to a normalised result
›</span></span>
<span class=keyword1><span class=command>lemma</span></span> fns2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>=</span> <span class=free>fa</span> <span class=main>⟹</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>⟷</span> <span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fold</span> eq_norm'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>Rep</span> <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> fun_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> fns3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span> <span class=main>=</span> <span class=free>fa</span> <span class=main>⟹</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟷</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fold</span> eq_norm'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∘</span> <span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> fun_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> fns<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>fr</span> <span class=main>∘</span> <span class=free>norm</span> <span class=main>=</span> <span class=free>norm</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟹</span> <span class=free>fa</span> <span class=main>∘</span> <span class=free>Abs</span> <span class=main>=</span> <span class=free>Abs</span> <span class=main>∘</span> <span class=free>fr</span> <span class=main>⟷</span> <span class=free>Rep</span> <span class=main>∘</span> <span class=free>fa</span> <span class=main>=</span> <span class=free>fr</span> <span class=main>∘</span> <span class=free>Rep</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> fns1b<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> fns1a<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fns3 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 3
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fns2 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_assoc<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_norm<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=free>Rep</span> <span class=main>∘</span> <span class=free>Abs</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_Rep_Abs<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemmas</span></span> td_ext_def' <span class=main>=</span>
  td_ext_def <span class=main>[</span><span class=operator>unfolded</span> type_definition_def td_ext_axioms_def<span class=main>]</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Type-definition locale instantiations›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>uints</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> int set"</span></span>
  <span class=comment1>― ‹the sets of integers representing the words›</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>uints</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> range <span class=main>(</span>take_bit <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sints</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> int set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>sints</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> range <span class=main>(</span>signed_take_bit <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> uints_num<span class=main>:</span> <span class=quoted><span class=quoted>"uints <span class=free>n</span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uints_def range_bintrunc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sints_num<span class=main>:</span> <span class=quoted><span class=quoted>"sints <span class=free>n</span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sints_def range_sbintrunc<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unats</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>unats</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>}</span>"</span></span>

<span class=comment1>― ‹naturals›</span>
<span class=keyword1><span class=command>lemma</span></span> uints_unats<span class=main>:</span> <span class=quoted><span class=quoted>"uints <span class=free>n</span> <span class=main>=</span> int <span class=main>`</span> unats <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> unats_def uints_num<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> image_eqI<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> nat_0_le <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> unats_uints<span class=main>:</span> <span class=quoted><span class=quoted>"unats <span class=free>n</span> <span class=main>=</span> nat <span class=main>`</span> uints <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uints_unats image_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_ext_uint<span class=main>:</span>
  <span class=quoted><span class=quoted>"td_ext <span class=main>(</span>uint <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> int<span class=main>)</span> word_of_int <span class=main>(</span>uints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span><span class=main>λ</span><span class=bound>w</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> td_ext_def'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uints_num take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>interpretation</span></span> word_uint<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"uint<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> int"</span></span>
    <span class=quoted>word_of_int</span>
    <span class=quoted><span class=quoted>"uints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=bound>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> td_ext_uint<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> td_uint <span class=main>=</span> word_uint.td_thm
<span class=keyword1><span class=command>lemmas</span></span> int_word_uint <span class=main>=</span> word_uint.eq_norm

<span class=keyword1><span class=command>lemma</span></span> td_ext_ubin<span class=main>:</span>
  <span class=quoted><span class=quoted>"td_ext <span class=main>(</span>uint <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> int<span class=main>)</span> word_of_int <span class=main>(</span>uints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>standard</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>interpretation</span></span> word_ubin<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"uint<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> int"</span></span>
    <span class=quoted>word_of_int</span>
    <span class=quoted><span class=quoted>"uints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> td_ext_ubin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_ext_unat <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    td_ext <span class=main>(</span>unat <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> nat<span class=main>)</span> of_nat <span class=main>(</span>unats <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unats_def take_bit_of_nat take_bit_nat_eq_self_iff
      <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> unat_of_nat <span class=main>=</span> td_ext_unat <span class=main>[</span><span class=operator>THEN</span> td_ext.eq_norm<span class=main>]</span>

<span class=keyword1><span class=command>interpretation</span></span> word_unat<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"unat<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat"</span></span>
    <span class=quoted>of_nat</span>
    <span class=quoted><span class=quoted>"unats <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> td_ext_unat<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> td_unat <span class=main>=</span> word_unat.td_thm

<span class=keyword1><span class=command>lemma</span></span> unat_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> unat <span class=free>z</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>∈</span> unats <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>z</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> unats_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xtrans<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> unat_lt2p<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> td_ext_sbin<span class=main>:</span>
  <span class=quoted><span class=quoted>"td_ext <span class=main>(</span>sint <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> int<span class=main>)</span> word_of_int <span class=main>(</span>sints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>(</span>signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sints_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> td_ext_sint<span class=main>:</span>
  <span class=quoted><span class=quoted>"td_ext <span class=main>(</span>sint <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> int<span class=main>)</span> word_of_int <span class=main>(</span>sints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span><span class=main>)</span>
     <span class=main>(</span><span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=main>(</span><span class=bound>w</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span>
         <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> td_ext_sbin <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tvar>?'a</span> <span class=main><span class=main>=</span></span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> no_sbintr_alt2<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We do <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>sint›</span></span></span></span> before <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>sbin›</span></span></span></span>, before <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>sint›</span></span></span></span> is the user version
  and interpretations do not produce thm duplicates. I.e.
  we get the name <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>word_sint.Rep_eqD›</span></span></span></span>, but not <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>word_sbin.Req_eqD›</span></span></span></span>,
  because the latter is the same thm as the former.
›</span></span>
<span class=keyword1><span class=command>interpretation</span></span> word_sint<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"sint <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> int"</span></span>
    <span class=quoted>word_of_int</span>
    <span class=quoted><span class=quoted>"sints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=main>(</span><span class=bound>w</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span><span class=main>^</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span>
      <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> td_ext_sint<span class=main>)</span>

<span class=keyword1><span class=command>interpretation</span></span> word_sbin<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"sint <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> int"</span></span>
    <span class=quoted>word_of_int</span>
    <span class=quoted><span class=quoted>"sints <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> td_ext_sbin<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> int_word_sint <span class=main>=</span> td_ext_sint <span class=main>[</span><span class=operator>THEN</span> td_ext.eq_norm<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> td_sint <span class=main>=</span> word_sint.td

<span class=keyword1><span class=command>lemma</span></span> uints_mod<span class=main>:</span> <span class=quoted><span class=quoted>"uints <span class=free>n</span> <span class=main>=</span> range <span class=main>(</span><span class=main>λ</span><span class=bound>w</span><span class=main>.</span> <span class=bound>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> uints_def <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> no_bintr_alt1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bintr_num <span class=main>=</span>
  word_ubin.norm_eq_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"numeral <span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"numeral <span class=free>b</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>,</span> <span class=operator>folded</span> word_numeral_alt<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span>
<span class=keyword1><span class=command>lemmas</span></span> sbintr_num <span class=main>=</span>
  word_sbin.norm_eq_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"numeral <span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"numeral <span class=free>b</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>,</span> <span class=operator>folded</span> word_numeral_alt<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span>

<span class=keyword1><span class=command>lemmas</span></span> uint_div_alt <span class=main>=</span> word_div_def <span class=main>[</span><span class=operator>THEN</span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> uint_cong int_word_uint<span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> uint_mod_alt <span class=main>=</span> word_mod_def <span class=main>[</span><span class=operator>THEN</span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> uint_cong int_word_uint<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>interpretation</span></span> test_bit<span class=main>:</span>
  td_ext
    <span class=quoted><span class=quoted>"<span class=main>(!!)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat <span class=main>⇒</span> bool"</span></span>
    <span class=quoted>set_bits</span>
    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>f</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>f</span> <span class=bound>i</span> <span class=main>⟶</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>h</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>h</span> <span class=bound>i</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>standard</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_word_eq bit_imp_le_length bit_set_bits_word_iff set_bits_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> td_nth <span class=main>=</span> test_bit.td_thm

<span class=keyword1><span class=command>lemma</span></span> sints_subset<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> sints <span class=free>m</span> <span class=main>⊆</span> sints <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sints_num<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Aligned><div class=head><h1>Theory Aligned</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Word Alignment"</span></span>

<span class=keyword1><span class=command>theory</span></span> Aligned
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=More_Word.html>More_Word</a>
    <a href=Word_EqI.html>Word_EqI</a>
    <a href=Typedef_Morphisms.html>Typedef_Morphisms</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> is_aligned <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span> <span class=bound>n</span><span class=main>.</span> <span class=numeral>2</span> <span class=main>^</span> <span class=bound>n</span> <span class=keyword1>dvd</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=bound>k</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_iff_udvd<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟷</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>udvd</span> <span class=free>w</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_iff_take_bit_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟷</span> take_bit <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_udvd take_bit_eq_0_iff exp_dvd_iff_exp_udvd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_iff_dvd_int<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>ptr</span> <span class=free>n</span> <span class=main>⟷</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>dvd</span> uint <span class=free>ptr</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_iff_dvd_nat<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>ptr</span> <span class=free>n</span> <span class=main>⟷</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>dvd</span> unat <span class=free>ptr</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹unat <span class=free>ptr</span> <span class=main>=</span> nat <span class=main>¦</span>uint <span class=free>ptr</span><span class=main>¦</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>dvd</span> unat <span class=free>ptr</span> <span class=main>⟷</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>dvd</span> uint <span class=free>ptr</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> dvd_nat_abs_iff<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_dvd_int<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=main>0</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_at_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_beyond_length<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_udvd<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_alignedI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>?</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>x</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>unfold</span> is_aligned_iff_udvd<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>udvd</span> <span class=free>x</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> dvd_triv_left exp_dvd_iff_exp_udvd <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_alignedE<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> word_of_nat <span class=free>q</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_beyond_length<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> that <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=free>thesis</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span>›</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> l<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=skolem>m</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>udvd</span> <span class=free>w</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_udvd<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word›</span></span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹unat <span class=free>w</span> <span class=main>=</span> unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>*</span> unat <span class=skolem>v</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>=</span> unat <span class=skolem>v</span>›</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> unat_w<span class=main>:</span> <span class=quoted><span class=quoted>‹unat <span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_of_nat <span class=main>(</span>unat <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>word_of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> w<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> word_of_nat <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=skolem>q</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=skolem>q</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> l power_add<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> unat_w <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_antisym nat_less_le unsigned_less<span class=main>)</span> 
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=free>thesis</span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_alignedE' <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>?</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>q</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=main>(</span>word_of_nat <span class=free>q</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> word_of_nat <span class=skolem>q</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedE<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=main>(</span>word_of_nat <span class=skolem>q</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> push_bit_eq_mult<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=free>thesis</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_take_bit_eq_0 take_bit_eq_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_imp_not_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>¬</span> bit <span class=free>w</span> <span class=free>m</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹is_aligned <span class=free>w</span> <span class=free>n</span>›</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=main>(</span>word_of_nat <span class=skolem>q</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> bit <span class=main>(</span>push_bit <span class=free>n</span> <span class=main>(</span>word_of_nat <span class=skolem>q</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span> <span class=free>m</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_weaken<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>w</span> <span class=free>x</span><span class=main>;</span> <span class=free>x</span> <span class=main>≥</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=free>w</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_aligned_iff_dvd_nat
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> dvd_trans <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_imp_power_dvd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_alignedE_pre<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> aligned<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>        rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=bound>q</span><span class=main>)</span> <span class=main>∧</span> <span class=bound>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> aligned is_alignedE <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_aligned<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> aligned1<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     aligned2<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>y</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>           lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> nlt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_aligned_iff_dvd_nat dvd_def
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> aligned2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q2</span></span> <span class=keyword2><span class=keyword>where</span></span> yv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> of_nat <span class=skolem>q2</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> q2v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q2</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> lt <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> aligned1 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q1</span></span> <span class=keyword2><span class=keyword>where</span></span> xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> of_nat <span class=skolem>q1</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> q1v<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q1</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> l1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> q1v<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=main>(</span><span class=operator>subst</span> kv<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> nlt<span class=main><span class=main>]</span></span><span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> l2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> q2v<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
          <span class=operator>rule</span> order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> order_le_less_trans<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span>  <span class=skolem>q1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> xv
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> yv
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> upls<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>q2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> f1<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>q1</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>q1</span><span class=main>)</span>›</span></span> l1 nat_mod_lem word_unat.inverse_norm
                             zero_less_numeral zero_less_power<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span><span class=main>)</span>›</span></span> l2 nat_mod_lem word_unat.inverse_norm
                             zero_less_numeral zero_less_power<span class=main>)</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> f1 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add semiring_normalization_rules<span class=main><span class=main>(</span></span>34<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=comment1>(* (2 ^ k * q1 + q2) *)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>d</span><span class=main>.</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=bound>d</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> unat_plus_if'<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> if_P<span class=main>)</span> <span class=operator>fact</span>

      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>q2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upls<span class=main>)</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>q2</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> upls<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> refl<span class=main>)</span>

      <span class=keyword1><span class=command>also</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span>  <span class=skolem>q2</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> len_of <span class=main>(</span><span class=keyword1>TYPE</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_trans less_imp_le_nat lt nlt<span class=main>)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_mod_right ordered_cancel_comm_monoid_diff_class.add_diff_inverse power_add<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> assms
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask not_less take_bit_eq_mod power_overflow word_arith_nat_defs<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> aligned_sub_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span>
   <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> add_uminus_conv_diff <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>diff_conv_add_uminus<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> aligned_add_aligned<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_alignedE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span> of_nat <span class=improper>q</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> is_alignedI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_shift<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>k</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> mv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> mv <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> mq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=skolem>q</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_imp_add_positive<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>dvd</span> unat <span class=main>(</span><span class=free>k</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword1><span class=command>have</span></span> kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>unat <span class=free>k</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span> <span class=main>+</span> unat <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span> <span class=main>=</span> unat <span class=free>k</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> div_mult_mod_eq<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>k</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> unat <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> mv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mq <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> power_add<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mod_mult2_eq<span class=main>)</span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>k</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>q</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> is_aligned_iff_dvd_nat<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less power_overflow is_aligned_mask shiftl_zero_size word_size<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mod_by_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_arith_nat_mod<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mod_eq_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_aligned_iff_dvd_nat
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_mask_dvd_nat p2_gt_0 word_mod_2p_is_mask<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask take_bit_eq_mod<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_triv<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> k <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=main>1</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_mult_triv1<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>x</span>  <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedI <span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_mult_triv2<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mult_triv1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_power_less_0_is_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>^</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_wrap<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>off</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ptr</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    off<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>+</span> unat <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> off p2_gt_0 word_neq_0_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> ptrq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ptr</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> of_nat <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    qv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>sz</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> off ptrq qv
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> sne<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>sz</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> uq<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=skolem>q</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> qv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_strict_increasing <span class=main><span class=main>[</span></span><span class=operator>OF</span> diff_less <span class=main><span class=main>[</span></span><span class=operator>OF</span> sne<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

      <span class=keyword1><span class=command>have</span></span> uptr<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ptrq<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uq<span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> qv order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uq<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>+</span> unat <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> szv
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uptr<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> nat_add_offset_less <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ qv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono <span class=main><span class=main>[</span></span><span class=operator>OF</span> off<span class=main><span class=main>]</span></span> order_eq_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_wrap'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ptr</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    off<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>ptr</span> <span class=main>≤</span> <span class=free>ptr</span> <span class=main>+</span> <span class=free>off</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> no_plus_overflow_unat_size<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> word_size<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> is_aligned_no_wrap<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_overflow'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span><span class=main>&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt unat_sub_if_size<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> al
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_wrap'<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>n</span><span class=main>&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less power_overflow is_aligned_mask mask_2pm1<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_overflow<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>sz</span> <span class=main>⟹</span> <span class=free>ptr</span> <span class=main>≤</span> <span class=free>ptr</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>sz</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> is_aligned_no_overflow'<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> replicate_not_True<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> replicate <span class=bound>n</span> False <span class=main>⟹</span> True <span class=main>∉</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> map_zip_replicate_False_xor<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=main>(</span>replicate <span class=free>n</span> False<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_minus_lem<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>n'</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> drop <span class=main>(</span><span class=free>n'</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> rev <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>  <span class=main>#</span> drop <span class=main>(</span>Suc <span class=main>(</span><span class=free>n'</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>n'</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>y</span> <span class=skolem>ys</span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> Cons.prems
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=skolem>ys</span><span class=main>)</span>"</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_diff_le Cons.hyps nth_append<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>n'</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> drop <span class=main>(</span><span class=free>n'</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> rev <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span>  <span class=main>#</span> drop <span class=main>(</span><span class=free>n'</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> drop_minus_lem<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_diff_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_xor<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>‹is_aligned <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=free>n'</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> bit <span class=free>x</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_imp_not_bit<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>OR</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> disjunctive_add<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> bit <span class=free>x</span> <span class=free>n</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_mult_multI<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>p</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>n'</span> <span class=main>=</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span> <span class=free>n'</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> aligned_add_aligned<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> is_alignedI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> k<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>z</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_multI<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>p</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>n'</span> <span class=main>=</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=free>n'</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> aligned_add_aligned<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> is_alignedI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> k<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=free>x</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_wrap'''<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ptr</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span><span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>ptr</span> <span class=free>sz</span><span class=main>;</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>⟧</span>
         <span class=main>⟹</span> unat <span class=free>ptr</span> <span class=main>+</span> <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> is_aligned_no_wrap<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> off<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"of_nat <span class=free>off</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_of_nat_len<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> power_strict_increasing<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_get_word_bits<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
           <span class=main>⟦</span> <span class=free>p</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> meta_mp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask power_add power_overflow not_less
    <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> take_bit_length_eq take_bit_of_0 take_bit_tightened<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_small_is_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask less_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> is_aligned_less_sz<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>a</span> <span class=free>sz</span><span class=main>;</span> <span class=free>a</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> aligned_small_is_0<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> notE<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_at_least_t2n_diff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> p<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>y</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>-</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> aligned_small_is_0<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> aligned_sub_aligned<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_overflow''<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> is_aligned_no_overflow'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_sub_1_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_nth <span class=main>[</span><span class=operator>word_eqI_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n</span></span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>.</span> <span class=main>¬</span><span class=free>p</span> <span class=main>!!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_aligned_mask bang_eq word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>&lt;</span> size <span class=free>p</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> test_bit_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_inter<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>∩</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>¬</span><span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>c</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_inter_non_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>{</span><span class=free>p</span><span class=main>..</span><span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>∩</span> <span class=main>{</span><span class=free>p</span><span class=main>..</span><span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>;</span>
     is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>p</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> False"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> range_inter<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>p</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> impE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_no_overflow'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> notE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_no_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> not_aligned_mod_nz<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> al <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> notE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedI <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral mult.commute word_mod_div_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_add_offset_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>assumes</span></span> yv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     mn<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> mn<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> yv <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>qy</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>+</span> <span class=skolem>qy</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> yv xv <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> xv
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> mult_le_mono1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_wrap_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ptr</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    off<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>+</span> <span class=free>off</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> ptrq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ptr</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> of_nat <span class=skolem>q</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    qv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>sz</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> off ptrq qv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_Suc_eq Suc_le_eq<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> sne<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>sz</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> uq<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=skolem>q</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> qv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_strict_increasing <span class=main><span class=main>[</span></span><span class=operator>OF</span> diff_less <span class=main><span class=main>[</span></span><span class=operator>OF</span> sne<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

      <span class=keyword1><span class=command>have</span></span> uptr<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ptrq<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uq<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> qv order_less_imp_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uq<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower <span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unat <span class=free>ptr</span> <span class=main>+</span> <span class=free>off</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> szv
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uptr<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> nat_add_offset_le <span class=main><span class=main>[</span></span><span class=operator>OF</span> off qv<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_not_mask is_aligned_shift is_aligned_weaken<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=numeral>2</span> <span class=main>^</span> size <span class=free>x</span> <span class=main>-</span> unat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unat_sub_if_size<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> size <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_eq_0 word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=main>(</span><span class=main>-</span> <span class=free>p</span><span class=main>)</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹is_aligned <span class=free>p</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less is_aligned_beyond_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_bit_minus <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> add_mask_lower_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>p</span> <span class=main>!!</span> <span class=bound>n'</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size is_aligned_nth<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper><span class=quoted><span class=improper><span class=quoted><span class=improper>na</span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_less test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_nth not_le test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_andI1<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_andI2<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>y</span> <span class=free>n</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_nth nth_shiftl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>m</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_nth nth_shiftr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_shiftl_self<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_shift<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.left_neutral is_aligned_mask word_plus_and_or_coroll2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_shiftr_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_not_mask is_aligned_neg_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_shiftr_mask_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>v</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=free>v</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size nth_shiftl nth_shiftr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>.</span> <span class=free>x</span> <span class=main>!!</span> <span class=bound>m</span> <span class=main>⟶</span> <span class=bound>m</span> <span class=main>≥</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_aligned_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>m</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_eqD<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> test_bit_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>a</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask_eq_concrete<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>msk</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=free>msk</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_bw_assocs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_neg_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_and_not_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>n</span> <span class=free>k</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_aligned_less_sz leI <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_and_2_to_k<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=keyword1>AND</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_power2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>a</span><span class=main>)</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_triv is_aligned_weaken<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_sub_aligned'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>b</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> aligned_sub_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask_weaken<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
   <span class=keyword1><span class=command>using</span></span> is_aligned_neg_mask_eq is_aligned_weaken <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_not_mask is_aligned_shift<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_0'<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>0</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> is_aligned_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_offset_no_wrap<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>off</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>   offv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=skolem>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> kl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>sz</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> szv
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> xv<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_mult_power_lem<span class=main><span class=main>[</span></span><span class=operator>OF</span> kl<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> nat_add_offset_less<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> offv<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>simplified</span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> eq_imp_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_power_lower<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> kl<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> offv <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less power_overflow <span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_offset_mod<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> ux<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> aligned_add_offset_no_wrap<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> al szv
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_alignedE<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_unat.Rep_inject <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_mod<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_add_lem<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> ux<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_mult_power_lem<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mono<span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> kv<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> eq_imp_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_power_lower<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less power_overflow is_aligned_mask mask_eq_decr_exp
                  word_mod_by_0<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_neq_into_no_overlap<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> neq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     alx<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     aly<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>y</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>x</span> <span class=main>..</span> <span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>∩</span> <span class=main>{</span><span class=free>y</span> <span class=main>..</span> <span class=free>y</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equals0I<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
    <span class=keyword3><span class=command>assume</span></span> xb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=skolem>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> xt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> yb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=skolem>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> yt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=main>(</span><span class=bound>p</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=bound>k</span> <span class=bound>w</span><span class=main>.</span> <span class=main>⟦</span>uint <span class=bound>p</span> <span class=main>+</span> uint <span class=bound>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=bound>w</span> <span class=main>=</span> <span class=bound>p</span> <span class=main>+</span> <span class=bound>k</span><span class=main>;</span> <span class=bound>w</span> <span class=main>≤</span> <span class=bound>p</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> add.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> add.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> word_plus_mcs_4<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> no_plus_overflow_uint_size<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less power_2_ge_iff szv<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> le_less_trans mask_eq_decr_exp mask_lt_2pn order_less_imp_le szv<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>from</span></span> xb <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>kx</span></span> <span class=keyword2><span class=keyword>where</span></span>
      kx<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> <span class=skolem>kx</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
      kxl<span class=main>:</span> <span class=quoted><span class=quoted>"uint <span class=free>x</span> <span class=main>+</span> uint <span class=skolem>kx</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_le_exists'<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> yb <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ky</span></span> <span class=keyword2><span class=keyword>where</span></span>
      ky<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=free>y</span> <span class=main>+</span> <span class=skolem>ky</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
      kyl<span class=main>:</span> <span class=quoted><span class=quoted>"uint <span class=free>y</span> <span class=main>+</span> uint <span class=skolem>ky</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_le_exists'<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>kx</span> <span class=main>=</span> <span class=skolem>z</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> kx<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> aligned_add_offset_mod<span class=main>)</span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>kx</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rl<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=skolem>ky</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> ky<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> aligned_add_offset_mod<span class=main>)</span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ky</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> kyl ky yt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rl<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> kxky<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>kx</span> <span class=main>=</span> <span class=skolem>ky</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=skolem>kx</span> <span class=main>=</span> <span class=free>y</span> <span class=main>+</span> <span class=skolem>ky</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> kx <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> ky <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>using</span></span> neq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> neq alx aly
  <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask mask_eq_decr_exp power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>d</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> is_aligned_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> context_conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> take_bit_eq_mask word_bw_lcs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_log_esimps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add_left_imp_eq take_bit_eq_mask word_plus_and_or_coroll2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> mask_inner_mask <span class=main>=</span> mask_eqs<span class=main>(</span>1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_add_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>q</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>q</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mask_inner_mask <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_out_add_aligned<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=free>q</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>q</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mask_add_aligned <span class=main>[</span><span class=operator>OF</span> al<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_out_sub_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_or<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=main>=</span> <span class=free>p</span> <span class=keyword1>OR</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_take_bit_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword2><span class=keyword>for</span></span> m
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_take_bit_iff less_mask_eq take_bit_eq_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> not_greatest_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> NOT_mask add_diff_cancel_right' diff_0 is_aligned_neg_mask_eq not_le word_and_le1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_mono_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> False"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp linorder_not_less power_overflow<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> word_bits<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_plus_and_or_coroll2 add.commute<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_imp_le<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> and_mask_less_size<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size word_bits<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_overflow''<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_neg_mask word_bits<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> not_greatest_aligned<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> b<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_neg_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> b
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add.commute<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_plus<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> aligned_at_least_t2n_diff<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_neg_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> aligned_small_is_0<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_neg_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=free>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_and_le2<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"False"</span></span> <span class=keyword1><span class=command>using</span></span> b <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> and_neg_mask_eq_iff_not_mask_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>⟷</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_iff neg_mask_mono_le word_and_le1 word_and_le2 word_bw_same<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_le_high_bits <span class=main>[</span><span class=operator>word_eqI_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=main>∈</span> <span class=main>{</span><span class=free>n</span> <span class=main>..&lt;</span> size <span class=free>w</span><span class=main>}</span><span class=main>.</span> <span class=free>w</span> <span class=main>!!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size and_neg_mask_eq_iff_not_mask_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_eq_iff neg_mask_test_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_less_t2n<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>p</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>^</span><span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span><span class=main>^</span><span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mask_eq_iff_w2p<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_add_or word_ao_dist less_mask_eq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> less_mask_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> two_power_increasing<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_offset_non_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_neq_0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> gt0_iff_gem1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> plus_le_left_cancel_nowrap<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_wrap'<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_leq_le_minus_one<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_no_wrap'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> gt0_iff_gem1 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_neq_0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_over_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask mask_over_length<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_overflow_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> is_aligned_no_overflow'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_step<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n'</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>p'</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> mask <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>p'</span> <span class=free>n'</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>(</span><span class=free>p'</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>+</span> mask <span class=free>n'</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_over_length<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mask_over_length<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt unat_plus_simple<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_plus_simple<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> is_aligned_no_overflow_mask<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_plus_simple<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> is_aligned_no_overflow_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dvd_def is_aligned_iff_dvd_nat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> k k'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>thin_tac</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"unat <span class=skolem><span class=skolem><span class=skolem>p</span></span></span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=skolem><span class=skolem><span class=skolem>x</span></span></span>"</span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=skolem><span class=skolem><span class=skolem>p</span></span></span> <span class=skolem><span class=skolem><span class=skolem>x</span></span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Suc_le_mono<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Suc_2p_unat_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_imp_less_Suc<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> Suc_2p_unat_mask<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> power_2_mult_step_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_mask_offset_unat<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>off</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>   offv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>≤</span> mask <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>+</span> unat <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=skolem>k</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> kl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>sz</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

  <span class=keyword1><span class=command>from</span></span> offv szv <span class=keyword1><span class=command>have</span></span> offv'<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_2pm1 unat_less_power<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> szv
    <span class=keyword1><span class=command>using</span></span> al is_aligned_no_wrap''' offv' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> al <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> is_aligned_get_word_bits<span class=main>)</span> 
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_less_plus_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> plus_one_helper2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_aligned_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_eqD<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main>0</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_offset_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> p<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>y</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> aligned_at_least_t2n_diff<span class=main><span class=main>[</span></span><span class=operator>rotated</span> -1<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> plus_one_helper2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_is_non_zero_p1<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> aligned_less_plus_1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> aligned_sub_aligned<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ order_refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
           <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_triv<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> diff_add_eq diff_diff_eq2<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>symmetric</span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_less_add_right<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> aligned_small_is_0<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> order_less_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
         <span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_le_minus_one_leq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_no_wrap' is_aligned_no_overflow <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> gap_between_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>a</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> is_aligned <span class=free>a</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>b</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> aligned_add_offset_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_step_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>b</span> <span class=free>n</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>+</span> mask <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> False"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> notE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_over_length<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mask_over_length<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt not_less not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_plus_simple<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> is_aligned_no_overflow_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unat_add_lem' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask_offset_unat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> gap_between_aligned linorder_not_less mask_eq_decr_exp unat_arith_simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_mask_lessD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>+</span> mask <span class=free>n</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> is_aligned <span class=free>x</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_no_overflow' mask_2pm1 order_le_less_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_add_mask_less_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>n</span><span class=main>;</span>  <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> mask <span class=free>n</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>using</span></span> aligned_add_mask_lessD is_aligned_add_step_le word_le_not_less <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_diff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>m</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> alm<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>m</span> <span class=free>s1</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     aln<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>n</span> <span class=free>s2</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    s2wb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>      nm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>∈</span> <span class=main>{</span><span class=free>n</span> <span class=main>..</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    s1s2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>≤</span> <span class=free>s2</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     s10<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>s1</span>"</span></span> <span class=comment1>(* Probably can be folded into the proof … *)</span>
<span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=free>m</span> <span class=main>-</span> <span class=free>n</span> <span class=main>=</span> of_nat <span class=bound>q</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>∧</span> <span class=bound>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>s2</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=bound>s</span><span class=main>)</span><span class=main>;</span> <span class=bound>s</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=bound>s</span> <span class=main>*</span> of_nat <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=bound>s</span> <span class=main>*</span> <span class=bound>m</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=main>::</span> <span class=quoted>nat</span> <span class=keyword2><span class=keyword>and</span></span>  <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> m<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>(</span>of_nat <span class=skolem>m</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=skolem>m</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_less<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_increasing<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?thesis</span> <span class=skolem>m</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>using</span></span> s m
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iffD1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_mult_lem<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_less_power_trans<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>have</span></span> s1wb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> s2wb s1s2 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>from</span></span> alm <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>mq</span></span> <span class=keyword2><span class=keyword>where</span></span> mmq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=skolem>mq</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> mq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>mq</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> aln <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>nq</span></span> <span class=keyword2><span class=keyword>where</span></span> nnq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>*</span> of_nat <span class=skolem>nq</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> nq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>nq</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>s2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> s1s2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>sq</span></span> <span class=keyword2><span class=keyword>where</span></span> sq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>=</span> <span class=free>s1</span> <span class=main>+</span> <span class=skolem>sq</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add<span class=main>)</span>

  <span class=keyword1><span class=command>note</span></span> us1 <span class=main>=</span> rl <span class=main>[</span><span class=operator>OF</span> mq s1wb<span class=main>]</span>
  <span class=keyword1><span class=command>note</span></span> us2 <span class=main>=</span> rl <span class=main>[</span><span class=operator>OF</span> nq s2wb<span class=main>]</span>

  <span class=keyword1><span class=command>from</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>*</span> of_nat <span class=skolem>nq</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=skolem>mq</span>"</span></span> <span class=keyword1><span class=command>using</span></span> nnq mmq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>*</span> <span class=skolem>nq</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> <span class=skolem>mq</span>"</span></span> <span class=keyword1><span class=command>using</span></span> s1wb s2wb
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt us1 us2<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> nqmq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span> <span class=main>≤</span> <span class=skolem>mq</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sq <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>*</span> of_nat <span class=skolem>nq</span>"</span></span> <span class=keyword1><span class=command>using</span></span> mmq nnq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> of_nat <span class=skolem>nq</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sq <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> of_nat <span class=skolem>nq</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=main>(</span><span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> s1wb s2wb us1 us2 nqmq
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_diff<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> mn<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> <span class=free>n</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>from</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> word_diff_ls'<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>s1</span> <span class=main>*</span> of_nat <span class=main>(</span><span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>s2</span>"</span></span> <span class=keyword1><span class=command>using</span></span> mn s2wb <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"of_nat <span class=main>(</span><span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=main>(</span><span class=free>s2</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> word_power_less_diff<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> mm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> mq <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> s10 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>s1</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> diff_less<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"of_nat <span class=main>(</span><span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> take_bit_nat_less_self_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span>›</span></span><span class=main>]</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt not_le not_less<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> take_bit_nat_eq_self_iff<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>mq</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=skolem>sq</span> <span class=main>*</span> <span class=skolem>nq</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>s2</span> <span class=main>-</span> <span class=free>s1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> mq s2wb
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt take_bit_eq_mod<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> mod_less<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_le_self<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_addD1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> al1<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     al2<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_aligned <span class=free>y</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> al2
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_get_word_bits<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> al1 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> al1 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q1</span></span>
    <span class=keyword2><span class=keyword>where</span></span> xy<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> of_nat <span class=skolem>q1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q1</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedE<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> al2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> of_nat <span class=skolem>q2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q2</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_alignedE<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=skolem>q1</span> <span class=main>-</span> of_nat <span class=skolem>q2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> nv <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mult_triv1<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> is_aligned_addD2 <span class=main>=</span>
       is_aligned_addD1<span class=main>[</span><span class=operator>OF</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> add.commute<span class=main><span class=main>,</span></span>
                                 <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>%</span><span class=bound>x</span><span class=main>.</span> is_aligned <span class=bound>x</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span> <span class=free>n</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>q</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>q</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask mask_add_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span><span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> is_aligned_nth test_bit_eq_bit<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> less_2p_is_upper_bits_unset not_le test_bit_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> le_add1 less_2p_is_upper_bits_unset test_bit_bin test_bit_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_shift'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span><span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>y</span> <span class=main>+</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main><span class=keyword3>;</span></span> <span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> is_aligned_nth test_bit_eq_bit<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> less_2p_is_upper_bits_unset not_le test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_imp_le_length le_add1 less_2p_is_upper_bits_unset test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> and_neg_mask_plus_mask_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> mask <span class=free>n</span> <span class=main>≥</span> <span class=free>p</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_le_minus_cancel<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> subtract_mask<span class=main>)</span>
   <span class=keyword1><span class=command>using</span></span> word_and_le1<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"mask <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>p</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp word_le_less_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_overflow'<span class=main><span class=main>[</span></span><span class=operator>folded</span> mask_2pm1<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_aligned_neg_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_neg_and_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ptr</span> <span class=main>≤</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ptr</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_neg_mask_plus_mask_mono mask_2pm1<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_sub_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>-</span> <span class=free>d</span><span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>d</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span> <span class=main>-</span> <span class=free>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_add_helper<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_after_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>k</span> <span class=free>m</span><span class=main>;</span><span class=free>m</span><span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>k</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_andI1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_plus<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=free>ptr</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>ptr</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mask_eqI<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>mask_twice min_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>is_aligned_add_helper<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_add_helper<span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct1<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_after_mask<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ptr</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span>
     <span class=main>=</span> <span class=main>(</span><span class=free>ptr</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>is_aligned_add_helper<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_add_helper<span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct2<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>is_aligned_after_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>word_bw_comms word_bw_lcs<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Least_significant_bit><div class=head><h1>Theory Least_significant_bit</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson, NICTA *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Operation variant for the least significant bit›</span></span>

<span class=keyword1><span class=command>theory</span></span> Least_significant_bit
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Bits_Int.html>Bits_Int</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>class</span></span> lsb <span class=main>=</span> semiring_bits <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>lsb</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lsb_odd<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>lsb</span> <span class=main>=</span> odd›</span></span>

<span class=keyword1><span class=command>instantiation</span></span> int <span class=main>::</span> <span class=quoted>lsb</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>lsb_int</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹int <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹lsb <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>!!</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>standard</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff lsb_int_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_conv_lsb<span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>=</span> lsb"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lsb_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_lsb_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span>Numeral1 <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>-</span> Numeral1 <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lsb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>lsb</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>lsb_word</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> word_lsb_def<span class=main>:</span> <span class=quoted><span class=quoted>‹lsb <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>⟷</span> odd <span class=main>(</span>uint <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word›</span></span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>standard</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff word_lsb_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> lsb_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹lsb <span class=main>=</span> <span class=main>(</span>odd <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> bool<span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> lsb_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_alt<span class=main>:</span> <span class=quoted><span class=quoted>"lsb <span class=free>w</span> <span class=main>=</span> test_bit <span class=free>w</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_test_bit_def word_lsb_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_1_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span> lsb <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_lsb_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_int<span class=main>:</span> <span class=quoted><span class=quoted>"lsb <span class=free>w</span> <span class=main>⟷</span> uint <span class=free>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lsb_odd <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> odd_iff_mod_2_eq_one<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_ops_lsb <span class=main>=</span> lsb0 <span class=main>[</span><span class=operator>unfolded</span> word_lsb_alt<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span>numeral <span class=free>bin</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟷</span> bin_last <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_lsb_alt test_bit_numeral <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_neg_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟷</span> bin_last <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_lsb_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_nat<span class=main>:</span><span class=quoted><span class=quoted>"lsb <span class=free>w</span> <span class=main>=</span> <span class=main>(</span>unat <span class=free>w</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_lsb_def <span class=dynamic><span class=dynamic>Groebner_Basis.algebra</span></span><span class=main><span class=main>(</span></span>31<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> even_nat_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Most_significant_bit><div class=head><h1>Theory Most_significant_bit</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson, NICTA *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Dedicated operation for the most significant bit›</span></span>

<span class=keyword1><span class=command>theory</span></span> Most_significant_bit
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Bits_Int.html>Bits_Int</a>
    <a href=Traditional_Infix_Syntax.html>Traditional_Infix_Syntax</a>
    <a href=More_Arithmetic.html>More_Arithmetic</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>class</span></span> msb <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>msb</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> bool›</span></span>

<span class=keyword1><span class=command>instantiation</span></span> int <span class=main>::</span> <span class=quoted>msb</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>‹msb <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> msb_conv_bin_sign<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>x</span> <span class=main>⟷</span> bin_sign <span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def not_le msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_bin_rest <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> msb <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_msb_and <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span> <span class=main>∧</span> msb <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_msb_or <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span> <span class=main>∨</span> msb <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_msb_xor <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span> <span class=main>≠</span> msb <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_msb_not <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>¬</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def not_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_shiftl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_shiftr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>r</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_bin_sc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>x</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_conv_bin_sign<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>0</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msb <span class=main>(</span>numeral <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>-</span> numeral <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>=</span> True"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>msb</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>msb_word</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word <span class=main>⇒</span> bool›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹msb <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>⟷</span> bin_sign <span class=main>(</span>sbintrunc <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>uint <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> msb_word_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹msb <span class=free>w</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_def bin_sign_lem bit_uint_iff<span class=main>)</span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> msb_word_iff_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>‹msb <span class=free>w</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_def bin_sign_def bit_uint_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"msb <span class=free>a</span> <span class=main>⟷</span> bin_sign <span class=main>(</span>sint <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_def sint_uint<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_sint<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>w</span> <span class=main>⟷</span> sint <span class=free>w</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq bit_last_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_word_iff_sless_0<span class=main>:</span>
  <span class=quoted><span class=quoted>‹msb <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=keyword1>&lt;s</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_msb_sint word_sless_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_word_of_int<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span>word_of_int <span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> bin_nth <span class=free>x</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_msb_def bin_sign_lem<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msb <span class=main>(</span>numeral <span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> bin_nth <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> msb_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_neg_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> bin_nth <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_neg_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> msb_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_msb_def bin_sign_def sint_uint sbintrunc_eq_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟷</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_1_wi msb_word_of_int eq_iff <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted>nat</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_le_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_nth<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>w</span> <span class=main>=</span> bin_nth <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_msb_def sint_uint bin_sign_lem<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_nth<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>w</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_msb_nth word_test_bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_n1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq not_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_shift<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq shiftr_word_eq bit_iff_odd_drop_bit drop_bit_eq_zero_iff_not_bit_last<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_ops_msb <span class=main>=</span> msb1 <span class=main>[</span><span class=operator>unfolded</span> msb_nth <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>unfolded</span> One_nat_def<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_sint_msb_eq<span class=main>:</span> <span class=quoted><span class=quoted>"sint <span class=free>x</span> <span class=main>=</span> uint <span class=free>x</span> <span class=main>-</span> <span class=main>(</span><span class=keyword1>if</span> msb <span class=free>x</span> <span class=keyword1>then</span> <span class=numeral>2</span> <span class=main>^</span> size <span class=free>x</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_def bin_sign_def <span class=dynamic><span class=dynamic>bit_simps</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc_from_most signed_take_bit_eq_if_positive signed_take_bit_eq_if_negative minus_exp_eq_not_mask <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sle_msb_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>&lt;=s</span> <span class=free>y</span> <span class=main>⟷</span> <span class=main>(</span>msb <span class=free>y</span> <span class=main>⟶</span> msb <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span>msb <span class=free>x</span> <span class=main>∧</span> <span class=main>¬</span> msb <span class=free>y</span><span class=main>)</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sle_eq word_sint_msb_eq word_size word_le_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ uint_ge_0<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> order_less_imp_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> notE<span class=main><span class=main>[</span></span><span class=operator>OF</span> leD<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ uint_ge_0<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sless_msb_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>&lt;s</span> <span class=free>y</span> <span class=main>⟷</span> <span class=main>(</span>msb <span class=free>y</span> <span class=main>⟶</span> msb <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span>msb <span class=free>x</span> <span class=main>∧</span> <span class=main>¬</span> msb <span class=free>y</span><span class=main>)</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sless_eq word_sle_msb_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> not_msb_from_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>¬</span> msb <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_eqD<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> iffD2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_eq_uint<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=free>x</span> <span class=main>⟹</span> sint <span class=free>x</span> <span class=main>=</span> uint <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>smt</span> One_nat_def bintrunc_bintrunc_l bintrunc_sbintrunc' diff_le_self len_gt_0 signed_take_bit_eq_if_positive<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_eq_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=free>x</span> <span class=main>⟹</span> scast <span class=free>x</span> <span class=main>=</span> ucast <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_signed_iff bit_unsigned_iff min_def msb_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> notE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> le_less_Suc_eq test_bit_bin test_bit_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> msb_ucast_eq<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span>
         msb <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> msb <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msb_big<span class=main>:</span>
     <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>  <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> msb_nth<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> bang_is_le<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> and_mask_less' <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>LENGTH</span></span><span class=main><span class=main>(</span></span><span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_not_le <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> and_mask_eq_iff_shiftr_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> msb_shift<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Even_More_List><div class=head><h1>Theory Even_More_List</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Lemmas on list operations›</span></span>

<span class=keyword1><span class=command>theory</span></span> Even_More_List
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> upt_add_eq_append'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>i</span><span class=main>..&lt;</span><span class=free>k</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>i</span><span class=main>..&lt;</span><span class=free>j</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=free>j</span><span class=main>..&lt;</span><span class=free>k</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms le_Suc_ex upt_add_eq_append <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> map_idem_upt_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹map <span class=free>f</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>q</span><span class=main>.</span> <span class=free>m</span> <span class=main>≤</span> <span class=bound>q</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>q</span> <span class=main>=</span> <span class=bound>q</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≥</span> <span class=free>m</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=free>m</span>›</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=skolem>r</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>q</span><span class=main>.</span> <span class=free>m</span> <span class=main>≤</span> <span class=bound>q</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>+</span> <span class=skolem>r</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>q</span> <span class=main>=</span> <span class=bound>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹map <span class=free>f</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>r</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>m</span> <span class=main>+</span> <span class=skolem>r</span><span class=main>]</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>r</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=skolem>r</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> upt_zero_numeral_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>numeral <span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>pred_numeral <span class=free>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span>pred_numeral <span class=free>n</span><span class=main>]</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_takeWhile_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span>set <span class=free>xs</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> length <span class=main>(</span>takeWhile <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>&lt;</span> length <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Min_eq_length_takeWhile<span class=main>:</span>
  <span class=quoted><span class=quoted>‹Min <span class=main>{</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span><span class=main>}</span> <span class=main>=</span> length <span class=main>(</span>takeWhile <span class=main>(</span>Not <span class=main>∘</span> <span class=free>P</span><span class=main>)</span> <span class=main>(</span><span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>r</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Min <span class=main>{</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span><span class=main>}</span> <span class=main>=</span> <span class=skolem>q</span> <span class=main>+</span> length <span class=main>(</span>takeWhile <span class=main>(</span>Not <span class=main>∘</span> <span class=free>P</span><span class=main>)</span> <span class=main>(</span><span class=main>[</span><span class=skolem>q</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>≤</span> <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=skolem>q</span> <span class=main>≤</span> <span class=bound>m</span> <span class=main>∧</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>q</span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> inc_induct<span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> base
    <span class=keyword1><span class=command>from</span></span> base <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>r</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>r</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>step <span class=skolem>q</span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>[</span><span class=skolem>q</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=skolem>q</span> <span class=main>#</span> <span class=main>[</span>Suc <span class=skolem>q</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upt_rec<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>q</span>›</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Suc <span class=skolem>q</span> <span class=main>≤</span> <span class=skolem>m</span> <span class=main>∧</span> <span class=skolem>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>m</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>m</span>
        <span class=keyword1><span class=command>using</span></span> that step.prems <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>m</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_le_eq less_le<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>P</span> <span class=skolem>q</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> * step.IH<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>n</span><span class=main>}</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> step.prems <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_imp_le_nat<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹finite <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>n</span><span class=main>}</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹finite <span class=main>{</span><span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span><span class=main>}</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>q</span>›</span></span> step.prems <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Min_eqI <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>from</span></span> this <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span> <span class=keyword2><span class=keyword>and</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> Max_eq_length_takeWhile<span class=main>:</span>
  <span class=quoted><span class=quoted>‹Max <span class=main>{</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>(</span>length <span class=main>(</span>takeWhile <span class=main>(</span>Not <span class=main>∘</span> <span class=free>P</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span>›</span></span>
<span class=keyword1><span class=command>using</span></span> * <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>n</span>›</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> <span class=skolem>n</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>m</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>m</span>
      <span class=keyword1><span class=command>using</span></span> that Suc.prems <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>m</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_le<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> Suc.IH <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=skolem>n</span><span class=main>}</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> Suc.prems <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq_le<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹finite <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=skolem>n</span><span class=main>}</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹finite <span class=main>{</span><span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span><span class=main>}</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>n</span>›</span></span> Suc.prems <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_eqI <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq_le<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Reversed_Bit_Lists><div class=head><h1>Theory Reversed_Bit_Lists</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson, NICTA *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Bit values as reversed lists of bools›</span></span>

<span class=keyword1><span class=command>theory</span></span> Reversed_Bit_Lists
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Typedef_Morphisms.html>Typedef_Morphisms</a>
    <a href=Least_significant_bit.html>Least_significant_bit</a>
    <a href=Most_significant_bit.html>Most_significant_bit</a>
    <a href=Even_More_List.html>Even_More_List</a>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Sublist.html>HOL-Library.Sublist</a>"</span>
    <a href=Aligned.html>Aligned</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> horner_sum_of_bool_2_concat<span class=main>:</span>
  <span class=quoted><span class=quoted>‹horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> map <span class=main>(</span>bit <span class=bound>x</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span> <span class=free>ws</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> horner_sum uint <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=free>ws</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ws</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word list›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ws</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>w</span> <span class=skolem>ws</span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=main>(</span>bit <span class=skolem>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> uint <span class=skolem>w</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span> <span class=main>::</span> <span class=quoted>int</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹map <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=skolem>k</span> <span class=bound>n</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span>
      <span class=main>=</span> map <span class=main>(</span>bit <span class=skolem>k</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bit <span class=skolem>k</span> <span class=bound>n</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>
      <span class=main>=</span> take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=skolem>k</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> horner_sum_bit_eq_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> horner_sum_append<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Implicit augmentation of list prefixes›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>takefill</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    Z<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>takefill</span> <span class=free><span class=bound><span class=entity>fill</span></span></span> <span class=main>0</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=main>|</span> Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>takefill</span> <span class=free><span class=bound><span class=entity>fill</span></span></span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>of</span>
        <span class=main>[]</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>fill</span></span></span> <span class=main>#</span> <span class=free>takefill</span> <span class=free><span class=bound><span class=entity>fill</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>
      <span class=main>|</span> <span class=bound>y</span> <span class=main>#</span> <span class=bound>ys</span> <span class=main>⇒</span> <span class=bound>y</span> <span class=main>#</span> <span class=free>takefill</span> <span class=free><span class=bound><span class=entity>fill</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=bound>ys</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_takefill<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>l</span> <span class=main>!</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>&lt;</span> length <span class=free>l</span> <span class=keyword1>then</span> <span class=free>l</span> <span class=main>!</span> <span class=free>m</span> <span class=keyword1>else</span> <span class=free>fill</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>l</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> takefill_alt<span class=main>:</span> <span class=quoted><span class=quoted>"takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>l</span> <span class=main>=</span> take <span class=free>n</span> <span class=free>l</span> <span class=main>@</span> replicate <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>l</span><span class=main>)</span> <span class=free>fill</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>l</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_replicate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"takefill <span class=free>fill</span> <span class=free>n</span> <span class=main>(</span>replicate <span class=free>m</span> <span class=free>fill</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> <span class=free>fill</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt replicate_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_le'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>⟹</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=main>(</span>takefill <span class=free>x</span> <span class=free>n</span> <span class=free>l</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_takefill <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>l</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> take_takefill'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=free>k</span> <span class=main>+</span> <span class=free>m</span> <span class=main>⟹</span> take <span class=free>k</span> <span class=main>(</span>takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>fill</span> <span class=free>k</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_takefill<span class=main>:</span> <span class=quoted><span class=quoted>"drop <span class=free>k</span> <span class=main>(</span>takefill <span class=free>fill</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>fill</span> <span class=free>m</span> <span class=main>(</span>drop <span class=free>k</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>k</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> list.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_le <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=main>(</span>takefill <span class=free>x</span> <span class=free>n</span> <span class=free>l</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add takefill_le'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> take_takefill <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> take <span class=free>m</span> <span class=main>(</span>takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>fill</span> <span class=free>m</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_iff_add take_takefill'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_append<span class=main>:</span> <span class=quoted><span class=quoted>"takefill <span class=free>fill</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>@</span> <span class=main>(</span>takefill <span class=free>fill</span> <span class=free>m</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_same'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span> takefill <span class=free>fill</span> <span class=free>l</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>l</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> takefill_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> takefill_same' <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> tf_rev<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> <span class=free>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> length <span class=free>bl</span> <span class=main>⟹</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=main>(</span>rev <span class=main>(</span>takefill <span class=free>y</span> <span class=free>n</span> <span class=free>bl</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>takefill <span class=free>y</span> <span class=free>m</span> <span class=main>(</span>rev <span class=main>(</span>takefill <span class=free>x</span> <span class=free>k</span> <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_takefill rev_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>bl</span> <span class=main>!</span> <span class=bound>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> takefill_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> takefill <span class=free>fill</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> takefill <span class=free>fill</span> <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> takefill_Suc_cases <span class=main>=</span>
  list.cases <span class=main>[</span><span class=operator>THEN</span> takefill.Suc <span class=main><span class=main><span class=main>[</span></span></span><span class=operator><span class=operator>THEN</span></span> trans<span class=main><span class=main><span class=main>]</span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> takefill_Suc_Nil <span class=main>=</span> takefill_Suc_cases <span class=main>(</span>1<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> takefill_Suc_Cons <span class=main>=</span> takefill_Suc_cases <span class=main>(</span>2<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> takefill_minus_simps <span class=main>=</span> takefill_Suc_cases <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main><span class=main>[</span></span></span>2<span class=main><span class=main><span class=main>]</span></span></span>
  takefill_minus <span class=main><span class=main><span class=main>[</span></span></span><span class=operator><span class=operator>symmetric</span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=operator><span class=operator>THEN</span></span> trans<span class=main><span class=main><span class=main>]</span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_numeral_Nil <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"takefill <span class=free>fill</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>[]</span> <span class=main>=</span> <span class=free>fill</span> <span class=main>#</span> takefill <span class=free>fill</span> <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_numeral_Cons <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"takefill <span class=free>fill</span> <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> takefill <span class=free>fill</span> <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Range projection›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bl_of_nth</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bl_of_nth</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> map <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_of_nth_simps <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bl_of_nth <span class=main>0</span> <span class=free>f</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"bl_of_nth <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>f</span> <span class=main>=</span> <span class=free>f</span> <span class=free>n</span> <span class=main>#</span> bl_of_nth <span class=free>n</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_of_nth_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_bl_of_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>bl_of_nth <span class=free>n</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_of_nth_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_bl_of_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> rev <span class=main>(</span>bl_of_nth <span class=free>n</span> <span class=free>f</span><span class=main>)</span> <span class=main>!</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_of_nth_def rev_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_of_nth_inj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>k</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>k</span><span class=main>)</span> <span class=main>⟹</span> bl_of_nth <span class=free>n</span> <span class=free>f</span> <span class=main>=</span> bl_of_nth <span class=free>n</span> <span class=free>g</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_of_nth_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_of_nth_nth_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> bl_of_nth <span class=free>n</span> <span class=main>(</span>nth <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> drop <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ hd_Cons_tl<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Suc_le_lessD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_nth trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> drop_Suc drop_tl<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> hd_drop_conv_nth<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> drop <span class=bound>n</span> <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_of_nth_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bl_of_nth <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=main>(!)</span> <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_of_nth_nth_le<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹More›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>rotater1</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>rotater1</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=keyword1>of</span> <span class=main>[]</span> <span class=main>⇒</span> <span class=main>[]</span> <span class=main>|</span> <span class=bound>x</span> <span class=main>#</span> <span class=bound>xs</span> <span class=main>⇒</span> last <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>#</span> butlast <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>rotater</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>rotater</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> rotater1 <span class=main>^^</span> <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> rotater_0' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> rotater_def <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> rotate1_rl'<span class=main>:</span> <span class=quoted><span class=quoted>"rotater1 <span class=main>(</span><span class=free>l</span> <span class=main>@</span> <span class=main>[</span><span class=free>a</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>#</span> <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>l</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater1_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotate1_rl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>:</span> <span class=quoted><span class=quoted>"rotater1 <span class=main>(</span>rotate1 <span class=free>l</span><span class=main>)</span> <span class=main>=</span> <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> rotater1_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>l</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=main><span class=improper>[</span></span>2<span class=main><span class=improper>]</span></span> <span class=quoted><span class=quoted>"<span class=improper>list</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rotate1_lr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>:</span> <span class=quoted><span class=quoted>"rotate1 <span class=main>(</span>rotater1 <span class=free>l</span><span class=main>)</span> <span class=main>=</span> <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>l</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater1_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotater1_rev'<span class=main>:</span> <span class=quoted><span class=quoted>"rotater1 <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rotate1 <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>xs</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rotater1_def<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rotate1_rl'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_rev'<span class=main>:</span> <span class=quoted><span class=quoted>"rotater <span class=free>n</span> <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rotate <span class=free>n</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> rotater1_rev'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_rev<span class=main>:</span> <span class=quoted><span class=quoted>"rotater <span class=free>n</span> <span class=free>ys</span> <span class=main>=</span> rev <span class=main>(</span>rotate <span class=free>n</span> <span class=main>(</span>rev <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rotater_rev' <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"rev <span class=free>ys</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_drop_take<span class=main>:</span>
  <span class=quoted><span class=quoted>"rotater <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span>
    drop <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=free>n</span> <span class=keyword1>mod</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>xs</span> <span class=main>@</span>
    take <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=free>n</span> <span class=keyword1>mod</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater_rev rotate_drop_take rev_take rev_drop<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_Suc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"rotater <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> rotater1 <span class=main>(</span>rotater <span class=free>n</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> rotater_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rotater<span class=main>:</span>
  <span class=quoted><span class=quoted>‹rotater <span class=free>m</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=free>m</span> <span class=keyword1>mod</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> length <span class=free>xs</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rotater_drop_take nth_append not_less less_diff_conv <span class=dynamic><span class=dynamic>ac_simps</span></span> le_mod_geq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rotater1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹rotater1 <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> length <span class=free>xs</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that nth_rotater <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>xs</span></span> <span class=quoted><span class=main>1</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> rotate_inv_plus <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟶</span> rotater <span class=bound>k</span> <span class=main>(</span>rotate <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rotater <span class=free>m</span> <span class=free>xs</span> <span class=main>∧</span>
    rotate <span class=bound>k</span> <span class=main>(</span>rotater <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rotate <span class=free>m</span> <span class=free>xs</span> <span class=main>∧</span>
    rotater <span class=free>n</span> <span class=main>(</span>rotate <span class=bound>k</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rotate <span class=free>m</span> <span class=free>xs</span> <span class=main>∧</span>
    rotate <span class=free>n</span> <span class=main>(</span>rotater <span class=bound>k</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> rotater <span class=free>m</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater_def rotate_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> funpow_swap1 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> rotate_inv_rel <span class=main>=</span> le_add_diff_inverse2 <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>THEN</span> rotate_inv_plus<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> rotate_inv_eq <span class=main>=</span> order_refl <span class=main>[</span><span class=operator>THEN</span> rotate_inv_rel<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> rotate_lr <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> rotate_inv_eq <span class=main>[</span><span class=operator>THEN</span> conjunct1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rotate_rl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> rotate_inv_eq <span class=main>[</span><span class=operator>THEN</span> conjunct2<span class=main>,</span> <span class=operator>THEN</span> conjunct1<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> rotate_gal<span class=main>:</span> <span class=quoted><span class=quoted>"rotater <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟷</span> rotate <span class=free>n</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> rotate_gal'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>=</span> rotater <span class=free>n</span> <span class=free>xs</span> <span class=main>⟷</span> <span class=free>xs</span> <span class=main>=</span> rotate <span class=free>n</span> <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> length_rotater <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>rotater <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> length <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> rotater_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotate_eq_mod<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=keyword1>mod</span> length <span class=free>xs</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> length <span class=free>xs</span> <span class=main>⟹</span> rotate <span class=free>m</span> <span class=free>xs</span> <span class=main>=</span> rotate <span class=free>n</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> box_equals<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rotate_conv_mod <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> restrict_to_left<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟷</span> <span class=free>y</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> rotate_eqs <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> rotate0 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> fun_cong<span class=main><span class=main>]</span></span> id_apply<span class=main>]</span>
  rotate_rotate <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  rotate_id
  rotate_conv_mod
  rotate_eq_mod

<span class=keyword1><span class=command>lemmas</span></span> rrs0 <span class=main>=</span> rotate_eqs <span class=main>[</span><span class=operator>THEN</span> restrict_to_left<span class=main>,</span>
  <span class=operator>simplified</span> rotate_gal <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span> rotate_gal' <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rrs1 <span class=main>=</span> rrs0 <span class=main>[</span><span class=operator>THEN</span> refl <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>THEN</span></span></span></span></span> rev_iffD1<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rotater_eqs <span class=main>=</span> rrs1 <span class=main>[</span><span class=operator>simplified</span> length_rotater<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> rotater_0 <span class=main>=</span> rotater_eqs <span class=main>(</span>1<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> rotater_add <span class=main>=</span> rotater_eqs <span class=main>(</span>2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> butlast_map<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> butlast <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>(</span>butlast <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> rotater1_map<span class=main>:</span> <span class=quoted><span class=quoted>"rotater1 <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>(</span>rotater1 <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater1_def last_map butlast_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_map<span class=main>:</span> <span class=quoted><span class=quoted>"rotater <span class=free>n</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>(</span>rotater <span class=free>n</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rotater_def rotater1_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> but_last_zip <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span> <span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ys</span><span class=main>.</span> length <span class=free>xs</span> <span class=main>=</span> length <span class=bound>ys</span> <span class=main>⟶</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟶</span>
    last <span class=main>(</span>zip <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>,</span> last <span class=bound>ys</span><span class=main>)</span> <span class=main>∧</span>
    butlast <span class=main>(</span>zip <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> zip <span class=main>(</span>butlast <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>butlast <span class=bound>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper><span class=quoted><span class=improper><span class=quoted><span class=improper>ys</span></span></span></span></span></span></span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> neq_Nil_conv<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> but_last_map2 <span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span> <span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>ys</span><span class=main>.</span> length <span class=free>xs</span> <span class=main>=</span> length <span class=bound>ys</span> <span class=main>⟶</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟶</span>
    last <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>last <span class=bound>ys</span><span class=main>)</span> <span class=main>∧</span>
    butlast <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>butlast <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>butlast <span class=bound>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper><span class=quoted><span class=improper><span class=quoted><span class=improper>ys</span></span></span></span></span></span></span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> neq_Nil_conv<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rotater1_zip<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rotater1 <span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> zip <span class=main>(</span>rotater1 <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rotater1 <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> rotater1_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free><span class=quoted><span class=free>ys</span></span></span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> neq_Nil_conv but_last_zip<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rotater1_map2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rotater1 <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>rotater1 <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rotater1 <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rotater1_map rotater1_zip<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> lrth <span class=main>=</span>
  box_equals <span class=main>[</span><span class=operator>OF</span> asm_rl length_rotater <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
                 length_rotater <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>,</span>
              <span class=operator>THEN</span> rotater1_map2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> rotater_map2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rotater <span class=free>n</span> <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>rotater <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rotater <span class=free>n</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> lrth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rotate1_map2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rotate1 <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>rotate1 <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rotate1 <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>ys</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> lth <span class=main>=</span> box_equals <span class=main>[</span><span class=operator>OF</span> asm_rl length_rotate <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
  length_rotate <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>THEN</span> rotate1_map2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> rotate_map2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rotate <span class=free>n</span> <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>rotate <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rotate <span class=free>n</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> lth<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Explicit bit representation of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>bl_to_bin_aux</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bl_to_bin_aux</span> <span class=main>[]</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>
  <span class=main>|</span> Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bl_to_bin_aux</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>bs</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=free>bl_to_bin_aux</span> <span class=free><span class=bound><span class=entity>bs</span></span></span> <span class=main>(</span>of_bool <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bl_to_bin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bl_to_bin</span> <span class=free><span class=bound><span class=entity>bs</span></span></span> <span class=main>=</span> bl_to_bin_aux <span class=free><span class=bound><span class=entity>bs</span></span></span> <span class=main>0</span>"</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>bin_to_bl_aux</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> int <span class=main>⇒</span> bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    Z<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bin_to_bl_aux</span> <span class=main>0</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>bl</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>bl</span></span></span>"</span></span>
  <span class=main>|</span> Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bin_to_bl_aux</span> <span class=main>(</span>Suc <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=free><span class=bound><span class=entity>bl</span></span></span> <span class=main>=</span> <span class=free>bin_to_bl_aux</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span>bin_rest <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>bin_last <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>bl</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bin_to_bl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> int <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>bin_to_bl</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> bin_to_bl_aux <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>[]</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_zero_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_to_bl_aux <span class=free>n</span> <span class=main>0</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>0</span> <span class=main>(</span>False <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_minus1_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>True <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_one_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_to_bl_aux <span class=free>n</span> <span class=main>1</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>0</span> <span class=main>(</span>True <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_Bit0_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
    bin_to_bl_aux <span class=free>n</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span>False <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_Bit1_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
    bin_to_bl_aux <span class=free>n</span> <span class=main>(</span>numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span>True <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_aux_append<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin_aux <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> bl_to_bin_aux <span class=free>cs</span> <span class=main>(</span>bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_append<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span> <span class=main>=</span> bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_append<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span> bl_to_bin_aux <span class=free>cs</span> <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bl_to_bin_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bl_to_bin_aux_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_alt<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=free>w</span> <span class=main>@</span> <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_to_bl_aux_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=main>0</span> <span class=free>bs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> size_bin_to_bl_aux<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> length <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> size_bin_to_bl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def size_bin_to_bl_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_bin_bl'<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=main>(</span><span class=free>n</span> <span class=main>+</span> length <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_Suc <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_bin_bl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=main>(</span>length <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bl_to_bin_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> box_equals<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_bin_bl'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bin_to_bl_aux.Z<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_inj<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=free>bs</span> <span class=main>=</span> bl_to_bin <span class=free>cs</span> <span class=main>⟹</span> length <span class=free>bs</span> <span class=main>=</span> length <span class=free>cs</span> <span class=main>⟹</span> <span class=free>bs</span> <span class=main>=</span> <span class=free>cs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> box_equals<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_bin_bl<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_bin_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_False <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>False <span class=main>#</span> <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bl_to_bin_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_Nil <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>[]</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bl_to_bin_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_zero_aux<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=free>n</span> <span class=main>0</span> <span class=free>bl</span> <span class=main>=</span> replicate <span class=free>n</span> False <span class=main>@</span> <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> replicate_app_Cons_same<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_zero<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>0</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_to_bl_zero_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_minus1_aux<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span> replicate <span class=free>n</span> True <span class=main>@</span> <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> replicate_app_Cons_same<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_minus1<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_to_bl_minus1_aux<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Semantic interpretation of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹bool list›</span></span></span></span> as <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_bl_bin'<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> bl_to_bin_aux <span class=free>bs</span> <span class=main>(</span>bintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bl_to_bin_def take_bit_Suc <span class=dynamic><span class=dynamic>ac_simps</span></span> mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_bl_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_bl_bin'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_rep_F<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>replicate <span class=free>n</span> False <span class=main>@</span> <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_zero_aux <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> bin_bl_bin'<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_trunc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> bin_to_bl <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> bl_to_bin_inj<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_bintr<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>bin</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span>
    replicate <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> False <span class=main>@</span> bin_to_bl_aux <span class=main>(</span>min <span class=free>n</span> <span class=free>m</span><span class=main>)</span> <span class=free>bin</span> <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>bin</span></span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>m</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_zero_aux<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> thin_rl<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper>n</span></span></span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_bintr<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>(</span>bintrunc <span class=free>m</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> replicate <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> False <span class=main>@</span> bin_to_bl <span class=main>(</span>min <span class=free>n</span> <span class=free>m</span><span class=main>)</span> <span class=free>bin</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bin_to_bl_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bin_to_bl_aux_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_rep_False<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>replicate <span class=free>n</span> False<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> len_bin_to_bl_aux<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> length <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> size_bin_to_bl_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> len_bin_to_bl<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> size_bin_to_bl<span class=main>)</span> <span class=comment1>(* FIXME: duplicate *)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_bl_bin'<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_sign <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_bl_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def sign_bl_bin'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_sbin_sign_aux<span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=main>(</span>bin_to_bl_aux <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>bin_sign <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def even_iff_mod_2_eq_zero bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_sbin_sign<span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>bin_sign <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bin_to_bl_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bl_sbin_sign_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_of_bl_aux<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>bl_to_bin_aux <span class=free>bl</span> <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> size <span class=free>bl</span> <span class=main>∧</span> rev <span class=free>bl</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>≥</span> length <span class=free>bl</span> <span class=main>∧</span> bin_nth <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> size <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
                      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le nth_append bit_double_iff even_bit_succ_iff <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_of_bl<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> length <span class=free>bl</span> <span class=main>∧</span> rev <span class=free>bl</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def bin_nth_of_bl_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> bin_nth <span class=free>w</span> <span class=free>n</span> <span class=main>=</span> nth <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>m</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_bin_to_bl_aux<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>+</span> length <span class=free>bl</span> <span class=main>⟹</span> <span class=main>(</span>bin_to_bl_aux <span class=free>m</span> <span class=free>w</span> <span class=free>bl</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> bit <span class=free>w</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=main>1</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>bl</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_bl <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>-</span> Suc <span class=free>n</span>›</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span> rev_nth <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def Suc_pred add_diff_cancel_left'
     add_diff_cancel_right' bin_to_bl_aux_alt bin_to_bl_def
     diff_Suc_Suc diff_is_0_eq diff_zero less_Suc_eq_0_disj
     less_antisym less_imp_Suc_add list.size<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> nat_less_le nth_append size_bin_to_bl_aux<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_bin_to_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span>bin_to_bl <span class=free>m</span> <span class=free>w</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> bin_nth <span class=free>w</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def nth_bin_to_bl_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_bintrunc<span class=main>:</span> <span class=quoted><span class=quoted>"takefill False <span class=free>n</span> <span class=free>bl</span> <span class=main>=</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span>bl_to_bin <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_takefill rev_nth nth_bin_to_bl bin_nth_of_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_bin_bl_rtf<span class=main>:</span> <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_bintrunc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_lt2p_aux<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>w</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> length <span class=free>bs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>b</span> <span class=skolem>bs</span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> Cons.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>w</span>›</span></span><span class=main>]</span> Cons.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> <span class=skolem>w</span>›</span></span><span class=main>]</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_2 <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> length <span class=skolem>bs</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.assoc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> pos_add_strict<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_lt2p_drop<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=free>bs</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> length <span class=main>(</span>dropWhile Not <span class=free>bs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>b</span> <span class=skolem>bs</span><span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> bl_to_bin_lt2p_aux<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_lt2p<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=free>bs</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> length <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bin_bl_bin bintr_lt2p bl_bin_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_ge2p_aux<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span> <span class=main>≥</span> <span class=free>w</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> length <span class=free>bs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>bs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>b</span> <span class=skolem>bs</span><span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> Cons.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>w</span>›</span></span><span class=main>]</span> Cons.IH <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> <span class=skolem>w</span>›</span></span><span class=main>]</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_le_imp_le_left <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> length <span class=skolem>bs</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_increasing<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_ge0<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=free>bs</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bl_to_bin_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> xtrans<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_to_bin_ge2p_aux<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> butlast_rest_bin<span class=main>:</span> <span class=quoted><span class=quoted>"butlast <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>bin_rest <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> butlast_bin_rest<span class=main>:</span> <span class=quoted><span class=quoted>"butlast <span class=free>bl</span> <span class=main>=</span> bin_to_bl <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>(</span>bin_rest <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> butlast_rest_bin <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"bl_to_bin <span class=free>bl</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>bl</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> butlast_rest_bl2bin_aux<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>bl</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> bl_to_bin_aux <span class=main>(</span>butlast <span class=free>bl</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> bin_rest <span class=main>(</span>bl_to_bin_aux <span class=free>bl</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> butlast_rest_bl2bin<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>butlast <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bin_rest <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bl_to_bin_def butlast_rest_bl2bin_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> trunc_bl2bin_aux<span class=main>:</span>
  <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=main>(</span>bl_to_bin_aux <span class=free>bl</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span>
    bl_to_bin_aux <span class=main>(</span>drop <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=free>bl</span><span class=main>)</span> <span class=main>(</span>bintrunc <span class=main>(</span><span class=free>m</span> <span class=main>-</span> length <span class=free>bl</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>b</span> <span class=skolem>bl</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> length <span class=skolem>bl</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> 0
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>length <span class=skolem>bl</span><span class=main>)</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=skolem>bl</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> Cons <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> Suc <span class=main>(</span>length <span class=skolem>bl</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> Cons Suc <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_Suc <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> trunc_bl2bin<span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=main>(</span>drop <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def trunc_bl2bin_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> trunc_bl2bin_len <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bintrunc <span class=main>(</span>length <span class=free>bl</span><span class=main>)</span> <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trunc_bl2bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl2bin_drop<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>drop <span class=free>k</span> <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> bintrunc <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trunc_bl2bin <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> length <span class=free>bl</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> take_rest_power_bin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> take <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>m</span> <span class=main>(</span><span class=main>(</span>bin_rest <span class=main>^^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_bin_to_bl nth_rest_power_bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> last_bin_last'<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=free>xs</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> last <span class=free>xs</span> <span class=main>⟷</span> bin_last <span class=main>(</span>bl_to_bin_aux <span class=free>xs</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> last_bin_last<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=free>xs</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> last <span class=free>xs</span> <span class=main>⟷</span> bin_last <span class=main>(</span>bl_to_bin <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bl_to_bin_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> last_bin_last'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_last<span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=free>w</span> <span class=main>⟷</span> last <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_bin2bl_aux<span class=main>:</span>
  <span class=quoted><span class=quoted>"drop <span class=free>m</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>bin</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span>
    bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=free>bin</span> <span class=main>(</span>drop <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>bin</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>m</span> <span class=main>≤</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le Suc_diff_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>m</span> <span class=main>-</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>use</span> Suc_diff_Suc <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> <span class=operator>fastforce</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_bin2bl<span class=main>:</span> <span class=quoted><span class=quoted>"drop <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bin</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=free>bin</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def drop_bin2bl_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> take_bin2bl_lem1<span class=main>:</span> <span class=quoted><span class=quoted>"take <span class=free>m</span> <span class=main>(</span>bin_to_bl_aux <span class=free>m</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>m</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> take_bin2bl_lem<span class=main>:</span> <span class=quoted><span class=quoted>"take <span class=free>m</span> <span class=main>(</span>bin_to_bl_aux <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> take <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def take_bin2bl_lem1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_take<span class=main>:</span> <span class=quoted><span class=quoted>"bin_split <span class=free>n</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span> bin_to_bl <span class=free>m</span> <span class=free>a</span> <span class=main>=</span> take <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bin2bl_lem drop_bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_drop_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> bin_to_bl <span class=free>m</span> <span class=main>(</span>drop_bit <span class=free>n</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> take <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=free>k</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bin_split_take <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_split_take1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> bin_split <span class=free>n</span> <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span> bin_to_bl <span class=free>m</span> <span class=free>a</span> <span class=main>=</span> take <span class=free>m</span> <span class=main>(</span>bin_to_bl <span class=free>k</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bin_split_take <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bl_bin_bl_rep_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>(</span>bl_to_bin <span class=free>bl</span><span class=main>)</span> <span class=main>=</span>
    replicate <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>bl</span><span class=main>)</span> False <span class=main>@</span> drop <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_inj bl_to_bin_rep_F trunc_bl2bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_aux_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"bl_to_bin_aux <span class=free>bs</span> <span class=main>(</span>bin_cat <span class=free>w</span> <span class=free>nv</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span>
    bin_cat <span class=free>w</span> <span class=main>(</span><span class=free>nv</span> <span class=main>+</span> length <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bl_to_bin_aux <span class=free>bs</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_of_bl_aux bin_nth_cat <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl_aux <span class=main>(</span><span class=free>nv</span> <span class=main>+</span> <span class=free>nw</span><span class=main>)</span> <span class=main>(</span>bin_cat <span class=free>v</span> <span class=free>nw</span> <span class=free>w</span><span class=main>)</span> <span class=free>bs</span> <span class=main>=</span>
    bin_to_bl_aux <span class=free>nv</span> <span class=free>v</span> <span class=main>(</span>bin_to_bl_aux <span class=free>nw</span> <span class=free>w</span> <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>nw</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> concat_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_aux_alt<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin_aux <span class=free>bs</span> <span class=free>w</span> <span class=main>=</span> bin_cat <span class=free>w</span> <span class=main>(</span>length <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bl_to_bin_aux_cat <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> nv <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> v <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl <span class=main>(</span><span class=free>nv</span> <span class=main>+</span> <span class=free>nw</span><span class=main>)</span> <span class=main>(</span>bin_cat <span class=free>v</span> <span class=free>nw</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span>
    bin_to_bl_aux <span class=free>nv</span> <span class=free>v</span> <span class=main>(</span>bin_to_bl <span class=free>nw</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_to_bl_aux_cat<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bl_to_bin_aux_app_cat <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> bl_to_bin_aux_append bl_to_bin_aux_alt<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> bin_to_bl_aux_cat_app <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> bin_to_bl_aux_cat bin_to_bl_aux_alt<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_app_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span><span class=free>bsa</span> <span class=main>@</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=main>(</span>bl_to_bin <span class=free>bsa</span><span class=main>)</span> <span class=main>(</span>length <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> bl_to_bin_aux_app_cat bl_to_bin_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_cat_app<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>nw</span><span class=main>)</span> <span class=main>(</span>bin_cat <span class=free>w</span> <span class=free>nw</span> <span class=free>wa</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=free>w</span> <span class=main>@</span> bin_to_bl <span class=free>nw</span> <span class=free>wa</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> bin_to_bl_def bin_to_bl_aux_cat_app<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>bl_to_bin_app_cat_alt›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>bl_to_bin_app_cat›</span></span></span></span> are easily interderivable.›</span></span>
<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_app_cat_alt<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=main>(</span>bl_to_bin <span class=free>cs</span><span class=main>)</span> <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> bl_to_bin <span class=main>(</span><span class=free>cs</span> <span class=main>@</span> bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_app_cat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>bl_to_bin <span class=main>(</span>True <span class=main>#</span> replicate <span class=free>n</span> False<span class=main>)</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=main>(</span>replicate <span class=free>n</span> True<span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bl_to_bin_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Suc_eq_plus1 replicate_add append_Cons <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> bl_to_bin_aux_append<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_exhaust<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span> <span class=bound>b</span><span class=main>.</span> <span class=free>bin</span> <span class=main>=</span> of_bool <span class=bound>b</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>Q</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>Q</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>bin</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹even <span class=free>bin</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> evenE oddE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>rbl_succ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_succ</span> Nil <span class=main>=</span> Nil"</span></span>
  <span class=main>|</span> Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_succ</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>then</span> False <span class=main>#</span> <span class=free>rbl_succ</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>else</span> True <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>rbl_pred</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_pred</span> Nil <span class=main>=</span> Nil"</span></span>
  <span class=main>|</span> Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_pred</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>then</span> False <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>else</span> True <span class=main>#</span> <span class=free>rbl_pred</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>rbl_add</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=comment1>― ‹result is length of first arg, second arg may be longer›</span>
    Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_add</span> Nil <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> Nil"</span></span>
  <span class=main>|</span> Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_add</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=bound>ws</span> <span class=main>=</span> <span class=free>rbl_add</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>(</span>tl <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span>
       <span class=keyword1>in</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>≠</span> hd <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>if</span> hd <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>then</span> rbl_succ <span class=bound>ws</span> <span class=keyword1>else</span> <span class=bound>ws</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>rbl_mult</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=comment1>― ‹result is length of first arg, second arg may be longer›</span>
    Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_mult</span> Nil <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> Nil"</span></span>
  <span class=main>|</span> Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>rbl_mult</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=bound>ws</span> <span class=main>=</span> False <span class=main>#</span> <span class=free>rbl_mult</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span>
       <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>then</span> rbl_add <span class=bound>ws</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>else</span> <span class=bound>ws</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> size_rbl_pred<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>rbl_pred <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> length <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> size_rbl_succ<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>rbl_succ <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> length <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> size_rbl_add<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>rbl_add <span class=free>bl</span> <span class=free>cl</span><span class=main>)</span> <span class=main>=</span> length <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>cl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def size_rbl_succ<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> size_rbl_mult<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>rbl_mult <span class=free>bl</span> <span class=free>cl</span><span class=main>)</span> <span class=main>=</span> length <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bl</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>cl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def size_rbl_add<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> rbl_sizes <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  size_rbl_pred size_rbl_succ size_rbl_add size_rbl_mult

<span class=keyword1><span class=command>lemmas</span></span> rbl_Nils <span class=main>=</span>
  rbl_pred.Nil rbl_succ.Nil rbl_add.Nil rbl_mult.Nil

<span class=keyword1><span class=command>lemma</span></span> rbl_add_app2<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>blb</span> <span class=main>≥</span> length <span class=free>bla</span> <span class=main>⟹</span> rbl_add <span class=free>bla</span> <span class=main>(</span><span class=free>blb</span> <span class=main>@</span> <span class=free>blc</span><span class=main>)</span> <span class=main>=</span> rbl_add <span class=free>bla</span> <span class=free>blb</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bla</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>blb</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>blb</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add_take2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>blb</span> <span class=main>≥</span> length <span class=free>bla</span> <span class=main>⟹</span> rbl_add <span class=free>bla</span> <span class=main>(</span>take <span class=main>(</span>length <span class=free>bla</span><span class=main>)</span> <span class=free>blb</span><span class=main>)</span> <span class=main>=</span> rbl_add <span class=free>bla</span> <span class=free>blb</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bla</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>blb</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>blb</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult_app2<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>blb</span> <span class=main>≥</span> length <span class=free>bla</span> <span class=main>⟹</span> rbl_mult <span class=free>bla</span> <span class=main>(</span><span class=free>blb</span> <span class=main>@</span> <span class=free>blc</span><span class=main>)</span> <span class=main>=</span> rbl_mult <span class=free>bla</span> <span class=free>blb</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>bla</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>blb</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>blb</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def rbl_add_app2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult_take2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>blb</span> <span class=main>≥</span> length <span class=free>bla</span> <span class=main>⟹</span> rbl_mult <span class=free>bla</span> <span class=main>(</span>take <span class=main>(</span>length <span class=free>bla</span><span class=main>)</span> <span class=free>blb</span><span class=main>)</span> <span class=main>=</span> rbl_mult <span class=free>bla</span> <span class=free>blb</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rbl_mult_app2 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"rbl_mult <span class=free>bla</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> append_take_drop_id<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>rbl_add <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>ws</span><span class=main>.</span> length <span class=bound>ws</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟶</span> <span class=bound>ws</span> <span class=main>=</span> rbl_add <span class=free>ys</span> <span class=free>xs</span> <span class=main>⟶</span>
      <span class=main>(</span><span class=free>y</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span>False <span class=main>#</span> rbl_succ <span class=bound>ws</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>¬</span> <span class=free>x</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span>True <span class=main>#</span> <span class=bound>ws</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span>
      <span class=main>(</span><span class=main>¬</span> <span class=free>y</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=bound>ws</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>rbl_mult <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>ws</span><span class=main>.</span> length <span class=bound>ws</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span> <span class=main>⟶</span> <span class=bound>ws</span> <span class=main>=</span> False <span class=main>#</span> rbl_mult <span class=free>ys</span> <span class=free>xs</span> <span class=main>⟶</span>
      <span class=main>(</span><span class=free>y</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span>rbl_add <span class=bound>ws</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>¬</span> <span class=free>y</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>ws</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_pred<span class=main>:</span> <span class=quoted><span class=quoted>"rbl_pred <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bin</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>bin</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>unfold</span> bin_to_bl_def<span class=main><span class=keyword3>,</span></span> <span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bin</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>bin</span> <span class=main>=</span> of_bool <span class=skolem>b</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> bin_exhaust <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> even_succ_div_2 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>using</span></span> Suc <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=skolem>bin</span> <span class=keyword1>div</span> <span class=numeral>2</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_succ<span class=main>:</span> <span class=quoted><span class=quoted>"rbl_succ <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bin</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>bin</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bin</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>bin</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>bina</span> <span class=bound>binb</span><span class=main>.</span> rbl_add <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=bound>bina</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=bound>binb</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=bound>bina</span> <span class=main>+</span> <span class=bound>binb</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>bina</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>binb</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>b</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=improper><span class=improper>ba</span></span>"</span></span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rbl_succ bin_to_bl_aux_alt Let_def <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add_long<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≥</span> <span class=free>n</span> <span class=main>⟹</span> rbl_add <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bina</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>m</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>bina</span> <span class=main>+</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> box_equals <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ rbl_add_take2 rbl_add<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"rbl_add <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bina</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rev_swap <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_take drop_bin2bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult_gt1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≥</span> length <span class=free>bl</span> <span class=main>⟹</span>
    rbl_mult <span class=free>bl</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>m</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rbl_mult <span class=free>bl</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=main>(</span>length <span class=free>bl</span><span class=main>)</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rbl_mult_take2 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"rbl_mult <span class=free>bl</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rev_swap <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_take drop_bin2bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult_gt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&gt;</span> <span class=free>n</span> <span class=main>⟹</span>
    rbl_mult <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bina</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>m</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rbl_mult <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bina</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> rbl_mult_gt1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> rbl_mult_Suc <span class=main>=</span> lessI <span class=main>[</span><span class=operator>THEN</span> rbl_mult_gt<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> rbbl_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>of_bool <span class=free>b</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mult<span class=main>:</span>
  <span class=quoted><span class=quoted>"rbl_mult <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>bina</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>bina</span> <span class=main>*</span> <span class=free>binb</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>bina</span></span> <span class=quoted><span class=free>binb</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>bina</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>binb</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbbl_Cons rbl_mult_Suc rbl_add <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sclem<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span>bin_to_bl <span class=free>n</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>*</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_foldl_lem<span class=main>:</span>
  <span class=quoted><span class=quoted>"foldl <span class=main>(</span><span class=main>λ</span><span class=bound>u</span><span class=main>.</span> bin_cat <span class=bound>u</span> <span class=free>n</span><span class=main>)</span> <span class=free>x</span> <span class=free>xs</span> <span class=main>=</span>
    bin_cat <span class=free>x</span> <span class=main>(</span>size <span class=free>xs</span> <span class=main>*</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>foldl <span class=main>(</span><span class=main>λ</span><span class=bound>u</span><span class=main>.</span> bin_cat <span class=bound>u</span> <span class=free>n</span><span class=main>)</span> <span class=free>y</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> asm_rl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> meta_spec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"bin_cat <span class=free>y</span> <span class=free>n</span> <span class=improper>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_assoc_sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_rcat_bl<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rcat <span class=free>n</span> <span class=free>wl</span> <span class=main>=</span> bl_to_bin <span class=main>(</span>concat <span class=main>(</span>map <span class=main>(</span>bin_to_bl <span class=free>n</span><span class=main>)</span> <span class=free>wl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> bin_rcat_eq_foldl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>wl</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_append<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_aux_alt sclem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_foldl_lem <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_bl_to_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>bs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>∧</span> last <span class=free>bs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>bs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def last_bin_last'<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main>0</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_bl_to_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>bl_to_bin <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=main>(</span>butlast <span class=free>bs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>bs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span><span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def butlast_rest_bl2bin_aux<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_xor_aux_bin<span class=main>:</span>
  <span class=quoted><span class=quoted>"map2 <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span><span class=main>)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>v</span> <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span>
    bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>XOR</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>map2 <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span><span class=main>)</span> <span class=free>bs</span> <span class=free>cs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quoted><span class=free>cs</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>v</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>w</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_or_aux_bin<span class=main>:</span>
  <span class=quoted><span class=quoted>"map2 <span class=main>(∨)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>v</span> <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span>
    bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>OR</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>map2 <span class=main>(∨)</span> <span class=free>bs</span> <span class=free>cs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quoted><span class=free>cs</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bl_and_aux_bin<span class=main>:</span>
  <span class=quoted><span class=quoted>"map2 <span class=main>(∧)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>v</span> <span class=free>bs</span><span class=main>)</span> <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span>
    bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>AND</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>map2 <span class=main>(∧)</span> <span class=free>bs</span> <span class=free>cs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>bs</span></span> <span class=quoted><span class=free>cs</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> bl_not_aux_bin<span class=main>:</span> <span class=quoted><span class=quoted>"map Not <span class=main>(</span>bin_to_bl_aux <span class=free>n</span> <span class=free>w</span> <span class=free>cs</span><span class=main>)</span> <span class=main>=</span> bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>w</span><span class=main>)</span> <span class=main>(</span>map Not <span class=free>cs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>cs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bl_not_bin<span class=main>:</span> <span class=quoted><span class=quoted>"map Not <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bl_not_aux_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_and_bin<span class=main>:</span> <span class=quoted><span class=quoted>"map2 <span class=main>(∧)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>AND</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bl_and_aux_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_or_bin<span class=main>:</span> <span class=quoted><span class=quoted>"map2 <span class=main>(∨)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>OR</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def bl_or_aux_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_xor_bin<span class=main>:</span> <span class=quoted><span class=quoted>"map2 <span class=main>(≠)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>v</span><span class=main>)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>XOR</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bl_xor_aux_bin <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Type <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=tfree><span class=tfree>'a</span></span> word›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> of_bl <span class=main>::</span> <span class=quoted><span class=quoted>‹bool list <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>bl_to_bin</span> <span class=keyword1><span class=command>.</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> to_bl <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool list›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹bin_to_bl <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_inj<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=free>w</span> <span class=main>=</span> bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bit_of_bl_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span>of_bl <span class=free>bs</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> rev <span class=free>bs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>bs</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_of_bl <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rev_to_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl.rep_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_bl bit_word.rep_eq to_bl.rep_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_eq_rev<span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=free>w</span> <span class=main>=</span> map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> rev_to_bl_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rev_is_rev_conv <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_map<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_rev_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹of_bl <span class=main>(</span>rev <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> horner_sum of_bool <span class=numeral>2</span> <span class=free>bs</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_of_bl_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_horner_sum_bit_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹of_bl <span class=free>bs</span> <span class=main>=</span> horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>rev <span class=free>bs</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> of_bl_rev_eq <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹rev <span class=free>bs</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bshiftr1_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bshiftr1 <span class=free>b</span> <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span><span class=free>b</span> <span class=main>#</span> butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bl_to_bin_app_cat <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=main>[</span>True<span class=main>]</span>›</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def add.commute bin_bl_bin bin_last_bl_to_bin bin_rest_bl_to_bin butlast_bin_rest concat_bit_eq last.simps list.distinct<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> list.size<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> list.size<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> odd_iff_mod_2_eq_one plus_1_eq_Suc power_Suc0_right push_bit_of_1 size_bin_to_bl take_bit_eq_mod trunc_bl2bin_len<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> butlast_rest_bl2bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_to_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹length <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_rotr_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_rotr <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>rotater <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword2><span class=keyword>for</span></span> n
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_word_rotr_iff bit_of_bl_iff rotater_rev length_to_bl_eq nth_rotate rev_to_bl_eq <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rotl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_rotl <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>rotate <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹rotate <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rotater <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rotater_rev'<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rotl_eq_word_rotr bit_of_bl_iff length_to_bl_eq rev_to_bl_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>subgoal</span></span></span></span> <span class=keyword2><span class=keyword>for</span></span> n
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_word_rotr_iff bit_of_bl_iff nth_rotater<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_def'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>to_bl <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool list<span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>∘</span> uint"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>

<span class=comment1>― ‹type definitions theorem for in terms of equivalent bool list›</span>
<span class=keyword1><span class=command>lemma</span></span> td_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"type_definition
    <span class=main>(</span>to_bl <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool list<span class=main>)</span>
    of_bl
    <span class=main>{</span><span class=bound>bl</span><span class=main>.</span> length <span class=bound>bl</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>standard</span><span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>interpretation</span></span> word_bl<span class=main>:</span>
  type_definition
    <span class=quoted><span class=quoted>"to_bl <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool list"</span></span>
    <span class=quoted>of_bl</span>
    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>bl</span><span class=main>.</span> length <span class=bound>bl</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> td_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_bl_Rep' <span class=main>=</span> word_bl.Rep <span class=main>[</span><span class=operator>unfolded</span> mem_Collect_eq<span class=main>,</span> <span class=operator>iff</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_size_bl<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=free>w</span> <span class=main>=</span> size <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_use_of_bl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> <span class=free>bl</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> of_bl <span class=free>bl</span> <span class=main>∧</span> length <span class=free>bl</span> <span class=main>=</span> length <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_bl.Abs_inverse <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> mem_Collect_eq<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_bl_gt_0 <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bl_Rep' <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> len_gt_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_not_Nil <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> length_bl_gt_0 <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> length_greater_0_conv<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_bl_neq_0 <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> length_bl_gt_0 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> gr_implies_not0<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> hd_bl_sign_sint<span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>bin_sign <span class=main>(</span>sint <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> bin_sign_lem bl_sbin_sign <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>using</span></span> bin_sign_lem bl_sbin_sign <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_drop'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>lend</span> <span class=main>=</span> length <span class=free>bl</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    of_bl <span class=main>(</span>drop <span class=free>lend</span> <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_bl <span class=free>bl</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> trunc_bl2bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_of_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>of_bl <span class=free>bl</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>rev <span class=free>bl</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_of_bl <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> no_of_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>numeral <span class=free>bin</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> uint_bl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> bin_to_bl <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_bl word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_of_bin<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>word_of_int <span class=free>bin</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=free>bin</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_bl word_ubin.eq_norm word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>numeral <span class=free>bin</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> to_bl_of_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_neg_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_neg_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> to_bl_of_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_to_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_bl word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> uint_bl_bin<span class=main>:</span> <span class=quoted><span class=quoted>"bl_to_bin <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> uint <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> bin_bl_bin word_ubin.norm_Rep<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_bl<span class=main>:</span> <span class=quoted><span class=quoted>"ucast <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_down_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=free>bl</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_append_same<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span><span class=free>X</span> <span class=main>@</span> to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_app_cat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_of_bl_up<span class=main>:</span>
  <span class=quoted><span class=quoted>‹ucast <span class=main>(</span>of_bl <span class=free>bl</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=free>bl</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹size <span class=free>bl</span> <span class=main>≤</span> size <span class=main>(</span>of_bl <span class=free>bl</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> trunc_bl2bin_len <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> bit_take_bit_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rev_tf<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_bin_bl_rtf<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_rep_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> length <span class=free>bl</span><span class=main>)</span> False <span class=main>@</span>
    drop <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=free>bl</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rev_tf takefill_alt rev_take<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>ucast <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> False <span class=main>@</span>
    drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> ucast_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_rep_drop<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_up_app<span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False <span class=main>@</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹source_size <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>+</span> <span class=free>n</span> <span class=main>=</span> target_size <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> source_size target_size to_bl_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_down_drop <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>uc</span> <span class=main>=</span> ucast <span class=main>⟹</span> source_size <span class=free>uc</span> <span class=main>=</span> target_size <span class=free>uc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span>
    to_bl <span class=main>(</span><span class=free>uc</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> source_size target_size to_bl_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_down_drop <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sc</span> <span class=main>=</span> scast <span class=main>⟹</span> source_size <span class=free>sc</span> <span class=main>=</span> target_size <span class=free>sc</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span>
    to_bl <span class=main>(</span><span class=free>sc</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>sc</span> <span class=main>=</span> ucast"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> ucast_down_drop<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> down_cast_same <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> source_size target_size is_down<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_0_bl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>[]</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_1_bl<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>[</span>True<span class=main>]</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>replicate <span class=free>n</span> False<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_rep_False<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_bl word_size bin_to_bl_zero<span class=main>)</span>

<span class=comment1>― ‹links with <span class=antiquoted><span class=raw_text><span class=operator>‹</span>rbl›</span></span> operations›</span>
<span class=keyword1><span class=command>lemma</span></span> word_succ_rbl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> <span class=free>bl</span> <span class=main>⟹</span> to_bl <span class=main>(</span>word_succ <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rbl_succ <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_succ<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_pred_rbl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> <span class=free>bl</span> <span class=main>⟹</span> to_bl <span class=main>(</span>word_pred <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rbl_pred <span class=main>(</span>rev <span class=free>bl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_pred<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_rbl<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=free>v</span> <span class=main>=</span> <span class=free>vbl</span> <span class=main>⟹</span> to_bl <span class=free>w</span> <span class=main>=</span> <span class=free>wbl</span> <span class=main>⟹</span>
    to_bl <span class=main>(</span><span class=free>v</span> <span class=main>+</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rbl_add <span class=main>(</span>rev <span class=free>vbl</span><span class=main>)</span> <span class=main>(</span>rev <span class=free>wbl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_mult_rbl<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=free>v</span> <span class=main>=</span> <span class=free>vbl</span> <span class=main>⟹</span> to_bl <span class=free>w</span> <span class=main>=</span> <span class=free>wbl</span> <span class=main>⟹</span>
    to_bl <span class=main>(</span><span class=free>v</span> <span class=main>*</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rbl_mult <span class=main>(</span>rev <span class=free>vbl</span><span class=main>)</span> <span class=main>(</span>rev <span class=free>wbl</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_mult<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rtb_rbl_ariths<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=main>(</span>word_succ <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_succ <span class=free>ys</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=main>(</span>word_pred <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_pred <span class=free>ys</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>v</span> <span class=main>*</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_mult <span class=free>ys</span> <span class=free>xs</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⟹</span> rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>v</span> <span class=main>+</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_add <span class=free>ys</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rev_swap <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_succ_rbl word_pred_rbl word_mult_rbl word_add_rbl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_length_less<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>of_bl <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹length <span class=free>x</span> <span class=main>=</span> <span class=free>k</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹length <span class=free>x</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>of_bl <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> length <span class=free>x</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_horner_sum_bit_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> length_rev <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> horner_sum_of_bool_2_less<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>with</span></span> that <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_eq_rbl_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟷</span> rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_not<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> map Not <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_not_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_xor<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>v</span> <span class=keyword1>XOR</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(≠)</span> <span class=main>(</span>to_bl <span class=free>v</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bl_xor_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_or<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>v</span> <span class=keyword1>OR</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∨)</span> <span class=main>(</span>to_bl <span class=free>v</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bl_or_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_and<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>v</span> <span class=keyword1>AND</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∧)</span> <span class=main>(</span>to_bl <span class=free>v</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bl_and_bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_uint'<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> rev <span class=main>(</span>bin_to_bl <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bin_nth_uint_imp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> bin_nth_uint_imp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bin_nth_bl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> bin_nth_uint <span class=main>=</span> bin_nth_uint' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> to_bl <span class=free>w</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size rev_nth test_bit_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_bit_interval_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>=</span> takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹length <span class=main>(</span>map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span>
    length <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> length <span class=main>(</span>map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=skolem>m</span> <span class=main>⟷</span> takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>m</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_takefill not_less rev_nth to_bl_nth word_size test_bit_word_eq <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> <span class=free>n</span> ›</span></span><span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>!</span> <span class=skolem>m</span> <span class=main>⟷</span> takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>m</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=free>w</span> <span class=main>=</span> rev <span class=main>(</span>map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_bit_interval_eq takefill_bintrunc to_bl_def <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rev_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_unfold<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=free>w</span> <span class=main>!</span> <span class=free>n</span> <span class=main>⟷</span> bit <span class=free>w</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_unfold rev_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_rep_False<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>replicate <span class=free>n</span> False <span class=main>@</span> <span class=free>bs</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=free>bs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> of_bl_def bl_to_bin_rep_F<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>abstract</span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹Word.the_int <span class=main>(</span>of_bl <span class=free>bs</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> horner_sum of_bool <span class=numeral>2</span> <span class=main>(</span>take <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>(</span>rev <span class=free>bs</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_eq <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_horner_sum_bit_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹to_bl <span class=free>w</span> <span class=main>=</span> map <span class=main>(</span>bit <span class=free>w</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>]</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> to_bl_eq_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_reverse_eq_of_bl_rev_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_reverse <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_word_reverse_iff bit_of_bl_iff nth_to_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_reverse_no_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  word_reverse_eq_of_bl_rev_to_bl <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"numeral <span class=free>w</span>"</span></span><span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_word_rev<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>word_reverse <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_rev_to_bl word_reverse_def word_rep_drop <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> of_bl_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_n1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> True"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_bl.Abs_inverse'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bl.Abs_inverse test_bit_bl word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_or<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∨)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_rev bl_word_or rev_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_and<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∧)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_rev bl_word_and rev_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_xor<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(≠)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_rev bl_word_xor rev_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_not<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_word_not rev_map<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bshiftr1_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bshiftr1 <span class=free>b</span> <span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span><span class=free>b</span> <span class=main>#</span> butlast <span class=main>(</span>bin_to_bl <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bshiftr1_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bshiftr1_bl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>bshiftr1 <span class=free>b</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=main>#</span> butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bshiftr1_eq <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_bl.Abs_inverse<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl1_of_bl<span class=main>:</span> <span class=quoted><span class=quoted>"shiftl1 <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span><span class=free>bl</span> <span class=main>@</span> <span class=main>[</span>False<span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl1_bl<span class=main>:</span> <span class=quoted><span class=quoted>"shiftl1 <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span> <span class=main>@</span> <span class=main>[</span>False<span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"shiftl1 <span class=free>w</span> <span class=main>=</span> shiftl1 <span class=main>(</span>of_bl <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span> <span class=main>@</span> <span class=main>[</span>False<span class=main>]</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> shiftl1_of_bl<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_shiftl1<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>shiftl1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> tl <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span>False<span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl1_bl word_rep_drop drop_Suc drop_Cons'<span class=main>)</span> <span class=main>(</span><span class=operator>fast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> Suc_leI<span class=main>)</span>

<span class=comment1>― ‹Generalized version of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>bl_shiftl1›</span></span>. Maybe this one should replace it?›</span>
<span class=keyword1><span class=command>lemma</span></span> bl_shiftl1'<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>shiftl1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> tl <span class=main>(</span>to_bl <span class=free>w</span> <span class=main>@</span> <span class=main>[</span>False<span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl1_bl word_rep_drop drop_Suc <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> drop_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹shiftr1 <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span>shiftr1 <span class=free>w</span><span class=main>)</span> <span class=skolem>n</span> <span class=main>⟷</span> bit <span class=main>(</span>of_bl <span class=main>(</span>butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=skolem>n</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_shiftr1_iff bit_of_bl_iff<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_shiftr1_iff bit_of_bl_iff rev_nth nth_butlast
        word_size test_bit_word_eq to_bl_nth<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_shiftr1<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>shiftr1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> False <span class=main>#</span> butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr1_bl word_rep_drop len_gt_0 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> Suc_leI<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=comment1>― ‹Generalized version of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>bl_shiftr1›</span></span>. Maybe this one should replace it?›</span>
<span class=keyword1><span class=command>lemma</span></span> bl_shiftr1'<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>shiftr1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> butlast <span class=main>(</span>False <span class=main>#</span> to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_bl.Abs_inverse'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> butlast.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr1_bl of_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_sshiftr1<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>sshiftr1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>#</span> butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> length <span class=main>(</span>to_bl <span class=main>(</span>sshiftr1 <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹to_bl <span class=main>(</span>sshiftr1 <span class=free>w</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>n</span> <span class=main>⟷</span> <span class=main>(</span>hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>#</span> butlast <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=skolem>n</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_nth word_size hd_conv_nth test_bit_eq_bit bit_sshiftr1_iff nth_butlast Suc_diff_Suc nth_to_bl<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> drop_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> take <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_Suc bl_shiftr1 butlast_drop <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> butlast_take <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_sshiftr<span class=main>:</span> <span class=quoted><span class=quoted>"drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> take <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size sshiftr_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size nth_to_bl bit_signed_drop_bit_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> take_shiftr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> size <span class=free>w</span> <span class=main>⟹</span> take <span class=free>n</span> <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_shiftr1' length_0_conv <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> take_butlast <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> take_sshiftr'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> size <span class=free>w</span> <span class=main>⟹</span> hd <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>∧</span>
    take <span class=free>n</span> <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> <span class=main>(</span>hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sshiftr_eq hd_bl_sign_sint bin_sign_def not_le word_size sint_signed_drop_bit_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_to_bl bit_signed_drop_bit_iff bit_last_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_to_bl bit_signed_drop_bit_iff bit_last_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> hd_sshiftr <span class=main>=</span> take_sshiftr' <span class=main>[</span><span class=operator>THEN</span> conjunct1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> take_sshiftr <span class=main>=</span> take_sshiftr' <span class=main>[</span><span class=operator>THEN</span> conjunct2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> atd_lem<span class=main>:</span> <span class=quoted><span class=quoted>"take <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>t</span> <span class=main>⟹</span> drop <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>d</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>t</span> <span class=main>@</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> append_take_drop_id <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> bl_shiftr <span class=main>=</span> atd_lem <span class=main>[</span><span class=operator>OF</span> take_shiftr drop_shiftr<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> bl_sshiftr <span class=main>=</span> atd_lem <span class=main>[</span><span class=operator>OF</span> take_sshiftr drop_sshiftr<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_of_bl<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=free>bl</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> of_bl <span class=main>(</span><span class=free>bl</span> <span class=main>@</span> replicate <span class=free>n</span> False<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> shiftl_def shiftl1_of_bl replicate_app_Cons_same<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span> <span class=main>@</span> replicate <span class=free>n</span> False<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>w</span> <span class=main>@</span> replicate <span class=free>n</span> False<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> shiftl_of_bl<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>@</span> replicate <span class=main>(</span>min <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_bl word_rep_drop word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_bl_of<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>bl</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
    shiftr1 <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>butlast <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> butlast_rest_bl2bin trunc_bl2bin<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_bl_of<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>bl</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span>of_bl <span class=free>bl</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> of_bl <span class=main>(</span>take <span class=main>(</span>length <span class=free>bl</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftr1_bl_of<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> butlast_take<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>≡</span> of_bl <span class=main>(</span>take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>using</span></span> shiftr_bl_of <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_bl_add_size <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"size <span class=free>x</span> <span class=main>-</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> size <span class=free>x</span> <span class=main>⟹</span> drop <span class=free>m</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False <span class=main>⟹</span>
    take <span class=free>m</span> <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>m</span> False <span class=main>⟹</span>
    to_bl <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> take <span class=free>m</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>@</span> drop <span class=free>m</span> <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_bl.Rep_eqD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_word_and<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> align_lem_and <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span><span class=main><span class=keyword3>[</span></span>5<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> bl_word_or<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> align_lem_or<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_bl<span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=free>n</span> <span class=main>=</span> of_bl <span class=main>(</span>replicate <span class=free>n</span> True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> test_bit_of_bl word_size <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> word_eqI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_and_mask'<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> False <span class=main>@</span>
    drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_nth word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size test_bit_bl nth_append rev_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> slice1_eq_of_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>slice1 <span class=free>n</span> <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span>slice1 <span class=free>n</span> <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=skolem>m</span> <span class=main>⟷</span> bit <span class=main>(</span>of_bl <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=skolem>m</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>≥</span> <span class=free>n</span>›</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≥</span> <span class=free>n</span>›</span></span><span class=main>)</span>
      <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_slice1_iff bit_of_bl_iff not_less rev_nth not_le nth_takefill nth_to_bl <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> slice1_no_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"slice1 <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice1_eq_of_bl<span class=main>)</span> <span class=comment1>(* TODO: neg_numeral *)</span>

<span class=keyword1><span class=command>lemma</span></span> slice_no_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"slice <span class=free>n</span> <span class=main>(</span>numeral <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>
    <span class=main>(</span>bin_to_bl <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice_def<span class=main>)</span> <span class=comment1>(* TODO: neg_numeral *)</span>

<span class=keyword1><span class=command>lemma</span></span> slice_take'<span class=main>:</span> <span class=quoted><span class=quoted>"slice <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> of_bl <span class=main>(</span>take <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice_def word_size slice1_eq_of_bl takefill_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> slice_take <span class=main>=</span> slice_take' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=comment1>― ‹shiftr to a word of the same size is just slice,
    slice is just shiftr then ucast›</span>
<span class=keyword1><span class=command>lemmas</span></span> shiftr_slice <span class=main>=</span> trans <span class=main>[</span><span class=operator>OF</span> shiftr_bl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> meta_eq_to_obj_eq<span class=main><span class=main>]</span></span> slice_take <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> slice1_down_alt'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sl</span> <span class=main>=</span> slice1 <span class=free>n</span> <span class=free>w</span> <span class=main>⟹</span> <span class=free>fs</span> <span class=main>=</span> size <span class=free>sl</span> <span class=main>⟹</span> <span class=free>fs</span> <span class=main>+</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=main>⟹</span>
    to_bl <span class=free>sl</span> <span class=main>=</span> takefill False <span class=free>fs</span> <span class=main>(</span>drop <span class=free>k</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice1_eq_of_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_bin_bl_rep_drop<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> drop_takefill
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> slice1_up_alt'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sl</span> <span class=main>=</span> slice1 <span class=free>n</span> <span class=free>w</span> <span class=main>⟹</span> <span class=free>fs</span> <span class=main>=</span> size <span class=free>sl</span> <span class=main>⟹</span> <span class=free>fs</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=free>k</span> <span class=main>⟹</span>
    to_bl <span class=free>sl</span> <span class=main>=</span> takefill False <span class=free>fs</span> <span class=main>(</span>replicate <span class=free>k</span> False <span class=main>@</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice1_eq_of_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_bin_bl_rep_drop <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> takefill_append<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> diff_add_inverse<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> sd1 <span class=main>=</span> slice1_down_alt' <span class=main>[</span><span class=operator>OF</span> refl refl<span class=main>,</span> <span class=operator>unfolded</span> word_size<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> su1 <span class=main>=</span> slice1_up_alt' <span class=main>[</span><span class=operator>OF</span> refl refl<span class=main>,</span> <span class=operator>unfolded</span> word_size<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> slice1_down_alt <span class=main>=</span> le_add_diff_inverse <span class=main>[</span><span class=operator>THEN</span> sd1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> slice1_up_alts <span class=main>=</span>
  le_add_diff_inverse <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>THEN</span> su1<span class=main>]</span>
  le_add_diff_inverse2 <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>THEN</span> su1<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> slice1_tf_tf'<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>slice1 <span class=free>n</span> <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> slice1_eq_of_bl <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_rev_tf<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> slice1_tf_tf <span class=main>=</span> slice1_tf_tf' <span class=main>[</span><span class=operator>THEN</span> word_bl.Rep_inverse'<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> revcast_eq_of_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>revcast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> revcast_def slice1_eq_of_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> revcast_no_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> revcast_eq_of_bl <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>w</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> word_size<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_revcast<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>revcast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_to_bl nth_takefill bit_revcast_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_cat_bl<span class=main>:</span> <span class=quoted><span class=quoted>"word_cat <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> of_bl <span class=main>(</span>to_bl <span class=free>a</span> <span class=main>@</span> to_bl <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_word_cat_iff bit_of_bl_iff nth_append not_less nth_rev_to_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> bit_word.rep_eq less_diff_conv2 nth_rev_to_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_append<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>of_bl <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> of_bl <span class=free>xs</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=main>(</span>length <span class=free>ys</span><span class=main>)</span> <span class=main>+</span> of_bl <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_app_cat bin_cat_num<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_False <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>False<span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> test_bit_of_bl nth_append<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_True <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_bl <span class=main>(</span>True <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>^</span>length <span class=free>xs</span> <span class=main>+</span> of_bl <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_bl_append <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>[</span>True<span class=main>]</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_1_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span><span class=free>x</span><span class=main>#</span><span class=free>xs</span><span class=main>)</span> <span class=main>=</span> of_bool <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span>length <span class=free>xs</span> <span class=main>+</span> of_bl <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> word_split_bl'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>std</span> <span class=main>=</span> size <span class=free>c</span> <span class=main>-</span> size <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span>word_split <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=free>a</span> <span class=main>=</span> of_bl <span class=main>(</span>take <span class=free>std</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> of_bl <span class=main>(</span>drop <span class=free>std</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_split_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit drop_bin2bl bin_to_bl_drop_bit <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span><span class=main><span class=main>]</span></span> min_absorb2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_split_bl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>std</span> <span class=main>=</span> size <span class=free>c</span> <span class=main>-</span> size <span class=free>b</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=free>a</span> <span class=main>=</span> of_bl <span class=main>(</span>take <span class=free>std</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> of_bl <span class=main>(</span>drop <span class=free>std</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span>
    word_split <span class=free>c</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_split_bl'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"word_split <span class=free>c</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> word_split_bl' <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_split_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_split <span class=free>c</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'c</span><span class=main>::</span>len word <span class=main>×</span> <span class=tfree>'d</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span>of_bl <span class=main>(</span>take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'d</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>
     of_bl <span class=main>(</span>drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'d</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>c</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_split_bl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> refl conjI<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rcat_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_rcat <span class=free>wl</span> <span class=main>=</span> of_bl <span class=main>(</span>concat <span class=main>(</span>map to_bl <span class=free>wl</span><span class=main>)</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ws</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ws</span> <span class=main>=</span> rev <span class=free>wl</span>›</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_rcat <span class=main>(</span>rev <span class=skolem>ws</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>concat <span class=main>(</span>map to_bl <span class=main>(</span>rev <span class=skolem>ws</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rcat_def of_bl_eq rev_concat rev_map comp_def rev_to_bl_eq <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> horner_sum_of_bool_2_concat<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> size_rcat_lem'<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=main>(</span>concat <span class=main>(</span>map to_bl <span class=free>wl</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> length <span class=free>wl</span> <span class=main>*</span> size <span class=main>(</span>hd <span class=free>wl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>wl</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> size_rcat_lem <span class=main>=</span> size_rcat_lem' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rcat_lem<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>wl</span><span class=main>::</span><span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>*</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    rev <span class=main>(</span>concat <span class=main>(</span>map to_bl <span class=free>wl</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span>
    rev <span class=main>(</span>to_bl <span class=main>(</span>rev <span class=free>wl</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>wl</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> nth_append size_rcat_lem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mult_Suc minus_div_mult_eq_mod <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq_le not_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> diff_is_0_eq div_le_mono len_not_eq_0 less_Suc_eq less_mult_imp_div_less nonzero_mult_div_cancel_right not_le nth_Cons_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> foldl_eq_foldr<span class=main>:</span> <span class=quoted><span class=quoted>"foldl <span class=main>(+)</span> <span class=free>x</span> <span class=free>xs</span> <span class=main>=</span> foldr <span class=main>(+)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>comm_monoid_add"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> add.assoc<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_cat_bl_no_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  word_cat_bl <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>b</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> to_bl_numeral<span class=main>]</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=comment1>(* FIXME: negative numerals, 0 and 1 *)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_split_bl_no_bin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  word_split_bl_eq <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> c<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>c</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> to_bl_numeral<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>c</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rot_defs <span class=main>=</span> word_roti_eq_word_rotr_word_rotl word_rotr_eq word_rotl_eq

<span class=keyword1><span class=command>lemma</span></span> to_bl_rotl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>word_rotl <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rotate <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rotl_eq to_bl_use_of_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> blrs0 <span class=main>=</span> rotate_eqs <span class=main>[</span><span class=operator>THEN</span> to_bl_rotl <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>THEN</span></span></span></span></span> trans<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rotl_eqs <span class=main>=</span>
  blrs0 <span class=main>[</span><span class=operator>simplified</span> word_bl_Rep' word_bl.Rep_inject to_bl_rotl <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_rotr<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>word_rotr <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> rotater <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rotr_eq to_bl_use_of_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> brrs0 <span class=main>=</span> rotater_eqs <span class=main>[</span><span class=operator>THEN</span> to_bl_rotr <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>THEN</span></span></span></span></span> trans<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rotr_eqs <span class=main>=</span>
  brrs0 <span class=main>[</span><span class=operator>simplified</span> word_bl_Rep' word_bl.Rep_inject to_bl_rotr <span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>declare</span></span> word_rotr_eqs <span class=main>(</span>1<span class=main>)</span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> word_rotl_eqs <span class=main>(</span>1<span class=main>)</span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> abl_cong <span class=main>=</span> arg_cong <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"of_bl"</span></span><span class=main>]</span>

<span class=keyword1><span class=command>locale</span></span> word_rotate
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_rot_defs' <span class=main>=</span> to_bl_rotl to_bl_rotr

<span class=keyword1><span class=command>lemmas</span></span> blwl_syms <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=main>=</span> bl_word_not bl_word_and bl_word_or bl_word_xor

<span class=keyword1><span class=command>lemmas</span></span> lbl_lbl <span class=main>=</span> trans <span class=main>[</span><span class=operator>OF</span> word_bl_Rep' word_bl_Rep' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> ths_map2 <span class=main>[</span><span class=operator>OF</span> lbl_lbl<span class=main>]</span> <span class=main>=</span> rotate_map2 rotater_map2

<span class=keyword1><span class=command>lemmas</span></span> ths_map <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"to_bl <span class=free><span class=free>v</span></span>"</span></span></span><span class=main>]</span> <span class=main>=</span> rotate_map rotater_map <span class=keyword2><span class=keyword>for</span></span> <span class=free>v</span>

<span class=keyword1><span class=command>lemmas</span></span> th1s <span class=main>[</span><span class=operator>simplified</span> word_rot_defs' <span class=main><span class=main><span class=main><span class=main><span class=main>[</span></span></span></span></span><span class=operator><span class=operator><span class=operator><span class=operator>symmetric</span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main>]</span></span></span></span></span><span class=main>]</span> <span class=main>=</span> ths_map2 ths_map

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemmas</span></span> bl_word_rotl_dt <span class=main>=</span> trans <span class=main>[</span><span class=operator>OF</span> to_bl_rotl rotate_drop_take<span class=main>,</span>
  <span class=operator>simplified</span> word_bl_Rep'<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> bl_word_rotr_dt <span class=main>=</span> trans <span class=main>[</span><span class=operator>OF</span> to_bl_rotr rotater_drop_take<span class=main>,</span>
  <span class=operator>simplified</span> word_bl_Rep'<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_roti_dt'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> nat <span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=free>i</span><span class=main>)</span> <span class=keyword1>mod</span> int <span class=main>(</span>size <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    to_bl <span class=main>(</span>word_roti <span class=free>i</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>@</span> take <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_roti_eq_word_rotr_word_rotl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_word_rotl_dt bl_word_rotr_dt word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_zminus1_eq_if<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_mult_distrib<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_diff_distrib <span class=main><span class=main>[</span></span><span class=operator>OF</span> pos_mod_sign pos_mod_conj
                                      <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> conjunct2<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>THEN</span> order_less_imp_le<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span>
                    nat_mod_distrib<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_mod_distrib<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> bl_word_roti_dt <span class=main>=</span> bl_word_roti_dt' <span class=main>[</span><span class=operator>unfolded</span> word_size<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rotl_dt <span class=main>=</span> bl_word_rotl_dt <span class=main>[</span><span class=operator>THEN</span> word_bl.Rep_inverse' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word_rotr_dt <span class=main>=</span> bl_word_rotr_dt <span class=main>[</span><span class=operator>THEN</span> word_bl.Rep_inverse' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word_roti_dt <span class=main>=</span> bl_word_roti_dt <span class=main>[</span><span class=operator>THEN</span> word_bl.Rep_inverse' <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rotr_dt_no_bin' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  word_rotr_dt <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>w</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> to_bl_numeral<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>
  <span class=comment1>(* FIXME: negative numerals, 0 and 1 *)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rotl_dt_no_bin' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  word_rotl_dt <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>w</span>"</span></span><span class=main>,</span> <span class=operator>unfolded</span> to_bl_numeral<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>
  <span class=comment1>(* FIXME: negative numerals, 0 and 1 *)</span>

<span class=keyword1><span class=command>lemma</span></span> max_word_bl<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>max_word<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> replicate <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> to_bl_n1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
  replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> False <span class=main>@</span>
    replicate <span class=main>(</span>min <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span><span class=main>)</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_bl word_rep_drop min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_replicate_True<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span>
    map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>y</span><span class=main>)</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=main>(</span>replicate <span class=free>n</span> True<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> map_replicate_False<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>y</span><span class=main>)</span>
    <span class=main>(</span>zip <span class=free>xs</span> <span class=main>(</span>replicate <span class=free>n</span> False<span class=main>)</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bl_and_mask<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>defines</span></span> <span class=quoted><span class=quoted>"<span class=free>n'</span> <span class=main>≡</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n'</span> False <span class=main>@</span> drop <span class=free>n'</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>note</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> map_replicate_True map_replicate_False
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∧)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=main>(</span>mask <span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_word_and<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> take <span class=free>n'</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>@</span> drop <span class=free>n'</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map2 <span class=main>(∧)</span> <span class=main>…</span> <span class=main>(</span>to_bl <span class=main>(</span>mask <span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
      replicate <span class=free>n'</span> False <span class=main>@</span> drop <span class=free>n'</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> to_bl_mask n'_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> zip_append<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_rev_takefill<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span>
    drop <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>takefill False <span class=free>n</span> <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt rev_take<span class=main>)</span>

<span class=keyword1><span class=command>declare</span></span> bin_to_bl_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> of_bl_reasoning <span class=main>=</span> to_bl_use_of_bl of_bl_append

<span class=keyword1><span class=command>lemma</span></span> uint_of_bl_is_bl_to_bin_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=main>(</span>dropWhile Not <span class=free>l</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> uint <span class=main>(</span>of_bl <span class=free>l</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_mod<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Divides.mod_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_to_bin_ge0<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> bl_to_bin_lt2p_drop <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order.strict_trans2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> uint_of_bl_is_bl_to_bin<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>l</span><span class=main>≤</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> uint <span class=main>(</span><span class=main>(</span>of_bl<span class=main>::</span>bool list<span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=free>l</span><span class=main>)</span> <span class=main>=</span> bl_to_bin <span class=free>l</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>rule</span> uint_of_bl_is_bl_to_bin_drop<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> le_trans length_dropWhile_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_or<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(∨)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>a</span><span class=main>)</span> <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bl_or_aux_bin<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=free>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>b</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> bs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> cs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_1_bl<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=main>[</span><span class=free>x</span> <span class=main>!!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_2_eq_odd test_bit_word_eq and_one_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_1_and_bl<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=keyword1>AND</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=main>[</span><span class=free>x</span> <span class=main>!!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_2_eq_odd test_bit_word_eq one_and_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>drop <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_bl <span class=free>xs</span> <span class=keyword1>AND</span> mask <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bang_eq test_bit_of_bl rev_nth <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> rev_conj_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size to_bl_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> False <span class=main>@</span> <span class=main>[</span>True<span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_unfold nth_append rev_nth bit_1_iff not_less not_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> eq_zero_set_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>True <span class=main>∉</span> set <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_unfold<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> of_drop_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=main>(</span>size <span class=free>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_drop word_size_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_bl_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_bl <span class=free>xs</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_bl <span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> length <span class=free>xs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_length_less<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> True
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt unat_of_nat<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_bl <span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> unat_split<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>from</span></span> False
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> length <span class=free>xs</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>^</span> length <span class=free>xs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> power_increasing<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_msb_alt<span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=free>w</span> <span class=main>⟷</span> hd <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_word_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> hd_conv_nth<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nth_to_bl<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_lsb_last<span class=main>:</span>
  <span class=quoted><span class=quoted>‹lsb <span class=free>w</span> <span class=main>⟷</span> last <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> nth_to_bl <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span>›</span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lsb_odd last_conv_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span>True <span class=main>∉</span> set <span class=main>(</span>drop <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_mask eq_zero_set_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_nth word_size <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> conj_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_diff_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>i</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>.</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span> <span class=main>+</span> <span class=bound>j</span> <span class=main>=</span> <span class=improper>i</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>j</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>thin_tac</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>!!</span> <span class=skolem>t</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=skolem>t</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>i</span> <span class=main>+</span> <span class=free>n</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span> <span class=main>+</span> <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_replicate<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> aligned<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>          nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> <span class=main>(</span>take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>@</span> replicate <span class=free>n</span> False"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> nv <span class=keyword1><span class=command>have</span></span> rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span>
      to_bl <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>of_nat <span class=bound>q</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
      drop <span class=free>n</span> <span class=main>(</span>to_bl <span class=main>(</span>of_nat <span class=bound>q</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span> <span class=main>@</span> replicate <span class=free>n</span> False"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bl_shiftl le_antisym min_def shiftl_t2n wsst_TYs<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> aligned
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rl <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_drop<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>@</span> replicate <span class=free>n</span> False"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_replicate<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>…</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> less_is_drop_replicate<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"to_bl <span class=free>x</span> <span class=main>=</span> replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> False <span class=main>@</span> drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms bl_and_mask' less_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_conv<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>off</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> aligned<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>        offv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>    <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>w</span> <span class=main>+</span> <span class=free>off</span><span class=main>)</span> <span class=main>=</span>
   <span class=main>(</span>take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span>drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>off</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
  <span class=keyword3><span class=command>assume</span></span> nv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> aligned_bl_add_size<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>n</span> False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_replicate <span class=main><span class=main>[</span></span><span class=operator>OF</span> aligned nv<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> offv <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>off</span><span class=main>)</span> <span class=main>=</span>
                    replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> False"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> less_is_drop_replicate<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>fact</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> offv <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_replicateI<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=free>p</span> <span class=main>=</span> <span class=free>addr</span> <span class=main>@</span> replicate <span class=free>n</span> False <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_to_bl word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"length <span class=free>addr</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> replicate_not_True<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted>length</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_2p<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
   to_bl <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span>
   replicate <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span> False <span class=main>@</span> True <span class=main>#</span> replicate <span class=free>n</span> False"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftl_1 <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bl_shiftl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_1 min_def word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> xor_2p_to_bl<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>
   <span class=keyword1>then</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span><span class=main>¬</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>!</span><span class=free>n</span><span class=main>)</span> <span class=main>#</span> drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span><span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>
   <span class=keyword1>else</span> to_bl <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span> <span class=main>=</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>@</span> drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_word_xor to_bl_2p<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> x<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> zip_append<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_zip_replicate_False_xor drop_minus<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size nth_w2p <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_replicateD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>∃</span><span class=bound>xs</span><span class=main>.</span> to_bl <span class=free>w</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>@</span> replicate <span class=free>n</span> False
               <span class=main>∧</span> length <span class=bound>xs</span> <span class=main>=</span> size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_replicate<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹right-padding a word to a certain length›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>bl_pad_to</span> <span class=free><span class=bound><span class=entity>bl</span></span></span> <span class=free><span class=bound><span class=entity>sz</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>bl</span></span></span> <span class=main>@</span> <span class=main>(</span>replicate <span class=main>(</span><span class=free><span class=bound><span class=entity>sz</span></span></span> <span class=main>-</span> length <span class=free><span class=bound><span class=entity>bl</span></span></span><span class=main>)</span> False<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_pad_to_length<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lbl<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>bl</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"length <span class=main>(</span>bl_pad_to <span class=free>bl</span> <span class=free>sz</span><span class=main>)</span> <span class=main>=</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lbl <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_pad_to_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bl_pad_to_prefix<span class=main>:</span>
  <span class=quoted><span class=quoted>"prefix <span class=free>bl</span> <span class=main>(</span>bl_pad_to <span class=free>bl</span> <span class=free>sz</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_pad_to_def<span class=main>)</span>


<span class=keyword1><span class=command>lemma</span></span> of_bl_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> of_bl <span class=free>xs</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> length <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_length_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_mult_and_not_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> length <span class=free>b</span> <span class=main>+</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> of_bl <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> push_bit_eq_mult subtract_mask<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le not_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> is_aligned_imp_not_bit is_aligned_weaken less_diff_conv2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_alignedE'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_push_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_of_bl_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> length <span class=free>b</span> <span class=main>+</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> length <span class=free>b</span> <span class=main>+</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span>
  <span class=main>⟹</span> bin_to_bl <span class=main>(</span>length <span class=free>b</span><span class=main>)</span> <span class=main>(</span>uint <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>+</span> of_bl <span class=free>b</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=free>c</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> push_bit_eq_mult take_bit_eq_mask <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_eq_drop_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le not_less unsigned_or_eq unsigned_drop_bit_eq
     unsigned_push_bit_eq bin_to_bl_or <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> is_aligned_imp_not_bit is_aligned_weaken less_diff_conv2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_alignedE'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_bin_to_bl <span class=dynamic><span class=dynamic>bit_simps</span></span> rev_nth <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> bin_to_bl_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* FIXME: move to Word distribution *)</span>
<span class=keyword1><span class=command>lemma</span></span> bin_nth_minus_Bit0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_nth <span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> bin_nth <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_minus_Bit1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_nth <span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> bin_nth <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* casting a long word to a shorter word and casting back to the long word
   is equal to the original long word -- if the word is small enough.
  'l is the longer word.
  's is the shorter word.
*)</span>
<span class=keyword1><span class=command>lemma</span></span> bl_cast_long_short_long_ingoreLeadingZero_generic<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> length <span class=main>(</span>dropWhile Not <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'s</span><span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'s</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'l</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>(</span>of_bl <span class=main>::</span> <span class=main>_</span> <span class=main>⇒</span> <span class=tfree>'l</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>(</span>to_bl <span class=main>(</span><span class=main>(</span>of_bl<span class=main>::</span><span class=main>_</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_uint_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_of_bl_is_bl_to_bin uint_of_bl_is_bl_to_bin_drop<span class=main>)</span>

<span class=comment1>(*
 Casting between longer and shorter word.
  'l is the longer word.
  's is the shorter word.
 For example: 'l::len word is 128 word (full ipv6 address)
              's::len word is 16 word (address piece of ipv6 address in colon-text-representation)
*)</span>
<span class=keyword1><span class=command>corollary</span></span> ucast_short_ucast_long_ingoreLeadingZero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> length <span class=main>(</span>dropWhile Not <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'s</span><span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'s</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'l</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>(</span>ucast<span class=main>::</span> <span class=tfree>'s</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'l</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>(</span><span class=main>(</span>ucast<span class=main>::</span> <span class=tfree>'l</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_bl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bl_cast_long_short_long_ingoreLeadingZero_generic<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_drop_mask<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>dropWhile Not <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>takeWhile Not <span class=main>(</span>replicate <span class=skolem>n</span> False <span class=main>@</span> <span class=skolem>ls</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>n</span> <span class=main>+</span> length <span class=main>(</span>takeWhile Not <span class=skolem>ls</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>ls</span> <span class=skolem>n</span> <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>subst</span> takeWhile_append2<span class=main>)</span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> bl_and_mask <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dropWhile_eq_drop<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> map_bits_rev_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>(!!)</span> <span class=free>x</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span>size <span class=free>x</span><span class=main>]</span> <span class=main>=</span> rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list_eq_iff_nth_eq test_bit_bl word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_length2<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> of_bl <span class=free>xs</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=free>c</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_bl_length word_less_power_trans2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_bl_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>of_bl <span class=free>xs</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> mask <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ys</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ys</span> <span class=main>=</span> rev <span class=free>xs</span>›</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=main>(</span>length <span class=skolem>ys</span><span class=main>)</span> <span class=main>(</span>horner_sum of_bool <span class=numeral>2</span> <span class=skolem>ys</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> horner_sum of_bool <span class=numeral>2</span> <span class=skolem>ys</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_horner_sum_bit_eq min_def<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>of_bl <span class=main>(</span>rev <span class=skolem>ys</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>≤</span> mask <span class=main>(</span>length <span class=skolem>ys</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> of_bl_rev_eq less_eq_mask_iff_take_bit_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> ys_def <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Ancient_Numeral><div class=head><h1>Theory Ancient_Numeral</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>theory</span></span> Ancient_Numeral
  <span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=Reversed_Bit_Lists.html>Reversed_Bit_Lists</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>Bit</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> bool <span class=main>⇒</span> int"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>BIT</span>"</span> 90<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1><span class=free>BIT</span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>k</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> Bit_B0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=free>k</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_B1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=free>k</span> <span class=main>+</span> <span class=free>k</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_B0_2t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Bit_B0<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_B1_2t<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Bit_B1<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> uminus_Bit_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=free>k</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=free>k</span> <span class=main>-</span> of_bool <span class=free>b</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> power_BIT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rl_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=free>w</span> <span class=keyword1>BIT</span> bin_last <span class=free>w</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> even_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"even <span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>¬</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"bin_last <span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> BIT_eq_iff <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>=</span> <span class=free>v</span> <span class=keyword1>BIT</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>u</span> <span class=main>=</span> <span class=free>v</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span> <span class=operator>arith</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> BIT_bin_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"numeral <span class=free>k</span> <span class=keyword1>BIT</span> False <span class=main>=</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"numeral <span class=free>k</span> <span class=keyword1>BIT</span> True <span class=main>=</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=free>k</span><span class=main>)</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=free>k</span><span class=main>)</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=main>-</span> numeral <span class=main>(</span>Num.BitM <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Bit_B0 Bit_B1 numeral.simps numeral_BitM<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> BIT_special_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=numeral>3</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>-</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_eq_0_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_eq_m1_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>∧</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> expand_BIT<span class=main>:</span>
  <span class=quoted><span class=quoted>"numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> numeral <span class=free>w</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=quoted><span class=quoted>"numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> numeral <span class=free>w</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> numeral <span class=main>(</span>Num.Bit0 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>w</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> numeral <span class=main>(</span>Num.Bit1 <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>w</span> <span class=main>+</span> Num.One<span class=main>)</span><span class=main>)</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> BitM_inc_eq add_One<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> less_Bits<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>v</span> <span class=main>&lt;</span> <span class=free>w</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_Bits<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>v</span> <span class=main>&lt;</span> <span class=free>w</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>≤</span> <span class=free>w</span> <span class=main>∧</span> <span class=main>(</span><span class=main>¬</span> <span class=free>b</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> pred_BIT_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> False <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> True <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> succ_BIT_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> False <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> True <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> add_BIT_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> False <span class=main>+</span> <span class=free>y</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> False <span class=main>+</span> <span class=free>y</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> True <span class=main>+</span> <span class=free>y</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> True <span class=main>+</span> <span class=free>y</span> <span class=keyword1>BIT</span> True <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mult_BIT_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> False <span class=main>*</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=free>y</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> True <span class=main>*</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> False <span class=main>+</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> B_mod_2'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> True<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>X</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> False<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>X</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0 Bit_B1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_ex_rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>w</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>w</span> <span class=keyword1>BIT</span> <span class=bound>b</span> <span class=main>=</span> <span class=free>bin</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bin_rl_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_exhaust<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>x</span> <span class=bound>b</span><span class=main>.</span> <span class=free>bin</span> <span class=main>=</span> <span class=bound>x</span> <span class=keyword1>BIT</span> <span class=bound>b</span> <span class=main>⟹</span> <span class=free>Q</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>Q</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bin_ex_rl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_abs_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bin</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>bin</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span> <span class=main>⟶</span> <span class=free>bin</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟶</span> nat <span class=main>¦</span><span class=free>w</span><span class=main>¦</span> <span class=main>&lt;</span> nat <span class=main>¦</span><span class=free>bin</span><span class=main>¦</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> Bit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>arith</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>arith</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_induct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> PPls<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>0</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> PMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> PBit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>bin</span> <span class=bound>bit</span><span class=main>.</span> <span class=free>P</span> <span class=bound>bin</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>bin</span> <span class=keyword1>BIT</span> <span class=bound>bit</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>bin</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=free>P</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=free>bin</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> f1<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"nat <span class=main>∘</span> abs"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> wf_measure <span class=main><span class=main>[</span></span><span class=operator>THEN</span> wf_induct<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> measure_def inv_image_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>x</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> bin_exhaust<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> bin_abs_lem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> PPls PMin PBit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> Bit_div2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> bin_rest_BIT<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> twice_conv_BIT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>BIT</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> BIT_lt0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> BIT_ge0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span><span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_to_bl_aux_Bit_minus_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_to_bl_aux <span class=free>n</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=free>bl</span> <span class=main>=</span> bin_to_bl_aux <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>w</span> <span class=main>(</span><span class=free>b</span> <span class=main>#</span> <span class=free>bl</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bl_to_bin_BIT<span class=main>:</span>
  <span class=quoted><span class=quoted>"bl_to_bin <span class=free>bs</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>=</span> bl_to_bin <span class=main>(</span><span class=free>bs</span> <span class=main>@</span> <span class=main>[</span><span class=free>b</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_append Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_0_BIT<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_Suc_BIT<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> bin_nth <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_minus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> bin_nth <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> bin_nth <span class=free>w</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_sign_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_sign <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bin_sign <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_sign_def Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_nth_Bit<span class=main>:</span> <span class=quoted><span class=quoted>"bin_nth <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> bin_nth <span class=free>w</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_Suc_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  signed_take_bit_Suc <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span>"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_BIT bin_rest_BIT<span class=main>]</span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=free>b</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_0_BIT_B0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  signed_take_bit_0 <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>BIT</span> False"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_numeral_simps bin_rest_numeral_simps<span class=main>]</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>

<span class=keyword1><span class=command>lemmas</span></span> sbintrunc_0_BIT_B1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  signed_take_bit_0 <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>BIT</span> True"</span></span><span class=main>,</span> <span class=operator>simplified</span> bin_last_BIT bin_rest_numeral_simps<span class=main>]</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span>

<span class=keyword1><span class=command>lemma</span></span> sbintrunc_Suc_minus_Is<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
  sbintrunc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span>
  sbintrunc <span class=free>n</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>b</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def signed_take_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_Suc_Bit<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>w</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=free>w</span> <span class=free>n</span> <span class=free>v</span> <span class=keyword1>BIT</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def concat_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_not_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=free>w</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=main>(</span><span class=main>¬</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_int_def Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_and_Bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=main>(</span><span class=free>b</span> <span class=main>∧</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> and_int_rec <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_or_Bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=main>(</span><span class=free>b</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> or_int_rec <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_xor_Bits <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>(</span><span class=free>b</span> <span class=main>∧</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> xor_int_rec <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=keyword1>BIT</span> <span class=free>c</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_B0_2t Bit_B1_2t<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mod_BIT<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>bin</span> <span class=keyword1>BIT</span> <span class=free>bit</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>bin</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=free>bit</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>bit</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>bin</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>bin</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_mult_mult1<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>bin</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> pos_zmod_mult_2<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>bin</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> Suc <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>mod_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> minus_BIT_0<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>-</span> <span class=free>y</span> <span class=keyword1>BIT</span> False <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>BIT</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_lsb_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"lsb <span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lsb_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_shiftr_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> int_shiftr0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> int_shiftr_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_int_def<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
   <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_int_def Bit_def add.commute pos_zdiv_mult_2<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> msb_BIT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=free>x</span> <span class=keyword1>BIT</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_int_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=Bitwise><div class=head><h1>Theory Bitwise</h1></div><pre class=source><span class=comment1>(*
 * Copyright Thomas Sewell, NICTA and Sascha Boehme, TU Muenchen
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>theory</span></span> Bitwise
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=More_Arithmetic.html>More_Arithmetic</a>
    <a href=Reversed_Bit_Lists.html>Reversed_Bit_Lists</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Helper constants used in defining addition›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>xor3</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool <span class=main>⇒</span> bool <span class=main>⇒</span> bool <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>xor3</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>carry</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool <span class=main>⇒</span> bool <span class=main>⇒</span> bool <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>carry</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>∧</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>∨</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> carry_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"carry True <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"carry <span class=free>a</span> True <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"carry <span class=free>a</span> <span class=free>b</span> True <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"carry False <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∧</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"carry <span class=free>a</span> False <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∧</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"carry <span class=free>a</span> <span class=free>b</span> False <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∧</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> carry_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> xor3_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"xor3 True <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"xor3 <span class=free>a</span> True <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"xor3 <span class=free>a</span> <span class=free>b</span> True <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"xor3 False <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≠</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"xor3 <span class=free>a</span> False <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≠</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"xor3 <span class=free>a</span> <span class=free>b</span> False <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≠</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> xor3_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Breaking up word equalities into equalities on their
  bit lists. Equalities are generated and manipulated in the
  reverse order to <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>const</span><span class=hidden>&gt;</span></span></span>‹to_bl›</span></span>.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> bl_word_sub<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> to_bl <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_1<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>[</span>True<span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span>word_succ <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> rtb_rbl_ariths<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_if<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> map2 <span class=main>(</span>If <span class=free>P</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add_carry_Cons<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>car</span> <span class=keyword1>then</span> rbl_succ <span class=keyword1>else</span> id<span class=main>)</span> <span class=main>(</span>rbl_add <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    xor3 <span class=free>x</span> <span class=free>y</span> <span class=free>car</span> <span class=main>#</span> <span class=main>(</span><span class=keyword1>if</span> carry <span class=free>x</span> <span class=free>y</span> <span class=free>car</span> <span class=keyword1>then</span> rbl_succ <span class=keyword1>else</span> id<span class=main>)</span> <span class=main>(</span>rbl_add <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> carry_def xor3_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_add_suc_carry_fold<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    <span class=main>∀</span><span class=bound>car</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>if</span> <span class=bound>car</span> <span class=keyword1>then</span> rbl_succ <span class=keyword1>else</span> id<span class=main>)</span> <span class=main>(</span>rbl_add <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=bound>res</span> <span class=bound>car</span><span class=main>.</span> xor3 <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span> <span class=main>#</span> <span class=bound>res</span> <span class=main>(</span>carry <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>[]</span><span class=main>)</span><span class=main>)</span> <span class=bound>car</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> list_induct2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> rbl_add_carry_Cons<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_plus_carry<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span>
    rev <span class=main>(</span>foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=bound>res</span> <span class=bound>car</span><span class=main>.</span> xor3 <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span> <span class=main>#</span> <span class=bound>res</span> <span class=main>(</span>carry <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>rev <span class=main>(</span>zip <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>[]</span><span class=main>)</span> False<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rbl_add_suc_carry_fold<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> ys<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_add_rbl<span class=main><span class=main>[</span></span><span class=operator>OF</span> refl refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted>False</span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_rev<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>rbl_plus</span> <span class=free><span class=bound><span class=entity>cin</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span>
  foldr <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span> <span class=bound>res</span> <span class=bound>car</span><span class=main>.</span> xor3 <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span> <span class=main>#</span> <span class=bound>res</span> <span class=main>(</span>carry <span class=bound>x</span> <span class=bound>y</span> <span class=bound>car</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>zip <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>[]</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>cin</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_plus_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"rbl_plus <span class=free>cin</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> xor3 <span class=free>x</span> <span class=free>y</span> <span class=free>cin</span> <span class=main>#</span> rbl_plus <span class=main>(</span>carry <span class=free>x</span> <span class=free>y</span> <span class=free>cin</span><span class=main>)</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
  <span class=quoted><span class=quoted>"rbl_plus <span class=free>cin</span> <span class=main>[]</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"rbl_plus <span class=free>cin</span> <span class=free>xs</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_plus_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_plus<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_plus False <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_plus_def to_bl_plus_carry zip_rev<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>rbl_succ2</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>then</span> rbl_succ <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_succ2_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"rbl_succ2 <span class=free>b</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"rbl_succ2 <span class=free>b</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>≠</span> <span class=free>x</span><span class=main>)</span> <span class=main>#</span> rbl_succ2 <span class=main>(</span><span class=free>x</span> <span class=main>∧</span> <span class=free>b</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_succ2_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> twos_complement<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=free>x</span> <span class=main>=</span> word_succ <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> arg_cong<span class=main>[</span><span class=operator>OF</span> word_add_not<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>x</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>-</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_succ_p1 word_sp_01<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> word_succ_p1<span class=main><span class=main>]</span></span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> word_add_not<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_neg<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_succ2 True <span class=main>(</span>map Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> twos_complement word_succ_rbl<span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span> bl_word_not rev_map rbl_succ2_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_cat<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span>word_cat <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span> <span class=main>@</span> rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_cat_bl word_rev_tf<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_slice<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span>slice <span class=free>n</span> <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>drop <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> slice_take word_rev_tf rev_take<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_ucast takefill_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_drop<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill False <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>replicate <span class=free>n</span> False <span class=main>@</span> rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_shiftl takefill_alt word_size rev_drop<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill False <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>drop <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_slice rbl_word_slice word_size<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>drop_nonempty</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>then</span> drop <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>else</span> <span class=main>[</span>last <span class=main>(</span><span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_nonempty_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"drop_nonempty <span class=free>v</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> drop_nonempty <span class=free>x</span> <span class=free>n</span> <span class=free>xs</span>"</span></span>
  <span class=quoted><span class=quoted>"drop_nonempty <span class=free>v</span> <span class=main>0</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"drop_nonempty <span class=free>v</span> <span class=free>n</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[</span><span class=free>v</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_nonempty_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>takefill_last</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> takefill <span class=main>(</span>last <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> takefill_last_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"takefill_last <span class=free>z</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> takefill_last <span class=free>x</span> <span class=free>n</span> <span class=free>xs</span>"</span></span>
  <span class=quoted><span class=quoted>"takefill_last <span class=free>z</span> <span class=main>0</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"takefill_last <span class=free>z</span> <span class=free>n</span> <span class=main>[]</span> <span class=main>=</span> replicate <span class=free>n</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_last_def<span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rbl_sshiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill_last False <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>drop_nonempty False <span class=free>n</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_sshiftr takefill_last_def word_size
      takefill_alt rev_take last_rev
      drop_nonempty_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> of_bl <span class=main>(</span>replicate <span class=main>(</span>size <span class=free>w</span><span class=main>)</span> <span class=main>(</span>msb <span class=free>w</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size takefill_last_def takefill_alt
      last_rev word_msb_alt word_rev_tf
      drop_nonempty_def take_Cons'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_sshiftr word_size test_bit_of_bl
      msb_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_word_of_int<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> bin_nth <span class=free>x</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_bl word_size to_bl_of_bin<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> conj_cong<span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> bin_nth_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nth_scast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>scast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span>
    <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>∧</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>!!</span> <span class=free>n</span>
     <span class=keyword1>else</span> <span class=free>x</span> <span class=main>!!</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_signed_take_bit_iff min_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_scast<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span>scast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> takefill_last False <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size takefill_last_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_scast takefill_last_def
      nth_takefill word_size rev_nth to_bl_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> less_Suc_eq_le linorder_not_less
      last_rev word_msb_alt<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
      msb_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>rbl_mul</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool list <span class=main>⇒</span> bool list <span class=main>⇒</span> bool list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>rbl_mul</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span> foldr <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>sm</span><span class=main>.</span> rbl_plus False <span class=main>(</span>map <span class=main>(</span><span class=main>(∧)</span> <span class=bound>x</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=main>(</span>False <span class=main>#</span> <span class=bound>sm</span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>[]</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_mul_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"rbl_mul <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span> rbl_plus False <span class=main>(</span>map <span class=main>(</span><span class=main>(∧)</span> <span class=free>x</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span> <span class=main>(</span>False <span class=main>#</span> rbl_mul <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rbl_mul <span class=main>[]</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_mul_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takefill_le2<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=main>(</span>takefill <span class=free>x</span> <span class=free>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> takefill <span class=free>x</span> <span class=free>m</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt replicate_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> take_rbl_plus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>n</span> <span class=bound>b</span><span class=main>.</span> take <span class=bound>n</span> <span class=main>(</span>rbl_plus <span class=bound>b</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> rbl_plus <span class=bound>b</span> <span class=main>(</span>take <span class=bound>n</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>take <span class=bound>n</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_plus_def take_zip<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> list<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"zip <span class=free>xs</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> list.induct<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> split_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rbl_mul_induct<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> size <span class=free>y</span> <span class=main>⟹</span>
    rbl_mul <span class=free>xs</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> take <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=main>(</span>of_bl <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_mul_simps<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Cons <span class=skolem>z</span> <span class=skolem>zs</span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> rbl_word_plus'<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> rev <span class=main>(</span>rbl_plus False <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=skolem>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=skolem>y</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> word"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_word_plus<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> mult_bit<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span>of_bl <span class=main>[</span><span class=skolem>z</span><span class=main>]</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span><span class=main>(∧)</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> map_cong<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_replicate_const <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> map_cong<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"of_bl <span class=skolem>xs</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span>of_bl <span class=skolem>xs</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>xs</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> zip_take_triv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span> <span class=bound>ys</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>=</span> length <span class=bound>ys</span> <span class=main>⟹</span> zip <span class=main>(</span>take <span class=bound>n</span> <span class=bound>xs</span><span class=main>)</span> <span class=bound>ys</span> <span class=main>=</span> zip <span class=bound>xs</span> <span class=bound>ys</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span> <span class=operator>simp_all</span>

  <span class=keyword1><span class=command>from</span></span> Cons <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> of_bl_append add.commute<span class=main><span class=main>]</span></span>
        rbl_mul_simps rbl_word_plus' distrib_right mult_bit shiftl rbl_shiftl<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takefill_alt word_size rev_map take_rbl_plus min_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rbl_plus_def zip_take_triv<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> rbl_word_mul<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> rbl_mul <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_rbl_mul_induct<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Breaking up inequalities into bitlist properties.›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rev_bl_order</span> <span class=free><span class=bound><span class=entity>F</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span>
     <span class=main>(</span>length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> length <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>∧</span>
       <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>F</span></span></span><span class=main>)</span>
          <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound><span class=bound>n</span></span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>.</span> drop <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> drop <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ys</span></span></span>
                   <span class=main>∧</span> <span class=main>¬</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>!</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> rev_bl_order_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev_bl_order <span class=free>F</span> <span class=main>[]</span> <span class=main>[]</span> <span class=main>=</span> <span class=free>F</span>"</span></span>
  <span class=quoted><span class=quoted>"rev_bl_order <span class=free>F</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> rev_bl_order <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>x</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=main>∨</span> <span class=main>¬</span> <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=free>F</span><span class=main>)</span><span class=main>)</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_bl_order_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conj_cong<span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_Cons'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_Cons'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rev_bl_order_rev_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
   rev_bl_order <span class=free>F</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=main>[</span><span class=free>y</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>x</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=main>∨</span> <span class=main>¬</span> <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> rev_bl_order <span class=free>F</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>F</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_induct2<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> rev_bl_order_simps<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rev_bl_order_bl_to_bin<span class=main>:</span>
  <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
    rev_bl_order True <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span>bl_to_bin <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>≤</span> bl_to_bin <span class=main>(</span>rev <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span>
    rev_bl_order False <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span>bl_to_bin <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>&lt;</span> bl_to_bin <span class=main>(</span>rev <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_induct2<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_bl_order_simps bl_to_bin_app_cat concat_bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bl_to_bin_def add1_zle_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_le_rbl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟷</span> rev_bl_order True <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rev_bl_order_bl_to_bin word_le_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_less_rbl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟷</span> rev_bl_order False <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_alt rev_bl_order_bl_to_bin<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free>map_last</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>[]</span> <span class=keyword1>then</span> <span class=main>[]</span> <span class=keyword1>else</span> butlast <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>@</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span>last <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> map_last_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"map_last <span class=free>f</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"map_last <span class=free>f</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>f</span> <span class=free>x</span><span class=main>]</span>"</span></span>
  <span class=quoted><span class=quoted>"map_last <span class=free>f</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>y</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> map_last <span class=free>f</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_last_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_sle_rbl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>&lt;=s</span> <span class=free>y</span> <span class=main>⟷</span> rev_bl_order True <span class=main>(</span>map_last Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map_last Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_msb_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span><span class=main>]</span> word_msb_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sle_msb_le word_le_rbl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>=</span> length <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"to_bl <span class=free>y</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_last_def rev_bl_order_rev_simp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sless_rbl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>&lt;s</span> <span class=free>y</span> <span class=main>⟷</span> rev_bl_order False <span class=main>(</span>map_last Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>map_last Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_msb_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span><span class=main>]</span> word_msb_alt<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sless_msb_less word_less_rbl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>=</span> length <span class=main>(</span>to_bl <span class=free>y</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"to_bl <span class=free>y</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> map_last_def rev_bl_order_rev_simp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Lemmas for unpacking <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹rev <span class=main><span class=main>(</span></span>to_bl <span class=free><span class=free>n</span></span><span class=main><span class=main>)</span></span>›</span></span></span></span> for numerals n and also
  for irreducible values and expressions.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> rev_bin_to_bl_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>0</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>num.Bit0 <span class=free>nm</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span>numeral <span class=free>nm</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>num.Bit1 <span class=free>nm</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span>numeral <span class=free>nm</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span>numeral <span class=main>(</span>num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True <span class=main>#</span> replicate <span class=free>n</span> False"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>nm</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> False <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>nm</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit1 <span class=free>nm</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    True <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>nm</span> <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True <span class=main>#</span> replicate <span class=free>n</span> True"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit0 <span class=free>nm</span> <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    True <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>nm</span> <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.Bit1 <span class=free>nm</span> <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    False <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span><span class=free>nm</span> <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"rev <span class=main>(</span>bin_to_bl <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> numeral <span class=main>(</span>num.One <span class=main>+</span> num.One<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    False <span class=main>#</span> rev <span class=main>(</span>bin_to_bl <span class=free>n</span> <span class=main>(</span><span class=main>-</span> numeral num.One<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_to_bl_aux_append bin_to_bl_zero_aux bin_to_bl_minus1_aux replicate_append_same<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bl_upt<span class=main>:</span> <span class=quoted><span class=quoted>"to_bl <span class=free>x</span> <span class=main>=</span> rev <span class=main>(</span>map <span class=main>(</span><span class=main>(!!)</span> <span class=free>x</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> size <span class=free>x</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> to_bl_nth word_size rev_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> rev_to_bl_upt<span class=main>:</span> <span class=quoted><span class=quoted>"rev <span class=main>(</span>to_bl <span class=free>x</span><span class=main>)</span> <span class=main>=</span> map <span class=main>(</span><span class=main>(!!)</span> <span class=free>x</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> size <span class=free>x</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bl_upt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upt_eq_list_intros<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>≤</span> <span class=free>i</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>i</span> <span class=main>..&lt;</span> <span class=free>j</span><span class=main>]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>..&lt;</span> <span class=free>j</span><span class=main>]</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>i</span> <span class=main>..&lt;</span> <span class=free>j</span><span class=main>]</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upt_eq_Cons_conv<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Tactic definition›</span></span>

<span class=keyword1><span class=command>lemma</span></span> if_bool_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"If <span class=free>p</span> True <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∨</span> <span class=free>y</span><span class=main>)</span> <span class=main>∧</span> If <span class=free>p</span> False <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>p</span> <span class=main>∧</span> <span class=free>y</span><span class=main>)</span> <span class=main>∧</span>
    If <span class=free>p</span> <span class=free>y</span> True <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>⟶</span> <span class=free>y</span><span class=main>)</span> <span class=main>∧</span> If <span class=free>p</span> <span class=free>y</span> False <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∧</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>ML</span></span> <span class=quoted>‹
<span class=keyword1><span class=keyword>structure</span></span> <span class=entity>Word_Bitwise_Tac</span> <span class=main>=</span>
<span class=keyword2><span class=keyword>struct</span></span>

<span class=keyword1><span class=keyword>val</span></span> <span class=entity>word_ss</span> <span class=main>=</span> simpset_of <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory_context</span><span class=hidden>&gt;</span></span>‹<a href=../../HOL/HOL-Library/Word.html>Word</a>›</span></span><span class=main>;</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>mk_nat_clist</span> <span class=entity>ns</span> <span class=main>=</span>
  fold_rev <span class=main>(</span>Thm.mk_binop <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹Cons <span class=main>::</span> nat <span class=main>⇒</span> <span class=main>_</span>›</span></span></span><span class=main>)</span>
    <span class=entity>ns</span> <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=main>[]</span> <span class=main>::</span> nat list›</span></span></span><span class=main>;</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>upt_conv</span> <span class=entity>ctxt</span> <span class=entity>ct</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>case</span></span> Thm.term_of <span class=entity>ct</span> <span class=keyword2><span class=keyword>of</span></span>
    <span class=main>(</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>const</span><span class=hidden>&gt;</span></span>‹upt›</span> $ <span class=entity>n</span> $ <span class=entity>m</span><span class=main>)</span> <span class=main>=&gt;</span>
      <span class=keyword2><span class=keyword>let</span></span>
        <span class=keyword1><span class=keyword>val</span></span> <span class=main>(</span><span class=entity>i</span><span class=main>,</span> <span class=entity>j</span><span class=main>)</span> <span class=main>=</span> apply2 <span class=main>(</span>snd o <span class=entity>HOLogic.dest_number</span><span class=main>)</span> <span class=main>(</span><span class=entity>n</span><span class=main>,</span> <span class=entity>m</span><span class=main>)</span><span class=main>;</span>
        <span class=keyword1><span class=keyword>val</span></span> <span class=entity>ns</span> <span class=main>=</span> map <span class=main>(</span><span class=entity>Numeral.mk_cnumber</span> <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>ctyp</span><span class=hidden>&gt;</span></span><span class=quoted>‹nat›</span></span></span><span class=main>)</span> <span class=main>(</span><span class=entity>i</span> upto <span class=main>(</span><span class=entity>j</span> - <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span>
          |&gt; <span class=entity>mk_nat_clist</span><span class=main>;</span>
        <span class=keyword1><span class=keyword>val</span></span> <span class=entity>prop</span> <span class=main>=</span>
          Thm.mk_binop <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=main>(=)</span> <span class=main>::</span> nat list <span class=main>⇒</span> <span class=main>_</span>›</span></span></span> <span class=entity>ct</span> <span class=entity>ns</span>
          |&gt; Thm.apply <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹Trueprop›</span></span></span><span class=main>;</span>
      <span class=keyword2><span class=keyword>in</span></span>
        try <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=main>(</span><span class=main>)</span> <span class=main>=&gt;</span>
          Goal.prove_internal <span class=entity>ctxt</span> <span class=main>[</span><span class=main>]</span> <span class=entity>prop</span>
            <span class=main>(</span>K <span class=main>(</span>REPEAT_DETERM <span class=main>(</span>resolve_tac <span class=entity>ctxt</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> upt_eq_list_intros<span class=antiquote>}</span></span></span> <span class=inner_numeral>1</span>
                ORELSE <span class=entity>simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>word_ss</span> <span class=entity>ctxt</span><span class=main>)</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> |&gt; <span class=entity>mk_meta_eq</span><span class=main>)</span> <span class=main>(</span><span class=main>)</span>
      <span class=keyword2><span class=keyword>end</span></span>
  <span class=main>|</span> <span class=main>_</span> <span class=main>=&gt;</span> NONE<span class=main>;</span>

<span class=keyword1><span class=keyword>val</span></span> <span class=entity>expand_upt_simproc</span> <span class=main>=</span>
  <span class=entity>Simplifier.make_simproc</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> <span class=inner_quoted>"expand_upt"</span>
   <span class=main>{</span>lhss <span class=main>=</span> <span class=main>[</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹upt <span class=free>x</span> <span class=free>y</span>›</span></span><span class=main>]</span><span class=main>,</span> proc <span class=main>=</span> K <span class=entity>upt_conv</span><span class=main>}</span><span class=main>;</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>word_len_simproc_fn</span> <span class=entity>ctxt</span> <span class=entity>ct</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword2><span class=keyword>case</span></span> Thm.term_of <span class=entity>ct</span> <span class=keyword2><span class=keyword>of</span></span>
    Const <span class=main>(</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>const_name</span><span class=hidden>&gt;</span></span>‹len_of›</span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>t</span> <span class=main>=&gt;</span>
     <span class=main>(</span><span class=keyword2><span class=keyword>let</span></span>
        <span class=keyword1><span class=keyword>val</span></span> <span class=entity>T</span> <span class=main>=</span> fastype_of <span class=entity>t</span> |&gt; dest_Type |&gt; snd |&gt; the_single
        <span class=keyword1><span class=keyword>val</span></span> <span class=entity>n</span> <span class=main>=</span> <span class=entity>Numeral.mk_cnumber</span> <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>ctyp</span><span class=hidden>&gt;</span></span><span class=quoted>‹nat›</span></span></span> <span class=main>(</span><span class=entity>Word_Lib.dest_binT</span> <span class=entity>T</span><span class=main>)</span><span class=main>;</span>
        <span class=keyword1><span class=keyword>val</span></span> <span class=entity>prop</span> <span class=main>=</span>
          Thm.mk_binop <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=main>(=)</span> <span class=main>::</span> nat <span class=main>⇒</span> <span class=main>_</span>›</span></span></span> <span class=entity>ct</span> <span class=entity>n</span>
          |&gt; Thm.apply <span class=antiquoted><span class=entity><span class=operator><span class=hidden>\&lt;^</span><span class=control>cterm</span><span class=hidden>&gt;</span></span><span class=quoted>‹Trueprop›</span></span></span><span class=main>;</span>
      <span class=keyword2><span class=keyword>in</span></span>
        Goal.prove_internal <span class=entity>ctxt</span> <span class=main>[</span><span class=main>]</span> <span class=entity>prop</span> <span class=main>(</span>K <span class=main>(</span><span class=entity>simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>word_ss</span> <span class=entity>ctxt</span><span class=main>)</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span>
        |&gt; <span class=entity>mk_meta_eq</span> |&gt; SOME
      <span class=keyword2><span class=keyword>end</span></span> <span class=keyword3><span class=keyword>handle</span></span> TERM <span class=main>_</span> <span class=main>=&gt;</span> NONE <span class=main>|</span> TYPE <span class=main>_</span> <span class=main>=&gt;</span> NONE<span class=main>)</span>
  <span class=main>|</span> <span class=main>_</span> <span class=main>=&gt;</span> NONE<span class=main>)</span><span class=main>;</span>

<span class=keyword1><span class=keyword>val</span></span> <span class=entity>word_len_simproc</span> <span class=main>=</span>
  <span class=entity>Simplifier.make_simproc</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> <span class=inner_quoted>"word_len"</span>
   <span class=main>{</span>lhss <span class=main>=</span> <span class=main>[</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹len_of <span class=free>x</span>›</span></span><span class=main>]</span><span class=main>,</span> proc <span class=main>=</span> K <span class=entity>word_len_simproc_fn</span><span class=main>}</span><span class=main>;</span>

<span class=comment1>(* convert 5 or nat 5 to Suc 4 when n_sucs = 1, Suc (Suc 4) when n_sucs = 2,
   or just 5 (discarding nat) when n_sucs = 0 *)</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>nat_get_Suc_simproc_fn</span> <span class=entity>n_sucs</span> <span class=entity>ctxt</span> <span class=entity>ct</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=main>(</span><span class=entity>f</span><span class=main>,</span> <span class=entity>arg</span><span class=main>)</span> <span class=main>=</span> dest_comb <span class=main>(</span>Thm.term_of <span class=entity>ct</span><span class=main>)</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>n</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword2><span class=keyword>case</span></span> <span class=entity>arg</span> <span class=keyword2><span class=keyword>of</span></span> <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹nat›</span></span> $ <span class=entity>n</span> <span class=main>=&gt;</span> <span class=entity>n</span> <span class=main>|</span> <span class=entity>n</span> <span class=main>=&gt;</span> <span class=entity>n</span><span class=main>)</span>
      |&gt; <span class=entity>HOLogic.dest_number</span> |&gt; snd<span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=main>(</span><span class=entity>i</span><span class=main>,</span> <span class=entity>j</span><span class=main>)</span> <span class=main>=</span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>n</span> &gt; <span class=entity>n_sucs</span> <span class=keyword2><span class=keyword>then</span></span> <span class=main>(</span><span class=entity>n_sucs</span><span class=main>,</span> <span class=entity>n</span> - <span class=entity>n_sucs</span><span class=main>)</span> <span class=keyword2><span class=keyword>else</span></span> <span class=main>(</span><span class=entity>n</span><span class=main>,</span> <span class=inner_numeral>0</span><span class=main>)</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>arg'</span> <span class=main>=</span> funpow <span class=entity>i</span> <span class=entity>HOLogic.mk_Suc</span> <span class=main>(</span><span class=entity>HOLogic.mk_number</span> <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span><span class=quoted>‹nat›</span></span> <span class=entity>j</span><span class=main>)</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=main>_</span> <span class=main>=</span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>arg</span> <span class=main>=</span> <span class=entity>arg'</span> <span class=keyword2><span class=keyword>then</span></span> <span class=keyword3><span class=keyword>raise</span></span> TERM <span class=main>(</span><span class=inner_quoted>""</span><span class=main>,</span> <span class=main>[</span><span class=main>]</span><span class=main>)</span> <span class=keyword2><span class=keyword>else</span></span> <span class=main>(</span><span class=main>)</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>propfn</span> <span class=entity>g</span> <span class=main>=</span>
      <span class=entity>HOLogic.mk_eq</span> <span class=main>(</span><span class=entity>g</span> <span class=entity>arg</span><span class=main>,</span> <span class=entity>g</span> <span class=entity>arg'</span><span class=main>)</span>
      |&gt; <span class=entity>HOLogic.mk_Trueprop</span> |&gt; Thm.cterm_of <span class=entity>ctxt</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>eq1</span> <span class=main>=</span>
      Goal.prove_internal <span class=entity>ctxt</span> <span class=main>[</span><span class=main>]</span> <span class=main>(</span><span class=entity>propfn</span> I<span class=main>)</span>
        <span class=main>(</span>K <span class=main>(</span><span class=entity>simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>word_ss</span> <span class=entity>ctxt</span><span class=main>)</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
  <span class=keyword2><span class=keyword>in</span></span>
    Goal.prove_internal <span class=entity>ctxt</span> <span class=main>[</span><span class=main>]</span> <span class=main>(</span><span class=entity>propfn</span> <span class=main>(</span>curry <span class=main>(</span><span class=keyword1><span class=keyword>op</span></span> $<span class=main>)</span> <span class=entity>f</span><span class=main>)</span><span class=main>)</span>
      <span class=main>(</span>K <span class=main>(</span><span class=entity>simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>HOL_ss</span> <span class=entity>ctxt</span> addsimps <span class=main>[</span><span class=entity>eq1</span><span class=main>]</span><span class=main>)</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span>
    |&gt; <span class=entity>mk_meta_eq</span> |&gt; SOME
  <span class=keyword2><span class=keyword>end</span></span> <span class=keyword3><span class=keyword>handle</span></span> TERM <span class=main>_</span> <span class=main>=&gt;</span> NONE<span class=main>;</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>nat_get_Suc_simproc</span> <span class=entity>n_sucs</span> <span class=entity>ts</span> <span class=main>=</span>
  <span class=entity>Simplifier.make_simproc</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> <span class=inner_quoted>"nat_get_Suc"</span>
   <span class=main>{</span>lhss <span class=main>=</span> map <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>t</span> <span class=main>=&gt;</span> <span class=entity>t</span> $ <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹<span class=free>n</span> <span class=main>::</span> nat›</span></span><span class=main>)</span> <span class=entity>ts</span><span class=main>,</span>
    proc <span class=main>=</span> K <span class=main>(</span><span class=entity>nat_get_Suc_simproc_fn</span> <span class=entity>n_sucs</span><span class=main>)</span><span class=main>}</span><span class=main>;</span>

<span class=keyword1><span class=keyword>val</span></span> <span class=entity>no_split_ss</span> <span class=main>=</span>
  simpset_of <span class=main>(</span>put_simpset <span class=entity>HOL_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span>
    |&gt; <span class=entity>Splitter.del_split</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> if_split<span class=antiquote>}</span></span></span><span class=main>)</span><span class=main>;</span>

<span class=keyword1><span class=keyword>val</span></span> <span class=entity>expand_word_eq_sss</span> <span class=main>=</span>
  <span class=main>(</span>simpset_of <span class=main>(</span>put_simpset <span class=entity>HOL_basic_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps
       <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> word_eq_rbl_eq word_le_rbl word_less_rbl word_sle_rbl word_sless_rbl<span class=antiquote>}</span></span></span><span class=main>)</span><span class=main>,</span>
  map simpset_of <span class=main>[</span>
   put_simpset <span class=entity>no_split_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps
    <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> rbl_word_plus rbl_word_and rbl_word_or rbl_word_not
                                rbl_word_neg bl_word_sub rbl_word_xor
                                rbl_word_cat rbl_word_slice rbl_word_scast
                                rbl_word_ucast rbl_shiftl rbl_shiftr rbl_sshiftr
                                rbl_word_if<span class=antiquote>}</span></span></span><span class=main>,</span>
   put_simpset <span class=entity>no_split_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps
    <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> to_bl_numeral to_bl_neg_numeral to_bl_0 rbl_word_1<span class=antiquote>}</span></span></span><span class=main>,</span>
   put_simpset <span class=entity>no_split_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps
    <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> rev_rev_ident rev_replicate rev_map to_bl_upt word_size<span class=antiquote>}</span></span></span>
          addsimprocs <span class=main>[</span><span class=entity>word_len_simproc</span><span class=main>]</span><span class=main>,</span>
   put_simpset <span class=entity>no_split_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps
    <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> list.simps split_conv replicate.simps list.map
                                zip_Cons_Cons zip_Nil drop_Suc_Cons drop_0 drop_Nil
                                foldr.simps list.map zip.simps<span class=main>(</span>1<span class=main>)</span> zip_Nil zip_Cons_Cons takefill_Suc_Cons
                                takefill_Suc_Nil takefill.Z rbl_succ2_simps
                                rbl_plus_simps rev_bin_to_bl_simps append.simps
                                takefill_last_simps drop_nonempty_simps
                                rev_bl_order_simps<span class=antiquote>}</span></span></span>
          addsimprocs <span class=main>[</span><span class=entity>expand_upt_simproc</span><span class=main>,</span>
                       <span class=entity>nat_get_Suc_simproc</span> <span class=inner_numeral>4</span>
                         <span class=main>[</span><span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹replicate›</span></span><span class=main>,</span> <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹takefill <span class=free>x</span>›</span></span><span class=main>,</span>
                          <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹drop›</span></span><span class=main>,</span> <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹bin_to_bl›</span></span><span class=main>,</span>
                          <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹takefill_last <span class=free>x</span>›</span></span><span class=main>,</span>
                          <span class=antiquoted><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span><span class=quoted>‹drop_nonempty <span class=free>x</span>›</span></span><span class=main>]</span><span class=main>]</span><span class=main>,</span>
    put_simpset <span class=entity>no_split_ss</span> <span class=antiquoted><span class=operator><span class=entity><span class=hidden>\&lt;^</span><span class=control>context</span><span class=hidden>&gt;</span></span></span></span> addsimps <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> xor3_simps carry_simps if_bool_simps<span class=antiquote>}</span></span></span>
  <span class=main>]</span><span class=main>)</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>tac</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=main>(</span><span class=entity>ss</span><span class=main>,</span> <span class=entity>sss</span><span class=main>)</span> <span class=main>=</span> <span class=entity>expand_word_eq_sss</span><span class=main>;</span>
  <span class=keyword2><span class=keyword>in</span></span>
    foldr1 <span class=main>(</span><span class=keyword1><span class=keyword>op</span></span> THEN_ALL_NEW<span class=main>)</span>
      <span class=main>(</span><span class=main>(</span>CHANGED o <span class=entity>safe_full_simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span> ::
        map <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ss</span> <span class=main>=&gt;</span> <span class=entity>safe_full_simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span> <span class=entity>sss</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span><span class=main>;</span>

<span class=keyword2><span class=keyword>end</span></span>
›</span>

<span class=keyword1><span class=command>method_setup</span></span> word_bitwise <span class=main>=</span>
  <span class=quoted>‹Scan.succeed <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ctxt</span> <span class=main>=&gt;</span> <span class=entity>Method.SIMPLE_METHOD</span> <span class=main>(</span><span class=entity>Word_Bitwise_Tac.tac</span> <span class=entity>ctxt</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span>›</span>
  <span class=quoted>"decomposer for word equalities and inequalities into bit propositions"</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Bitwise_Signed><div class=head><h1>Theory Bitwise_Signed</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Bitwise tactic for Signed Words"</span></span>

<span class=keyword1><span class=command>theory</span></span> Bitwise_Signed
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
  <a href=Bitwise.html>Bitwise</a>
  <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>ML</span></span> <span class=quoted>‹<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>bw_tac_signed</span> <span class=entity>ctxt</span> <span class=main>=</span> <span class=keyword2><span class=keyword>let</span></span>
  <span class=keyword1><span class=keyword>val</span></span> <span class=main>(</span><span class=entity>ss</span><span class=main>,</span> <span class=entity>sss</span><span class=main>)</span> <span class=main>=</span> <span class=entity>Word_Bitwise_Tac.expand_word_eq_sss</span>
  <span class=keyword1><span class=keyword>val</span></span> <span class=entity>sss</span> <span class=main>=</span> nth_map <span class=inner_numeral>2</span> <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ss</span> <span class=main>=&gt;</span> put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span> addsimps <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> len_signed<span class=antiquote>}</span></span></span> |&gt; simpset_of<span class=main>)</span> <span class=entity>sss</span>
<span class=keyword2><span class=keyword>in</span></span>
    foldr1 <span class=main>(</span><span class=keyword1><span class=keyword>op</span></span> THEN_ALL_NEW<span class=main>)</span>
      <span class=main>(</span><span class=main>(</span>CHANGED o <span class=entity>safe_full_simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span> ::
        map <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ss</span> <span class=main>=&gt;</span> <span class=entity>safe_full_simp_tac</span> <span class=main>(</span>put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span> <span class=entity>sss</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span><span class=main>;</span>
›</span>

<span class=keyword1><span class=command>method_setup</span></span> word_bitwise_signed <span class=main>=</span>
  <span class=quoted>‹Scan.succeed <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ctxt</span> <span class=main>=&gt;</span> <span class=entity>Method.SIMPLE_METHOD</span> <span class=main>(</span><span class=entity>bw_tac_signed</span> <span class=entity>ctxt</span> <span class=inner_numeral>1</span><span class=main>)</span><span class=main>)</span>›</span>
  <span class=quoted>"decomposer for word equalities and inequalities into bit propositions"</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Enumeration><div class=head><h1>Theory Enumeration</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Enumeration extensions and alternative definition"</span></span>

<span class=keyword1><span class=command>theory</span></span> Enumeration
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=quoted><span class=quoted>"<span class=free>enum</span> <span class=main>≡</span> enum_class.enum"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=quoted><span class=quoted>"<span class=free>enum_all</span> <span class=main>≡</span> enum_class.enum_all"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=quoted><span class=quoted>"<span class=free>enum_ex</span> <span class=main>≡</span> enum_class.enum_ex"</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=main>(</span>nonexhaustive<span class=main>)</span>
  <span class=entity>the_index</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>the_index</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> Suc <span class=main>(</span><span class=free>the_index</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> the_index_bounded<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> the_index <span class=free>xs</span> <span class=free>x</span> <span class=main>&lt;</span> length <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_the_index<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> the_index <span class=free>xs</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> distinct_the_index_is_index<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> distinct <span class=free>xs</span> <span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> the_index <span class=free>xs</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> nth_eq_iff_index_eq nth_mem nth_the_index the_index_bounded<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> the_index_last_distinct<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=free>xs</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> the_index <span class=free>xs</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> last <span class=free>xs</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>!</span> the_index <span class=free>xs</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> last <span class=free>xs</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nth_eq_iff_index_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the_index_bounded<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_the_index<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>context</span></span> enum <span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* These two are added for historical reasons. *)</span>
<span class=keyword1><span class=command>lemmas</span></span> enum_surj<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> enum_UNIV
<span class=keyword1><span class=command>declare</span></span> enum_distinct<span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> enum_nonempty<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>enum</span> <span class=main>::</span> <span class=tfree>'a</span> list<span class=main>)</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> enum_surj <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>maxBound</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>maxBound</span> <span class=main>≡</span> last <span class=free>enum</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>minBound</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>minBound</span> <span class=main>≡</span> hd <span class=free>enum</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>toEnum</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>toEnum</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>enum</span> <span class=main>::</span> <span class=tfree>'a</span> list<span class=main>)</span> <span class=keyword1>then</span> <span class=free>enum</span> <span class=main>!</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=keyword1>else</span> the None"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>fromEnum</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> nat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>fromEnum</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> the_index <span class=free>enum</span> <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>


<span class=keyword1><span class=command>lemma</span></span> maxBound_is_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"fromEnum maxBound <span class=main>=</span> length <span class=main>(</span><span class=free>enum</span> <span class=main>::</span> <span class=tfree>'a</span> list<span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> maxBound_def fromEnum_def the_index_last_distinct<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> maxBound_less_length<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>≤</span> fromEnum maxBound<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>enum</span> <span class=main>::</span> <span class=tfree>'a</span> list<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> maxBound_is_length <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"length <span class=free>enum</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> maxBound_is_bound <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"fromEnum <span class=free>x</span> <span class=main>≤</span> fromEnum maxBound"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> maxBound_less_length
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> fromEnum_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> the_index_bounded<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_from_enum <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"toEnum <span class=main>(</span>fromEnum <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>enum</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> toEnum_def fromEnum_def nth_the_index the_index_bounded<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> from_to_enum <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> fromEnum maxBound <span class=main>⟹</span> fromEnum <span class=main>(</span>toEnum <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> maxBound_less_length <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> toEnum_def fromEnum_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_enum<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'a</span></span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=free>enum</span> <span class=main>!</span> fromEnum <span class=free>x</span> <span class=main>=</span> <span class=free>f</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fromEnum <span class=free>x</span> <span class=main>≤</span> fromEnum <span class=main>(</span>maxBound <span class=main>::</span> <span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> maxBound_is_bound<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fromEnum <span class=free>x</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>enum</span><span class=main>::</span><span class=tfree>'a</span> list<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> maxBound_less_length<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=free>enum</span> <span class=main>!</span> fromEnum <span class=free>x</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>enum</span> <span class=main>!</span> fromEnum <span class=free>x</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=free>enum</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>enum</span> <span class=main>!</span> fromEnum <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnum_def nth_the_index<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>assocs</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> list"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>assocs</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=free>enum</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=comment1>(* For historical naming reasons. *)</span>
<span class=keyword1><span class=command>lemmas</span></span> enum_bool <span class=main>=</span> enum_bool_def

<span class=keyword1><span class=command>lemma</span></span> fromEnumTrue <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"fromEnum True <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnum_def enum_bool<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> fromEnumFalse <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"fromEnum False <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnum_def enum_bool<span class=main>)</span>


<span class=keyword1><span class=command>class</span></span> enum_alt <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>enum_alt</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span> option"</span></span>

<span class=keyword1><span class=command>class</span></span> enumeration_alt <span class=main>=</span> enum_alt <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span> enum_alt_one_bound<span class=main>:</span>
    <span class=quoted><span class=quoted>"enum_alt <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>None <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span> <span class=main>⟹</span> enum_alt <span class=main>(</span>Suc <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>None <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> enum_alt_surj<span class=main>:</span>
    <span class=quoted><span class=quoted>"range enum_alt <span class=main>∪</span> <span class=main>{</span>None<span class=main>}</span> <span class=main>=</span> UNIV"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> enum_alt_inj<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>enum_alt <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span> <span class=main>=</span> enum_alt <span class=free>y</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span>enum_alt <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>None <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> enum_alt_inj_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"enum_alt <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>enum_alt <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"enum_alt <span class=free>x</span> <span class=main>≠</span> <span class=main>(</span>None <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span>enum_alt <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>None <span class=main>::</span> <span class=tfree>'a</span> option<span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> enum_alt_inj<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> enum_alt_surj_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> enum_alt <span class=bound>x</span> <span class=main>=</span> Some <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Some <span class=free>y</span> <span class=main>∈</span> range enum_alt <span class=main>∪</span> <span class=main>{</span>None<span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> enum_alt_surj<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Some <span class=free>y</span> <span class=main>∈</span> range enum_alt"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>alt_from_ord</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>alt_from_ord</span> <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>≡</span> <span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=keyword1>if</span> <span class=main>(</span><span class=bound>n</span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>L</span></span></span><span class=main>)</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=keyword1>else</span> None"</span></span>

<span class=keyword1><span class=command>lemma</span></span> handy_if_lemma<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> Some <span class=free>A</span> <span class=keyword1>else</span> None<span class=main>)</span> <span class=main>=</span> Some <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>P</span> <span class=main>∧</span> <span class=main>(</span><span class=free>A</span> <span class=main>=</span> <span class=free>B</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>class</span></span> enumeration_both <span class=main>=</span> enum_alt <span class=main>+</span> enum <span class=main>+</span>
  <span class=keyword2><span class=keyword>assumes</span></span> enum_alt_rel<span class=main>:</span> <span class=quoted><span class=quoted>"enum_alt <span class=main>=</span> alt_from_ord <span class=free>enum</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span> enumeration_both <span class=main>&lt;</span> enumeration_alt
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro_classes</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_alt_rel alt_from_ord_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rev_image_eqI<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the_index_bounded<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nth_the_index<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> handy_if_lemma<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nth_eq_iff_index_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>instantiation</span></span> bool <span class=main>::</span> <span class=quoted>enumeration_both</span>
<span class=keyword2><span class=keyword>begin</span></span>
  <span class=keyword1><span class=command>definition</span></span> enum_alt_bool<span class=main>:</span> <span class=quoted><span class=quoted>"enum_alt <span class=main>≡</span> alt_from_ord <span class=main>[</span>False<span class=main>,</span> True<span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro_classes</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_bool_def enum_alt_bool<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>toEnumAlt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> enum_alt<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>toEnumAlt</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> the <span class=main>(</span>enum_alt <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>fromEnumAlt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> enum_alt<span class=main>)</span> <span class=main>⇒</span> nat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>fromEnumAlt</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> <span class=keyword1>THE</span> <span class=bound>n</span><span class=main>.</span> enum_alt <span class=bound>n</span> <span class=main>=</span> Some <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>upto_enum</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> enumeration_alt<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(1</span><span class=keyword1>[</span>_ <span class=keyword1>.e.</span> _<span class=keyword1>]</span><span class=keyword3>)</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>upto_enum</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>≡</span> map toEnumAlt <span class=main>[</span>fromEnumAlt <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>..&lt;</span> Suc <span class=main>(</span>fromEnumAlt <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>]</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> fromEnum_alt_red<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"fromEnumAlt <span class=main>=</span> <span class=main>(</span>fromEnum <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> enumeration_both<span class=main>)</span> <span class=main>⇒</span> nat<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnumAlt_def fromEnum_def enum_alt_rel alt_from_ord_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> theI2<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> nth_the_index<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the_index_bounded<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> toEnum_alt_red<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"toEnumAlt <span class=main>=</span> <span class=main>(</span>toEnum <span class=main>::</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>::</span> enumeration_both<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_alt_rel alt_from_ord_def toEnum_def toEnumAlt_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_red<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> enumeration_both<span class=main>)</span><span class=main>)</span> <span class=keyword1>.e.</span> <span class=free>m</span><span class=main>]</span> <span class=main>=</span> map toEnum <span class=main>[</span>fromEnum <span class=free>n</span> <span class=main>..&lt;</span> Suc <span class=main>(</span>fromEnum <span class=free>m</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>instantiation</span></span> nat <span class=main>::</span> <span class=quoted>enumeration_alt</span>
<span class=keyword2><span class=keyword>begin</span></span>
  <span class=keyword1><span class=command>definition</span></span> enum_alt_nat<span class=main>:</span> <span class=quoted><span class=quoted>"enum_alt <span class=main>≡</span> Some"</span></span>
  <span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro_classes</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_alt_nat UNIV_option_conv<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> toEnumAlt_nat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"toEnumAlt <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> toEnumAlt_def enum_alt_nat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> fromEnumAlt_nat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"fromEnumAlt <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnumAlt_def enum_alt_nat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_nat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>n</span> <span class=keyword1>.e.</span> <span class=free>m</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>n</span> <span class=main>..&lt;</span> Suc <span class=free>m</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_def<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>zipE1</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enum_alt <span class=main>⇒</span> <span class=tfree>'b</span> list <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>zipE1</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>≡</span> zip <span class=main>(</span>map toEnumAlt <span class=main>[</span>fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>..&lt;</span> fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>+</span> length <span class=free><span class=bound><span class=entity>L</span></span></span><span class=main>]</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>L</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>zipE2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enum_alt <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span> list <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>zipE2</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xn</span></span></span> <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>≡</span> zip <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> toEnumAlt <span class=main>(</span>fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>+</span> <span class=main>(</span>fromEnumAlt <span class=free><span class=bound><span class=entity>xn</span></span></span> <span class=main>-</span> fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=main>*</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>
                      <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> length <span class=free><span class=bound><span class=entity>L</span></span></span><span class=main>]</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>L</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>zipE3</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> enum_alt <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>zipE3</span> <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> zip <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>(</span>map toEnumAlt <span class=main>[</span>fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>..&lt;</span> fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>+</span> length <span class=free><span class=bound><span class=entity>L</span></span></span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>zipE4</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> enum_alt <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>zipE4</span> <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>xn</span></span></span> <span class=main>≡</span> zip <span class=free><span class=bound><span class=entity>L</span></span></span> <span class=main>(</span>map <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> toEnumAlt <span class=main>(</span>fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>+</span> <span class=main>(</span>fromEnumAlt <span class=free><span class=bound><span class=entity>xn</span></span></span> <span class=main>-</span> fromEnumAlt <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=main>*</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> length <span class=free><span class=bound><span class=entity>L</span></span></span><span class=main>]</span><span class=main>)</span>"</span></span>


<span class=keyword1><span class=command>lemma</span></span> to_from_enum_alt<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"toEnumAlt <span class=main>(</span>fromEnumAlt <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> enumeration_alt<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> rl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> Some <span class=bound>b</span> <span class=main>⟹</span> the <span class=bound>a</span> <span class=main>=</span> <span class=bound>b</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> fromEnumAlt_def toEnumAlt_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rl<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> theI'<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> enum_alt_inj enum_alt_surj_2 not_None_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_triv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> toEnum_eq_to_fromEnum_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>v</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enum"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> fromEnum <span class=main>(</span>maxBound <span class=main>::</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>toEnum <span class=free>n</span> <span class=main>=</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> fromEnum <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> le_imp_diff_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>j</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>j</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> fromEnum_upto_nth<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>start</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enumeration_both"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=main>[</span><span class=free>start</span> <span class=keyword1>.e.</span> <span class=free>end</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fromEnum <span class=main>(</span><span class=main>[</span><span class=free>start</span> <span class=keyword1>.e.</span> <span class=free>end</span><span class=main>]</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> fromEnum <span class=free>start</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> less_sub<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span> <span class=bound>k</span> <span class=bound>m'</span> <span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=bound>m</span> <span class=main>-</span> <span class=bound>k</span> <span class=main>;</span> <span class=bound>m</span> <span class=main>≤</span> <span class=bound>m'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=bound>m'</span> <span class=main>-</span> <span class=bound>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>note</span></span> upt_Suc<span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_red
                <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> less_sub<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> m'<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"Suc <span class=main>(</span>fromEnum maxBound<span class=main>)</span>"</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> maxBound_is_bound<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum_le_maxBound<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>start</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enumeration_both"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>[</span><span class=free>start</span> <span class=keyword1>.e.</span> <span class=free>end</span><span class=main>]</span> <span class=main>≤</span> Suc <span class=main>(</span>fromEnum <span class=main>(</span>maxBound <span class=main>::</span> <span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_red <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_imp_diff_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> maxBound_is_bound<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>end</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_length_upto_enum_maxBoundD<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>start</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> enumeration_both"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=main>[</span><span class=free>start</span> <span class=keyword1>.e.</span> <span class=free>end</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> fromEnum <span class=main>(</span>maxBound <span class=main>::</span> <span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_red less_Suc_eq_le
                le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ le_imp_diff_le<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> maxBound_is_bound<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>end</span>"</span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span>
           <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> fromEnum_eq_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>fromEnum <span class=free>e</span> <span class=main>=</span> fromEnum <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>e</span> <span class=main>=</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>∈</span> set enum"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>∈</span> set enum"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>from</span></span> nth_the_index<span class=main>[</span><span class=operator>OF</span> a<span class=main>]</span> nth_the_index<span class=main>[</span><span class=operator>OF</span> b<span class=main>]</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>unfolding</span></span> fromEnum_def <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> maxBound_is_bound'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> fromEnum <span class=main>(</span><span class=free>e</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>enum<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> fromEnum <span class=main>(</span>maxBound<span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>enum<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Enumeration_Word><div class=head><h1>Theory Enumeration_Word</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Thomas Sewell *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Enumeration Instances for Words"</span></span>

<span class=keyword1><span class=command>theory</span></span> Enumeration_Word
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=More_Word.html>More_Word</a>
    <a href=Enumeration.html>Enumeration</a>
    <a href=Even_More_List.html>Even_More_List</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> length_word_enum<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>enum <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word list<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> fromEnum_unat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"fromEnum <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"enum <span class=main>!</span> the_index enum <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> nth_the_index<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the_index enum <span class=free>x</span> <span class=main>&lt;</span> length <span class=main>(</span>enum<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word list<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> the_index_bounded<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"of_nat <span class=skolem>y</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span> <span class=keyword1><span class=command>using</span></span> of_nat_inverse <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fromEnum_def enum_word_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> toEnum_of_nat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>toEnum <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> of_nat <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> toEnum_def length_word_enum enum_word_def<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>enumeration_both</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  enum_alt_word_def<span class=main>:</span> <span class=quoted><span class=quoted>"enum_alt <span class=main>≡</span> alt_from_ord <span class=main>(</span>enum <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word list<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro_classes</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_alt_word_def<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>upto_enum_step</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word list"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>[</span>_ <span class=keyword1>,</span> _ <span class=keyword1>.e.</span> _<span class=keyword1>]</span>"</span><span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>upto_enum_step</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>≡</span>
      <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>then</span> <span class=main>[]</span> <span class=keyword1>else</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>+</span> <span class=bound>x</span> <span class=main>*</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=keyword1>.e.</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=comment1>(* in the wraparound case, bad things happen. *)</span>

<span class=keyword1><span class=command>lemma</span></span> maxBound_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>maxBound<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> maxBound_def enum_word_def last_map of_nat_diff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> minBound_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>minBound<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minBound_def enum_word_def upt_conv_Cons<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> maxBound_max_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>maxBound<span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> max_word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> maxBound_word<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> leq_maxBound <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> maxBound"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> maxBound_max_word<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_red'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>≤</span> <span class=free>X</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>.e.</span> <span class=free>X</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=main>=</span>  map of_nat <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> unat <span class=free>X</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> lt'<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>X</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Suc_unat_diff_1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> lt<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> map_cong <span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> toEnum_of_nat<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ lt'<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_red2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=main>0</span><span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>.e.</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=main>=</span>
  map of_nat <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span><span class=main>]</span>"</span></span> <span class=keyword1><span class=command>using</span></span> szv
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> szv<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> upto_enum_red'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_le_nat_alt<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_step_red<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>   usszv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>us</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>,</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span> <span class=keyword1>.e.</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=main>=</span>
  map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> of_nat <span class=bound>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>sz</span> <span class=main>-</span> <span class=free>us</span><span class=main>)</span><span class=main>]</span>"</span></span> <span class=keyword1><span class=command>using</span></span> szv
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_step_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> if_not_P<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> leD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_le_nat_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_minus_one<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> upt.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Suc_div_unat_helper <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=tfree><span class=quoted><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> szv usszv<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> toEnum_of_nat<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans<span class=main>)</span>
   <span class=keyword1><span class=command>using</span></span> szv
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span> <span class=main>=</span> map of_nat <span class=main>[</span>unat <span class=free>x</span> <span class=main>..&lt;</span> Suc <span class=main>(</span>unat <span class=free>y</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> toEnum_of_nat<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_upto_Cons_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=main>[</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upt_conv_Cons<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> list.map list.inject upto_enum_red to_from_enum simp_thms<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> distinct_enum_upto<span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=main>(</span><span class=bound>b</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>.</span> <span class=main>[</span><span class=main>0</span> <span class=keyword1>.e.</span> <span class=bound>b</span><span class=main>]</span> <span class=main>=</span> nths enum <span class=main>{..&lt;</span> Suc <span class=main>(</span>fromEnum <span class=bound>b</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_upt_eq_take<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> enum_word_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_map<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_upt<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_0 fromEnum_unat<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ order_eq_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Suc_leI <span class=main><span class=main>[</span></span><span class=operator>OF</span> unat_lt2p<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> toEnum_of_nat<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ unat_lt2p<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ssubst<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> distinct_nthsI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_set_conv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>b</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> set_map<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> iffD2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> word_le_nat_alt<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> le_unat_uoi nat_less_le toEnum_of_nat unsigned_less word_le_nat_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> le_unat_uoi less_or_eq_imp_le toEnum_of_nat unsigned_less word_le_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"fromEnum <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> image_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_less<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> xin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=main>[</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=keyword1>.e.</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     nv<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 0
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> xin <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>m</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> xin nv le_m1_iff_lt p2_gt_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_len_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> length <span class=main>[</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span> <span class=keyword1>.e.</span> <span class=free>c</span><span class=main>]</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_step_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum_step<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>⟹</span> length <span class=main>[</span><span class=free>x</span> <span class=main>,</span> <span class=free>y</span> <span class=keyword1>.e.</span> <span class=free>z</span><span class=main>]</span> <span class=main>=</span> <span class=main>(</span>unat <span class=main>(</span><span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_step_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_red<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_length_unfold_one<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> xv<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>(</span>unat <span class=free>x</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ax<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=free>f</span> <span class=free>a</span> <span class=main>#</span> map <span class=free>f</span> <span class=main>[</span><span class=free>a</span> <span class=main>+</span> <span class=main>1</span> <span class=keyword1>.e.</span> <span class=free>x</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> word_upto_Cons_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_set_conv2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span> <span class=main>..</span> <span class=free>b</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=free>b</span><span class=main>)</span> <span class=main>-</span> unat <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt upto_enum_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Suc_diff_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum_cases<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>then</span> Suc <span class=main>(</span>unat <span class=free>b</span><span class=main>)</span> <span class=main>-</span> unat <span class=free>a</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum_less_one<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=main>≠</span> <span class=main>0</span><span class=main>⟧</span>
  <span class=main>⟹</span> length <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_sub<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_upto_enum<span class=main>:</span>
  <span class=quoted><span class=quoted>"drop <span class=main>(</span>unat <span class=free>n</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=keyword1>.e.</span> <span class=free>m</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>n</span> <span class=keyword1>.e.</span> <span class=free>m</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> drop_map drop_upt plus_nat.add_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> distinct_enum_upto' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> drop_upto_enum <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> distinct_drop<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> distinct_enum_upto<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_interval<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>set <span class=free>xs</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>b</span><span class=main>}</span><span class=main>;</span> distinct <span class=free>xs</span><span class=main>⟧</span>
  <span class=main>⟹</span> length <span class=free>xs</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=free>b</span><span class=main>)</span> <span class=main>-</span> unat <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> distinct_card<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>=</span> set <span class=main>[</span><span class=free>a</span> <span class=keyword1>.e.</span> <span class=free>b</span><span class=main>]</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> distinct_card <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>[</span></span><span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>.e.</span></span> <span class=free><span class=free>b</span></span><span class=main><span class=main>]</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> length_upto_enum<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> distinct_enum_upto'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> enum_word_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>v</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>xs</span> <span class=bound>ys</span><span class=main>.</span> enum <span class=main>=</span> <span class=bound>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>v</span><span class=main>]</span> <span class=main>@</span> <span class=bound>ys</span>
             <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span> <span class=main>∈</span> set <span class=bound>xs</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>v</span><span class=main>)</span>
             <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> set <span class=bound>ys</span><span class=main>.</span> <span class=free>v</span> <span class=main>&lt;</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> enum_word_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upt_add_eq_append'<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> j<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"unat <span class=free><span class=free>v</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_imp_le<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upt_conv_Cons<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> exI conjI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> of_nat_mono_maybe<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>,</span></span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=tfree><span class=quoted><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Suc_le_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> of_nat_mono_maybe<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>,</span></span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=tfree><span class=quoted><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Generic_set_bit><div class=head><h1>Theory Generic_set_bit</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson, NICTA *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Operation variant for setting and unsetting bits›</span></span>

<span class=keyword1><span class=command>theory</span></span> Generic_set_bit
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Bits_Int.html>Bits_Int</a>
    <a href=Most_significant_bit.html>Most_significant_bit</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>class</span></span> set_bit <span class=main>=</span> semiring_bits <span class=main>+</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>set_bit</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> bool <span class=main>⇒</span> <span class=tfree>'a</span>›</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> bit_set_bit_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
    <span class=quoted><span class=quoted>‹bit <span class=main>(</span><span class=free>set_bit</span> <span class=free>a</span> <span class=free>m</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span>
      <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>b</span> <span class=keyword1>else</span> bit <span class=free>a</span> <span class=free>n</span><span class=main>)</span> <span class=main>∧</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>

<span class=keyword1><span class=command>lemma</span></span> set_bit_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹set_bit <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> Bit_Operations.set_bit <span class=keyword1>else</span> unset_bit<span class=main>)</span> <span class=free>n</span> <span class=free>a</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span><span class=main>{</span>ring_bit_operations<span class=main>,</span> set_bit<span class=main>}</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> int <span class=main>::</span> <span class=quoted>set_bit</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>set_bit_int</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹int <span class=main>⇒</span> nat <span class=main>⇒</span> bool <span class=main>⇒</span> int›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹set_bit <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>=</span> bin_sc <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span>›</span></span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>standard</span>
    <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bit_int_def bin_nth_sc_gen <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bit_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"set_bit <span class=free>x</span> <span class=main>0</span> <span class=free>b</span> <span class=main>=</span> of_bool <span class=free>b</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bit_int_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> bin_rl_eqI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bit_Suc<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"set_bit <span class=free>x</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>b</span> <span class=main>=</span> of_bool <span class=main>(</span>odd <span class=free>x</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> set_bit <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=free>n</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bit_int_def <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> bin_rl_eqI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_last_set_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_last <span class=main>(</span>set_bit <span class=free>x</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> bin_last <span class=free>x</span> <span class=keyword1>else</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> int_set_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_rest_set_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"bin_rest <span class=main>(</span>set_bit <span class=free>x</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> set_bit <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=free>b</span> <span class=keyword1>else</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> int_set_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> int_set_bit_numeral<span class=main>:</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"set_bit <span class=free>x</span> <span class=main>(</span>numeral <span class=free>w</span><span class=main>)</span> <span class=free>b</span> <span class=main>=</span> of_bool <span class=main>(</span>odd <span class=free>x</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> set_bit <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>(</span>pred_numeral <span class=free>w</span><span class=main>)</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bit_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> int_set_bit_numerals <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  int_set_bit_numeral<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>w'</span>"</span></span><span class=main>]</span>
  int_set_bit_numeral<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span> numeral <span class=free>w'</span>"</span></span><span class=main>]</span>
  int_set_bit_numeral<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Numeral1"</span></span><span class=main>]</span>
  int_set_bit_numeral<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span><span class=main>]</span>
  int_set_bit_numeral<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span><span class=main>]</span>
  int_set_bit_Suc<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>w'</span>"</span></span><span class=main>]</span>
  int_set_bit_Suc<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span> numeral <span class=free>w'</span>"</span></span><span class=main>]</span>
  int_set_bit_Suc<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Numeral1"</span></span><span class=main>]</span>
  int_set_bit_Suc<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span><span class=main>]</span>
  int_set_bit_Suc<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span><span class=main>]</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w'</span>

<span class=keyword1><span class=command>lemma</span></span> msb_set_bit <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"msb <span class=main>(</span>set_bit <span class=main>(</span><span class=free>x</span> <span class=main>::</span> int<span class=main>)</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟷</span> msb <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> msb_conv_bin_sign set_bit_int_def<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>set_bit</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>set_bit_word</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span> word <span class=main>⇒</span> nat <span class=main>⇒</span> bool <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>
  <span class=keyword2><span class=keyword>where</span></span> word_set_bit_def<span class=main>:</span> <span class=quoted><span class=quoted>‹set_bit <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span>uint <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span><span class=main>)</span>›</span></span>

<span class=keyword1><span class=command>instance</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>standard</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_set_bit_def bin_nth_sc_gen <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> set_bit_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> Bit_Operations.set_bit <span class=free>n</span> <span class=free>w</span> <span class=keyword1>else</span> unset_bit <span class=free>n</span> <span class=free>w</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bit_set_bit_word_iff <span class=main>[</span><span class=operator>bit_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=main>(</span>set_bit <span class=free>w</span> <span class=free>m</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> <span class=free>b</span> <span class=keyword1>else</span> bit <span class=free>w</span> <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_nth <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=free>w</span> <span class=free>n</span> <span class=main>(</span>test_bit <span class=free>w</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_test_bit_def word_set_bit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>x</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size word_test_bit_def word_set_bit_def nth_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_set_gen<span class=main>:</span>
  <span class=quoted><span class=quoted>"test_bit <span class=main>(</span>set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>x</span><span class=main>)</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>∧</span> <span class=free>x</span> <span class=keyword1>else</span> test_bit <span class=free>w</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_size word_test_bit_def word_set_bit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_bintr bin_nth_sc_gen<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> test_bit_size <span class=main><span class=main>[</span></span><span class=operator>unfolded</span> word_size<span class=main><span class=main>]</span></span>
      <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_test_bit_def <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_set_set_same <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=main>(</span>set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>x</span><span class=main>)</span> <span class=free>n</span> <span class=free>y</span> <span class=main>=</span> set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> test_bit_set_gen word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_set_diff<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≠</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"set_bit <span class=main>(</span>set_bit <span class=free>w</span> <span class=free>m</span> <span class=free>x</span><span class=main>)</span> <span class=free>n</span> <span class=free>y</span> <span class=main>=</span> set_bit <span class=main>(</span>set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>y</span><span class=main>)</span> <span class=free>m</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> test_bit_set_gen word_size assms<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> set_bit_word_of_int<span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=main>(</span>word_of_int <span class=free>x</span><span class=main>)</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_set_bit_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size bin_nth_sc_gen nth_bintr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set_bit <span class=main>(</span>numeral <span class=free>bin</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span>
    word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_bit_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_neg_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"set_bit <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span>
    word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=main>(</span><span class=main>-</span> numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_neg_numeral_alt <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_bit_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_bit_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=main>0</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_0_wi <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_bit_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_bit_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=main>1</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> word_of_int <span class=main>(</span>bin_sc <span class=free>n</span> <span class=free>b</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_1_wi <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_bit_word_of_int<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_set_nth_iff<span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=free>w</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=free>w</span> <span class=main>⟷</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>b</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>≥</span> size <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjCI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_eqD<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> sym <span class=main><span class=main>[</span></span><span class=operator>THEN</span> trans<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_set<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> test_bit_set_gen<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> test_bit_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_clr_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≥</span> set_bit <span class=free>w</span> <span class=free>n</span> False"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_set_bit_def word_le_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bintr_bin_clr_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_set_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≤</span> set_bit <span class=free>w</span> <span class=free>n</span> True"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_set_bit_def word_le_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ bintr_bin_set_ge<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> set_bit_beyond<span class=main>:</span>
  <span class=quoted><span class=quoted>"size <span class=free>x</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> set_bit <span class=free>x</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> word_eqI <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_set_gen word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> one_bit_shiftl<span class=main>:</span> <span class=quoted><span class=quoted>"set_bit <span class=main>0</span> <span class=free>n</span> True <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_set_gen nth_shiftl word_size
              <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> word_set_bit_0 shiftl_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> one_bit_pow <span class=main>=</span> trans <span class=main>[</span><span class=operator>OF</span> one_bit_shiftl shiftl_1<span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Hex_Words><div class=head><h1>Theory Hex_Words</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Print Words in Hex"</span></span>

<span class=keyword1><span class=command>theory</span></span> Hex_Words
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Print words in hex.›</span></span>

<span class=comment1>(* mostly clagged from Num.thy *)</span>
<span class=keyword1><span class=command>typed_print_translation</span></span>  <span class=quoted>‹
<span class=keyword2><span class=keyword>let</span></span>
  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>dest_num</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> Num.Bit0<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>n</span><span class=main>)</span> <span class=main>=</span> <span class=inner_numeral>2</span> * <span class=entity>dest_num</span> <span class=entity>n</span>
    <span class=main>|</span> <span class=entity>dest_num</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> Num.Bit1<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>n</span><span class=main>)</span> <span class=main>=</span> <span class=inner_numeral>2</span> * <span class=entity>dest_num</span> <span class=entity>n</span> + <span class=inner_numeral>1</span>
    <span class=main>|</span> <span class=entity>dest_num</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> Num.One<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=inner_numeral>1</span><span class=main>;</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>dest_bin_hex_str</span> <span class=entity>tm</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>num</span> <span class=main>=</span> <span class=entity>dest_num</span> <span class=entity>tm</span><span class=main>;</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>pre</span> <span class=main>=</span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>num</span> &lt; <span class=inner_numeral>10</span> <span class=keyword2><span class=keyword>then</span></span> <span class=inner_quoted>""</span> <span class=keyword2><span class=keyword>else</span></span> <span class=inner_quoted>"0x"</span>
  <span class=keyword2><span class=keyword>in</span></span>
    <span class=entity>pre</span> ^ <span class=main>(</span>Int.fmt StringCvt.HEX <span class=entity>num</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span><span class=main>;</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>num_tr'</span> <span class=entity>sign</span> <span class=entity>ctxt</span> <span class=entity>T</span> <span class=main>[</span><span class=entity>n</span><span class=main>]</span> <span class=main>=</span>
    <span class=keyword2><span class=keyword>let</span></span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>k</span> <span class=main>=</span> <span class=entity>dest_bin_hex_str</span> <span class=entity>n</span><span class=main>;</span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>t'</span> <span class=main>=</span> Syntax.const <span class=antiquoted><span class=antiquote>@{</span><span class=operator>syntax_const</span> "_Numeral"<span class=antiquote>}</span></span> $
        Syntax.free <span class=main>(</span><span class=entity>sign</span> ^ <span class=entity>k</span><span class=main>)</span><span class=main>;</span>
    <span class=keyword2><span class=keyword>in</span></span>
      <span class=keyword2><span class=keyword>case</span></span> <span class=entity>T</span> <span class=keyword2><span class=keyword>of</span></span>
        Type <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>type_name</span> fun<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>[</span><span class=main>_</span><span class=main>,</span> <span class=entity>T'</span> <span class=keyword1><span class=keyword>as</span></span> Type<span class=main>(</span><span class=inner_quoted>"Word.word"</span><span class=main>,</span><span class=main>_</span><span class=main>)</span><span class=main>]</span><span class=main>)</span> <span class=main>=&gt;</span>
          <span class=keyword2><span class=keyword>if</span></span> not <span class=main>(</span>Config.get <span class=entity>ctxt</span> show_types<span class=main>)</span> <span class=keyword1><span class=keyword>andalso</span></span> can Term.dest_Type <span class=entity>T'</span>
          <span class=keyword2><span class=keyword>then</span></span> <span class=entity>t'</span>
          <span class=keyword2><span class=keyword>else</span></span> Syntax.const <span class=antiquoted><span class=antiquote>@{</span><span class=operator>syntax_const</span> "_constrain"<span class=antiquote>}</span></span> $ <span class=entity>t'</span> $
                            Syntax_Phases.term_of_typ <span class=entity>ctxt</span> <span class=entity>T'</span>
      <span class=main>|</span> <span class=entity>T'</span> <span class=main>=&gt;</span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>T'</span> <span class=main>=</span> dummyT <span class=keyword2><span class=keyword>then</span></span> <span class=entity>t'</span> <span class=keyword2><span class=keyword>else</span></span> <span class=keyword3><span class=keyword>raise</span></span> Match
    <span class=keyword2><span class=keyword>end</span></span><span class=main>;</span>
<span class=keyword2><span class=keyword>in</span></span> <span class=main>[</span><span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> numeral<span class=antiquote>}</span></span><span class=main>,</span> <span class=entity>num_tr'</span> <span class=inner_quoted>""</span><span class=main>)</span><span class=main>]</span> <span class=keyword2><span class=keyword>end</span></span>
›</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=More_Sublist><div class=head><h1>Theory More_Sublist</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Lemmas on sublists›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Sublist
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Sublist.html>HOL-Library.Sublist</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> same_length_is_parallel<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> len<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> set <span class=free>as</span><span class=main>.</span> length <span class=bound>y</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span> <span class=main>∈</span> set <span class=free>as</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> set <span class=free>as</span> <span class=main>-</span> <span class=main>{</span><span class=bound>x</span><span class=main>}</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∥</span> <span class=bound>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> xi<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> set <span class=free>as</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> yi<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>∈</span> set <span class=free>as</span> <span class=main>-</span> <span class=main>{</span><span class=skolem>x</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> len <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> len'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> set <span class=free>as</span><span class=main>.</span> length <span class=bound>y</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∥</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> not_equal_is_parallel<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> xi yi <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>≠</span> <span class=skolem>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> xi yi len' <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"length <span class=skolem>x</span> <span class=main>=</span> length <span class=skolem>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bspec<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> sublist_equal_part<span class=main>:</span>
  <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> take <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> prefix_length_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"strict_prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> length <span class=free>xs</span> <span class=main>&lt;</span> length <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> strict_prefix_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> prefix_length_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> take_less <span class=main>=</span> take_strict_prefix

<span class=keyword1><span class=command>lemma</span></span> not_prefix_longer<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> length <span class=free>xs</span> <span class=main>&gt;</span> length <span class=free>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> prefix_length_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map_prefixI<span class=main>:</span>
  <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> prefix <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>map <span class=free>f</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> list_all2_induct_suffixeq <span class=main>[</span><span class=operator>consumes</span> 1<span class=main>,</span> <span class=operator>case_names</span> Nil Cons<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lall<span class=main>:</span> <span class=quoted><span class=quoted>"list_all2 <span class=free>Q</span> <span class=free>as</span> <span class=free>bs</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     nilr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>[]</span> <span class=main>[]</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    consr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>xs</span> <span class=bound>y</span> <span class=bound>ys</span><span class=main>.</span>
  <span class=main>⟦</span>list_all2 <span class=free>Q</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>;</span> <span class=free>Q</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>;</span> <span class=free>P</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>;</span> suffix <span class=main>(</span><span class=bound>x</span> <span class=main>#</span> <span class=bound>xs</span><span class=main>)</span> <span class=free>as</span><span class=main>;</span> suffix <span class=main>(</span><span class=bound>y</span> <span class=main>#</span> <span class=bound>ys</span><span class=main>)</span> <span class=free>bs</span><span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>x</span> <span class=main>#</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>(</span><span class=bound>y</span> <span class=main>#</span> <span class=bound>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>as</span> <span class=free>bs</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>as'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>as'</span> <span class=main>==</span> <span class=free>as</span>"</span></span>
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>bs'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>bs'</span> <span class=main>==</span> <span class=free>bs</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"suffix <span class=free>as</span> <span class=skolem>as'</span> <span class=main>∧</span> suffix <span class=free>bs</span> <span class=skolem>bs'</span>"</span></span> <span class=keyword1><span class=command>unfolding</span></span> as'_def bs'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> lall
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_induct2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> list_all2_lengthD <span class=main><span class=main>[</span></span><span class=operator>OF</span> lall<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> 1 <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>2 <span class=skolem>x</span> <span class=skolem>xs</span> <span class=skolem>y</span> <span class=skolem>ys</span><span class=main>)</span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> consr<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted>"2.prems"</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"list_all2 <span class=free>Q</span> <span class=skolem>xs</span> <span class=skolem>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>xs</span> <span class=skolem>ys</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted>"2.hyps"</span> <span class=quoted>"2.prems"</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> suffix_ConsD<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted>"2.prems"</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"suffix <span class=main>(</span><span class=skolem>x</span> <span class=main>#</span> <span class=skolem>xs</span><span class=main>)</span> <span class=free>as</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"suffix <span class=main>(</span><span class=skolem>y</span> <span class=main>#</span> <span class=skolem>ys</span><span class=main>)</span> <span class=free>bs</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> as'_def bs'_def<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> take_prefix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>take <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>ys</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> Nil <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> Cons <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>ys</span></span><span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=More_Misc><div class=head><h1>Theory More_Misc</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Miscellaneous lemmas›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Misc
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemmas</span></span> ls_splits <span class=main>=</span> prod.split prod.split_asm if_split_asm

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Strict_part_mono><div class=head><h1>Theory Strict_part_mono</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>theory</span></span> Strict_part_mono
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span> <a href=More_Word.html>More_Word</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>strict_part_mono</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> order <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>::</span> order<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>strict_part_mono</span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>A</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>.</span> <span class=main>∀</span><span class=bound>B</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main>.</span> <span class=bound>A</span> <span class=main>&lt;</span> <span class=bound>B</span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>A</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>B</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> strict_part_mono_by_steps<span class=main>:</span>
  <span class=quoted><span class=quoted>"strict_part_mono <span class=main>{..</span><span class=free>n</span> <span class=main>::</span> nat<span class=main>}</span> <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟶</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>f</span> <span class=free>n</span> <span class=main>∧</span> strict_part_mono <span class=main>{..</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=free>f</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> strict_part_mono_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>B</span> <span class=main>=</span> Suc <span class=improper>nat</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>A</span> <span class=main>=</span> <span class=improper>nat</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> strict_part_mono_singleton<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"strict_part_mono <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> strict_part_mono_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> strict_part_mono_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>f</span> <span class=main>0</span><span class=main>;</span> strict_part_mono <span class=main>{..</span> <span class=free>n</span> <span class=main>::</span> nat<span class=main>}</span> <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound><span class=bound>m</span></span> <span class=main>≤</span> <span class=free>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>f</span> <span class=bound>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> atMost_iff le_0_eq le_cases neq0_conv order.strict_trans strict_part_mono_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> strict_part_mono_reverseE<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>f</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>f</span> <span class=free>m</span><span class=main>;</span> strict_part_mono <span class=main>{..</span> <span class=free>N</span> <span class=main>::</span> nat<span class=main>}</span> <span class=free>f</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>N</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_le strict_part_mono_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> two_power_strict_part_mono<span class=main>:</span>
  <span class=quoted><span class=quoted>"strict_part_mono <span class=main>{..</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> strict_part_mono <span class=main>{..</span><span class=skolem>n</span><span class=main>}</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=skolem>n</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> 0 <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>Suc <span class=skolem>n</span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> Suc.prems
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=skolem>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> Suc <span class=skolem>n</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> power_strict_increasing unat_power_lower word_less_nat_alt <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>with</span></span> Suc
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> strict_part_mono_by_steps<span class=main>)</span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Legacy_Aliases><div class=head><h1>Theory Legacy_Aliases</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Legacy aliases›</span></span>

<span class=keyword1><span class=command>theory</span></span> Legacy_Aliases
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>complement</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span>  <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>complement</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> <span class=keyword1>NOT</span> <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> complement_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"complement <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> complement_def mask_eq_decr_exp <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> less_def <span class=main>=</span> less_eq <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> le_def <span class=main>=</span> not_less <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tvar>?'a</span> <span class=main><span class=main>=</span></span> <span class=quoted>nat</span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Next_and_Prev><div class=head><h1>Theory Next_and_Prev</h1></div><pre class=source><span class=comment1>(*
 * Copyright Julius Michaelis, Cornelius Diekmann
 * SPDX-License-Identifier: BSD-3-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span><span class=quoted><span class=plain_text>‹Increment and Decrement Machine Words Without Wrap-Around›</span></span>

<span class=keyword1><span class=command>theory</span></span> Next_and_Prev
<span class=keyword2><span class=keyword>imports</span></span>
  <a href=Aligned.html>Aligned</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Previous and next words addresses, without wrap around.›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> word_next <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=keyword1>if</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>dvd</span> <span class=bound>k</span> <span class=main>+</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=bound>k</span> <span class=main>+</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> take_bit_add<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> word_prev <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=keyword1>if</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>dvd</span> <span class=bound>k</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=bound>k</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> take_bit_diff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_next_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_next <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_minus_one_eq_mask <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask_iff_exp_dvd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_prev_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_prev <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹Word.the_int <span class=main>(</span>word_next <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>then</span> Word.the_int <span class=free>w</span> <span class=keyword1>else</span> Word.the_int <span class=free>w</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span>
    <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_minus_one_eq_mask mask_eq_exp_minus_1 take_bit_incr_eq <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask_iff_exp_dvd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹Word.the_int <span class=main>(</span>word_prev <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> Word.the_int <span class=free>w</span> <span class=keyword1>else</span> Word.the_int <span class=free>w</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_eq_0_iff take_bit_decr_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_adjacent_union<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_next <span class=free>e</span> <span class=main>=</span> <span class=free>s'</span> <span class=main>⟹</span> <span class=free>s</span> <span class=main>≤</span> <span class=free>e</span> <span class=main>⟹</span> <span class=free>s'</span> <span class=main>≤</span> <span class=free>e'</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>s</span><span class=main>..</span><span class=free>e</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=free>s'</span><span class=main>..</span><span class=free>e'</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>s</span> <span class=main>..</span> <span class=free>e'</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_next_unfold ivl_disj_un_two_touch <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_atLeastLessThan_Suc_atLeastAtMost_union<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_Suc_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Norm_Words><div class=head><h1>Theory Norm_Words</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Normalising Word Numerals"</span></span>

<span class=keyword1><span class=command>theory</span></span> Norm_Words
  <span class=keyword2><span class=keyword>imports</span></span> <a href=Bits_Int.html>Bits_Int</a> <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Normalise word numerals, including negative ones apart from <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>-</span></span><span class=main><span class=main>1</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, to the
  interval <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>[0..2^len_of 'a)›</span></span></span></span>. Only for concrete word lengths.
›</span></span>

<span class=keyword1><span class=command>lemma</span></span> neg_num_bintr<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> numeral <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
  word_of_int <span class=main>(</span>bintrunc <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span>numeral <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>ML</span></span> <span class=quoted>‹
  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>is_refl</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> Pure.eq<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>x</span> $ <span class=entity>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=entity>x</span> <span class=main>=</span> <span class=entity>y</span><span class=main>)</span>
    <span class=main>|</span> <span class=entity>is_refl</span> <span class=main>_</span> <span class=main>=</span> false<span class=main>;</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>signed_dest_wordT</span> <span class=main>(</span>Type <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>type_name</span> word<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>[</span>Type <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>type_name</span> signed<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>[</span><span class=entity>T</span><span class=main>]</span><span class=main>)</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=entity>Word_Lib.dest_binT</span> <span class=entity>T</span>
    <span class=main>|</span> <span class=entity>signed_dest_wordT</span> <span class=entity>T</span> <span class=main>=</span> <span class=entity>Word_Lib.dest_wordT</span> <span class=entity>T</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>typ_size_of</span> <span class=entity>t</span> <span class=main>=</span> <span class=entity>signed_dest_wordT</span> <span class=main>(</span>type_of <span class=main>(</span>Thm.term_of <span class=entity>t</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>num_len</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> Num.Bit0<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>n</span><span class=main>)</span> <span class=main>=</span> <span class=entity>num_len</span> <span class=entity>n</span> + <span class=inner_numeral>1</span>
    <span class=main>|</span> <span class=entity>num_len</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> Num.Bit1<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>n</span><span class=main>)</span> <span class=main>=</span> <span class=entity>num_len</span> <span class=entity>n</span> + <span class=inner_numeral>1</span>
    <span class=main>|</span> <span class=entity>num_len</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> Num.One<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=inner_numeral>1</span>
    <span class=main>|</span> <span class=entity>num_len</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> numeral<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>t</span><span class=main>)</span> <span class=main>=</span> <span class=entity>num_len</span> <span class=entity>t</span>
    <span class=main>|</span> <span class=entity>num_len</span> <span class=main>(</span>Const <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_name</span> uminus<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> $ <span class=entity>t</span><span class=main>)</span> <span class=main>=</span> <span class=entity>num_len</span> <span class=entity>t</span>
    <span class=main>|</span> <span class=entity>num_len</span> <span class=entity>t</span> <span class=main>=</span> <span class=keyword3><span class=keyword>raise</span></span> TERM <span class=main>(</span><span class=inner_quoted>"num_len"</span><span class=main>,</span> <span class=main>[</span><span class=entity>t</span><span class=main>]</span><span class=main>)</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>unsigned_norm</span> <span class=entity>is_neg</span> <span class=main>_</span> <span class=entity>ctxt</span> <span class=entity>ct</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword2><span class=keyword>if</span></span> <span class=entity>is_neg</span> <span class=keyword1><span class=keyword>orelse</span></span> <span class=entity>num_len</span> <span class=main>(</span>Thm.term_of <span class=entity>ct</span><span class=main>)</span> &gt; <span class=entity>typ_size_of</span> <span class=entity>ct</span> <span class=keyword2><span class=keyword>then</span></span> <span class=keyword2><span class=keyword>let</span></span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>btr</span> <span class=main>=</span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>is_neg</span>
                <span class=keyword2><span class=keyword>then</span></span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> neg_num_bintr<span class=antiquote>}</span></span></span> <span class=keyword2><span class=keyword>else</span></span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> num_abs_bintr<span class=antiquote>}</span></span></span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>th</span> <span class=main>=</span> <span class=main>[</span>Thm.reflexive <span class=entity>ct</span><span class=main>,</span> <span class=entity>mk_eq</span> <span class=entity>btr</span><span class=main>]</span> MRS transitive_thm

      <span class=comment1>(* will work in context of theory Word as well *)</span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>ss</span> <span class=main>=</span> simpset_of <span class=main>(</span><span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>context</span><span class=antiquote>}</span></span></span> addsimps <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> bintrunc_numeral<span class=antiquote>}</span></span></span><span class=main>)</span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>cnv</span> <span class=main>=</span> <span class=entity>simplify</span> <span class=main>(</span>put_simpset <span class=entity>ss</span> <span class=entity>ctxt</span><span class=main>)</span> <span class=entity>th</span>
    <span class=keyword2><span class=keyword>in</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=entity>is_refl</span> <span class=main>(</span>Thm.prop_of <span class=entity>cnv</span><span class=main>)</span> <span class=keyword2><span class=keyword>then</span></span> NONE <span class=keyword2><span class=keyword>else</span></span> SOME <span class=entity>cnv</span> <span class=keyword2><span class=keyword>end</span></span>
    <span class=keyword2><span class=keyword>else</span></span> NONE<span class=main>)</span>
  <span class=keyword3><span class=keyword>handle</span></span> TERM <span class=main>(</span><span class=inner_quoted>"num_len"</span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> <span class=main>=&gt;</span> NONE
       <span class=main>|</span> TYPE <span class=main>(</span><span class=inner_quoted>"dest_binT"</span><span class=main>,</span> <span class=main>_</span><span class=main>,</span> <span class=main>_</span><span class=main>)</span> <span class=main>=&gt;</span> NONE
›</span>

<span class=keyword1><span class=command>simproc_setup</span></span>
  unsigned_norm <span class=main>(</span><span class=quoted><span class=quoted>"numeral <span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word"</span></span><span class=main>)</span> <span class=main>=</span> <span class=quoted>‹<span class=entity>unsigned_norm</span> false›</span>

<span class=keyword1><span class=command>simproc_setup</span></span>
  unsigned_norm_neg0 <span class=main>(</span><span class=quoted><span class=quoted>"<span class=main>-</span>numeral <span class=main>(</span>num.Bit0 <span class=free>num</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word"</span></span><span class=main>)</span> <span class=main>=</span> <span class=quoted>‹<span class=entity>unsigned_norm</span> true›</span>

<span class=keyword1><span class=command>simproc_setup</span></span>
  unsigned_norm_neg1 <span class=main>(</span><span class=quoted><span class=quoted>"<span class=main>-</span>numeral <span class=main>(</span>num.Bit1 <span class=free>num</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word"</span></span><span class=main>)</span> <span class=main>=</span> <span class=quoted>‹<span class=entity>unsigned_norm</span> true›</span>

<span class=keyword1><span class=command>lemma</span></span> minus_one_norm<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>of_nat_diff<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> minus_one_norm_num <span class=main>=</span>
  minus_one_norm <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len bit0"</span></span><span class=main>]</span> minus_one_norm <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len0 bit1"</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=numeral>7</span> <span class=main>::</span> <span class=numeral>2</span> word<span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=numeral>3</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=numeral>7</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>3</span> <span class=main>::</span> <span class=numeral>2</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>21</span> <span class=main>+</span> <span class=main>1</span> <span class=main>::</span> <span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>13</span> <span class=main>+</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span> <span class=comment1>(* does not touch generic word length *)</span>
  <span class=keyword1><span class=command>oops</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>0xFFFFFFFE</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>2</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>3</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>0xFFFFFFFE</span> <span class=main>::</span> <span class=numeral>32</span> signed word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We leave <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>-</span></span><span class=main><span class=main>1</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> untouched by default, because it is often useful
  and its normal form can be large.
  To include it in the normalisation, add <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [source] minus_one_norm_num<span class=antiquote><span class=antiquote>}</span></span></span></span>.
  The additional normalisation is restricted to concrete numeral word lengths,
  like the rest.
›</span></span>
<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>notes</span></span> minus_one_norm_num <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>15</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>7</span> <span class=main>::</span> <span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>0xFFFF</span> <span class=main>::</span> <span class=numeral>16</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=numeral>0xFFFF</span> <span class=main>+</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span> <span class=comment1>(* does not touch generic -1 *)</span>
  <span class=keyword1><span class=command>oops</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Rsplit><div class=head><h1>Theory Rsplit</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(* Author: Jeremy Dawson and Gerwin Klein, NICTA *)</span>

<span class=keyword1><span class=command>theory</span></span> Rsplit
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span> <a href=Bits_Int.html>Bits_Int</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_rsplit</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>word_rsplit</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> map word_of_int <span class=main>(</span>bin_rsplit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>,</span> uint <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_no<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_rsplit <span class=main>(</span>numeral <span class=free>bin</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>=</span>
    map word_of_int <span class=main>(</span>bin_rsplit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>)</span>
      <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>,</span> take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>numeral <span class=free>bin</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rsplit_def of_nat_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word_rsplit_no_cl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> word_rsplit_no
  <span class=main>[</span><span class=operator>unfolded</span> bin_rsplitl_def bin_rsplit_l <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  This odd result arises from the fact that the statement of the
  result implies that the decoded words are of the same type,
  and therefore of the same length, as the original word.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_same<span class=main>:</span> <span class=quoted><span class=quoted>"word_rsplit <span class=free>w</span> <span class=main>=</span> <span class=main>[</span><span class=free>w</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rsplit_def bin_rsplit_all<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_empty_iff_size<span class=main>:</span> <span class=quoted><span class=quoted>"word_rsplit <span class=free>w</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>⟷</span> size <span class=free>w</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rsplit_def bin_rsplit_def word_size bin_rsplit_aux_simp_alt Let_def
      <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_rsplit<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sw</span> <span class=main>=</span> word_rsplit <span class=free>w</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>&lt;</span> size <span class=main>(</span>hd <span class=free>sw</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=free>k</span> <span class=main>&lt;</span> length <span class=free>sw</span> <span class=main>⟹</span> <span class=main>(</span>rev <span class=free>sw</span> <span class=main>!</span> <span class=free>k</span><span class=main>)</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> size <span class=main>(</span>hd <span class=free>sw</span><span class=main>)</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>sw</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word list"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> word_rsplit_def word_test_bit_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> bin_nth <span class=bound>x</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_map <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bin_nth_rsplit<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_size rev_map<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> map_ident <span class=main><span class=main>[</span></span><span class=operator>THEN</span> fun_cong<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> refl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> map_cong<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>using</span></span> bin_rsplit_size_sign take_bit_int_eq_self_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> test_bit_rsplit_alt<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>word_rsplit <span class=free>w</span>  <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span> <span class=main>!</span> <span class=free>i</span> <span class=main>!!</span> <span class=free>m</span> <span class=main>⟷</span>
    <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=main>(</span>length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span> <span class=main>-</span> Suc <span class=free>i</span><span class=main>)</span> <span class=main>*</span> size <span class=main>(</span>hd <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>&lt;</span> length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>&lt;</span> size <span class=main>(</span>hd <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word list<span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> test_bit_cong<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> rev_nth <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>‹rev <span class=main><span class=main>(</span></span>word_rsplit <span class=free><span class=free>w</span></span><span class=main><span class=main>)</span></span>›</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span> rev_rev_ident<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> that<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> test_bit_rsplit<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> asm_rl<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> that<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_Suc_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> that<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_len_indep <span class=main>[</span><span class=operator>OF</span> refl refl refl refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>u</span><span class=main>,</span><span class=free>v</span><span class=main>]</span> <span class=main>=</span> <span class=free>p</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>su</span><span class=main>,</span><span class=free>sv</span><span class=main>]</span> <span class=main>=</span> <span class=free>q</span> <span class=main>⟹</span> word_rsplit <span class=free>u</span> <span class=main>=</span> <span class=free>su</span> <span class=main>⟹</span>
    word_rsplit <span class=free>v</span> <span class=main>=</span> <span class=free>sv</span> <span class=main>⟹</span> length <span class=free>su</span> <span class=main>=</span> length <span class=free>sv</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_rsplit_def bin_rsplit_len_indep<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_word_rsplit_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟷</span> size <span class=free>w</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_rsplit_def word_size bin_rsplit_len_le<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> length_word_rsplit_lt_size <span class=main>=</span>
  length_word_rsplit_size <span class=main>[</span><span class=operator>unfolded</span> Not_eq_iff linorder_not_less <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> length_word_rsplit_exp_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span>
    length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>size <span class=free>w</span> <span class=main>+</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_rsplit_def word_size bin_rsplit_len<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> length_word_rsplit_even_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> size <span class=free>w</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span> <span class=main>⟹</span>
    length <span class=main>(</span>word_rsplit <span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_word_rsplit_exp_size div_nat_eqI<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> length_word_rsplit_exp_size' <span class=main>=</span> refl <span class=main>[</span><span class=operator>THEN</span> length_word_rsplit_exp_size<span class=main>]</span>

<span class=comment1>― ‹alternative proof of <span class=antiquoted><span class=raw_text><span class=operator>‹</span>word_rcat_rsplit›</span></span>›</span>
<span class=keyword1><span class=command>lemmas</span></span> tdle <span class=main>=</span> times_div_less_eq_dividend
<span class=keyword1><span class=command>lemmas</span></span> dtle <span class=main>=</span> xtrans<span class=main>(</span>4<span class=main>)</span> <span class=main>[</span><span class=operator>OF</span> tdle mult.commute<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_rcat_rsplit<span class=main>:</span> <span class=quoted><span class=quoted>"word_rcat <span class=main>(</span>word_rsplit <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> test_bit_rcat word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> refl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> test_bit_rsplit<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size
      refl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> length_word_rsplit_size <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>simplified</span> not_less <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>symmetric</span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>simplified</span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> xtrans<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> dtle<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> size_word_rsplit_rcat_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_rcat <span class=free>ws</span> <span class=main>=</span> <span class=free>frcw</span> <span class=main>⟹</span> size <span class=free>frcw</span> <span class=main>=</span> length <span class=free>ws</span> <span class=main>*</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>
    <span class=main>⟹</span> length <span class=main>(</span>word_rsplit <span class=free>frcw</span><span class=main>::</span><span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>=</span> length <span class=free>ws</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ws</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word list"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>frcw</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size length_word_rsplit_exp_size' div_nat_eqI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> msrevs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_rcat_size <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"word_rcat <span class=free>ws</span> <span class=main>=</span> <span class=free>frcw</span> <span class=main>⟹</span>
    size <span class=free>frcw</span> <span class=main>=</span> length <span class=free>ws</span> <span class=main>*</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> word_rsplit <span class=free>frcw</span> <span class=main>=</span> <span class=free>ws</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ws</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word list"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> size_word_rsplit_rcat_size<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI <span class=main><span class=main>[</span></span><span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> test_bit_rsplit_alt<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> test_bit_rcat <span class=main><span class=main>[</span></span><span class=operator>OF</span> refl refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> rev_nth<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le0 <span class=main><span class=main>[</span></span><span class=operator>THEN</span> <span class=main><span class=main><span class=main>[</span></span></span>2<span class=main><span class=main><span class=main>]</span></span></span> xtrans<span class=main><span class=main><span class=main>(</span></span></span>7<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> diff_Suc_less<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mult_distrib<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"size <span class=free>ws</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_upt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> size <span class=free>x</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>*</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span>
    <span class=main>⟹</span> word_rsplit <span class=free>x</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=bound>i</span> <span class=main>*</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=free>n</span><span class=main>]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>word_rsplit <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word list<span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_equalityI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> allI word_eqI impI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_rsplit_alt word_size<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_ucast nth_shiftr rev_nth <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_word_rsplit_exp_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Nat.add_diff_assoc Suc_leI add_0_left diff_Suc_less div_less len_gt_0 msrevs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=Type_Syntax><div class=head><h1>Theory Type_Syntax</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Displaying Phantom Types for Word Operations"</span></span>

<span class=keyword1><span class=command>theory</span></span> Type_Syntax
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>ML</span></span> <span class=quoted>‹
<span class=keyword1><span class=keyword>structure</span></span> <span class=entity>Word_Syntax</span> <span class=main>=</span>
<span class=keyword2><span class=keyword>struct</span></span>

  <span class=keyword1><span class=keyword>val</span></span> <span class=entity>show_word_types</span> <span class=main>=</span> <span class=entity>Attrib.setup_config_bool</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>binding</span> show_word_types<span class=antiquote>}</span></span></span> <span class=main>(</span>K true<span class=main>)</span>

  <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>tr'</span> <span class=entity>cnst</span> <span class=entity>ctxt</span> <span class=entity>typ</span> <span class=entity>ts</span> <span class=main>=</span> <span class=keyword2><span class=keyword>if</span></span> Config.get <span class=entity>ctxt</span> <span class=entity>show_word_types</span> <span class=keyword2><span class=keyword>then</span></span>
      <span class=keyword2><span class=keyword>case</span></span> <span class=main>(</span>Term.binder_types <span class=entity>typ</span><span class=main>,</span> Term.body_type <span class=entity>typ</span><span class=main>)</span> <span class=keyword2><span class=keyword>of</span></span>
        <span class=main>(</span><span class=main>[</span>Type <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>type_name</span> "word"<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>[</span><span class=entity>S</span><span class=main>]</span><span class=main>)</span><span class=main>]</span><span class=main>,</span> Type <span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>type_name</span> "word"<span class=antiquote>}</span></span><span class=main>,</span> <span class=main>[</span><span class=entity>T</span><span class=main>]</span><span class=main>)</span><span class=main>)</span> <span class=main>=&gt;</span>
          list_comb
            <span class=main>(</span>Syntax.const <span class=entity>cnst</span> $ Syntax_Phases.term_of_typ <span class=entity>ctxt</span> <span class=entity>S</span> $ Syntax_Phases.term_of_typ <span class=entity>ctxt</span> <span class=entity>T</span>
            <span class=main>,</span> <span class=entity>ts</span><span class=main>)</span>
        <span class=main>|</span> <span class=main>_</span> <span class=main>=&gt;</span> <span class=keyword3><span class=keyword>raise</span></span> Match
  <span class=keyword2><span class=keyword>else</span></span> <span class=keyword3><span class=keyword>raise</span></span> Match

<span class=keyword2><span class=keyword>end</span></span>
›</span>


<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_Ucast"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"type <span class=main>⇒</span> type <span class=main>⇒</span> logic"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(1</span><span class=keyword1>UCAST</span><span class=keyword3>/</span><span class=keyword3>(1</span><span class=keyword1>'(</span>_ <span class=keyword1>→</span> _<span class=keyword1>')</span><span class=keyword3>)</span><span class=keyword3>)</span>"</span><span class=main>)</span>
<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree><span class=free>'s</span></span> <span class=main>→</span> <span class=tfree><span class=free>'t</span></span><span class=main>)</span>"</span> <span class=main>=&gt;</span> <span class=quoted>"<span class=keyword1>CONST</span> ucast <span class=main>::</span> <span class=main>(</span><span class=tfree><span class=free>'s</span></span> word <span class=main>⇒</span> <span class=tfree><span class=free>'t</span></span> word<span class=main>)</span>"</span>
<span class=keyword1><span class=command>typed_print_translation</span></span>
  <span class=quoted>‹ <span class=main>[</span><span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> ucast<span class=antiquote>}</span></span><span class=main>,</span> <span class=entity>Word_Syntax.tr'</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>syntax_const</span> "_Ucast"<span class=antiquote>}</span></span><span class=main>)</span><span class=main>]</span> ›</span>


<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_Scast"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"type <span class=main>⇒</span> type <span class=main>⇒</span> logic"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(1</span><span class=keyword1>SCAST</span><span class=keyword3>/</span><span class=keyword3>(1</span><span class=keyword1>'(</span>_ <span class=keyword1>→</span> _<span class=keyword1>')</span><span class=keyword3>)</span><span class=keyword3>)</span>"</span><span class=main>)</span>
<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=keyword1>SCAST</span><span class=main>(</span><span class=tfree><span class=free>'s</span></span> <span class=main>→</span> <span class=tfree><span class=free>'t</span></span><span class=main>)</span>"</span> <span class=main>=&gt;</span> <span class=quoted>"<span class=keyword1>CONST</span> scast <span class=main>::</span> <span class=main>(</span><span class=tfree><span class=free>'s</span></span> word <span class=main>⇒</span> <span class=tfree><span class=free>'t</span></span> word<span class=main>)</span>"</span>
<span class=keyword1><span class=command>typed_print_translation</span></span>
  <span class=quoted>‹ <span class=main>[</span><span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> scast<span class=antiquote>}</span></span><span class=main>,</span> <span class=entity>Word_Syntax.tr'</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>syntax_const</span> "_Scast"<span class=antiquote>}</span></span><span class=main>)</span><span class=main>]</span> ›</span>


<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_Revcast"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"type <span class=main>⇒</span> type <span class=main>⇒</span> logic"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(1</span><span class=keyword1>REVCAST</span><span class=keyword3>/</span><span class=keyword3>(1</span><span class=keyword1>'(</span>_ <span class=keyword1>→</span> _<span class=keyword1>')</span><span class=keyword3>)</span><span class=keyword3>)</span>"</span><span class=main>)</span>
<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=keyword1>REVCAST</span><span class=main>(</span><span class=tfree><span class=free>'s</span></span> <span class=main>→</span> <span class=tfree><span class=free>'t</span></span><span class=main>)</span>"</span> <span class=main>=&gt;</span> <span class=quoted>"<span class=keyword1>CONST</span> revcast <span class=main>::</span> <span class=main>(</span><span class=tfree><span class=free>'s</span></span> word <span class=main>⇒</span> <span class=tfree><span class=free>'t</span></span> word<span class=main>)</span>"</span>
<span class=keyword1><span class=command>typed_print_translation</span></span>
  <span class=quoted>‹ <span class=main>[</span><span class=main>(</span><span class=antiquoted><span class=antiquote>@{</span><span class=operator>const_syntax</span> revcast<span class=antiquote>}</span></span><span class=main>,</span> <span class=entity>Word_Syntax.tr'</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>syntax_const</span> "_Revcast"<span class=antiquote>}</span></span><span class=main>)</span><span class=main>]</span> ›</span>

<span class=comment1>(* Further candidates for showing word sizes, but with different arities:
   slice, word_cat, word_split, word_rcat, word_rsplit *)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Signed_Division_Word><div class=head><h1>Theory Signed_Division_Word</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Signed division on word›</span></span>

<span class=keyword1><span class=command>theory</span></span> Signed_Division_Word
  <span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Signed_Division.html>HOL-Library.Signed_Division</a>"</span> <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>instantiation</span></span> word <span class=main>::</span> <span class=main>(</span><span class=quoted>len</span><span class=main>)</span> <span class=quoted>signed_division</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> <span class=class_parameter>signed_divide_word</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span> <span class=bound>l</span><span class=main>.</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=bound>k</span> <span class=keyword1>sdiv</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=bound>l</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> signed_take_bit_decr_length_iff<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> <span class=class_parameter>signed_modulo_word</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word›</span></span>
  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=main>λ</span><span class=bound>k</span> <span class=bound>l</span><span class=main>.</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=bound>k</span> <span class=keyword1>smod</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=bound>l</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> signed_take_bit_decr_length_iff<span class=main>)</span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> sdiv_word_def <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>v</span> <span class=keyword1>sdiv</span> <span class=free>w</span> <span class=main>=</span> word_of_int <span class=main>(</span>sint <span class=free>v</span> <span class=keyword1>sdiv</span> sint <span class=free>w</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>v</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_def <span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>v</span> <span class=keyword1>smod</span> <span class=free>w</span> <span class=main>=</span> word_of_int <span class=main>(</span>sint <span class=free>v</span> <span class=keyword1>smod</span> sint <span class=free>w</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>v</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> sdiv_smod_id<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>a</span> <span class=keyword1>sdiv</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=free>b</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>smod</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹sint <span class=free>a</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>‹sint <span class=free>b</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_modulo_int_def sdiv_word_def smod_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> signed_div_arith<span class=main>:</span>
    <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> signed_mod_arith<span class=main>:</span>
    <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> signed_take_bit <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sdiv_div1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>1</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>nat</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_signed_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sdiv_div0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sdiv_word_def signed_divide_int_def sgn_if<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_sdiv_div_minus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>-</span><span class=main>1</span> <span class=main>=</span> <span class=main>-</span><span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sdiv_word_def signed_divide_int_def sgn_if<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Suc_pred len_gt_0 signed_take_bit_eq_iff_take_bit_eq signed_take_bit_of_0 take_bit_of_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_sdiv_0 <span class=main>=</span> word_sdiv_div0

<span class=keyword1><span class=command>lemma</span></span> sdiv_word_min<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> sint <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> sdiv_int_range <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> abs_le_iff add.inverse_inverse le_cases le_minus_iff not_le signed_take_bit_int_eq_self_iff signed_take_bit_minus<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_sdiv_numerals_lhs <span class=main>=</span> sdiv_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=free>x</span><span class=main>]</span>
    sdiv_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span> sdiv_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_sdiv_numerals <span class=main>=</span> word_sdiv_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"numeral <span class=free><span class=free><span class=free>y</span></span></span>"</span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span></span> <span class=free><span class=free><span class=free>y</span></span></span><span class=main>]</span>
    word_sdiv_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main>]</span> word_sdiv_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_mod_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>smod</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> smod_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_0_mod <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>smod</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> smod_word_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=keyword1>smod</span> sint <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹sint <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sint_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>using</span></span> smod_int_range <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_le_iff<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> diff_Suc_1 le_cases linorder_not_le sint_lt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.inverse_inverse diff_Suc_1 linorder_not_less neg_less_iff_less sint_ge<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_min<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> sint <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=keyword1>smod</span> sint <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹sint <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> diff_Suc_1 sint_ge<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> smod_int_range <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span> abs_le_iff<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> abs_zero add.left_neutral add_mono_thms_linordered_semiring<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> diff_Suc_1 le_cases linorder_not_less sint_lt zabs_less_one_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> abs_zero add.inverse_inverse add.left_neutral add_mono_thms_linordered_semiring<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> diff_Suc_1 le_cases le_minus_iff linorder_not_less sint_ge zabs_less_one_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> smod_word_alt_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>sdiv</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=free>b</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>1</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> smod_word_def sdiv_word_def signed_modulo_int_def
     <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> wi_hom_sub wi_hom_mult<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> smod_word_def signed_modulo_int_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_smod_numerals_lhs <span class=main>=</span> smod_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"numeral <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=free>x</span><span class=main>]</span>
    smod_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span><span class=main>]</span> smod_word_def<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> v<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_smod_numerals <span class=main>=</span> word_smod_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"numeral <span class=free><span class=free><span class=free>y</span></span></span>"</span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>for</span></span></span></span></span> <span class=free><span class=free><span class=free>y</span></span></span><span class=main>]</span>
    word_smod_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main>]</span> word_smod_numerals_lhs<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span></span></span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=Word_Lemmas><div class=head><h1>Theory Word_Lemmas</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lemmas with Generic Word Length"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_Lemmas
  <span class=keyword2><span class=keyword>imports</span></span>
    <a href=Type_Syntax.html>Type_Syntax</a>
    <a href=Signed_Division_Word.html>Signed_Division_Word</a>
    <a href=Signed_Words.html>Signed_Words</a>
    <a href=More_Word.html>More_Word</a>
    <a href=Most_significant_bit.html>Most_significant_bit</a>
    <a href=Enumeration_Word.html>Enumeration_Word</a>
    <a href=Aligned.html>Aligned</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* The seL4 bitfield generator produces functions containing mask and shift operations, such that
 * invoking two of them consecutively can produce something like the following.
 *)</span>
<span class=keyword1><span class=command>lemma</span></span> bitfield_op_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ao_dist<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bitfield_op_twice''<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=keyword1>NOT</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>b</span> <span class=main>=</span> mask <span class=bound>x</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>a</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>a</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>xa</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> m<span class=main><span class=main>=</span></span><span class=quoted><span class=free>c</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bitfield_op_twice<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>mask_eq_decr_exp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> not_switch<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> bit_twiddle_min<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=keyword1>then</span> <span class=main>-</span><span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> min <span class=free>x</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Parity.bit_eq_iff bit_xor_iff min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bit_twiddle_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>XOR</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=keyword1>then</span> <span class=main>-</span><span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> max <span class=free>x</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Parity.bit_eq_iff bit_xor_iff max_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> swap_with_xor<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>XOR</span> <span class=free>b</span><span class=main>;</span> <span class=free>y</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>XOR</span> <span class=free>x</span><span class=main>;</span> <span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>XOR</span> <span class=free>y</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>z</span> <span class=main>=</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Parity.bit_eq_iff bit_xor_iff max_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_nop1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=main>(</span>of_int <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> sword<span class=main>)</span> <span class=main>=</span> of_int <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> scast_eq<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> len_signed sint_sbintrunc' word_sint.Rep_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_nop2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=main>(</span>of_int <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> sword<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> of_int <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> scast_eq<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> len_signed sint_sbintrunc' word_sint.Rep_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> scast_nop <span class=main>=</span> scast_nop1 scast_nop2 scast_id

<span class=keyword1><span class=command>lemma</span></span> le_mask_imp_and_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_mask_eq_iff_le_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> or_not_mask_nop<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>OR</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_and_not word_ao_dist2 word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_log_esimps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_subsume<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>OR</span> <span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Parity.bit_eq_iff bit_not_iff bit_or_iff bit_and_iff bit_mask_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_0_iff_le_mask<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>≤</span> mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_0_eq_x le_mask_imp_and_mask and_mask_eq_iff_le_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_twice2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mask_twice min_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> uint_2_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>⟹</span> uint <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bintrunc_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>m</span> <span class=main>≤</span> of_nat <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bintrunc_mod2p le_less_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_unfold<span class=main>:</span> <span class=quoted><span class=quoted>"shiftr1 <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def comp_apply funpow.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> funpow.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> id_apply shiftr_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_is_div_2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftl1_is_mult<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def mult_2 mult_2_right one_add_one
        power_0 power_Suc shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> div_of_0_id<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_div_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> degenerate_word<span class=main>:</span><span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def less_irrefl_nat sint_1_cases<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> div_by_0_word<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>div</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> div_0 div_by_0 unat_0 word_arith_nat_defs<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span> word_div_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> div_less_dividend_word<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≠</span> <span class=main>0</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>word_neq_0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_arith_nat_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_of_nat_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_less_dividend<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> unat_eq_zero word_unat_Rep_inject1 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>unat_gt_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_lt<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftr1_is_div_2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_less_dividend_word<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_less_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>div</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def Suc_le_mono le0 le_div_geq not_less unat_0 unat_div unat_gt_0 word_less_nat_alt zero_less_one<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> not_degenerate_imp_2_neq_0<span class=main>:</span><span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> numerals<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> power_not_zero power_zero_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_0_or_1<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> shiftr1_is_div_2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_less_div<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>degenerate_word<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> not_degenerate_imp_2_neq_0<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> x_less_2_0_1'<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_overflow<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>&gt;</span> <span class=free>x</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_0 eq_diff_eq less_x_plus_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_overflow_unat<span class=main>:</span><span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Suc_eq_plus1 add.commute unatSuc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> even_word_imp_odd_next<span class=main>:</span><span class=quoted><span class=quoted>"even <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> odd <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_overflow_unat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> odd_word_imp_even_next<span class=main>:</span><span class=quoted><span class=quoted>"odd <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> even <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> word_overflow_unat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> overflow_imp_lsb<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>!!</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> even_plus_one_iff <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_word_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> odd_iff_lsb<span class=main>:</span><span class=quoted><span class=quoted>"odd <span class=main>(</span>unat <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>!!</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> even_nat_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_neq_iff_word<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≠</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
         <span class=main>(</span><span class=main>(</span><span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>≠</span> of_nat <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≠</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> of_nat_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> of_nat <span class=free>y</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> word_unat.norm_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_irrelevant_lsb<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>!!</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>transfer</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit drop_bit_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_0_imp_only_lsb<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def shiftr1_0_or_1 word_less_1 word_overflow<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr1_irrelevant_lsb'<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>!!</span> <span class=main>0</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> shiftr1_irrelevant_lsb<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> lsb_this_or_next<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>!!</span> <span class=main>0</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>!!</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>poly_guards_query<span class=main><span class=main>)</span></span> even_word_imp_odd_next odd_iff_lsb overflow_imp_lsb<span class=main>)</span>

<span class=comment1>(* Perhaps this one should be a simp lemma, but it seems a little dangerous. *)</span>
<span class=keyword1><span class=command>lemma</span></span> cast_chunk_assemble_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> and_not_mask<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_ucast_mask<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_ao_dist2<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ucast_ucast_len<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> shiftr_less_t2n'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> and_mask_eq_iff_le_mask<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mult_2_right<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add_diff_cancel_left' len_gt_0 mult_2_right zero_less_diff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> cast_chunk_scast_assemble_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>=</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span> <span class=keyword1>OR</span>
   <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>ucast <span class=free>x</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>cast_chunk_assemble_id<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> down_cast_same<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> is_down<span class=main><span class=keyword3>,</span></span> <span class=operator>arith</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_or_not_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=keyword1>OR</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_oa_dist<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_oa_dist2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_add_not_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>is_aligned <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=main>¬</span> is_aligned <span class=main>(</span><span class=free>q</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>q</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_addD1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_gr0_conv_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>m</span> <span class=main>=</span> <span class=bound>n</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add_minus_cancel<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_add_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>q</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>q</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_add_helper is_aligned_neg_mask_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_sless_sint_le<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>&lt;s</span> <span class=free>y</span> <span class=main>⟹</span> sint <span class=free>x</span> <span class=main>≤</span> sint <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_sless_alt zle_diff1_eq<span class=main>)</span>


<span class=keyword1><span class=command>lemma</span></span> upper_trivial<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> constraint_expand<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=free>lower</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≤</span> <span class=free>upper</span><span class=main>}</span> <span class=main>=</span> <span class=main>(</span><span class=free>lower</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>upper</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> mem_Collect_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> card_map_elide<span class=main>:</span>
  <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=main>(</span>of_nat <span class=main>::</span> nat <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> card <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span>"</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>CARD</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?of_nat</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"of_nat <span class=main>::</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span>
  <span class=keyword1><span class=command>from</span></span> word_unat.Abs_inj_on
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?of_nat</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=keyword1>CARD</span><span class=main>(</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unats_def card_word<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=keyword1>CARD</span><span class=main>(</span><span class=tfree>'a</span> word<span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on <span class=var>?of_nat</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_subset<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_image<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> card_map_elide2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>CARD</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟹</span> card <span class=main>(</span><span class=main>(</span>of_nat<span class=main>::</span>nat <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> card_map_elide<span class=main>)</span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> le_max_word_ucast_id<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'b</span> <span class=main>→</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>›</span></span>
    <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≤</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span>
    <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> that <span class=keyword1><span class=command>have</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≤</span> word_of_int <span class=main>(</span>uint <span class=main>(</span>word_of_int <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> f2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>ia</span><span class=main>.</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>+</span> <span class=main>-</span> <span class=main>1</span> <span class=main>*</span> <span class=bound>ia</span> <span class=main>∧</span> <span class=bound>i</span> <span class=keyword1>mod</span> <span class=bound>ia</span> <span class=main>≠</span> <span class=bound>i</span><span class=main>)</span> <span class=main>∨</span>
            <span class=main>¬</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>1</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>∨</span>
            <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span>
              <span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>ia</span><span class=main>.</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>+</span> <span class=main>-</span> <span class=main>1</span> <span class=main>*</span> <span class=bound>ia</span> <span class=main>∧</span> <span class=bound>i</span> <span class=keyword1>mod</span> <span class=bound>ia</span> <span class=main>≠</span> <span class=bound>i</span><span class=main>)</span> <span class=main>∨</span>
            <span class=main>¬</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>∨</span>
            <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> f3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span> <span class=bound>ia</span><span class=main>.</span> <span class=main>¬</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>∨</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>i</span> <span class=main>+</span> <span class=main>-</span> <span class=main>1</span> <span class=main>*</span> <span class=bound>ia</span> <span class=main>∨</span> <span class=bound>i</span> <span class=keyword1>mod</span> <span class=bound>ia</span> <span class=main>=</span> <span class=bound>i</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mod_pos_pos_trivial <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> f3 f2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> f4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
  <span class=keyword1><span class=command>have</span></span> f5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> word_of_int <span class=main>(</span>uint <span class=main>(</span>word_of_int <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a1 <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> f6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>have</span></span> f7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>*</span> <span class=main>1</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x0</span> <span class=bound>x1</span><span class=main>.</span> <span class=main>(</span><span class=bound>x1</span><span class=main>::</span>int<span class=main>)</span> <span class=main>-</span> <span class=bound>x0</span> <span class=main>=</span> <span class=bound>x1</span> <span class=main>+</span> <span class=main>-</span> <span class=main>1</span> <span class=main>*</span> <span class=bound>x0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> f7 f6 f5 f4 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> uint_word_of_int wi_homs<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> word_arith_wis<span class=main><span class=main>(</span></span>8<span class=main><span class=main>)</span></span> word_of_int_2p<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹uint <span class=free>x</span> <span class=main>≤</span> uint <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_def<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹uint <span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span>
      <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹uint <span class=free>x</span> <span class=main>≤</span> uint <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>›</span></span> linorder_not_less lt2p_lem uint_1 uint_minus_simple_alt uint_power_lower word_le_def zle_diff1_eq<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_ubin.eq_norm bintrunc_mod2p unsigned_ucast_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span> and_mask_eq_iff_le_mask mask_eq_decr_exp take_bit_eq_mask<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> remdups_enum_upto<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"remdups <span class=main>[</span><span class=free>s</span> <span class=keyword1>.e.</span> <span class=free>e</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>s</span> <span class=keyword1>.e.</span> <span class=free>e</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> card_enum_upto<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>set <span class=main>[</span><span class=free>s</span> <span class=keyword1>.e.</span> <span class=free>e</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>unat <span class=free>e</span><span class=main>)</span> <span class=main>-</span> unat <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> List.card_set<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remdups_enum_upto<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> complement_nth_w2p<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>!!</span> <span class=free>n'</span> <span class=main>=</span> <span class=main>(</span><span class=free>n'</span> <span class=main>≠</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ops_nth_size word_size nth_w2p<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_unat_and_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∨</span> unat <span class=free>y</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_less_trans word_and_le1 word_and_le2 word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_unat_mask_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> size <span class=free>w</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_unat_and_lt<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_mask word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_shiftr_less_t2n<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_div_2n' power_add mult.commute less_mult_imp_div_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_or_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≤</span> <span class=free>w'</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>OR</span> mask <span class=free>x</span> <span class=main>≤</span> <span class=free>w'</span> <span class=keyword1>OR</span> mask <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=free>w'</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> neg_mask_add_mask add.commute le_word_or1 mask_2pm1 neg_mask_mono_le word_plus_mono_left<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_shiftr1'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> shiftr1 <span class=free>u</span> <span class=main>≤</span> shiftr1 <span class=free>v</span> <span class=main>;</span> shiftr1 <span class=free>u</span> <span class=main>≠</span> shiftr1 <span class=free>v</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>u</span> <span class=main>≤</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> le_shiftr'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>u</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>v</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>;</span> <span class=free>u</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=free>v</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>u</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span>shiftr1 <span class=main>^^</span> <span class=improper>n</span><span class=main>)</span> <span class=free>u</span> <span class=main>=</span> <span class=main>(</span>shiftr1 <span class=main>^^</span> <span class=improper>n</span><span class=main>)</span> <span class=free>v</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> le_shiftr1'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_no_overflow<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> max_word <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> less_x_plus_1 order_less_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> lt_plus_1_le_word<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> bound<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> unat <span class=main>(</span>maxBound<span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>+</span> of_nat <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> of_nat <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute bound max_word_max word_Suc_leq word_not_le word_of_nat_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_up_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ucast_eq unat_eq_nat_uint
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> int_word_uint<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_pos_pos_trivial<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> lt2p_lem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_less_no_overflow<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> unat <span class=free>f</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&lt;</span> of_nat <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span>  order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ of_nat_mono_maybe<span class=main><span class=main>,</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_less_no_overflow_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>unat <span class=free>f</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&lt;</span> of_nat <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unat_less_helper unat_ucast_less_no_overflow <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_no_overflow_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> no_overflow<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>b</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> upward_cast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>unat <span class=free>f</span> <span class=main>&lt;</span> unat <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> LR<span class=main>:</span> <span class=quoted><span class=quoted>"ucast <span class=free>f</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> unat <span class=free>f</span> <span class=main>&lt;</span> unat <span class=free>b</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>ucast_nat_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> <span class=tfree>'b1</span> <span class=main><span class=main>=</span></span> <span class=tfree><span class=quoted><span class=tfree>'b</span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span>  ucast_less_ucast<span class=main><span class=main>[</span></span><span class=operator>OF</span> order.strict_implies_order<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> upward_cast<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_ucast_mask less_mask_eq word_less_nat_alt
                     unat_power_lower<span class=main><span class=main>[</span></span><span class=operator>OF</span> upward_cast<span class=main><span class=main>]</span></span> no_overflow<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>have</span></span> RL<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>f</span> <span class=main>&lt;</span> unat <span class=free>b</span> <span class=main>⟹</span> ucast <span class=free>f</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> ineq<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>f</span> <span class=main>&lt;</span> unat <span class=free>b</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span>ucast <span class=free>b</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_less_ucast<span class=main><span class=main>[</span></span><span class=operator>OF</span> order.strict_implies_order<span class=main><span class=main>]</span></span> upward_cast<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> ucast_nat_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_ucast_less_no_overflow<span class=main><span class=main>[</span></span><span class=operator>OF</span> no_overflow ineq<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>ucast_ucast_mask word_and_le2<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>RL LR iffI<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> ucast_up_mono <span class=main>=</span> ucast_less_ucast<span class=main>[</span><span class=operator>THEN</span> iffD2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> minus_one_word<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> mask_exceed<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_not_mask shiftr_eq_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_shift_by_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>4</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_2p_upper_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>p</span> <span class=main>!!</span> <span class=bound>n'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> upper_bits_unset_is_l2p<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le2p_bits_unset<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound><span class=bound>n'</span></span><span class=main>≥</span><span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=bound>n'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> upper_bits_unset_is_l2p <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> p<span class=main><span class=main>=</span></span><span class=quoted><span class=free>p</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_less_shiftl_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span>
    <span class=main>⟹</span> <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> ucast_less<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> shiftl_t2n <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_less_power_trans2<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_power_nonzero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_mask_eq_iff_shiftr_0 less_mask_eq p2_gt_0 semiring_normalization_rules<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span>
            shiftl_shiftr_id shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> less_1_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>::</span> int<span class=main>)</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> div_power_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_uint.Rep_eqD<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> uint_word_ariths uint_div uint_power_lower<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_pos_pos_trivial<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_pos_pos_trivial<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_diff_eq uint_2p_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_1_helper<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_increasing<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_pos_pos_trivial<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_2p_alt<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_1_helper<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_increasing<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> int_div_sub_1<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_2p_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_0<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uint_2p_alt le_imp_power_dvd power_diff_power_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_add_power_off<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> ak<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> kw<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> mw<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> off<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>off</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>)</span> <span class=main>+</span> <span class=free>off</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> off ak <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False

  <span class=keyword1><span class=command>from</span></span> ak <span class=keyword1><span class=command>have</span></span> ak1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inc_le<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_power_nonzero<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans  <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ kw<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mw<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_is_non_zero_p1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> ak<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>)</span> <span class=main>+</span> <span class=free>off</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> kw mw
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> distrib_right<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_strict_mono_right <span class=main><span class=main>[</span></span><span class=operator>OF</span> off<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_overflow''<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_mult_triv2<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> ak1 mw kw False
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_mult_le_mono1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> p2_gt_0<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> nat_mult_power_less_eq zero_less_numeral<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> offset_not_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>p</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>i</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>;</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span>
   <span class=main>¬</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>+</span> of_nat <span class=free>i</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_add_not_aligned<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_iff_udvd<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bintrunc_bintrunc_ge int_ops<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nat_int_comparison<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nat_less_le take_bit_eq_0_iff take_bit_nat_eq_self_iff take_bit_of_nat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> length_upto_enum_one<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lt1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> lt2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> lt3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=main>,</span> <span class=free>y</span> <span class=keyword1>.e.</span> <span class=free>z</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> upto_enum_step_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_red<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> if_not_P <span class=main><span class=main>[</span></span><span class=operator>OF</span> leD <span class=main><span class=main>[</span></span><span class=operator>OF</span> lt3<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>subst</span> unat_div<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> div_less<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> syx<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>y</span> <span class=main>-</span> unat <span class=free>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> unat_sub <span class=main><span class=main>[</span></span><span class=operator>OF</span> order_less_imp_le<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>fact</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>z</span> <span class=main>-</span> unat <span class=free>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> unat_sub<span class=main>)</span> <span class=operator>fact</span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>&lt;</span> unat <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> lt2 lt3 unat_mono word_less_minus_mono_left <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_zero_left unat_0 word_unat.Rep_eqD<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> max_word_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>max_word <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mask_eq_decr_exp <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> mask_len_max <span class=main>=</span> max_word_mask<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> mask_out_first_mask_some<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_lower_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_lower_twice2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span>max <span class=free>n</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_and_neg_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> ucast <span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_and_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> ucast <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_mask_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* negating a mask which has been shifted to the very left *)</span>
<span class=keyword1><span class=command>lemma</span></span> NOT_mask_shifted_lenword<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>len</span> <span class=main>&lt;&lt;</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_word_eq word_size bit_not_iff bit_push_bit_iff bit_mask_iff<span class=main>)</span>

<span class=comment1>(* Comparisons between different word sizes. *)</span>

<span class=keyword1><span class=command>lemma</span></span> eq_ucast_ucast_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> ucast <span class=free>y</span> <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> le_ucast_ucast_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> ucast <span class=free>y</span> <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> le_unat_uoi linorder_not_less order_less_imp_le ucast_nat_def unat_arith_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> less_ucast_ucast_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> ucast <span class=free>y</span> <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ucast_nat_def unat_mono unat_ucast_up_simp word_of_nat_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_le_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_arith_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> unat_ucast_up_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> ucast_up_mono_le <span class=main>=</span> ucast_le_ucast<span class=main>[</span><span class=operator>THEN</span> iffD2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_le_ucast_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> n<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=free>x</span> <span class=main>≤</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> less_mask_eq<span class=main><span class=main>[</span></span><span class=operator>OF</span> x<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> less_mask_eq<span class=main><span class=main>[</span></span><span class=operator>OF</span> y<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> n<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_ucast_mask<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_le_ucast<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> ucast_mono_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ y<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> n<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_or_distrib<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=keyword1>OR</span> <span class=free>y</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>x</span> <span class=keyword1>OR</span> ucast <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> div_le_dividend le_less_trans shiftr_div_2n' unat_arith_simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_notzeroD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> <span class=free>w'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>w'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word_exists_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>i</span><span class=main>.</span> <span class=free>w</span> <span class=main>!!</span> <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff test_bit_word_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_le_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_unat.Rep_eqD<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_div_2n'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>of_nat <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_nat <span class=free>x</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> of_nat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>*</span> of_nat <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> shiftl_t2n <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_unat_power<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_1_not_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> max_word_not_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>1</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_zero_is_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span> is_aligned <span class=free>w</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_aligned_mask word_eq_iff word_size nth_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_eq_unat_and_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>w</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_max_word_pos<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> unat <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unat_gt_0 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=comment1>(* Miscellaneous conditional injectivity rules. *)</span>

<span class=keyword1><span class=command>lemma</span></span> mult_pow2_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> ws<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> mask <span class=free>m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> mask <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>from</span></span> eq <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹push_bit <span class=free>n</span> <span class=free>x</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=free>y</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> push_bit_eq_mult<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> le <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=free>m</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=free>m</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_eq_mask_iff_take_bit_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹push_bit <span class=free>n</span> <span class=main>(</span>take_bit <span class=free>m</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> push_bit <span class=free>n</span> <span class=main>(</span>take_bit <span class=free>m</span> <span class=free>y</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> ws <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>x</span> <span class=skolem>q</span> <span class=main>⟷</span> bit <span class=free>y</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> push_bit_take_bit<span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> bit_eq_iff
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=free>m</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=quoted><span class=quoted>‹take_bit <span class=free>m</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y</span>›</span></span> add.commute add_diff_cancel_right' add_less_cancel_right bit_take_bit_iff le_add2 less_le_trans<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_of_nat_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> bounded<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> of_nats<span class=main>:</span> <span class=quoted><span class=quoted>"of_nat <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> contrapos_pp<span class=main><span class=main>[</span></span><span class=operator>OF</span> of_nats<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> bounded<span class=main><span class=main>[</span></span><span class=operator>THEN</span> of_nat_mono_maybe<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=comment1>(* Uints *)</span>

<span class=keyword1><span class=command>lemma</span></span> uints_mono_iff<span class=main>:</span> <span class=quoted><span class=quoted>"uints <span class=free>l</span> <span class=main>⊆</span> uints <span class=free>m</span> <span class=main>⟷</span> <span class=free>l</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> power_increasing_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>::</span>int"</span></span> <span class=quoted><span class=free>l</span></span> <span class=quoted><span class=free>m</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uints_num subset_iff <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> power_increasing_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> less_irrefl not_le zero_le_numeral zero_le_power<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> uints_monoI <span class=main>=</span> uints_mono_iff<span class=main>[</span><span class=operator>THEN</span> iffD2<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_in_uints_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"of_bool <span class=free>c</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>w</span> <span class=main>∈</span> uints <span class=main>(</span>Suc <span class=free>m</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>∈</span> uints <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> that
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uints_num<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Bit_in_uintsI<span class=main>:</span> <span class=quoted><span class=quoted>"of_bool <span class=free>c</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>w</span> <span class=main>∈</span> uints <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>∈</span> uints <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Bit_in_uints_Suc<span class=main>[</span><span class=operator>OF</span> that<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> that<span class=main>(</span>2<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_in_uintsI<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>∈</span> uints <span class=free>m</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>∈</span> uints <span class=free>l</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>≥</span> <span class=free>l</span> <span class=main>+</span> <span class=free>n</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>≥</span> <span class=free>l</span> <span class=main>+</span> <span class=free>n</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>=</span> <span class=free>l</span> <span class=main>+</span> <span class=free>n</span> <span class=main>+</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> le_Suc_ex <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=numeral>2</span><span class=main>::</span>int<span class=main>)</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>l</span> <span class=main>+</span> <span class=skolem>q</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>l</span> <span class=main>+</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>∈</span> uints <span class=free>l</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uints_def take_bit_eq_mod power_add Divides.mod_mult2_eq<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹concat_bit <span class=free>n</span> <span class=free>b</span> <span class=free>a</span> <span class=main>=</span> take_bit <span class=free>m</span> <span class=main>(</span>concat_bit <span class=free>n</span> <span class=free>b</span> <span class=free>a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> concat_bit_eq take_bit_eq_mod push_bit_eq_mult Divides.mod_mult2_eq<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uints_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_cong<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> bin_cat <span class=free>c</span> <span class=free>m</span> <span class=free>d</span>"</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=free>m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>c</span>"</span></span> <span class=quoted><span class=quoted>"bintrunc <span class=free>m</span> <span class=free>b</span> <span class=main>=</span> bintrunc <span class=free>m</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> that<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> that<span class=main>(</span>1<span class=main>,</span>2<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_cat_eq_push_bit_add_take_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_eqD1<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> bin_cat <span class=free>c</span> <span class=free>n</span> <span class=free>d</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> drop_bit_bin_cat_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_eqD2<span class=main>:</span> <span class=quoted><span class=quoted>"bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> bin_cat <span class=free>c</span> <span class=free>n</span> <span class=free>d</span> <span class=main>⟹</span> bintrunc <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> take_bit_bin_cat_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> bin_cat_inj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>bin_cat <span class=free>a</span> <span class=free>n</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> bin_cat <span class=free>c</span> <span class=free>n</span> <span class=free>d</span> <span class=main>⟷</span> <span class=free>a</span> <span class=main>=</span> <span class=free>c</span> <span class=main>∧</span> bintrunc <span class=free>n</span> <span class=free>b</span> <span class=main>=</span> bintrunc <span class=free>n</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> bin_cat_cong bin_cat_eqD1 bin_cat_eqD2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_of_int_bin_cat_eq_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=main>(</span>bin_cat <span class=main>(</span>uint <span class=free>a</span><span class=main>)</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span>
  word_of_int <span class=main>(</span>bin_cat <span class=main>(</span>uint <span class=free>c</span><span class=main>)</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>(</span>uint <span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>b</span> <span class=main>=</span> <span class=free>d</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'c</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>b</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> word_uint.Abs_inject<span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> bin_cat_inj <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> that bin_cat_in_uintsI<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_cat_inj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>word_cat <span class=free>a</span> <span class=free>b</span><span class=main>::</span><span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> word_cat <span class=free>c</span> <span class=free>d</span> <span class=main>⟷</span> <span class=free>a</span> <span class=main>=</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> <span class=free>d</span>"</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'c</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>b</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_of_int_bin_cat_eq_iff <span class=main>[</span><span class=operator>OF</span> that<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>d</span></span> <span class=quoted><span class=free>c</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> p2_eq_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def not_less one_less_numeral_iff p2_eq_0 p2_gt_0 power_0 power_0
        power_inject_exp semiring_norm<span class=main><span class=main>(</span></span>76<span class=main><span class=main>)</span></span> unat_power_lower zero_neq_one<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* usually: x,y = (len_of TYPE ('a)) *)</span>
<span class=keyword1><span class=command>lemma</span></span> bitmagic_zeroLast_leq_or1Last<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=free>len</span> <span class=main>&lt;&lt;</span> <span class=free>x</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_word_or2 order_trans word_and_le2<span class=main>)</span>


<span class=keyword1><span class=command>lemma</span></span> zero_base_lsb_imp_set_eq_as_bit_operation<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>base</span> <span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> valid_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>base</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>base</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>a</span><span class=main>)</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=free>a</span> <span class=main>∈</span> <span class=main>{</span><span class=free>base</span> <span class=main>..</span> <span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>have</span></span> helper3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=keyword1>OR</span> <span class=skolem>y</span> <span class=main>=</span> <span class=skolem>x</span> <span class=keyword1>OR</span> <span class=skolem>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=skolem>x</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_oa_dist2<span class=main>)</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>a</span> <span class=main>⟹</span>
                    <span class=free>a</span> <span class=main>∈</span> <span class=main>{</span><span class=free>base</span><span class=main>..</span><span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_and_le1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span><span class=main>(</span><span class=operator>metis</span> helper3 le_word_or2 word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_bw_comms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=main>{</span><span class=free>base</span><span class=main>..</span><span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> f2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>.</span> <span class=free>base</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> a neg_mask_mono_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> f3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>.</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>0</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> a neg_mask_mono_le <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> f4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=free>base</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> valid_prefix <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mask_eq_0_eq_x word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> f5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x<span class=hidden>⇩</span><sub>6</sub></span><span class=main>.</span> <span class=main>(</span><span class=free>base</span> <span class=keyword1>OR</span> <span class=bound>x<span class=hidden>⇩</span><sub>6</sub></span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
                      <span class=free>base</span> <span class=keyword1>OR</span> <span class=bound>x<span class=hidden>⇩</span><sub>6</sub></span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> word_ao_dist <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> f6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x<span class=hidden>⇩</span><sub>2</sub></span> <span class=bound>x<span class=hidden>⇩</span><sub>3</sub></span><span class=main>.</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>≤</span> <span class=bound>x<span class=hidden>⇩</span><sub>3</sub></span> <span class=main>∨</span>
                      <span class=main>¬</span> <span class=main>(</span><span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=bound>x<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>≤</span> <span class=bound>x<span class=hidden>⇩</span><sub>3</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> f3 dual_order.trans <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=main>(</span><span class=free>base</span> <span class=keyword1>OR</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> f5 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> f2 f4 f6 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_iff<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>base</span> <span class=main>=</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>len</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>a</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_eq_signed_scast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>of_nat <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> signed word<span class=main>)</span><span class=main>)</span>
   <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_of_nat scast_scast_id<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_aligned_add_no_wrap_bounded<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>w</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>w</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>n</span> <span class=main>≠</span> <span class=main>0</span><span class=main>;</span> is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> is_aligned_no_overflow le_less_trans word_leq_le_minus_one<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_Suc<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_mono<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz'</span> <span class=main>≤</span> <span class=free>sz</span> <span class=main>⟹</span> mask <span class=free>sz'</span> <span class=main>≤</span> <span class=main>(</span>mask <span class=free>sz</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_mask_iff shiftr_mask_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_disjoint<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_zero_eq is_aligned_mask le_mask_imp_and_mask word_bw_lcs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_or_mask_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>a</span> <span class=free>n</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> aligned_mask_disjoint word_plus_and_or_coroll<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_or_mask_aligned2<span class=main>:</span>
  <span class=quoted><span class=quoted>‹is_aligned <span class=free>b</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>OR</span> <span class=free>b</span>›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_and_or_mask_aligned <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_ucastI<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>n</span> <span class=main>⟹</span> is_aligned <span class=main>(</span>ucast <span class=free>w</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bintrunc_bintrunc_ge bintrunc_n_0 nat_less_le not_le take_bit_eq_0_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_le_maskI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> mask <span class=free>n</span> <span class=main>⟹</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>a</span> <span class=main>≤</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_mask_eq_iff_le_mask ucast_and_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_add_mask_aligned<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> mask <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>b</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span> <span class=main>+</span> ucast <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute is_aligned_ucastI ucast_le_maskI ucast_or_distrib word_and_or_mask_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> ucast <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_leq_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> ucast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≤</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_eq_mask_iff_take_bit_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftl_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span><span class=free>n</span><span class=main>)</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>-</span><span class=free>n</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>word_eqI</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=improper>n'</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute add.right_neutral diff_add_inverse le_diff_conv linorder_not_less zero_order<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> distinct_word_add_ucast_shift_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>off</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>+</span> <span class=main>(</span>ucast <span class=free>off'</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span><span class=main>;</span>
     is_aligned <span class=free>p</span> <span class=free>n'</span><span class=main>;</span> is_aligned <span class=free>p'</span> <span class=free>n'</span><span class=main>;</span> <span class=free>n'</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>n'</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>p'</span> <span class=main>=</span> <span class=free>p</span> <span class=main>∧</span> <span class=free>off'</span> <span class=main>=</span> <span class=free>off</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_and_or_mask_aligned le_mask_shiftl_le_mask<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main><span class=main>]</span></span>
                   ucast_leq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_nth<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main><span class=keyword3>;</span></span> <span class=operator>word_eqI</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute test_bit_conj_lt diff_add_inverse le_diff_conv nat_less_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> i<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>i</span><span class=main>+</span><span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_upto_Nil<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_red not_le word_less_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_enum_decomp_elem<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>]</span> <span class=main>=</span> <span class=free>as</span> <span class=main>@</span> <span class=free>a</span> <span class=main>#</span> <span class=free>bs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>as</span> <span class=main>⊆</span> set <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> set <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted>set</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> max_word_not_less<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=main>¬</span> max_word <span class=main>&lt;</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_enum_prefix<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>]</span> <span class=main>=</span> <span class=free>as</span> <span class=main>@</span> <span class=free>a</span> <span class=main>#</span> <span class=free>bs</span> <span class=main>⟹</span> <span class=free>as</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=keyword1>then</span> <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span> <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>as</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>x</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> dual_order.not_eq_order_implies_strict<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_upto_Nil<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_upto_Cons_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> dual_order.not_eq_order_implies_strict<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_upto_Nil<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_upto_Cons_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> word_enum_decomp_elem<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_Suc_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> meta_spec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> meta_mp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> word_upto_Cons_eq<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_enum_decomp_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>]</span> <span class=main>=</span> <span class=free>as</span> <span class=main>@</span> <span class=free>a</span> <span class=main>#</span> <span class=free>bs</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>∉</span> set <span class=free>as</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> distinct_append distinct_enum_upto' not_distinct_conv_prefix<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_enum_decomp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>]</span> <span class=main>=</span> <span class=free>as</span> <span class=main>@</span> <span class=free>a</span> <span class=main>#</span> <span class=free>bs</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>∉</span> set <span class=free>as</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>z</span> <span class=main>∈</span> set <span class=free>as</span><span class=main>.</span> <span class=free>x</span> <span class=main>≤</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>z</span> <span class=main>≤</span> <span class=free>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=free>as</span> <span class=main>⊆</span> set <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span> <span class=main>∧</span> <span class=free>a</span> <span class=main>∈</span> set <span class=main>[</span><span class=free>x</span> <span class=keyword1>.e.</span> <span class=free>y</span><span class=main>]</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted>set</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> word_enum_decomp_set<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_unat_le_mask_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>of_nat <span class=main>(</span>unat <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>=</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> ucast_nat_def ucast_ucast_mask <span class=quasi_keyword>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> and_mask_eq_iff_le_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> less_diff_gt0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemma</span></span> unat_plus_gt<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>≤</span> unat <span class=free>a</span> <span class=main>+</span> unat <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> unat_plus_if_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> const_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>≠</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_1_simp word_le_less_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> add_mult_aligned_neg_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=free>y</span> <span class=main>*</span> <span class=free>m</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>m</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span>
    add.assoc add.commute add.right_neutral add_uminus_conv_diff
   mask_eq_decr_exp mask_eqs<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> mask_eqs<span class=main><span class=main>(</span></span>6<span class=main><span class=main>)</span></span> mult.commute mult_zero_left
   subtract_mask<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> that<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_minus_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span>of_nat <span class=free>n</span><span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_diff unat_eq_of_nat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_eq_zeroI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_must_wrap<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_add_format<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len  word<span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=free>b</span> <span class=main>+</span> <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_word_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> unat <span class=main>(</span><span class=free>j</span> <span class=main>-</span> <span class=free>i</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>[</span><span class=free>i</span> <span class=keyword1>.e.</span> <span class=free>j</span><span class=main>]</span> <span class=main>!</span> <span class=free>k</span> <span class=main>=</span> <span class=free>i</span> <span class=main>+</span> of_nat <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_def nth_append<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_le_nat_alt<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> toEnum_of_nat<span class=main><span class=keyword3>,</span></span> <span class=operator>unat_arith</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> not_less unat_sub<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_step_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> unat <span class=main>(</span><span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>[</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span> <span class=keyword1>.e.</span> <span class=free>c</span><span class=main>]</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span> <span class=main>+</span> of_nat <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_step_def not_less<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> upto_enum_word_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_inc_1_len<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟹</span> <span class=main>[</span><span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>.e.</span> <span class=main>1</span> <span class=main>+</span> <span class=free>a</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span> <span class=keyword1>.e.</span> <span class=free>a</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=main>1</span> <span class=main>+</span> <span class=free>a</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_word<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> unat <span class=free>a</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_plus_simple<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> add.commute no_plus_overflow_neg olen_add_eqv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>unat_arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mask_out_sub_mask mask_eqs<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mask_twice<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_shiftl_shiftr<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>  <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> add_right_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> no_olen_add_nat is_aligned_mask<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_arith_simps shiftr_div_2n' <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> if_P<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_div_2n' is_aligned_iff_dvd_nat<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sub_right_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> add_right_shift<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>-</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=free>y</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=free>n</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> aligned_sub_aligned is_aligned_mask<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> word_sub_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_and_mask_simple<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> mask <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_and_mask_simple_not<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_le'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_and_le1 order_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_and_less'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_w2p<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> t2p_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> scast_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len signed word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unsigned_uminus1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>(</span>unsigned <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>::</span><span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_mask_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> ucast <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_up_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_up_neq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> ucast <span class=free>x</span> <span class=main>≠</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span><span class=main>;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> ucast <span class=free>x</span> <span class=main>≠</span> <span class=main>(</span>ucast <span class=free>y</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ucast_up_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_AND_less_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mask_twice2 word_and_notzeroD<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_len_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> uint_lt2p <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_down_same<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=keyword1>SCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> down_cast_same is_down<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_aligned_0_sum<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> mask <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_plus_and_or_coroll aligned_mask_disjoint word_or_zero<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq1_nochoice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span><span class=main>;</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> word_and_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_and_eq_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>w</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> and_not_mask bit.conj_ac<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> bit.conj_ac<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> mask_eq_0_eq_x shiftl_mask_is_0 shiftl_over_and_dist<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> add_mask_lower_bits'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>len</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span>
     <span class=main>∀</span><span class=bound><span class=bound>n'</span></span> <span class=main>≥</span> <span class=free>n</span><span class=main>.</span> <span class=bound>n'</span> <span class=main>&lt;</span> <span class=free>len</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>p</span> <span class=main>!!</span> <span class=bound>n'</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> add_mask_lower_bits <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> leq_mask_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> mask <span class=main>(</span><span class=free>low_bits</span> <span class=main>+</span> <span class=free>high_bits</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span><span class=main>)</span> <span class=main>≤</span> mask <span class=free>high_bits</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_mask_iff shiftr_shiftr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_eq_mask_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> mask <span class=main>(</span><span class=free>low_bits</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>
   <span class=main>⟹</span> ucast<span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> and_mask_eq_iff_le_mask eq_ucast_ucast_eq not_le_imp_less shiftr_less_t2n'
            ucast_ucast_len<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> const_le_unat<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> of_nat <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>≤</span> unat <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> uint_nat zle_int<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_nat_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upt_enum_offset_trivial<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> unat <span class=free>x</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=main>[</span><span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>.e.</span> <span class=free>x</span><span class=main>]</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> of_nat <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>x</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_word_nth<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_le_mask_out_plus_2sz<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_diff_eq word_neg_and_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span> <span class=main>+</span> <span class=main>(</span>ucast <span class=free>b</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> signed word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_add<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span> <span class=main>-</span> <span class=main>(</span>ucast <span class=free>b</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> signed word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> ucast_add<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>b</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> add_diff_eq diff_add_cancel ucast_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_add_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_1<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ucast_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_and_le_plus_one<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> gt0_iff_gem1 word_and_less'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_ucast_then_shift_eq_unat_of_shift<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_div_2n' unat_ucast_up_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_ucast_then_mask_eq_unat_of_mask<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ucast_and_mask unat_ucast_up_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_less_t2n3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> shiftr_less_t2n' <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp power_overflow<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_shiftr_le_bound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>bnd</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>bnd</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_bit_take_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>defer</span></span></span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_le_iff of_nat_diff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_eqD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>y</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>x</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>y</span> <span class=free>n</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_aligned_shiftr_shiftl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_shiftr_shiftl_shiftr_eq_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≥</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_shift multi_shift_simps<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span> shiftr_shiftr<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_int_uint_ucast<span class=main>:</span>
   <span class=quoted><span class=quoted>"of_int <span class=main>(</span>uint <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> Word.of_int_uint<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mod_mask_drop<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> mask <span class=free>n</span> <span class=keyword1>AND</span> <span class=free>msk</span> <span class=main>=</span> mask <span class=free>n</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>msk</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_mod_2p_is_mask word_bw_assocs<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq_ucast_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'c</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span><span class=main>;</span>
     <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>⟧</span>
    <span class=main>⟹</span> ucast <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ucast_and_mask ucast_id ucast_ucast_mask ucast_up_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat_less_t2n<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_nat <span class=free>i</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>∧</span> unat <span class=main>(</span>of_nat <span class=free>i</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> order_less_trans p2_gt_0 unat_less_power word_neq_0_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> two_power_increasing_less_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_diff_cancel le_m1_iff_lt less_imp_diff_less p2_gt_0 two_power_increasing
            word_1_le_power word_le_minus_mono_left word_less_sub_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_sub_mono4<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>y</span> <span class=main>+</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>+</span> <span class=free>x</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>+</span> <span class=free>x</span><span class=main>;</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>+</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_add_le_iff2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> eq_or_less_helperD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>=</span> unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>&lt;</span> unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> le_less_trans nat_less_le unat_less_power word_power_less_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_sub<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> mask <span class=free>m</span> <span class=main>-</span> mask <span class=free>n</span> <span class=main>=</span> mask <span class=free>m</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> and_mask_eq_iff_shiftr_0 mask_out_sub_mask shiftr_mask_le word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_diff_bound<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz'</span><span class=main>≤</span> <span class=free>sz</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz'</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz'</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⟹</span> <span class=var>?lhs</span> <span class=main>≤</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>ptr</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz'</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=free>ptr</span> <span class=keyword1>AND</span> <span class=main>(</span>mask <span class=free>sz</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_diff_cancel_left' multiple_mask_trivia<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> <span class=var>?rhs</span>"</span></span> <span class=keyword1><span class=command>using</span></span> lt
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>)</span></span> add_diff_eq diff_eq_eq eq_iff mask_2pm1 mask_sub word_and_le'<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_out_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>idx</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span><span class=main>;</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>of_nat <span class=free>idx</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_power less_mask_eq mask_eq_0_eq_x<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_neg_mask_eq'<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>sz</span> <span class=main>=</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span> <span class=main>=</span> <span class=free>ptr</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_aligned_mask mask_eq_0_eq_x <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_mask_unat<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span><span class=free>ptr</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> unat <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> mask <span class=free>sz</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>ptr</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> AND_NOT_mask_plus_AND_mask_eq unat_plus_simple word_and_le2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_pow_le_intro<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> lt2p_lem not_le of_nat_le_iff of_nat_numeral semiring_1_class.of_nat_power uint_nat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_shiftl_less_t2n<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> of_nat_power diff_le_self le_less_trans shiftl_less_t2n
                       unat_less_power word_unat.Rep_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_is_aligned_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> unat <span class=free>d</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>⟧</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=keyword1>AND</span> mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>d</span> <span class=main>∧</span> unat <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>d</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> unat <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral and_mask_eq_iff_le_mask and_not_mask le_mask_iff mask_add_aligned
            mask_out_add_aligned mult_zero_right shiftl_t2n shiftr_le_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_shiftr_shiftl_mask_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>c</span> <span class=main>+</span> <span class=free>a</span> <span class=main>≥</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=main>;</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>q</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> unat_is_aligned_add<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> p<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>c</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> conjunct2<span class=main><span class=main>]</span></span>
                       unat_shiftl_less_t2n unat_shiftr_less_t2n unat_pow_le_intro<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> of_nat_ucast <span class=main>=</span> ucast_of_nat<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> shift_then_mask_eq_shift_low_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> mask <span class=main>(</span><span class=free>low_bits</span> <span class=main>+</span> <span class=free>high_bits</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>high_bits</span> <span class=main>=</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> leq_mask_shift le_mask_imp_and_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> leq_low_bits_iff_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> mask <span class=main>(</span><span class=free>low</span> <span class=free>bits</span> <span class=main>+</span> <span class=free>high</span> <span class=free>bits</span><span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>low_bits</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>low_bits</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> and_mask_eq_iff_shiftr_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> unat <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=free>b</span><span class=main>;</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> of_nat <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unat_ucast_less_no_overflow_simp <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_no_overflow3<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> <span class=free>c</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>;</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>+</span> <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> is_aligned_no_wrap' le_m1_iff_lt not_le word_less_sub_1 word_plus_mono_right<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_add_aligned_right<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>q</span> <span class=main>+</span> <span class=free>p</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>=</span> <span class=free>q</span> <span class=keyword1>AND</span> mask <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_add_aligned add.commute<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> leq_high_bits_shiftr_low_bits_leq_bits_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> mask <span class=free>high_bits</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>low_bits</span> <span class=main>≤</span> mask <span class=main>(</span><span class=free>low_bits</span> <span class=main>+</span> <span class=free>high_bits</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> le_mask_shiftl_le_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_two_power_neg_ineq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>⟹</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≤</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt unat_minus word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> power_increasing<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>2</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>n</span></span><span class=main><span class=main>]</span></span> power_increasing<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>2</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> add_le_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_shiftl_absorb<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>p</span><span class=main>;</span> <span class=free>p</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> add_diff_cancel_right' add_lessD1 le_add2 le_less_trans mult.commute nat_le_power_trans
          unat_lt2p unat_mult_lem unat_power_lower word_le_nat_alt<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_plus_mono_right_split<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> unat <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>sz</span><span class=main>)</span> <span class=main>+</span> unat <span class=free>z</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span><span class=main>;</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>sz</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>sz</span><span class=main>)</span> <span class=main>+</span> <span class=free>z</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>word_plus_and_or_coroll2 <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_le_trans no_olen_add_nat<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> of_nat_power is_aligned_no_wrap' <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>lemma</span></span> mul_not_mask_eq_neg_shiftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> NOT_mask shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_mul_not_mask_eq_and_not_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>*</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> NOT_mask and_not_mask mult_minus_left semiring_normalization_rules<span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_eq_n1_shiftr<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span>mask <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>&gt;&gt;</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_diff_cancel eq_refl mask_full shiftr_mask2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_mask_out_add_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_out_sub_mask mask_add_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> is_aligned_mask_out_add_eq_sub
    <span class=main>=</span> is_aligned_mask_out_add_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>-</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=free>a</span> <span class=free>b</span><span class=main>,</span> <span class=operator>simplified</span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_bump_down<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> is_aligned_mask_out_add_eq<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> NOT_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_2tp_if<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>then</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_of_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"mask <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>mask <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> unat_signed_ucast_less_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>⟹</span> unat <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len signed word<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_ucast_up_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> toEnum_of_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span>
   <span class=main>(</span>toEnum <span class=main>(</span>unat <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> of_nat <span class=main>(</span>unat <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_pow_le_intro<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_ucast_mask <span class=main>=</span> unat_ucast_eq_unat_and_mask<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> w<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=free>a</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> t2n_mask_eq_if<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>AND</span> mask <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size nth_w2p <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_nat_def word_unat_less_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_le_up_down_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>;</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>≤</span> ucast <span class=main>(</span>max_word <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span>ucast <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> ucast <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> le_max_word_ucast_id ucast_le_ucast <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_mask_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span>
   <span class=main>⟹</span> ucast <span class=main>(</span>ucast <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.commute le_mask_iff shiftr_mask_le ucast_ucast_eq_mask_shift word_and_le'<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_mask_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span>
   <span class=main>⟹</span> unat <span class=main>(</span>ucast <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> linear ucast_ucast_mask_shift unat_ucast_up_simp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_overlap_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> NOT_mask_AND_mask mask_lower_twice2 max_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_shifl_overlap_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_mask_0_iff_le_mask mask_mono mask_shiftl_decompose order_trans shiftl_over_and_dist word_and_le' word_and_le2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_overlap_zero'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≥</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> mask_AND_NOT_mask mask_AND_less_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> mask_rshift_mult_eq_rshift_lshift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_t2n<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shift_alignment<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≥</span> <span class=free>b</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>&lt;&lt;</span> <span class=free>a</span><span class=main>)</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_aligned_shift is_aligned_weaken <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> mask_split_sum_twice<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≥</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute multiple_mask_trivia word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_bw_lcs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_plus_and_or_coroll2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_shift_eq_mask_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span> <span class=main>&lt;&lt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_not_mask<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_shift_sum<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≥</span> <span class=free>b</span><span class=main>;</span> unat <span class=free>n</span> <span class=main>=</span> unat <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>b</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>p</span> <span class=keyword1>AND</span> mask <span class=free>a</span> <span class=main>&gt;&gt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> and_not_mask mask_rshift_mult_eq_rshift_lshift mask_split_sum_twice word_unat.Rep_eqD<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_up_compose<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_up <span class=free>uc</span><span class=main>;</span> is_up <span class=free>uc'</span> <span class=main>⟧</span> <span class=main>⟹</span> is_up <span class=main>(</span><span class=free>uc'</span> <span class=main>∘</span> <span class=free>uc</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_up_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Word.target_size Word.source_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> of_int_sint_scast<span class=main>:</span>
  <span class=quoted><span class=quoted>"of_int <span class=main>(</span>sint <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> Word.of_int_sint<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_of_nat_to_signed <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> scast_of_nat_signed_to_unsigned_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>+</span> of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len signed word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>+</span> of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_nat_add scast_of_nat<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_of_nat_unsigned_to_signed_add<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>scast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>+</span> of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>+</span> of_nat <span class=free>y</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len signed word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Abs_fnat_hom_add scast_of_nat_to_signed<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask_cases<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> len<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>∈</span> of_nat <span class=main>`</span> set <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> image_eqI <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>‹unat <span class=main>(</span>take_bit <span class=free>n</span> <span class=free>x</span><span class=main>)</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> len <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sint_eq_uint_2pl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> sint <span class=free>a</span> <span class=main>=</span> uint <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_msb_from_less sint_eq_uint word_2p_lem word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> pow_sub_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>a</span> <span class=main>⟧</span>
   <span class=main>⟹</span> unat <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>b</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>)</span></span> eq_or_less_helperD not_less of_nat_numeral power_add
                        semiring_1_class.of_nat_power unat_pow_le_intro word_unat.Rep_inverse<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sle_le_2pl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>&lt;=s</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_msb_from_less word_sle_msb_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sless_less_2pl<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>&lt;s</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> not_msb_from_less word_sless_msb_less <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> and_mask2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>AND</span> mask <span class=main>(</span>size <span class=free>w</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> size <span class=free>w</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_and_le2 and_mask shiftl_zero_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_sub_aligned_simple<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>a</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>b</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> is_aligned <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> aligned_sub_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> minus_one_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp NOT_eq <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mul_not_mask_eq_neg_shiftl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_eq_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span>
   <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>;</span></span> <span class=operator>word_eqI_solve</span><span class=main>)</span>

<span class=keyword1><span class=command>context</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1><span class=command>lemma</span></span> sbintrunc_uint_ucast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sbintrunc <span class=free>n</span> <span class=main>(</span>uint <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span> <span class=main>=</span> sbintrunc <span class=free>n</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms sbintrunc_bintrunc ucast_eq word_ubin.eq_norm<span class=main>)</span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1><span class=command>lemma</span></span> test_bit_sbintrunc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=main>(</span>sbintrunc <span class=free>n</span> <span class=main>(</span>uint <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>!!</span> <span class=free>i</span>
           <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_sbintr<span class=main>)</span>
                 <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_bin<span class=main>)</span>

<span class=keyword2><span class=keyword>private</span></span> <span class=keyword1><span class=command>lemma</span></span> test_bit_sbintrunc_ucast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> len_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>word_of_int <span class=main>(</span>sbintrunc <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>uint <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>!!</span> <span class=free>i</span>
          <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>≤</span> <span class=free>i</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> sbintrunc_uint_ucast<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> test_bit_sbintrunc<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> len_a<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> if_cong<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ refl refl<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> leD less_linear <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_high_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>‹scast <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>w</span>
     <span class=main>⟷</span> <span class=main>(</span><span class=main>∀</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>{</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>..&lt;</span> size <span class=free>w</span><span class=main>}</span><span class=main>.</span> <span class=free>w</span> <span class=main>!!</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>w</span> <span class=main>!!</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>m</span> <span class=main>+</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_ucast_eq word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_signed_take_bit_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> Suc <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>m</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>m</span> <span class=main>=</span> Suc <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>with</span></span> False <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>=</span> Suc <span class=skolem>q</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>m</span> <span class=main>+</span> <span class=skolem>q</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_ucast_eq word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span> <span class=quasi_keyword>fixing</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>m</span></span> <span class=quoted><span class=skolem>q</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> signed_take_bit_take_bit<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>rule</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> bit_eq_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff bit_signed_take_bit_iff min_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_le_eq<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> less_imp_le_nat <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>using</span></span> less_imp_le_nat <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_mask_compare<span class=main>:</span>
  <span class=quoted><span class=quoted>"scast <span class=main>(</span>ucast <span class=free>w</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=free>w</span>
   <span class=main>⟷</span> <span class=main>(</span><span class=free>w</span> <span class=main>≤</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>∨</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> le_mask_high_bits neg_mask_le_high_bits scast_ucast_high_bits word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> i j<span class=main><span class=keyword3>;</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>i</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=improper><span class=improper>j</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>LENGTH</span></span><span class=main><span class=main>(</span></span><span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>-</span></span> <span class=main><span class=main>1</span></span>"</span></span></span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_less_shiftl_helper'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span> <span class=main>+</span> <span class=free>a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=free>a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> ucast_less<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=tfree><span class=quoted><span class=tfree>'a</span></span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> shiftl_t2n <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_less_power_trans2<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_mask2<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_down <span class=main>(</span><span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
   <span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'b</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'c</span><span class=main>::</span>len<span class=main>)</span> <span class=main>(</span><span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>UCAST</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'c</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI_solve</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_NOT<span class=main>:</span>
  <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span><span class=main>(</span>ucast <span class=free>x</span><span class=main>)</span> <span class=keyword1>AND</span> mask <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_NOT_down<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_down <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len <span class=main>→</span> <span class=tfree>'b</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟹</span> <span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>NOT</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>NOT</span><span class=main>(</span><span class=keyword1>UCAST</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>→</span> <span class=tfree>'b</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_eqI</span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_step_shift<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>[</span><span class=free>p</span> <span class=main>,</span> <span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>.e.</span> <span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span><span class=main>)</span>
      <span class=main>=</span> map <span class=main>(</span><span class=main>(+)</span> <span class=free>p</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span><span class=main>,</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>.e.</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_idI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_step_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> is_aligned_no_overflow<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_step_shift_red<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>sz</span><span class=main>;</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>us</span> <span class=main>≤</span> <span class=free>sz</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>[</span><span class=free>p</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>,</span> <span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span> <span class=keyword1>.e.</span> <span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>]</span>
          <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>p</span> <span class=main>+</span> of_nat <span class=bound>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>us</span><span class=main>)</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>sz</span> <span class=main>-</span> <span class=free>us</span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> upto_enum_step_shift<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upto_enum_step_red<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> upto_enum_step_subset<span class=main>:</span>
  <span class=quoted><span class=quoted>"set <span class=main>[</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span> <span class=keyword1>.e.</span> <span class=free>z</span><span class=main>]</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>x</span> <span class=main>..</span> <span class=free>z</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> upto_enum_step_def linorder_not_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_to_mult_word_lt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_random<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> word_plus_mono_right<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>lemma</span></span> ucast_distrib<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>L</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lift_M<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> uint <span class=main>(</span><span class=free>M</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>L</span> <span class=main>(</span>uint <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>uint <span class=bound>y</span><span class=main>)</span>  <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lift_M'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> uint <span class=main>(</span><span class=free>M'</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>L</span> <span class=main>(</span>uint <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>uint <span class=bound>y</span><span class=main>)</span>  <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> distrib<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=free>L</span> <span class=main>(</span><span class=bound>x</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=bound>y</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>
                               <span class=main>=</span> <span class=main>(</span><span class=free>L</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> is_down<span class=main>:</span> <span class=quoted><span class=quoted>"is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=free>M</span> <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>M'</span> <span class=main>(</span>ucast <span class=free>a</span><span class=main>)</span> <span class=main>(</span>ucast <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ucast_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> lift_M<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> of_int_uint <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> lift_M'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span>1 2<span class=main><span class=main>)</span></span> int_word_uint<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_ubin.norm_eq_iff <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span>1 2<span class=main><span class=main>)</span></span> bintrunc_mod2p<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> is_down<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> is_down_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> target_size source_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mod_exp_eq min_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> distrib <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_down_add<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>ucast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  ucast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>a</span> <span class=main>+</span> ucast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ucast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(+)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>presburger</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_down_minus<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>ucast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  ucast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>a</span> <span class=main>-</span> ucast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ucast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(-)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> mod_diff_left_eq mod_diff_right_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> ucast_down_mult<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>ucast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  ucast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast <span class=free>a</span> <span class=main>*</span> ucast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ucast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(*)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> mod_mult_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_distrib<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'b</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>L</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> int <span class=main>⇒</span> int"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lift_M<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> uint <span class=main>(</span><span class=free>M</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>L</span> <span class=main>(</span>uint <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>uint <span class=bound>y</span><span class=main>)</span>  <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> lift_M'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> uint <span class=main>(</span><span class=free>M'</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>L</span> <span class=main>(</span>uint <span class=bound>x</span><span class=main>)</span> <span class=main>(</span>uint <span class=bound>y</span><span class=main>)</span>  <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> distrib<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=free>L</span> <span class=main>(</span><span class=bound>x</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=bound>y</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>
                               <span class=main>=</span> <span class=main>(</span><span class=free>L</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> is_down<span class=main>:</span> <span class=quoted><span class=quoted>"is_down <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"scast <span class=main>(</span><span class=free>M</span> <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=free>M'</span> <span class=main>(</span>scast <span class=free>a</span><span class=main>)</span> <span class=main>(</span>scast <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span>1 2 3<span class=main><span class=main>)</span></span> down_cast_same <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> is_down<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_down_def target_size source_size is_down<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ucast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>L</span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> lift_M lift_M' distrib<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> is_down<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_down_def target_size source_size is_down<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_down_add<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>scast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  scast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>a</span> <span class=main>+</span> scast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> scast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(+)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>presburger</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_down_minus<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>scast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  scast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>a</span> <span class=main>-</span> scast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> scast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(-)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> mod_diff_left_eq mod_diff_right_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_down_mult<span class=main>:</span>
    <span class=quoted><span class=quoted>"is_down <span class=main>(</span>scast<span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟹</span>  scast <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>scast <span class=free>a</span> <span class=main>*</span> scast <span class=free>b</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> scast_distrib <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> L<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>(*)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> uint_word_ariths<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> mod_mult_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
         <span class=main>(</span>scast <span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same ucast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
         <span class=main>(</span>scast <span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same ucast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_ucast_4<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_up <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
         <span class=main>(</span>scast <span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same ucast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_scast_b<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_up <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
     <span class=main>(</span>scast <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> scast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_eq sint_up_scast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_scast_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
            <span class=main>(</span>ucast <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> scast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_scast_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
     <span class=main>(</span>ucast <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> scast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> scast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_scast_4<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_up <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span><span class=main>;</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
     <span class=main>(</span>ucast <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> scast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same scast_eq sint_up_scast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_a<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
        <span class=main>(</span>ucast <span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same ucast_eq ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_ucast_b<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_up <span class=main>(</span>ucast <span class=main>::</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'b</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
     <span class=main>(</span>ucast <span class=main>(</span>ucast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> ucast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ucast_up_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> scast_scast_a<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_down <span class=main>(</span>scast <span class=main>::</span> <span class=tfree>'b</span> word <span class=main>⇒</span> <span class=tfree>'c</span> word<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
            <span class=main>(</span>scast <span class=main>(</span>scast <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>::</span> <span class=tfree>'c</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> scast <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> scast_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same is_up_down scast_eq ucast_down_wi<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> scast_down_wi <span class=main>[</span><span class=operator>OF</span> refl<span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>uc</span> <span class=main>=</span> scast <span class=main>⟹</span> is_down <span class=free>uc</span> <span class=main>⟹</span> <span class=free>uc</span> <span class=main>(</span>word_of_int <span class=free>x</span><span class=main>)</span> <span class=main>=</span> word_of_int <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> down_cast_same is_up_down ucast_down_wi<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> cast_simps <span class=main>=</span>
  is_down is_up
  scast_down_add scast_down_minus scast_down_mult
  ucast_down_add ucast_down_minus ucast_down_mult
  scast_ucast_1 scast_ucast_3 scast_ucast_4
  ucast_scast_1 ucast_scast_3 ucast_scast_4
  ucast_ucast_a ucast_ucast_b
  scast_scast_a scast_scast_b
  ucast_down_wi scast_down_wi
  ucast_of_nat scast_of_nat
  uint_up_ucast sint_up_scast
  up_scast_surj up_ucast_surj

<span class=keyword1><span class=command>lemma</span></span> sdiv_word_max<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> sint <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
          <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>≠</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>b</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=var>?a_int_min</span> <span class=main>∨</span> <span class=main>¬</span> <span class=var>?b_minus1</span><span class=main>)</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> classical<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> not_thesis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?thesis</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> not_zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> not_thesis
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> result_range<span class=main>:</span> <span class=quoted><span class=quoted>"sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>∈</span> <span class=main>(</span>sints <span class=main>(</span>size <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>∪</span> <span class=main>{</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> sdiv_int_range <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> rev_subsetD<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> sint_range' <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span><span class=main>]</span>  sint_range' <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> max_def abs_if word_size sints_num<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>have</span></span> result_range_overflow<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=var>?a_int_min</span> <span class=main>∧</span> <span class=var>?b_minus1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> signed_divide_int_def sgn_if word_size sint_int_min<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> classical<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=var>?a_int_min</span>"</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size sint_int_min<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> diff_0_right
              int_sdiv_negated_is_minus1 minus_diff_eq minus_int_code<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span>
              power_eq_0_iff sint_minus1 zero_neq_numeral<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"abs <span class=main>(</span>sint <span class=free>a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> sdiv_int_range <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> sdiv_int_range <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> word_sint.Rep <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=free>a</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> minus_le_iff word_size abs_if sints_num <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> minus_minus sint_int_min word_sint.Rep_inject<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>have</span></span> result_range_simple<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>∈</span> <span class=main>(</span>sints <span class=main>(</span>size <span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=var>?thesis</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> sdiv_int_range <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"sint <span class=free>b</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size sints_num sint_int_min<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> UnE <span class=main><span class=main>[</span></span><span class=operator>OF</span> result_range result_range_simple<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> result_range_overflow
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> sdiv_word_min' <span class=main>=</span> sdiv_word_min <span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sdiv_word_max' <span class=main>=</span> sdiv_word_max <span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> signed_arith_ineq_checks_to_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span> <span class=main>=</span> sint <span class=main>(</span><span class=main>-</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=keyword1>sdiv</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span> <span class=main>=</span> sint <span class=main>(</span><span class=free>a</span> <span class=keyword1>smod</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sint_word_ariths word_size signed_div_arith signed_mod_arith
                    sbintrunc_eq_in_range range_sbintrunc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> signed_arith_sint<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>+</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>-</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> sint <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=main>*</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=free>a</span> <span class=keyword1>sdiv</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>sdiv</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=free>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
    <span class=main>⟹</span> sint <span class=main>(</span><span class=free>a</span> <span class=keyword1>smod</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sint <span class=free>a</span> <span class=keyword1>smod</span> sint <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> signed_arith_ineq_checks_to_eq<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_8><div class=head><h1>Theory Word_8</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Words of Length 8"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_8
<span class=keyword2><span class=keyword>imports</span></span>
  <a href=More_Word.html>More_Word</a>
  <a href=Enumeration_Word.html>Enumeration_Word</a>
  <a href=Even_More_List.html>Even_More_List</a>
  <a href=Signed_Words.html>Signed_Words</a>
  <a href=Word_Lemmas.html>Word_Lemmas</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> len8<span class=main>:</span> <span class=quoted><span class=quoted>"len_of <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>8</span> itself<span class=main>)</span> <span class=main>=</span> <span class=numeral>8</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word8_and_max_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xFF</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>8</span> word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_and_full_mask_simp <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc mask_Suc_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> enum_word8_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹enum <span class=main>=</span> <span class=main>[</span><span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=numeral>2</span><span class=main>,</span> <span class=numeral>3</span><span class=main>,</span> <span class=numeral>4</span><span class=main>,</span> <span class=numeral>5</span><span class=main>,</span> <span class=numeral>6</span><span class=main>,</span> <span class=numeral>7</span><span class=main>,</span> <span class=numeral>8</span><span class=main>,</span> <span class=numeral>9</span><span class=main>,</span> <span class=numeral>10</span><span class=main>,</span> <span class=numeral>11</span><span class=main>,</span> <span class=numeral>12</span><span class=main>,</span> <span class=numeral>13</span><span class=main>,</span> <span class=numeral>14</span><span class=main>,</span> <span class=numeral>15</span><span class=main>,</span> <span class=numeral>16</span><span class=main>,</span> <span class=numeral>17</span><span class=main>,</span> <span class=numeral>18</span><span class=main>,</span> <span class=numeral>19</span><span class=main>,</span>
                            <span class=numeral>20</span><span class=main>,</span> <span class=numeral>21</span><span class=main>,</span> <span class=numeral>22</span><span class=main>,</span> <span class=numeral>23</span><span class=main>,</span> <span class=numeral>24</span><span class=main>,</span> <span class=numeral>25</span><span class=main>,</span> <span class=numeral>26</span><span class=main>,</span> <span class=numeral>27</span><span class=main>,</span> <span class=numeral>28</span><span class=main>,</span> <span class=numeral>29</span><span class=main>,</span> <span class=numeral>30</span><span class=main>,</span> <span class=numeral>31</span><span class=main>,</span> <span class=numeral>32</span><span class=main>,</span> <span class=numeral>33</span><span class=main>,</span> <span class=numeral>34</span><span class=main>,</span> <span class=numeral>35</span><span class=main>,</span> <span class=numeral>36</span><span class=main>,</span>
                            <span class=numeral>37</span><span class=main>,</span> <span class=numeral>38</span><span class=main>,</span> <span class=numeral>39</span><span class=main>,</span> <span class=numeral>40</span><span class=main>,</span> <span class=numeral>41</span><span class=main>,</span> <span class=numeral>42</span><span class=main>,</span> <span class=numeral>43</span><span class=main>,</span> <span class=numeral>44</span><span class=main>,</span> <span class=numeral>45</span><span class=main>,</span> <span class=numeral>46</span><span class=main>,</span> <span class=numeral>47</span><span class=main>,</span> <span class=numeral>48</span><span class=main>,</span> <span class=numeral>49</span><span class=main>,</span> <span class=numeral>50</span><span class=main>,</span> <span class=numeral>51</span><span class=main>,</span> <span class=numeral>52</span><span class=main>,</span> <span class=numeral>53</span><span class=main>,</span>
                            <span class=numeral>54</span><span class=main>,</span> <span class=numeral>55</span><span class=main>,</span> <span class=numeral>56</span><span class=main>,</span> <span class=numeral>57</span><span class=main>,</span> <span class=numeral>58</span><span class=main>,</span> <span class=numeral>59</span><span class=main>,</span> <span class=numeral>60</span><span class=main>,</span> <span class=numeral>61</span><span class=main>,</span> <span class=numeral>62</span><span class=main>,</span> <span class=numeral>63</span><span class=main>,</span> <span class=numeral>64</span><span class=main>,</span> <span class=numeral>65</span><span class=main>,</span> <span class=numeral>66</span><span class=main>,</span> <span class=numeral>67</span><span class=main>,</span> <span class=numeral>68</span><span class=main>,</span> <span class=numeral>69</span><span class=main>,</span> <span class=numeral>70</span><span class=main>,</span>
                            <span class=numeral>71</span><span class=main>,</span> <span class=numeral>72</span><span class=main>,</span> <span class=numeral>73</span><span class=main>,</span> <span class=numeral>74</span><span class=main>,</span> <span class=numeral>75</span><span class=main>,</span> <span class=numeral>76</span><span class=main>,</span> <span class=numeral>77</span><span class=main>,</span> <span class=numeral>78</span><span class=main>,</span> <span class=numeral>79</span><span class=main>,</span> <span class=numeral>80</span><span class=main>,</span> <span class=numeral>81</span><span class=main>,</span> <span class=numeral>82</span><span class=main>,</span> <span class=numeral>83</span><span class=main>,</span> <span class=numeral>84</span><span class=main>,</span> <span class=numeral>85</span><span class=main>,</span> <span class=numeral>86</span><span class=main>,</span> <span class=numeral>87</span><span class=main>,</span>
                            <span class=numeral>88</span><span class=main>,</span> <span class=numeral>89</span><span class=main>,</span> <span class=numeral>90</span><span class=main>,</span> <span class=numeral>91</span><span class=main>,</span> <span class=numeral>92</span><span class=main>,</span> <span class=numeral>93</span><span class=main>,</span> <span class=numeral>94</span><span class=main>,</span> <span class=numeral>95</span><span class=main>,</span> <span class=numeral>96</span><span class=main>,</span> <span class=numeral>97</span><span class=main>,</span> <span class=numeral>98</span><span class=main>,</span> <span class=numeral>99</span><span class=main>,</span> <span class=numeral>100</span><span class=main>,</span> <span class=numeral>101</span><span class=main>,</span> <span class=numeral>102</span><span class=main>,</span> <span class=numeral>103</span><span class=main>,</span>
                            <span class=numeral>104</span><span class=main>,</span> <span class=numeral>105</span><span class=main>,</span> <span class=numeral>106</span><span class=main>,</span> <span class=numeral>107</span><span class=main>,</span> <span class=numeral>108</span><span class=main>,</span> <span class=numeral>109</span><span class=main>,</span> <span class=numeral>110</span><span class=main>,</span> <span class=numeral>111</span><span class=main>,</span> <span class=numeral>112</span><span class=main>,</span> <span class=numeral>113</span><span class=main>,</span> <span class=numeral>114</span><span class=main>,</span> <span class=numeral>115</span><span class=main>,</span> <span class=numeral>116</span><span class=main>,</span> <span class=numeral>117</span><span class=main>,</span>
                            <span class=numeral>118</span><span class=main>,</span> <span class=numeral>119</span><span class=main>,</span> <span class=numeral>120</span><span class=main>,</span> <span class=numeral>121</span><span class=main>,</span> <span class=numeral>122</span><span class=main>,</span> <span class=numeral>123</span><span class=main>,</span> <span class=numeral>124</span><span class=main>,</span> <span class=numeral>125</span><span class=main>,</span> <span class=numeral>126</span><span class=main>,</span> <span class=numeral>127</span><span class=main>,</span> <span class=numeral>128</span><span class=main>,</span> <span class=numeral>129</span><span class=main>,</span> <span class=numeral>130</span><span class=main>,</span> <span class=numeral>131</span><span class=main>,</span>
                            <span class=numeral>132</span><span class=main>,</span> <span class=numeral>133</span><span class=main>,</span> <span class=numeral>134</span><span class=main>,</span> <span class=numeral>135</span><span class=main>,</span> <span class=numeral>136</span><span class=main>,</span> <span class=numeral>137</span><span class=main>,</span> <span class=numeral>138</span><span class=main>,</span> <span class=numeral>139</span><span class=main>,</span> <span class=numeral>140</span><span class=main>,</span> <span class=numeral>141</span><span class=main>,</span> <span class=numeral>142</span><span class=main>,</span> <span class=numeral>143</span><span class=main>,</span> <span class=numeral>144</span><span class=main>,</span> <span class=numeral>145</span><span class=main>,</span>
                            <span class=numeral>146</span><span class=main>,</span> <span class=numeral>147</span><span class=main>,</span> <span class=numeral>148</span><span class=main>,</span> <span class=numeral>149</span><span class=main>,</span> <span class=numeral>150</span><span class=main>,</span> <span class=numeral>151</span><span class=main>,</span> <span class=numeral>152</span><span class=main>,</span> <span class=numeral>153</span><span class=main>,</span> <span class=numeral>154</span><span class=main>,</span> <span class=numeral>155</span><span class=main>,</span> <span class=numeral>156</span><span class=main>,</span> <span class=numeral>157</span><span class=main>,</span> <span class=numeral>158</span><span class=main>,</span> <span class=numeral>159</span><span class=main>,</span>
                            <span class=numeral>160</span><span class=main>,</span> <span class=numeral>161</span><span class=main>,</span> <span class=numeral>162</span><span class=main>,</span> <span class=numeral>163</span><span class=main>,</span> <span class=numeral>164</span><span class=main>,</span> <span class=numeral>165</span><span class=main>,</span> <span class=numeral>166</span><span class=main>,</span> <span class=numeral>167</span><span class=main>,</span> <span class=numeral>168</span><span class=main>,</span> <span class=numeral>169</span><span class=main>,</span> <span class=numeral>170</span><span class=main>,</span> <span class=numeral>171</span><span class=main>,</span> <span class=numeral>172</span><span class=main>,</span> <span class=numeral>173</span><span class=main>,</span>
                            <span class=numeral>174</span><span class=main>,</span> <span class=numeral>175</span><span class=main>,</span> <span class=numeral>176</span><span class=main>,</span> <span class=numeral>177</span><span class=main>,</span> <span class=numeral>178</span><span class=main>,</span> <span class=numeral>179</span><span class=main>,</span> <span class=numeral>180</span><span class=main>,</span> <span class=numeral>181</span><span class=main>,</span> <span class=numeral>182</span><span class=main>,</span> <span class=numeral>183</span><span class=main>,</span> <span class=numeral>184</span><span class=main>,</span> <span class=numeral>185</span><span class=main>,</span> <span class=numeral>186</span><span class=main>,</span> <span class=numeral>187</span><span class=main>,</span>
                            <span class=numeral>188</span><span class=main>,</span> <span class=numeral>189</span><span class=main>,</span> <span class=numeral>190</span><span class=main>,</span> <span class=numeral>191</span><span class=main>,</span> <span class=numeral>192</span><span class=main>,</span> <span class=numeral>193</span><span class=main>,</span> <span class=numeral>194</span><span class=main>,</span> <span class=numeral>195</span><span class=main>,</span> <span class=numeral>196</span><span class=main>,</span> <span class=numeral>197</span><span class=main>,</span> <span class=numeral>198</span><span class=main>,</span> <span class=numeral>199</span><span class=main>,</span> <span class=numeral>200</span><span class=main>,</span> <span class=numeral>201</span><span class=main>,</span>
                            <span class=numeral>202</span><span class=main>,</span> <span class=numeral>203</span><span class=main>,</span> <span class=numeral>204</span><span class=main>,</span> <span class=numeral>205</span><span class=main>,</span> <span class=numeral>206</span><span class=main>,</span> <span class=numeral>207</span><span class=main>,</span> <span class=numeral>208</span><span class=main>,</span> <span class=numeral>209</span><span class=main>,</span> <span class=numeral>210</span><span class=main>,</span> <span class=numeral>211</span><span class=main>,</span> <span class=numeral>212</span><span class=main>,</span> <span class=numeral>213</span><span class=main>,</span> <span class=numeral>214</span><span class=main>,</span> <span class=numeral>215</span><span class=main>,</span>
                            <span class=numeral>216</span><span class=main>,</span> <span class=numeral>217</span><span class=main>,</span> <span class=numeral>218</span><span class=main>,</span> <span class=numeral>219</span><span class=main>,</span> <span class=numeral>220</span><span class=main>,</span> <span class=numeral>221</span><span class=main>,</span> <span class=numeral>222</span><span class=main>,</span> <span class=numeral>223</span><span class=main>,</span> <span class=numeral>224</span><span class=main>,</span> <span class=numeral>225</span><span class=main>,</span> <span class=numeral>226</span><span class=main>,</span> <span class=numeral>227</span><span class=main>,</span> <span class=numeral>228</span><span class=main>,</span> <span class=numeral>229</span><span class=main>,</span>
                            <span class=numeral>230</span><span class=main>,</span> <span class=numeral>231</span><span class=main>,</span> <span class=numeral>232</span><span class=main>,</span> <span class=numeral>233</span><span class=main>,</span> <span class=numeral>234</span><span class=main>,</span> <span class=numeral>235</span><span class=main>,</span> <span class=numeral>236</span><span class=main>,</span> <span class=numeral>237</span><span class=main>,</span> <span class=numeral>238</span><span class=main>,</span> <span class=numeral>239</span><span class=main>,</span> <span class=numeral>240</span><span class=main>,</span> <span class=numeral>241</span><span class=main>,</span> <span class=numeral>242</span><span class=main>,</span> <span class=numeral>243</span><span class=main>,</span>
                            <span class=numeral>244</span><span class=main>,</span> <span class=numeral>245</span><span class=main>,</span> <span class=numeral>246</span><span class=main>,</span> <span class=numeral>247</span><span class=main>,</span> <span class=numeral>248</span><span class=main>,</span> <span class=numeral>249</span><span class=main>,</span> <span class=numeral>250</span><span class=main>,</span> <span class=numeral>251</span><span class=main>,</span> <span class=numeral>252</span><span class=main>,</span> <span class=numeral>253</span><span class=main>,</span> <span class=numeral>254</span><span class=main>,</span> <span class=numeral>255</span><span class=main>]</span>›</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>‹<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>›</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹map unat <span class=var>?lhs</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=numeral>256</span><span class=main>]</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_word_def comp_def take_bit_nat_eq_self map_idem_upt_eq<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>…</span> <span class=main>=</span> map unat <span class=var>?rhs</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> upt_zero_numeral_unfold<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unat_inj <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> map_injective<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> set_enum_word8_def<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>set enum <span class=main>::</span> <span class=numeral>8</span> word set<span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=numeral>2</span><span class=main>,</span> <span class=numeral>3</span><span class=main>,</span> <span class=numeral>4</span><span class=main>,</span> <span class=numeral>5</span><span class=main>,</span> <span class=numeral>6</span><span class=main>,</span> <span class=numeral>7</span><span class=main>,</span> <span class=numeral>8</span><span class=main>,</span> <span class=numeral>9</span><span class=main>,</span> <span class=numeral>10</span><span class=main>,</span> <span class=numeral>11</span><span class=main>,</span> <span class=numeral>12</span><span class=main>,</span> <span class=numeral>13</span><span class=main>,</span> <span class=numeral>14</span><span class=main>,</span> <span class=numeral>15</span><span class=main>,</span> <span class=numeral>16</span><span class=main>,</span> <span class=numeral>17</span><span class=main>,</span> <span class=numeral>18</span><span class=main>,</span> <span class=numeral>19</span><span class=main>,</span>
                            <span class=numeral>20</span><span class=main>,</span> <span class=numeral>21</span><span class=main>,</span> <span class=numeral>22</span><span class=main>,</span> <span class=numeral>23</span><span class=main>,</span> <span class=numeral>24</span><span class=main>,</span> <span class=numeral>25</span><span class=main>,</span> <span class=numeral>26</span><span class=main>,</span> <span class=numeral>27</span><span class=main>,</span> <span class=numeral>28</span><span class=main>,</span> <span class=numeral>29</span><span class=main>,</span> <span class=numeral>30</span><span class=main>,</span> <span class=numeral>31</span><span class=main>,</span> <span class=numeral>32</span><span class=main>,</span> <span class=numeral>33</span><span class=main>,</span> <span class=numeral>34</span><span class=main>,</span> <span class=numeral>35</span><span class=main>,</span> <span class=numeral>36</span><span class=main>,</span>
                            <span class=numeral>37</span><span class=main>,</span> <span class=numeral>38</span><span class=main>,</span> <span class=numeral>39</span><span class=main>,</span> <span class=numeral>40</span><span class=main>,</span> <span class=numeral>41</span><span class=main>,</span> <span class=numeral>42</span><span class=main>,</span> <span class=numeral>43</span><span class=main>,</span> <span class=numeral>44</span><span class=main>,</span> <span class=numeral>45</span><span class=main>,</span> <span class=numeral>46</span><span class=main>,</span> <span class=numeral>47</span><span class=main>,</span> <span class=numeral>48</span><span class=main>,</span> <span class=numeral>49</span><span class=main>,</span> <span class=numeral>50</span><span class=main>,</span> <span class=numeral>51</span><span class=main>,</span> <span class=numeral>52</span><span class=main>,</span> <span class=numeral>53</span><span class=main>,</span>
                            <span class=numeral>54</span><span class=main>,</span> <span class=numeral>55</span><span class=main>,</span> <span class=numeral>56</span><span class=main>,</span> <span class=numeral>57</span><span class=main>,</span> <span class=numeral>58</span><span class=main>,</span> <span class=numeral>59</span><span class=main>,</span> <span class=numeral>60</span><span class=main>,</span> <span class=numeral>61</span><span class=main>,</span> <span class=numeral>62</span><span class=main>,</span> <span class=numeral>63</span><span class=main>,</span> <span class=numeral>64</span><span class=main>,</span> <span class=numeral>65</span><span class=main>,</span> <span class=numeral>66</span><span class=main>,</span> <span class=numeral>67</span><span class=main>,</span> <span class=numeral>68</span><span class=main>,</span> <span class=numeral>69</span><span class=main>,</span> <span class=numeral>70</span><span class=main>,</span>
                            <span class=numeral>71</span><span class=main>,</span> <span class=numeral>72</span><span class=main>,</span> <span class=numeral>73</span><span class=main>,</span> <span class=numeral>74</span><span class=main>,</span> <span class=numeral>75</span><span class=main>,</span> <span class=numeral>76</span><span class=main>,</span> <span class=numeral>77</span><span class=main>,</span> <span class=numeral>78</span><span class=main>,</span> <span class=numeral>79</span><span class=main>,</span> <span class=numeral>80</span><span class=main>,</span> <span class=numeral>81</span><span class=main>,</span> <span class=numeral>82</span><span class=main>,</span> <span class=numeral>83</span><span class=main>,</span> <span class=numeral>84</span><span class=main>,</span> <span class=numeral>85</span><span class=main>,</span> <span class=numeral>86</span><span class=main>,</span> <span class=numeral>87</span><span class=main>,</span>
                            <span class=numeral>88</span><span class=main>,</span> <span class=numeral>89</span><span class=main>,</span> <span class=numeral>90</span><span class=main>,</span> <span class=numeral>91</span><span class=main>,</span> <span class=numeral>92</span><span class=main>,</span> <span class=numeral>93</span><span class=main>,</span> <span class=numeral>94</span><span class=main>,</span> <span class=numeral>95</span><span class=main>,</span> <span class=numeral>96</span><span class=main>,</span> <span class=numeral>97</span><span class=main>,</span> <span class=numeral>98</span><span class=main>,</span> <span class=numeral>99</span><span class=main>,</span> <span class=numeral>100</span><span class=main>,</span> <span class=numeral>101</span><span class=main>,</span> <span class=numeral>102</span><span class=main>,</span> <span class=numeral>103</span><span class=main>,</span>
                            <span class=numeral>104</span><span class=main>,</span> <span class=numeral>105</span><span class=main>,</span> <span class=numeral>106</span><span class=main>,</span> <span class=numeral>107</span><span class=main>,</span> <span class=numeral>108</span><span class=main>,</span> <span class=numeral>109</span><span class=main>,</span> <span class=numeral>110</span><span class=main>,</span> <span class=numeral>111</span><span class=main>,</span> <span class=numeral>112</span><span class=main>,</span> <span class=numeral>113</span><span class=main>,</span> <span class=numeral>114</span><span class=main>,</span> <span class=numeral>115</span><span class=main>,</span> <span class=numeral>116</span><span class=main>,</span> <span class=numeral>117</span><span class=main>,</span>
                            <span class=numeral>118</span><span class=main>,</span> <span class=numeral>119</span><span class=main>,</span> <span class=numeral>120</span><span class=main>,</span> <span class=numeral>121</span><span class=main>,</span> <span class=numeral>122</span><span class=main>,</span> <span class=numeral>123</span><span class=main>,</span> <span class=numeral>124</span><span class=main>,</span> <span class=numeral>125</span><span class=main>,</span> <span class=numeral>126</span><span class=main>,</span> <span class=numeral>127</span><span class=main>,</span> <span class=numeral>128</span><span class=main>,</span> <span class=numeral>129</span><span class=main>,</span> <span class=numeral>130</span><span class=main>,</span> <span class=numeral>131</span><span class=main>,</span>
                            <span class=numeral>132</span><span class=main>,</span> <span class=numeral>133</span><span class=main>,</span> <span class=numeral>134</span><span class=main>,</span> <span class=numeral>135</span><span class=main>,</span> <span class=numeral>136</span><span class=main>,</span> <span class=numeral>137</span><span class=main>,</span> <span class=numeral>138</span><span class=main>,</span> <span class=numeral>139</span><span class=main>,</span> <span class=numeral>140</span><span class=main>,</span> <span class=numeral>141</span><span class=main>,</span> <span class=numeral>142</span><span class=main>,</span> <span class=numeral>143</span><span class=main>,</span> <span class=numeral>144</span><span class=main>,</span> <span class=numeral>145</span><span class=main>,</span>
                            <span class=numeral>146</span><span class=main>,</span> <span class=numeral>147</span><span class=main>,</span> <span class=numeral>148</span><span class=main>,</span> <span class=numeral>149</span><span class=main>,</span> <span class=numeral>150</span><span class=main>,</span> <span class=numeral>151</span><span class=main>,</span> <span class=numeral>152</span><span class=main>,</span> <span class=numeral>153</span><span class=main>,</span> <span class=numeral>154</span><span class=main>,</span> <span class=numeral>155</span><span class=main>,</span> <span class=numeral>156</span><span class=main>,</span> <span class=numeral>157</span><span class=main>,</span> <span class=numeral>158</span><span class=main>,</span> <span class=numeral>159</span><span class=main>,</span>
                            <span class=numeral>160</span><span class=main>,</span> <span class=numeral>161</span><span class=main>,</span> <span class=numeral>162</span><span class=main>,</span> <span class=numeral>163</span><span class=main>,</span> <span class=numeral>164</span><span class=main>,</span> <span class=numeral>165</span><span class=main>,</span> <span class=numeral>166</span><span class=main>,</span> <span class=numeral>167</span><span class=main>,</span> <span class=numeral>168</span><span class=main>,</span> <span class=numeral>169</span><span class=main>,</span> <span class=numeral>170</span><span class=main>,</span> <span class=numeral>171</span><span class=main>,</span> <span class=numeral>172</span><span class=main>,</span> <span class=numeral>173</span><span class=main>,</span>
                            <span class=numeral>174</span><span class=main>,</span> <span class=numeral>175</span><span class=main>,</span> <span class=numeral>176</span><span class=main>,</span> <span class=numeral>177</span><span class=main>,</span> <span class=numeral>178</span><span class=main>,</span> <span class=numeral>179</span><span class=main>,</span> <span class=numeral>180</span><span class=main>,</span> <span class=numeral>181</span><span class=main>,</span> <span class=numeral>182</span><span class=main>,</span> <span class=numeral>183</span><span class=main>,</span> <span class=numeral>184</span><span class=main>,</span> <span class=numeral>185</span><span class=main>,</span> <span class=numeral>186</span><span class=main>,</span> <span class=numeral>187</span><span class=main>,</span>
                            <span class=numeral>188</span><span class=main>,</span> <span class=numeral>189</span><span class=main>,</span> <span class=numeral>190</span><span class=main>,</span> <span class=numeral>191</span><span class=main>,</span> <span class=numeral>192</span><span class=main>,</span> <span class=numeral>193</span><span class=main>,</span> <span class=numeral>194</span><span class=main>,</span> <span class=numeral>195</span><span class=main>,</span> <span class=numeral>196</span><span class=main>,</span> <span class=numeral>197</span><span class=main>,</span> <span class=numeral>198</span><span class=main>,</span> <span class=numeral>199</span><span class=main>,</span> <span class=numeral>200</span><span class=main>,</span> <span class=numeral>201</span><span class=main>,</span>
                            <span class=numeral>202</span><span class=main>,</span> <span class=numeral>203</span><span class=main>,</span> <span class=numeral>204</span><span class=main>,</span> <span class=numeral>205</span><span class=main>,</span> <span class=numeral>206</span><span class=main>,</span> <span class=numeral>207</span><span class=main>,</span> <span class=numeral>208</span><span class=main>,</span> <span class=numeral>209</span><span class=main>,</span> <span class=numeral>210</span><span class=main>,</span> <span class=numeral>211</span><span class=main>,</span> <span class=numeral>212</span><span class=main>,</span> <span class=numeral>213</span><span class=main>,</span> <span class=numeral>214</span><span class=main>,</span> <span class=numeral>215</span><span class=main>,</span>
                            <span class=numeral>216</span><span class=main>,</span> <span class=numeral>217</span><span class=main>,</span> <span class=numeral>218</span><span class=main>,</span> <span class=numeral>219</span><span class=main>,</span> <span class=numeral>220</span><span class=main>,</span> <span class=numeral>221</span><span class=main>,</span> <span class=numeral>222</span><span class=main>,</span> <span class=numeral>223</span><span class=main>,</span> <span class=numeral>224</span><span class=main>,</span> <span class=numeral>225</span><span class=main>,</span> <span class=numeral>226</span><span class=main>,</span> <span class=numeral>227</span><span class=main>,</span> <span class=numeral>228</span><span class=main>,</span> <span class=numeral>229</span><span class=main>,</span>
                            <span class=numeral>230</span><span class=main>,</span> <span class=numeral>231</span><span class=main>,</span> <span class=numeral>232</span><span class=main>,</span> <span class=numeral>233</span><span class=main>,</span> <span class=numeral>234</span><span class=main>,</span> <span class=numeral>235</span><span class=main>,</span> <span class=numeral>236</span><span class=main>,</span> <span class=numeral>237</span><span class=main>,</span> <span class=numeral>238</span><span class=main>,</span> <span class=numeral>239</span><span class=main>,</span> <span class=numeral>240</span><span class=main>,</span> <span class=numeral>241</span><span class=main>,</span> <span class=numeral>242</span><span class=main>,</span> <span class=numeral>243</span><span class=main>,</span>
                            <span class=numeral>244</span><span class=main>,</span> <span class=numeral>245</span><span class=main>,</span> <span class=numeral>246</span><span class=main>,</span> <span class=numeral>247</span><span class=main>,</span> <span class=numeral>248</span><span class=main>,</span> <span class=numeral>249</span><span class=main>,</span> <span class=numeral>250</span><span class=main>,</span> <span class=numeral>251</span><span class=main>,</span> <span class=numeral>252</span><span class=main>,</span> <span class=numeral>253</span><span class=main>,</span> <span class=numeral>254</span><span class=main>,</span> <span class=numeral>255</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enum_word8_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> set_strip_insert<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>∈</span> insert <span class=free>a</span> <span class=free>S</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>S</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word8_exhaust<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>8</span> word›</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≠</span> <span class=main>0</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>1</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>2</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>3</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>4</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>5</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>6</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>7</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>8</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>9</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>10</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>11</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>12</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>13</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>14</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>15</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>16</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>17</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>18</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>19</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>20</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>21</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>22</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>23</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>24</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>25</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>26</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>27</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>28</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>29</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>30</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>31</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>32</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>33</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>34</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>35</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>36</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>37</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>38</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>39</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>40</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>41</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>42</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>43</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>44</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>45</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>46</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>47</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>48</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>49</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>50</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>51</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>52</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>53</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>54</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>55</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>56</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>57</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>58</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>59</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>60</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>61</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>62</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>63</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>64</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>65</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>66</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>67</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>68</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>69</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>70</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>71</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>72</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>73</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>74</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>75</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>76</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>77</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>78</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>79</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>80</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>81</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>82</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>83</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>84</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>85</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>86</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>87</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>88</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>89</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>90</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>91</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>92</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>93</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>94</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>95</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>96</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>97</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>98</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>99</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>100</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>101</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>102</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>103</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>104</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>105</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>106</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>107</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>108</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>109</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>110</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>111</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>112</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>113</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>114</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>115</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>116</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>117</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>118</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>119</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>120</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>121</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>122</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>123</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>124</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>125</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>126</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>127</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>128</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>129</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>130</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>131</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>132</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>133</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>134</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>135</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>136</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>137</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>138</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>139</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>140</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>141</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>142</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>143</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>144</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>145</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>146</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>147</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>148</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>149</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>150</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>151</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>152</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>153</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>154</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>155</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>156</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>157</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>158</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>159</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>160</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>161</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>162</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>163</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>164</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>165</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>166</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>167</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>168</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>169</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>170</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>171</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>172</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>173</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>174</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>175</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>176</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>177</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>178</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>179</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>180</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>181</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>182</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>183</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>184</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>185</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>186</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>187</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>188</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>189</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>190</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>191</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>192</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>193</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>194</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>195</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>196</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>197</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>198</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>199</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>200</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>201</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>202</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>203</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>204</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>205</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>206</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>207</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>208</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>209</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>210</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>211</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>212</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>213</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>214</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>215</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>216</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>217</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>218</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>219</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>220</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>221</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>222</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>223</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>224</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>225</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>226</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>227</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>228</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>229</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>230</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>231</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>232</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>233</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>234</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>235</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>236</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>237</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>238</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>239</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>240</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>241</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>242</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>243</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>244</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>245</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>246</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>247</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>248</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>249</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span>
          <span class=numeral>250</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>251</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>252</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>253</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>254</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=numeral>255</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set enum"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> set_enum_word8_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> set_strip_insert<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> emptyE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> enum_UNIV<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> UNIV_I<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_16><div class=head><h1>Theory Word_16</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Words of Length 16"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_16
<span class=keyword2><span class=keyword>imports</span></span>
  <a href=More_Word.html>More_Word</a>
  <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> len16<span class=main>:</span> <span class=quoted><span class=quoted>"len_of <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>16</span> itself<span class=main>)</span> <span class=main>=</span> <span class=numeral>16</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word16_and_max_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xFFFF</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>16</span> word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_and_full_mask_simp <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc mask_Suc_exp<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_Syntax><div class=head><h1>Theory Word_Syntax</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Additional Syntax for Word Bit Operations"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_Syntax
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Additional bit and type syntax that forces word types.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>wordNOT</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span>      <span class=main>(</span><span class=quoted>"<span class=keyword1>~~</span> _"</span> <span class=main>[</span>70<span class=main>]</span> 71<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>~~</span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>==</span> <span class=keyword1>NOT</span> <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>wordAND</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>&amp;&amp;</span>"</span> 64<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main><span class=free>&amp;&amp;</span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>==</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>AND</span> <span class=free><span class=bound><span class=entity>b</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>wordOR</span>   <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>||</span>"</span>  59<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main><span class=free>||</span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>==</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>OR</span> <span class=free><span class=bound><span class=entity>b</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>wordXOR</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>xor</span>"</span> 59<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1><span class=free>xor</span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>==</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>XOR</span> <span class=free><span class=bound><span class=entity>b</span></span></span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_Names><div class=head><h1>Theory Word_Names</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Names of Specific Word Lengths"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_Names
  <span class=keyword2><span class=keyword>imports</span></span> <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> word8 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>8</span> word"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> word16 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>16</span> word"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> word32 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> word"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> word64 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>64</span> word"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> sword8 <span class=main>=</span>  <span class=quoted><span class=quoted>"<span class=numeral>8</span> sword"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> sword16 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>16</span> sword"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> sword32 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> sword"</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> sword64 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>64</span> sword"</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=More_Word_Operations><div class=head><h1>Theory More_Word_Operations</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Misc word operations›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Word_Operations
  <span class=keyword2><span class=keyword>imports</span></span>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=Aligned.html>Aligned</a>
    <a href=Reversed_Bit_Lists.html>Reversed_Bit_Lists</a>
    <a href=More_Misc.html>More_Misc</a>
    <a href=Signed_Words.html>Signed_Words</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>ptr_add</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ptr_add</span> <span class=free><span class=bound><span class=entity>ptr</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>ptr</span></span></span> <span class=main>+</span> of_nat <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>alignUp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>alignUp</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹alignUp <span class=free>w</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>+</span> mask <span class=free>n</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_def mask_eq_exp_minus_1 add_mask_fold<span class=main>)</span>

<span class=comment1>(* standard notation for blocks of 2^n-1 words, usually aligned;
   abbreviation so it simplifies directly *)</span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>mask_range</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> word set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mask_range</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>..</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>+</span> mask <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>w2byte</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>⇒</span> <span class=numeral>8</span> word"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>w2byte</span> <span class=main>≡</span> ucast"</span></span>

<span class=comment1>(* Count leading zeros  *)</span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>word_clz</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_clz</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> length <span class=main>(</span>takeWhile Not <span class=main>(</span>to_bl <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>(* Count trailing zeros  *)</span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>word_ctz</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_ctz</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> length <span class=main>(</span>takeWhile Not <span class=main>(</span>rev <span class=main>(</span>to_bl <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_ctz_le<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_ctz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ctz_def<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> length_takeWhile_le <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_ctz_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> word_ctz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ctz_def eq_zero_set_bl<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> length_takeWhile_less <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> take_bit_word_ctz_eq <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹take_bit <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>(</span>word_ctz <span class=free>w</span><span class=main>)</span> <span class=main>=</span> word_ctz <span class=free>w</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_nat_eq_self_iff word_ctz_def to_bl_unfold<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> length_takeWhile_le <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_ctz_not_minus_1<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_of_nat <span class=main>(</span>word_ctz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>note</span></span> word_ctz_le
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_mask<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_ctz <span class=free>w</span> <span class=main>&lt;</span> mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_of_nat <span class=main>(</span>word_ctz <span class=free>w</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span>word_of_nat <span class=main>(</span>mask <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_word_less_iff<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>…</span> <span class=main>=</span> <span class=main>-</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_ctz_mw<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=main>(</span>word_ctz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> word_ctz <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_ctz_smw<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=main>(</span>word_ctz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len signed word<span class=main>)</span> <span class=main>=</span> word_ctz <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>word_log2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_log2</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>≡</span> size <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>-</span> <span class=main>1</span> <span class=main>-</span> word_clz <span class=free><span class=bound><span class=entity>w</span></span></span>"</span></span>

<span class=comment1>(* Bit population count. Equivalent of __builtin_popcount. *)</span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>pop_count</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> word <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>pop_count</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> length <span class=main>(</span>filter id <span class=main>(</span>to_bl <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=comment1>(* Sign extension from bit n *)</span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>sign_extend</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> <span class=tfree>'a</span> word"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sign_extend</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>!!</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=keyword1>OR</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=keyword1>AND</span> mask <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_eq_signed_take_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>‹sign_extend <span class=main>=</span> signed_take_bit›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹sign_extend <span class=skolem>n</span> <span class=skolem>w</span> <span class=main>=</span> signed_take_bit <span class=skolem>n</span> <span class=skolem>w</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>‹bit <span class=main>(</span>sign_extend <span class=skolem>n</span> <span class=skolem>w</span><span class=main>)</span> <span class=skolem>q</span> <span class=main>⟷</span> bit <span class=main>(</span>signed_take_bit <span class=skolem>n</span> <span class=skolem>w</span><span class=main>)</span> <span class=skolem>q</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit bit_signed_take_bit_iff
        sign_extend_def bit_and_iff bit_or_iff bit_not_iff bit_mask_iff not_less
        exp_eq_0_imp_not_bit not_le min_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>sign_extended</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sign_extended</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>&lt;</span> <span class=bound>i</span> <span class=main>⟶</span> <span class=bound>i</span> <span class=main>&lt;</span> size <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>!!</span> <span class=bound>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>!!</span> <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> ptr_add_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"ptr_add <span class=free>ref</span> <span class=main>0</span> <span class=main>=</span> <span class=free>ref</span> "</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ptr_add_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> pop_count_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"pop_count <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>pop_count_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> pop_count_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"pop_count <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>pop_count_def to_bl_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> pop_count_0_imp_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>pop_count <span class=free>w</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>w</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>pop_count_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> filter_empty_conv<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span>eq_zero_set_bl<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_zero_eq <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_log2 <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_log2_def word_clz_def word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_unfold<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_log2 <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=skolem>r</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Max <span class=main>{</span><span class=bound>m</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>m</span><span class=main>}</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> Suc <span class=main>(</span>length
    <span class=main>(</span>takeWhile <span class=main>(</span>Not <span class=main>∘</span> bit <span class=free>w</span><span class=main>)</span> <span class=main>(</span>rev <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>]</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Max_eq_length_takeWhile <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_log2 <span class=free>w</span> <span class=main>=</span> Max <span class=main>{</span><span class=bound>x</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>x</span><span class=main>}</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_log2_def word_clz_def word_size to_bl_unfold rev_map takeWhile_map<span class=main>)</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_eqI<span class=main>:</span>
  <span class=quoted><span class=quoted>‹word_log2 <span class=free>w</span> <span class=main>=</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=bound>m</span> <span class=main>≤</span> <span class=free>n</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_log2 <span class=free>w</span> <span class=main>=</span> Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_log2_unfold<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_eqI<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> bit_word_log2<span class=main>:</span>
  <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=main>(</span>word_log2 <span class=free>w</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>r</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>r</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=skolem>r</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹word_log2 <span class=free>w</span> <span class=main>=</span> Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_log2_unfold<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=skolem>r</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Max_in<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_maximum<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≤</span> word_log2 <span class=free>w</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹bit <span class=free>w</span> <span class=free>n</span>›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>≤</span> Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> that <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_ge<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> that <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹Max <span class=main>{</span><span class=bound>n</span><span class=main>.</span> bit <span class=free>w</span> <span class=bound>n</span><span class=main>}</span> <span class=main>=</span> word_log2 <span class=free>w</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_log2_unfold<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_nth_same<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>!!</span> word_log2 <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> bit_word_log2<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_nth_not_set<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> word_log2 <span class=free>w</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>;</span> <span class=free>i</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_log2_maximum <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>i</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_highest<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>!!</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> word_log2 <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> a <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_eq_bit word_log2_maximum<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_log2_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_log2 <span class=free>w</span> <span class=main>&lt;</span> size <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>‹<span class=free>w</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> bit_word_log2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fact</span> bit_imp_le_length<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"word_clz <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_clz_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_minus_one<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"word_clz <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_clz_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_alignUp<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span>alignUp <span class=free>p</span> <span class=free>n</span><span class=main>)</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_def is_aligned_mask mask_eq_decr_exp word_bw_assocs<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_le<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"alignUp <span class=free>p</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> alignUp_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_and_le2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_idem<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> alignUp_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_cancel_right_right add_diff_eq and_mask_eq_iff_le_mask mask_eq_decr_exp mask_out_add_aligned order_refl word_plus_and_or_coroll2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_not_aligned_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> anz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> not_aligned_mod_nz<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> um<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> Euclidean_Division.div_eq_0_iff le_m1_iff_lt measure_unat order_less_trans
              unat_less_power word_less_sub_le word_mod_less_divisor<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_mod_div_equality<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command>unfolding</span></span> alignUp_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mask_eq_decr_exp <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> ssubst<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> neg_mask_is_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_arith_nat_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> unat_word_ariths<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> uno_simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_add_right_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_mod_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> div_mult_self1<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> um<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_mod_power<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_unat_power<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Abs_fnat_hom_mult<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mod_left<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Abs_fnat_hom_1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Abs_fnat_hom_add<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_unat_power<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Abs_fnat_hom_mult<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_unat.Rep_inverse<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Abs_fnat_hom_mult<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_ge<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> nowrap<span class=main>:</span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> alignUp <span class=free>a</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> alignUp_idem<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False

  <span class=keyword1><span class=command>have</span></span> lt0<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> shiftr_div_2n' word_shiftr_lt<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def Suc_leI add.right_neutral add_Suc_right lt0 nat_le_power_trans nat_less_le<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>≠</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> nowrap sz
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> contrapos_nn<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> alignUp_not_aligned_eq <span class=main><span class=main>[</span></span><span class=operator>OF</span> False sz<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_arith_simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mod_left<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_div <span class=dynamic><span class=dynamic>field_simps</span></span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mod_mod_power<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> word_mod_div_equality <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz lt
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_add_less_mono1<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_mod_less_divisor<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_word_ariths<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_div<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span>  alignUp <span class=free>a</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_not_aligned_eq <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_imp_le<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_le_greater_al<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> sz le <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_idem<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> anz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> not_aligned_mod_nz<span class=main>)</span>

  <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> xk<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> of_nat <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> kn<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>of_nat <span class=skolem>k</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>*</span> unat <span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sz
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_of_nat_eq<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_less_power_trans<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword1><span class=command>have</span></span> au<span class=main>:</span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_not_aligned_eq<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>≤</span> of_nat <span class=skolem>k</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> word_mult_le_mono1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> inc_le _ kn<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> of_nat <span class=skolem>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> kv xk le sz anz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_div_helper<span class=main>)</span>

    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> p2_gt_0 sz<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> xk <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_is_aligned_nz<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ax<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     az<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"alignUp <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>a</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_idem<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> az <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> anz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> not_aligned_mod_nz<span class=main>)</span>

  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> asm<span class=main>:</span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> lt0<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> shiftr_div_2n' word_shiftr_lt<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> leq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def Suc_leI add.right_neutral add_Suc_right lt0 nat_le_power_trans
                order_less_imp_le<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> al <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span>  kv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> xk<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> of_nat <span class=skolem>k</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> is_alignedE<span class=main>)</span>

    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> of_nat <span class=skolem>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> ax sz anz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_div_helper<span class=main>)</span>

    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> r<span class=main>:</span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> drop_bit_eq_div unat_drop_bit_eq<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> leI le_unat_uoi unat_mono<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_not_aligned_eq<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>using</span></span> asm <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>dvd</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sz <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_arith_simps <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
                  <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths <span class=dynamic><span class=dynamic>mod_simps</span></span> mod_eq_0_iff_dvd<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> leq <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span>unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> le_SucE<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> Groups.add_ac<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> add.right_neutral
                add_diff_cancel_left' div_le_dividend div_mult_self4 gr_implies_not0
                le_neq_implies_less power_eq_0_iff zero_neq_numeral<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unat <span class=free>a</span> <span class=keyword1>div</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sz <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_sub<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> r
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>using</span></span> kv <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_ar_helper<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     sz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    sub<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>x</span><span class=main>..</span><span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    anz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>∧</span> alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>from</span></span> al <span class=keyword1><span class=command>have</span></span> xl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_no_overflow<span class=main>)</span>

  <span class=keyword1><span class=command>from</span></span> xl sub <span class=keyword1><span class=command>have</span></span> ax<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> alignUp <span class=free>a</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_ge<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>using</span></span> al sz ax anz
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_is_aligned_nz<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> xl <span class=keyword3><span class=command>show</span></span> tp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>b</span>"</span></span> <span class=keyword1><span class=command>using</span></span> sub
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>from</span></span> ax <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> alignUp_le_greater_al<span class=main>)</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> xl al is_aligned_no_overflow' olen_add_eqv word_plus_mcs_3 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_def2<span class=main>:</span>
  <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>sz</span> <span class=main>=</span> <span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_def <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mask_eq_decr_exp<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_def3<span class=main>:</span>
  <span class=quoted><span class=quoted>"alignUp <span class=free>a</span> <span class=free>sz</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>^</span> <span class=free>sz</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_def2 is_aligned_triv <span class=dynamic><span class=dynamic>field_simps</span></span> mask_out_add_aligned<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span>  alignUp_plus<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>w</span> <span class=free>us</span> <span class=main>⟹</span> alignUp <span class=main>(</span><span class=free>w</span> <span class=main>+</span> <span class=free>a</span><span class=main>)</span> <span class=free>us</span>  <span class=main>=</span> <span class=free>w</span> <span class=main>+</span> alignUp <span class=free>a</span> <span class=free>us</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> alignUp_def2 mask_out_add_aligned <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> alignUp_distance<span class=main>:</span>
  <span class=quoted><span class=quoted>"alignUp <span class=main>(</span><span class=free>q</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>sz</span> <span class=main>-</span> <span class=free>q</span> <span class=main>≤</span> mask <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> add.commute add_diff_cancel_left alignUp_def2 diff_add_cancel
                       mask_2pm1 subtract_mask<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> word_and_le1 word_sub_le_iff<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> is_aligned_diff_neg_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>sz</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>p</span> <span class=main>-</span> <span class=free>q</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>-</span> <span class=main>(</span><span class=main>(</span>alignUp <span class=free>q</span> <span class=free>sz</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>sz</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span>word_and_le2 diff_conv_add_uminus<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mask_out_add_aligned<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_neg_iff_add_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add.commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> alignUp_distance is_aligned_neg_mask_eq mask_out_add_aligned and_mask_eq_iff_le_mask <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> mask_eq_x_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_clz <span class=free>w</span> <span class=main>≤</span> size <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_clz_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> length_takeWhile_le word_size_bl<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_nonzero_max<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> nz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"word_clz <span class=free>w</span> <span class=main>&lt;</span> size <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"word_clz <span class=free>w</span> <span class=main>=</span> size <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"length <span class=main>(</span>takeWhile Not <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> length <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_clz_def word_size<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> allj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>set<span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> a length_takeWhile_less less_irrefl_nat word_clz_def<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"to_bl <span class=free>w</span> <span class=main>=</span> replicate <span class=main>(</span>length <span class=main>(</span>to_bl <span class=free>w</span><span class=main>)</span><span class=main>)</span> False"</span></span>
      <span class=keyword1><span class=command>using</span></span> eq_zero_set_bl nz <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> to_bl_0 word_bl.Rep_eqD word_bl_Rep'<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> nz <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> word_clz_max
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_neq_trans<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* Sign extension from bit n. *)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_bitwise_if<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> sign_extend <span class=free>e</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>e</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>e</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extend_def neg_mask_test_bit word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_bitwise_if'  <span class=main>[</span><span class=operator>word_eqI_simps</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟹</span> sign_extend <span class=free>e</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>e</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>e</span><span class=main>)</span>›</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>w</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=tfree>'a</span><span class=main>::</span>len word›</span></span>
  <span class=keyword1><span class=command>using</span></span> sign_extend_bitwise_if <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>i</span></span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>e</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_bitwise_disj<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> sign_extend <span class=free>e</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>⟷</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>e</span> <span class=main>∧</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>∨</span> <span class=free>e</span> <span class=main>≤</span> <span class=free>i</span> <span class=main>∧</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>e</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sign_extend_bitwise_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_bitwise_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> size <span class=free>w</span> <span class=main>⟹</span> sign_extend <span class=free>e</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>⟷</span> <span class=main>(</span><span class=free>i</span> <span class=main>≤</span> <span class=free>e</span> <span class=main>⟶</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>i</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=free>e</span> <span class=main>≤</span> <span class=free>i</span> <span class=main>⟶</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>e</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sign_extend_bitwise_if<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> sign_extend_bitwise_disj' <span class=main>=</span> sign_extend_bitwise_disj<span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sign_extend_bitwise_cases' <span class=main>=</span> sign_extend_bitwise_cases<span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>]</span>

<span class=comment1>(* Often, it is easier to reason about an operation which does not overwrite
   the bit which determines which mask operation to apply. *)</span>
<span class=keyword1><span class=command>lemma</span></span> sign_extend_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"sign_extend <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=keyword1>OR</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>w</span> <span class=keyword1>AND</span> mask <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> sign_extend_eq_signed_take_bit min_def test_bit_eq_bit less_Suc_eq_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_sign_extend<span class=main>:</span>
  <span class=quoted><span class=quoted>"sign_extended <span class=free>n</span> <span class=main>(</span>sign_extend <span class=free>n</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sign_extended_def word_size sign_extend_bitwise_if<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_iff_sign_extend<span class=main>:</span>
  <span class=quoted><span class=quoted>"sign_extended <span class=free>n</span> <span class=free>w</span> <span class=main>⟷</span> sign_extend <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_eq_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> sign_extend_eq_signed_take_bit not_le min_def sign_extended_def test_bit_eq_bit word_size <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> le_imp_less_or_eq <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit_imp_le_length nat_less_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Suc_leI Suc_n_not_le_n le_trans nat_less_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_weaken<span class=main>:</span>
  <span class=quoted><span class=quoted>"sign_extended <span class=free>n</span> <span class=free>w</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> sign_extended <span class=free>m</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sign_extended_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_sign_extend_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"sign_extend <span class=free>m</span> <span class=main>(</span>sign_extend <span class=free>n</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> sign_extend <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bit_word_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extend_eq_signed_take_bit <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_high_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> sign_extended <span class=free>e</span> <span class=free>p</span><span class=main>;</span> <span class=free>j</span> <span class=main>&lt;</span> size <span class=free>p</span><span class=main>;</span> <span class=free>e</span> <span class=main>≤</span> <span class=free>i</span><span class=main>;</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>!!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>p</span> <span class=main>!!</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> sign_extended_weaken<span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extended_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extend_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=keyword1>AND</span> mask <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>v</span> <span class=keyword1>AND</span> mask <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> sign_extend <span class=free>n</span> <span class=free>w</span> <span class=main>=</span> sign_extend <span class=free>n</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> take_bit_eq_mask <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extend_eq_signed_take_bit signed_take_bit_eq_iff_take_bit_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_add<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> p<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>p</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> f<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> e<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>e</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sign_extended <span class=free>e</span> <span class=free>p</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sign_extended <span class=free>e</span> <span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>e</span> <span class=main>&lt;</span> size <span class=free>p</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>note</span></span> and_or <span class=main>=</span> is_aligned_add_or<span class=main>[</span><span class=operator>OF</span> p f<span class=main>]</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>f</span> <span class=main>!!</span> <span class=free>e</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> True e less_2p_is_upper_bits_unset<span class=main>[</span><span class=operator>THEN</span> iffD1<span class=main>,</span> <span class=operator>OF</span> f<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> i<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>p</span> <span class=main>+</span> <span class=free>f</span><span class=main>)</span> <span class=main>!!</span> <span class=free>e</span> <span class=main>=</span> <span class=free>p</span> <span class=main>!!</span> <span class=free>e</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_or<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> fm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=keyword1>AND</span> mask <span class=free>e</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subst<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>f</span><span class=main>.</span> <span class=bound>f</span> <span class=keyword1>AND</span> mask <span class=free>e</span> <span class=main>=</span> <span class=bound>f</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> less_mask_eq<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> f<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span>
                  <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mask_twice e<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extended_iff_sign_extend sign_extend_def i<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> and_or word_bw_comms<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>p</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>f</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_ao_dist fm word_bw_assocs <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_splits<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sign_extended_def word_size<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> sign_extended_neq_mask<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>sign_extended <span class=free>n</span> <span class=free>ptr</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> sign_extended <span class=free>n</span> <span class=main>(</span><span class=free>ptr</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sign_extended_def word_size neg_mask_test_bit<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>limited_and</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>AND</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> limited_and_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> limited_and <span class=free>x</span> <span class=free>z</span><span class=main>;</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=free>z</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> limited_and_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> arg_cong2<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=keyword1>(AND)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> sym<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bw_assocs word_bw_comms word_bw_lcs<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> limited_and_eq_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> limited_and <span class=free>x</span> <span class=free>z</span><span class=main>;</span> <span class=free>y</span> <span class=keyword1>AND</span> <span class=free>z</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> limited_and_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_bw_lcs word_bw_assocs word_bw_comms<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> lshift_limited_and<span class=main>:</span>
  <span class=quoted><span class=quoted>"limited_and <span class=free>x</span> <span class=free>z</span> <span class=main>⟹</span> limited_and <span class=main>(</span><span class=free>x</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>z</span> <span class=main>&lt;&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> limited_and_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftl_over_and_dist<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rshift_limited_and<span class=main>:</span>
  <span class=quoted><span class=quoted>"limited_and <span class=free>x</span> <span class=free>z</span> <span class=main>⟹</span> limited_and <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>z</span> <span class=main>&gt;&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> limited_and_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> shiftr_over_and_dist<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> limited_and_simps1 <span class=main>=</span> limited_and_eq_0 limited_and_eq_id

<span class=keyword1><span class=command>lemmas</span></span> is_aligned_limited_and
    <span class=main>=</span> is_aligned_neg_mask_eq<span class=main>[</span><span class=operator>unfolded</span> mask_eq_decr_exp<span class=main>,</span> <span class=operator>folded</span> limited_and_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> limited_and_simps <span class=main>=</span> limited_and_simps1
       limited_and_simps1<span class=main>[</span><span class=operator>OF</span> is_aligned_limited_and<span class=main>]</span>
       limited_and_simps1<span class=main>[</span><span class=operator>OF</span> lshift_limited_and<span class=main>]</span>
       limited_and_simps1<span class=main>[</span><span class=operator>OF</span> rshift_limited_and<span class=main>]</span>
       limited_and_simps1<span class=main>[</span><span class=operator>OF</span> rshift_limited_and<span class=main>,</span> <span class=operator>OF</span> is_aligned_limited_and<span class=main>]</span>
       not_one shiftl_shiftr1<span class=main>[</span><span class=operator>unfolded</span> word_size mask_eq_decr_exp<span class=main>]</span>
       shiftl_shiftr2<span class=main>[</span><span class=operator>unfolded</span> word_size mask_eq_decr_exp<span class=main>]</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>from_bool</span> <span class=main>::</span> <span class=quoted><span class=quoted>"bool <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>::</span>len word"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>from_bool</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>of</span> True <span class=main>⇒</span> of_nat <span class=main>1</span>
                         <span class=main>|</span> False <span class=main>⇒</span> of_nat <span class=main>0</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>‹from_bool <span class=main>=</span> of_bool›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff from_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>from_bool <span class=free>x</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_eq_if'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> from_bool <span class=free>Q</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>P</span> <span class=main>=</span> <span class=free>Q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>Q</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>to_bool</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>to_bool</span> <span class=main>≡</span> <span class=main>(≠)</span> <span class=main>0</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> to_bool_and_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bool <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>!!</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> test_bit_word_eq to_bool_def and_one_eq mod_2_eq_odd<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bool_from_bool <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"to_bool <span class=main>(</span>from_bool <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> from_bool_def to_bool_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_neq_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>from_bool <span class=free>b</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_mask_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>from_bool <span class=free>r</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> from_bool <span class=free>r</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> from_bool_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>from_bool <span class=free>P</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> ge_0_from_bool <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> from_bool <span class=free>P</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> limited_and_from_bool<span class=main>:</span>
  <span class=quoted><span class=quoted>"limited_and <span class=main>(</span>from_bool <span class=free>b</span><span class=main>)</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def limited_and_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.split<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bool_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"to_bool <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bool_def<span class=main>)</span>
<span class=keyword1><span class=command>lemma</span></span> to_bool_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>to_bool <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_eq_if<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>from_bool <span class=free>Q</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>P</span> <span class=main>=</span> <span class=free>Q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>Q</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> from_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bool_eq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span> to_bool <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> to_bool_neq_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>to_bool <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_all_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>bool</span><span class=main>.</span> from_bool <span class=bound>bool</span> <span class=main>=</span> <span class=free>val</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>bool</span><span class=main>)</span>
      <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>∃</span><span class=bound>bool</span><span class=main>.</span> from_bool <span class=bound>bool</span> <span class=main>=</span> <span class=free>val</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=free>val</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> from_bool_0<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> fold_eq_0_to_bool<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> to_bool <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> to_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_to_bool_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>=</span> from_bool <span class=free>b</span> <span class=main>⟷</span> to_bool <span class=free>w</span> <span class=main>=</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>(</span><span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>w</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> from_bool_def to_bool_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_bool_eqI<span class=main>:</span>
  <span class=quoted><span class=quoted>"from_bool <span class=free>x</span> <span class=main>=</span> from_bool <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> from_bool_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> bool.splits<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> neg_mask_in_mask_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=free>ptr</span> <span class=free>bits</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>ptr'</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>bits</span><span class=main>)</span> <span class=main>=</span> <span class=free>ptr</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>ptr'</span> <span class=main>∈</span> mask_range <span class=free>ptr</span> <span class=free>bits</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_and_le2<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_plus_and_or_coroll<span class=main><span class=keyword3>,</span></span> <span class=operator>word_eqI_solve</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> bit.disj_ac<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> bit.disj_conj_distrib2 le_word_or2 word_and_max word_or_not<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>smt</span> add.right_neutral eq_iff is_aligned_neg_mask_eq mask_out_add_aligned neg_mask_mono_le
              word_and_not<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow mask_eq_decr_exp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_offset_in_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>m</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span><span class=main>;</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≥</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>∈</span> <span class=main>{</span><span class=free>p</span> <span class=main>..</span> <span class=free>p</span> <span class=main>+</span> mask <span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> mask_range <span class=free>p</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disjunctive_add<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_alignedE'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>bit_simps</span></span> not_le<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> less_2p_is_upper_bits_unset test_bit_eq_bit<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> is_aligned_add_or word_ao_dist <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> neg_mask_in_mask_range<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> is_aligned_mask is_aligned_neg_mask less_mask_eq word_bw_comms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_bw_lcs<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_range_to_bl'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>ptr</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>bits</span><span class=main>;</span> <span class=free>bits</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> mask_range <span class=free>ptr</span> <span class=free>bits</span>
       <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>ptr</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>y</span><span class=main>.</span> <span class=improper>x</span> <span class=main>=</span> <span class=free>ptr</span> <span class=main>+</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>bits</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_add_conv<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>-</span> <span class=free>ptr</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_less_sub_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_diff_ls'<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> mask_eq_decr_exp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>bits</span> <span class=main>∧</span> to_bl <span class=main>(</span><span class=free>ptr</span> <span class=main>+</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> to_bl <span class=improper>x</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> is_aligned_no_wrap'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_diff_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mask_eq_decr_exp<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_no_wrap'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"of_bl <span class=main>(</span>drop <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=improper>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> context_conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> of_bl_length<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> is_aligned_add_conv<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rep_drop<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_range_to_bl<span class=main>:</span>
  <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>ptr</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>bits</span>
   <span class=main>⟹</span> mask_range <span class=free>ptr</span> <span class=free>bits</span>
        <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> take <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>(</span>to_bl <span class=free>ptr</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> is_aligned_get_word_bits<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mask_range_to_bl'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_overflow mask_eq_decr_exp<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_range_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>p'</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n'</span> <span class=main>⟧</span>
   <span class=main>⟹</span> mask_range <span class=free>p</span> <span class=free>n</span> <span class=main>∩</span> mask_range <span class=free>p'</span> <span class=free>n'</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>∨</span>
       mask_range <span class=free>p</span> <span class=free>n</span> <span class=main>⊆</span> mask_range <span class=free>p'</span> <span class=free>n'</span> <span class=main>∨</span>
       mask_range <span class=free>p</span> <span class=free>n</span> <span class=main>⊇</span> mask_range <span class=free>p'</span> <span class=free>n'</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_range_to_bl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Meson.disj_comm<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> disjCI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>n''</span><span class=main>.</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n'</span><span class=main>)</span> <span class=main>+</span> <span class=bound>n''</span><span class=main>)</span>
                    <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n''</span><span class=main>.</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n'</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>+</span> <span class=bound>n''</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> take_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>arith</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_range_offset_subset<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> al<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=main>(</span><span class=free>ptr</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>sz</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> al'<span class=main>:</span> <span class=quoted><span class=quoted>"is_aligned <span class=free>x</span> <span class=free>sz'</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> szv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz'</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> xsz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mask_range <span class=main>(</span><span class=free>ptr</span><span class=main>+</span><span class=free>x</span><span class=main>)</span> <span class=free>sz'</span> <span class=main>⊆</span> mask_range <span class=free>ptr</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> al
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_get_word_bits<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> p0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ptr</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> szv'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>::</span><span class=tfree>'a</span> word<span class=main>)</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> p0
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>^</span> <span class=free>sz</span> <span class=main>=</span> <span class=main>0</span>›</span></span> mask_eq_decr_exp<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> szv'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>hence</span></span> blah<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>sz</span> <span class=main>-</span> <span class=free>sz'</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> szv <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> szv szv'
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>using</span></span> al assms<span class=main>(</span>4<span class=main>)</span> is_aligned_no_wrap' <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> add_diff_eq add_mask_fold<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> add.assoc<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
     <span class=keyword1><span class=command>using</span></span> al' is_aligned_add_less_t2n xsz
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> szv al is_aligned_no_overflow<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_ranges_disjoint<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>p</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>p'</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n'</span><span class=main>;</span>
     <span class=free>p</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n'</span><span class=main>)</span> <span class=main>≠</span> <span class=free>p'</span><span class=main>;</span> <span class=free>p'</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span><span class=main>(</span>mask <span class=free>n</span><span class=main>)</span> <span class=main>≠</span> <span class=free>p</span> <span class=main>⟧</span>
   <span class=main>⟹</span> mask_range <span class=free>p</span> <span class=free>n</span> <span class=main>∩</span> mask_range <span class=free>p'</span> <span class=free>n'</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> aligned_mask_range_cases
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> neg_mask_in_mask_range<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_ranges_disjoint2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>ptr</span> <span class=free>bits</span><span class=main>;</span> <span class=free>n</span> <span class=main>≥</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> size <span class=free>p</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>bits</span><span class=main>;</span>
     <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>y</span></span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span><span class=main>.</span> <span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=bound>y</span> <span class=main>&lt;&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=main>∉</span> mask_range <span class=free>ptr</span> <span class=free>bits</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> mask_range <span class=free>p</span> <span class=free>n</span> <span class=main>∩</span> mask_range <span class=free>ptr</span> <span class=free>bits</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quasi_keyword>flip</span><span class=main><span class=main>:</span></span> neg_mask_in_mask_range<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=keyword1>AND</span> mask <span class=free>n</span> <span class=main>&gt;&gt;</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> and_mask_less_size wsst_TYs shiftr_less_t2n multiple_mask_trivia neg_mask_twice
                        word_bw_assocs max_absorb2 shiftr_shiftl1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_sint_upper<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≥</span> <span class=numeral>3</span> <span class=main>⟹</span> sint <span class=main>(</span>of_nat <span class=main>(</span>word_clz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> sword<span class=main>)</span> <span class=main>≤</span> int <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> word_clz_max <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> signed_take_bit_int_eq_self<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> negative_zle of_nat_numeral semiring_1_class.of_nat_power<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> small_powers_of_2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> word_clz_sint_lower<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>≥</span> <span class=numeral>3</span>
   <span class=main>⟹</span> <span class=main>-</span> sint <span class=main>(</span>of_nat <span class=main>(</span>word_clz <span class=main>(</span><span class=free>w</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span> <span class=main>≤</span> int <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> sint_eq_uint<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> word_clz_max <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> not_msb_from_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_less_nat_alt<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_bit_nat_eq_self<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> small_powers_of_2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> mask_range_subsetD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p'</span> <span class=main>∈</span> mask_range <span class=free>p</span> <span class=free>n</span><span class=main>;</span> <span class=free>x'</span> <span class=main>∈</span> mask_range <span class=free>p'</span> <span class=free>n'</span><span class=main>;</span> <span class=free>n'</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>p</span> <span class=free>n</span><span class=main>;</span> is_aligned <span class=free>p'</span> <span class=free>n'</span> <span class=main>⟧</span> <span class=main>⟹</span>
   <span class=free>x'</span> <span class=main>∈</span> mask_range <span class=free>p</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> aligned_mask_step <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> nasty_split_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span> len word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_diff_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_1<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_sub_mono<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_mult_le_mono1<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inc_le<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> word_neq_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_not_zero<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_power_lower<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power_strict_increasing<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_sub_1_le<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> shiftl_t2n<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_shift_nonzero<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> inc_le<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unat_arith</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_power_less_1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nasty_split_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>nm</span><span class=main>;</span> <span class=free>nm</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>len<span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>nm</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>⟧</span>
   <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>nm</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_less_sub_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ nasty_split_lt<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_plus_mono_right<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> word_sub_mono<span class=main>)</span>
         <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_le_nat_alt<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sub_1_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> power_not_zero<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_sub_1_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> power_not_zero<span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_no_wrap'<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_aligned_mult_triv2<span class=main>)</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> order_le_less_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> add_mult_in_mask_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>base</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>bits</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>bits</span><span class=main>)</span> <span class=main>⟧</span>
   <span class=main>⟹</span> <span class=free>base</span> <span class=main>+</span> <span class=free>x</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>^</span><span class=free>bits</span> <span class=main>∈</span> mask_range <span class=free>base</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_no_wrap' mask_2pm1 nasty_split_lt word_less_power_trans2
                word_plus_mono_right<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> from_to_bool_last_bit<span class=main>:</span>
  <span class=quoted><span class=quoted>"from_bool <span class=main>(</span>to_bool <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> from_bool_to_bool_iff word_and_1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> sint_ctz<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=numeral>2</span>
   <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> sint <span class=main>(</span>of_nat <span class=main>(</span>word_ctz <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span>
        <span class=main>∧</span> sint <span class=main>(</span>of_nat <span class=main>(</span>word_ctz <span class=free>x</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'a</span> signed word<span class=main>)</span> <span class=main>≤</span> int <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> len_signed order_le_less_trans sint_of_nat_ge_zero word_ctz_le<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> int_eq_sint len_signed sint_of_nat_le word_ctz_le<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> small_powers_of_2 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>‹<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_nat_word_log2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span>
   <span class=main>⟹</span> unat <span class=main>(</span>of_nat <span class=main>(</span>word_log2 <span class=main>(</span><span class=free>n</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>)</span> <span class=main>::</span> <span class=tfree>'b</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>=</span> word_log2 <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_trans unat_of_nat_eq word_log2_max word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> aligned_mask_diff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> is_aligned <span class=main>(</span><span class=free>dest</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>bits</span><span class=main>;</span> is_aligned <span class=main>(</span><span class=free>ptr</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=free>sz</span><span class=main>;</span>
     <span class=free>bits</span> <span class=main>≤</span> <span class=free>sz</span><span class=main>;</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span><span class=main>;</span> <span class=free>dest</span> <span class=main>&lt;</span> <span class=free>ptr</span> <span class=main>⟧</span>
   <span class=main>⟹</span> mask <span class=free>bits</span> <span class=main>+</span> <span class=free>dest</span> <span class=main>&lt;</span> <span class=free>ptr</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> p' <span class=main><span class=main>=</span></span> <span class=quoted><span class=free>ptr</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> aligned_mask_range_cases<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>elim</span> disjE<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> is_aligned_no_overflow_mask<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_split_simps</span></span> word_le_not_less<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> is_aligned_no_overflow_mask<span class=main><span class=keyword3>;</span></span> <span class=operator>fastforce</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_aligned_weaken <span class=dynamic><span class=dynamic>algebra_split_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> is_aligned_no_overflow_mask leD <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>meson</span> aligned_add_mask_less_eq is_aligned_weaken le_less_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span></pre></div><div id=Word_32><div class=head><h1>Theory Word_32</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Words of Length 32"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_32
  <span class=keyword2><span class=keyword>imports</span></span>
    <a href=Word_Lemmas.html>Word_Lemmas</a>
    <a href=Word_Syntax.html>Word_Syntax</a>
    <a href=Word_Names.html>Word_Names</a>
    <a href=Rsplit.html>Rsplit</a>
    <a href=More_Word_Operations.html>More_Word_Operations</a>
    <a href=Bitwise.html>Bitwise</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> word32 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> word"</span></span>
<span class=keyword1><span class=command>lemma</span></span> len32<span class=main>:</span> <span class=quoted><span class=quoted>"len_of <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>32</span> itself<span class=main>)</span> <span class=main>=</span> <span class=numeral>32</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>type_synonym</span></span> sword32 <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> sword"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> machine_word_len <span class=main>=</span> <span class=quoted><span class=numeral>32</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> machine_word <span class=main>=</span> <span class=quoted><span class=quoted>"machine_word_len word"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_bits</span> <span class=main>::</span> <span class=quoted>nat</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_bits</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span>machine_word_len<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following two are numerals so they can be used as nats and words.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_size_bits</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> numeral"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_size_bits</span> <span class=main>=</span> <span class=numeral>2</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_size</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> numeral"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_size</span> <span class=main>=</span> <span class=numeral>4</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_conv<span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"word_bits <span class=main>=</span> <span class=numeral>32</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_size_word_size_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_size<span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> word_size_bits"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_size_def word_size_bits_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_word_size_conv<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_bits <span class=main>=</span> word_size <span class=main>*</span> <span class=numeral>8</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def word_size_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_8_32_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"inj <span class=main>(</span>ucast <span class=main>::</span>  <span class=numeral>8</span> word <span class=main>⇒</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> down_ucast_inj<span class=main>)</span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_down_def target_size source_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_2_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=numeral>2</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemmas</span></span> upper_bits_unset_is_l2p_32 <span class=main>=</span> upper_bits_unset_is_l2p <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> le_2p_upper_bits_32 <span class=main>=</span> le_2p_upper_bits <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> le2p_bits_unset_32 <span class=main>=</span> le2p_bits_unset<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_len_of<span class=main>:</span>
  <span class=quoted><span class=quoted>"len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>32</span><span class=main>)</span> <span class=main>=</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_power_lower32' <span class=main>=</span> unat_power_lower<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_power_lower32 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> unat_power_lower32'<span class=main>[</span><span class=operator>unfolded</span> word_bits_len_of<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word32_less_sub_le' <span class=main>=</span> word_less_sub_le<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main>=</span></span> <span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word32_less_sub_le<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> word32_less_sub_le' <span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"size <span class=main>(</span><span class=free>w</span><span class=main>::</span>word32<span class=main>)</span> <span class=main>=</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word32_power_less_1' <span class=main>=</span> word_power_less_1<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main>=</span></span> <span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word32_power_less_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> word32_power_less_1'<span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat32_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>of_nat <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>word32<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits<span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> of_nat_0<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_mask_2_less_4<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>p</span> <span class=main>&amp;&amp;</span> mask <span class=numeral>2</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>4</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> word_and_le1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> unat_of_nat32' <span class=main>=</span> unat_of_nat_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_of_nat32 <span class=main>=</span> unat_of_nat32'<span class=main>[</span><span class=operator>unfolded</span> word_bits_len_of<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_power_nonzero_32 <span class=main>=</span> word_power_nonzero <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_mult_simple <span class=main>=</span> iffD1 <span class=main>[</span><span class=operator>OF</span> unat_mult_lem <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=numeral>32</span></span><span class=main><span class=main>,</span></span> <span class=operator>unfolded</span> word_bits_len_of<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> div_power_helper_32 <span class=main>=</span> div_power_helper <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> n_less_word_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> word_bits<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>32</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> of_nat_less_pow_32 <span class=main>=</span> of_nat_power <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> lt_word_bits_lt_pow<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> word_bits <span class=main>⟹</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_word_bits<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>word32</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> unat <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ unat_lt2p<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_mask_word32' <span class=main>=</span> unat_mask<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_mask_word32 <span class=main>=</span> unat_mask_word32'<span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_2p_word_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> Suc_unat_mask_div<span class=main>:</span>
  <span class=quoted><span class=quoted>"Suc <span class=main>(</span>unat <span class=main>(</span>mask <span class=free>sz</span> <span class=keyword1>div</span> word_size<span class=main>::</span>word32<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>sz</span> word_bits <span class=main>-</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> word_bits"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size_def word_bits_def min_def mask_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> Suc_div_unat_helper
           <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>32</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> sz<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>sz</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> us<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>2</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le word_size_def word_bits_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>sz</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>nat</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths
                                  unat_mask_word32 min_def word_bits_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths
                   unat_mask_word32 min_def word_bits_def word_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word32_minus_one_le' <span class=main>=</span> word_minus_one_le<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word32_minus_one_le <span class=main>=</span> word32_minus_one_le'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_not_helper<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=numeral>8</span> word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=numeral>0xFF</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ucast <span class=free>a</span> <span class=main>≠</span> <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word32<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ucast <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word32<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word32<span class=main>)</span> <span class=main>=</span> ucast <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>using</span></span> a
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> up_ucast_inj<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> less_4_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span>word32<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>4</span> <span class=main>⟹</span> <span class=free>x</span><span class=main>=</span><span class=main>0</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=main>1</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=numeral>2</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=numeral>3</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_less_cases<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_8_32<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>8</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_then_1_else_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word32<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_then_0_else_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word32<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> if_then_simps <span class=main>=</span> if_then_0_else_1 if_then_1_else_0

<span class=keyword1><span class=command>lemma</span></span> ucast_le_ucast_8_32<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span>ucast <span class=free>y</span> <span class=main>::</span> word32<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_le_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> in_16_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>r</span> <span class=main>+</span> <span class=bound>x</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>16</span> <span class=main>::</span> word32<span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>S</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>r</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>16</span> <span class=main>*</span> <span class=free>n</span> <span class=main>-</span> <span class=numeral>16</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=main>::</span> word32<span class=main>.</span> <span class=free>r</span> <span class=main>+</span> <span class=bound>x</span> <span class=main>*</span> <span class=numeral>16</span><span class=main>)</span> <span class=main>`</span> <span class=free>S</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> image_def <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bexI<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> eq_2_32_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=numeral>32</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> x_less_2_0_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>word32</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> x_less_2_0_1'<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> mask_32_max_word  <span class=main>=</span> max_word_mask <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat32_n_less_equal_power_2<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>32</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span>of_nat <span class=free>n</span><span class=main>)</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_n_less_equal_power_2<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_rsplit <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rsplit_def bin_rsplit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_10_32 <span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>10</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bool_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>word32</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>&amp;&amp;</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bool_mask'<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word32_bounds<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2147483648</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2147483647</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>32</span> signed word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2147483648</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>32</span> signed word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2147483647</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_ge_min<span class=main>:</span><span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=numeral>2147483648</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> sint_ge word32_bounds<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_arith_ineq_checks_to_eq_word32'
    <span class=main>=</span> signed_arith_ineq_checks_to_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span></span></span><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral>32</span></span></span></span></span></span></span></span></span></span></span></span><span class=main>]</span>
      signed_arith_ineq_checks_to_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=numeral><span class=numeral><span class=numeral><span class=numeral><span class=numeral><span class=numeral>32</span></span></span></span></span></span> signed"</span></span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_arith_ineq_checks_to_eq_word32
    <span class=main>=</span> signed_arith_ineq_checks_to_eq_word32' <span class=main>[</span><span class=operator>unfolded</span> word32_bounds<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_mult_eq_checks32_to_64'
    <span class=main>=</span> signed_mult_eq_checks_double_size<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'b</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
      signed_mult_eq_checks_double_size<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>32</span> signed"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'b</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_mult_eq_checks32_to_64 <span class=main>=</span> signed_mult_eq_checks32_to_64'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sdiv_word32_max' <span class=main>=</span> sdiv_word_max <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span> sdiv_word_max <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>32</span> signed"</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sdiv_word32_max <span class=main>=</span> sdiv_word32_max'<span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sdiv_word32_min' <span class=main>=</span> sdiv_word_min <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span> sdiv_word_min <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>32</span> signed"</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sdiv_word32_min <span class=main>=</span> sdiv_word32_min' <span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sint32_of_int_eq' <span class=main>=</span> sint_of_int_eq <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sint32_of_int_eq <span class=main>=</span> sint32_of_int_eq' <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_of_nats <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>::</span> sword32<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>::</span> <span class=numeral>16</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word32<span class=main>)</span> <span class=main>::</span> <span class=numeral>8</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=numeral>16</span> word<span class=main>)</span> <span class=main>::</span> <span class=numeral>16</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=numeral>16</span> word<span class=main>)</span> <span class=main>::</span> <span class=numeral>8</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span> <span class=main>::</span> <span class=numeral>8</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_take_bit take_bit_word_eq_self<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_simpler_32'
    <span class=main>=</span> power_strict_increasing_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>::</span> nat"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>31</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_simpler_32 <span class=main>=</span> signed_shift_guard_simpler_32'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word32_31_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>32</span> signed<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> nat<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>32</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> nat<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_to_word_32
    <span class=main>=</span> signed_shift_guard_to_word<span class=main>[</span><span class=operator>OF</span> word32_31_less<span class=main><span class=main>(</span></span>1-2<span class=main><span class=main>)</span></span><span class=main>]</span>
    signed_shift_guard_to_word<span class=main>[</span><span class=operator>OF</span> word32_31_less<span class=main><span class=main>(</span></span>3-4<span class=main><span class=main>)</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_word_3<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≤</span>  <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=numeral>32</span> <span class=main>-</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_step_down_word_2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span>word32<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> has_zero_byte<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>~~</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>v</span><span class=main>::</span>word32<span class=main>)</span> <span class=main>&amp;&amp;</span> <span class=numeral>0x7f7f7f7f</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>0x7f7f7f7f</span><span class=main>)</span> <span class=main>||</span> <span class=free>v</span><span class=main>)</span> <span class=main>||</span> <span class=numeral>0x7f7f7f7f</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>
    <span class=main>⟹</span> <span class=free>v</span> <span class=main>&amp;&amp;</span> <span class=numeral>0xff000000</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>&amp;&amp;</span> <span class=numeral>0xff0000</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>&amp;&amp;</span> <span class=numeral>0xff00</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>v</span> <span class=main>&amp;&amp;</span> <span class=numeral>0xff</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_bitwise</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> mask_step_down_32<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=numeral>32</span> <span class=main>∧</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>32</span>word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹odd <span class=free>b</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_2_eq_odd and_one_eq<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> odd_iff_mod_2_eq_one <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=numeral>32</span> <span class=main>∧</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>&lt;</span> <span class=numeral>32</span>›</span></span> <span class=quoted><span class=quoted>‹mask <span class=skolem>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹mask <span class=skolem>x</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=numeral>2</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> shiftr1_is_div_2 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>…</span> <span class=main>=</span> <span class=free>b</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_div_mod_eq<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=free>b</span>›</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹mask <span class=main>(</span>Suc <span class=skolem>x</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_Suc_rec<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_int_32<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>i</span> <span class=main>≥</span> <span class=main>0</span><span class=main>;</span> <span class=free>i</span> <span class=main>≤</span><span class=numeral>2</span> <span class=main>^</span> <span class=numeral>31</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>unat <span class=main>(</span><span class=main>(</span>of_int <span class=free>i</span><span class=main>)</span><span class=main>::</span>sword32<span class=main>)</span><span class=main>)</span> <span class=main>=</span> nat <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unat_eq_nat_uint
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> eq_nat_nat_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_int_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_ctz_not_minus_1_32 <span class=main>=</span> word_ctz_not_minus_1<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>32</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=comment1>(* Helper for packing then unpacking a 64-bit variable. *)</span>
<span class=keyword1><span class=command>lemma</span></span> cast_chunk_assemble_id_64<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>||</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=numeral>32</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=numeral>32</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>cast_chunk_assemble_id<span class=main>)</span>

<span class=comment1>(* Another variant of packing and unpacking a 64-bit variable. *)</span>
<span class=keyword1><span class=command>lemma</span></span> cast_chunk_assemble_id_64'<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>||</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span>ucast <span class=main>(</span><span class=main>(</span>scast <span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=numeral>32</span><span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span><span class=main>)</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>&lt;&lt;</span> <span class=numeral>32</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>cast_chunk_scast_assemble_id<span class=main>)</span>

<span class=comment1>(* Specialisations of down_cast_same for adding to local simpsets. *)</span>
<span class=keyword1><span class=command>lemma</span></span> cast_down_u64<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>scast<span class=main>::</span><span class=numeral>64</span> word <span class=main>⇒</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast<span class=main>::</span><span class=numeral>64</span> word <span class=main>⇒</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> down_cast_same<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>is_down<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> cast_down_s64<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>scast<span class=main>::</span><span class=numeral>64</span> sword <span class=main>⇒</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>ucast<span class=main>::</span><span class=numeral>64</span> sword <span class=main>⇒</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> down_cast_same<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>is_down<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word32_and_max_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xFFFFFFFF</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>32</span> word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_and_full_mask_simp <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc mask_Suc_exp<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Many_More><div class=head><h1>Theory Many_More</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>theory</span></span> Many_More
  <span class=keyword2><span class=keyword>imports</span></span>
    <a href=../../HOL/HOL/Main.html>Main</a>
    <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
    <a href=More_Word.html>More_Word</a>
    <a href=Even_More_List.html>Even_More_List</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_less_mult_monoish<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>d</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>&lt;=</span> <span class=free>b</span> <span class=main>*</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Suc_leI<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult_le_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> if_and_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>If <span class=free>x</span> <span class=free>v</span> <span class=free>v'</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=free>v''</span> <span class=main>=</span> If <span class=free>x</span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>AND</span> <span class=free>v''</span><span class=main>)</span> <span class=main>(</span><span class=free>v'</span> <span class=keyword1>AND</span> <span class=free>v''</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> if_distrib<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> eq_eqI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> map2_Cons_2_3<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>#</span> <span class=free>zs</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span> <span class=bound>xs'</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>#</span> <span class=bound>xs'</span> <span class=main>∧</span> <span class=free>f</span> <span class=bound>x</span> <span class=free>y</span> <span class=main>=</span> <span class=free>z</span> <span class=main>∧</span> map2 <span class=free>f</span> <span class=bound>xs'</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>zs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> map2_xor_replicate_False<span class=main>:</span>
  <span class=quoted><span class=quoted>"map2 <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>⟷</span> <span class=main>¬</span> <span class=bound>y</span><span class=main>)</span> <span class=free>xs</span> <span class=main>(</span>replicate <span class=free>n</span> False<span class=main>)</span> <span class=main>=</span> take <span class=free>n</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> plus_Collect_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(+)</span> <span class=free>x</span> <span class=main>`</span> <span class=main>{</span><span class=bound>xa</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>xa</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>xa</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>xa</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> plus_Collect_helper2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(+)</span> <span class=main>(</span><span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=bound>xa</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>xa</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>xa</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=bound>xa</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> plus_Collect_helper <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=free>x</span>"</span></span> <span class=quoted><span class=free>P</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> range_subset_eq2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word <span class=main>..</span> <span class=free>b</span><span class=main>}</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>{</span><span class=free>a</span> <span class=main>..</span> <span class=free>b</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>c</span> <span class=main>..</span> <span class=free>d</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>c</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nat_mod_power_lem<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>a</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_iff_add power_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> i_hate_words_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=main>(</span><span class=free>j</span> <span class=main>-</span> <span class=free>k</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> i_hate_words<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> word<span class=main>)</span> <span class=main>≤</span> unat <span class=main>(</span><span class=free>b</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> len word<span class=main>)</span> <span class=main>-</span> Suc <span class=main>0</span>
    <span class=main>⟹</span> <span class=free>a</span> <span class=main>≠</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> i_hate_words_helper<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span><span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> word_le_nat_alt<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_minus_one_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> notE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_Suc_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> neq0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> unat_eq_0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(+)</span></span> <span class=main><span class=main>1</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> If_eq_obvious<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=free>z</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> Some_to_the<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>=</span> Some <span class=free>x</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> the <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> dom_if_Some<span class=main>:</span>
  <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> <span class=free>P</span> <span class=bound>x</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>∪</span> dom <span class=free>g</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> dom_insert_absorb<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> dom <span class=free>f</span> <span class=main>⟹</span> insert <span class=free>x</span> <span class=main>(</span>dom <span class=free>f</span><span class=main>)</span> <span class=main>=</span> dom <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> insert_absorb<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> emptyE2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>S</span> <span class=main>=</span> <span class=main>{}</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ptr_add_image_multI<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span> <span class=main>*</span> <span class=free>val</span> <span class=main>=</span> <span class=bound>y</span> <span class=main>*</span> <span class=free>val'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>x</span> <span class=main>*</span> <span class=free>val''</span> <span class=main>=</span> <span class=bound>y</span><span class=main>)</span><span class=main>;</span> <span class=free>x</span> <span class=main>*</span> <span class=free>val''</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span>
     <span class=free>ptr_add</span> <span class=free>ptr</span> <span class=main>(</span><span class=free>x</span> <span class=main>*</span> <span class=free>val</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>p</span><span class=main>.</span> <span class=free>ptr_add</span> <span class=free>ptr</span> <span class=main>(</span><span class=bound>p</span> <span class=main>*</span> <span class=free>val'</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>S</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span> <span class=operator>metis</span>

<span class=keyword1><span class=command>lemmas</span></span> map_prod_split_imageI'
  <span class=main>=</span> map_prod_imageI<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"case_prod <span class=free>f</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> g<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"case_prod <span class=free>g</span>"</span></span>
                    <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>c</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>for</span></span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span> <span class=free>f</span> <span class=free>g</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> map_prod_split_imageI <span class=main>=</span> map_prod_split_imageI'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> dom_if<span class=main>:</span>
  <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=main>λ</span><span class=bound>a</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>a</span> <span class=main>∈</span> <span class=free>addrs</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>f</span> <span class=bound>a</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>g</span> <span class=bound>a</span><span class=main>)</span>  <span class=main>=</span> <span class=free>addrs</span> <span class=main>∪</span> dom <span class=free>g</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dom_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> arg_cong_Not <span class=main>=</span> arg_cong <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main>=</span></span><span class=quoted>Not</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> drop_append_miracle<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span> drop <span class=free>n</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> foldr_does_nothing_to_xf<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xf</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span> <span class=bound>s</span><span class=main>)</span> <span class=main>=</span> <span class=free>xf</span> <span class=bound>s</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xf</span> <span class=main>(</span>foldr <span class=free>f</span> <span class=free>xs</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=free>xf</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mod_mod_power_int<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>m</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> mod_exp_eq<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_nat<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>i</span> <span class=main>=</span> <span class=free>n</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>;</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_int<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=free>i</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>i</span> <span class=main>=</span> <span class=free>n</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>;</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>⟶</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> replicate_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"replicate <span class=main>(</span>numeral <span class=free>k</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> replicate <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> list_exhaust_size_gt0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span> <span class=bound>list</span><span class=main>.</span> <span class=free>y</span> <span class=main>=</span> <span class=bound>a</span> <span class=main>#</span> <span class=bound>list</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> length <span class=free>y</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> list_exhaust_size_eq0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"length <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> size_Cons_lem_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=free>xa</span> <span class=main>#</span> <span class=free>list</span> <span class=main>⟹</span> size <span class=free>y</span> <span class=main>=</span> Suc <span class=free>k</span> <span class=main>⟹</span> size <span class=free>list</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> takeWhile_take_has_property<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> length <span class=main>(</span>takeWhile <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span> <span class=main>∈</span> set <span class=main>(</span>take <span class=free>n</span> <span class=free>xs</span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takeWhile_take_has_property_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=main>(</span>takeWhile <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takeWhile_replicate<span class=main>:</span>
  <span class=quoted><span class=quoted>"takeWhile <span class=free>f</span> <span class=main>(</span>replicate <span class=free>len</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>f</span> <span class=free>x</span> <span class=keyword1>then</span> replicate <span class=free>len</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=free><span class=quoted><span class=free>len</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> takeWhile_replicate_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>f</span> <span class=free>x</span> <span class=main>⟹</span> takeWhile <span class=free>f</span> <span class=main>(</span>replicate <span class=free>len</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takeWhile_replicate<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> takeWhile_replicate_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>x</span> <span class=main>⟹</span> takeWhile <span class=free>f</span> <span class=main>(</span>replicate <span class=free>len</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> replicate <span class=free>len</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> takeWhile_replicate<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rev<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> rev <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> <span class=main>1</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> rev_nth <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nth_rev_alt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>ys</span> <span class=main>⟹</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> rev <span class=free>ys</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>ys</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_rev<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> hd_butlast<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>&gt;</span> <span class=main>1</span> <span class=main>⟹</span> hd <span class=main>(</span>butlast <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> hd <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>xs</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> split_upt_on_n<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=free>m</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span> <span class=main>..&lt;</span> <span class=free>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=free>n</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span>Suc <span class=free>n</span> <span class=main>..&lt;</span> <span class=free>m</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> append_Cons append_Nil less_Suc_eq_le less_imp_le_nat upt_add_eq_append'
            upt_rec zero_less_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> drop_eq_mono<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> drop<span class=main>:</span> <span class=quoted><span class=quoted>"drop <span class=free>m</span> <span class=free>xs</span> <span class=main>=</span> drop <span class=free>m</span> <span class=free>ys</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"drop <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span> drop <span class=free>n</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> <span class=bound>p</span> <span class=main>+</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> exI<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>n</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=skolem>p</span> <span class=main>+</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>unfolding</span></span> p drop_drop<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> drop <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> drop_Suc_nth<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> drop <span class=free>n</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span><span class=main>!</span><span class=free>n</span> <span class=main>#</span> drop <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Cons_nth_drop_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> and_len<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> tl_if<span class=main>:</span> <span class=quoted><span class=quoted>"tl <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> tl <span class=free>xs</span> <span class=keyword1>else</span> tl <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> hd_if<span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> hd <span class=free>xs</span> <span class=keyword1>else</span> hd <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> if_single<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>xc</span> <span class=keyword1>then</span> <span class=main>[</span><span class=free>xab</span><span class=main>]</span> <span class=keyword1>else</span> <span class=main>[</span><span class=free>an</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=keyword1>if</span> <span class=free>xc</span> <span class=keyword1>then</span> <span class=free>xab</span> <span class=keyword1>else</span> <span class=free>an</span><span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=comment1>― ‹note -- <span class=antiquoted><span class=raw_text><span class=operator>‹</span>if_Cons›</span></span> can cause blowup in the size, if <span class=antiquoted><span class=raw_text><span class=operator>‹</span>p›</span></span> is complex, so make a simproc›</span>
<span class=keyword1><span class=command>lemma</span></span> if_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>#</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> If <span class=free>p</span> <span class=free>x</span> <span class=free>y</span> <span class=main>#</span> If <span class=free>p</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> list_of_false<span class=main>:</span>
  <span class=quoted><span class=quoted>"True <span class=main>∉</span> set <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>=</span> replicate <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> list_all2_induct <span class=main>[</span><span class=operator>consumes</span> 1<span class=main>,</span> <span class=operator>case_names</span> Nil Cons<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> lall<span class=main>:</span> <span class=quoted><span class=quoted>"list_all2 <span class=free>Q</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     nilr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>[]</span> <span class=main>[]</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    consr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>xs</span> <span class=bound>y</span> <span class=bound>ys</span><span class=main>.</span> <span class=main>⟦</span>list_all2 <span class=free>Q</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>;</span> <span class=free>Q</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>;</span> <span class=free>P</span> <span class=bound>xs</span> <span class=bound>ys</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>x</span> <span class=main>#</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>(</span><span class=bound>y</span> <span class=main>#</span> <span class=bound>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> lall
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_induct2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> list_all2_lengthD <span class=main><span class=main>[</span></span><span class=operator>OF</span> lall<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> 1 <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>2 <span class=skolem>x</span> <span class=skolem>xs</span> <span class=skolem>y</span> <span class=skolem>ys</span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> consr<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted>"2.prems"</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"list_all2 <span class=free>Q</span> <span class=skolem>xs</span> <span class=skolem>ys</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>x</span> <span class=skolem>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>xs</span> <span class=skolem>ys</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> <span class=quoted>"2.hyps"</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> replicate_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> replicate <span class=free>n</span> False <span class=main>=</span> replicate <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> False <span class=main>@</span> replicate <span class=free>k</span> False"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> replicate_add <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> cart_singleton_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>S</span> <span class=main>×</span> <span class=main>{</span><span class=free>e</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>S</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> MinI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> fa<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     ne<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     xv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>    min<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span><span class=main>.</span> <span class=free>m</span> <span class=main>≤</span> <span class=bound>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Min <span class=free>A</span> <span class=main>=</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> fa ne xv min
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>A</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>m</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> finite_ne_induct<span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> singleton <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>insert <span class=skolem>y</span> <span class=skolem>F</span><span class=main>)</span>

  <span class=keyword1><span class=command>from</span></span> insert.prems <span class=keyword1><span class=command>have</span></span> yx<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>≤</span> <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> fx<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> <span class=skolem>F</span><span class=main>.</span> <span class=skolem>m</span> <span class=main>≤</span> <span class=bound>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> insert <span class=skolem>y</span> <span class=skolem>F</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> mv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> mlt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>≤</span> Min <span class=skolem>F</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iffD2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> Min_ge_iff <span class=main><span class=main>[</span></span><span class=operator>OF</span> insert.hyps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> insert.hyps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span> fx<span class=main><span class=main>]</span></span><span class=main>)</span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Min_insert <span class=main><span class=main>[</span></span><span class=operator>OF</span> insert.hyps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> insert.hyps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mv <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> min_def mlt<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> <span class=skolem>F</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> mf<span class=main>:</span> <span class=quoted><span class=quoted>"Min <span class=skolem>F</span> <span class=main>=</span> <span class=skolem>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> insert.hyps<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ fx<span class=main><span class=main>]</span></span><span class=main>)</span>

    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Min_insert <span class=main><span class=main>[</span></span><span class=operator>OF</span> insert.hyps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> insert.hyps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mf<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffD2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ yx<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> power_numeral<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>^</span> numeral <span class=free>k</span> <span class=main>=</span> <span class=free>a</span> <span class=main>*</span> <span class=free>a</span> <span class=main>^</span> <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> funpow_numeral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>^^</span> numeral <span class=free>k</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>^^</span> <span class=main>(</span>pred_numeral <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> funpow_minus_simp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>^^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>^^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> gr0_implies_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> rco_alt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span> <span class=main>^^</span> <span class=free>n</span> <span class=main>∘</span> <span class=free>f</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=main>(</span><span class=free>g</span> <span class=main>∘</span> <span class=free>f</span><span class=main>)</span> <span class=main>^^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> union_sub<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>C</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>∪</span> <span class=main>(</span><span class=free>B</span> <span class=main>-</span> <span class=free>C</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>C</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>lemma</span></span> insert_sub<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span>insert <span class=free>x</span> <span class=main>(</span><span class=free>xs</span> <span class=main>-</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>-</span> <span class=main>(</span><span class=free>ys</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> ran_upd<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> inj_on <span class=free>f</span> <span class=main>(</span>dom <span class=free>f</span><span class=main>)</span><span class=main>;</span> <span class=free>f</span> <span class=free>y</span> <span class=main>=</span> Some <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> ran <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>then</span> None <span class=keyword1>else</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> ran <span class=free>f</span> <span class=main>-</span> <span class=main>{</span><span class=free>z</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ran_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> domI inj_on_eq_iff option.sel<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> if_apply_def2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>F</span> <span class=keyword1>else</span> <span class=free>G</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>P</span> <span class=main>⟶</span> <span class=free>F</span> <span class=bound>x</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span> <span class=main>⟶</span> <span class=free>G</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> case_bool_If<span class=main>:</span>
  <span class=quoted><span class=quoted>"case_bool <span class=free>P</span> <span class=free>Q</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> <span class=free>P</span> <span class=keyword1>else</span> <span class=free>Q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_f<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>then</span> <span class=free>f</span> <span class=free>b</span> <span class=keyword1>else</span> <span class=free>f</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>then</span> <span class=free>b</span> <span class=keyword1>else</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> size_if<span class=main>:</span> <span class=quoted><span class=quoted>"size <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> size <span class=free>xs</span> <span class=keyword1>else</span> size <span class=free>ys</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> if_distrib<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> if_Not_x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=main>¬</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> if_x_Not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=main>¬</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> if_same_and<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>If <span class=free>p</span> <span class=free>x</span> <span class=free>y</span> <span class=main>∧</span> If <span class=free>p</span> <span class=free>u</span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>u</span> <span class=keyword1>else</span> <span class=free>y</span> <span class=main>∧</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> if_same_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>If <span class=free>p</span> <span class=free>x</span> <span class=free>y</span>  <span class=main>=</span> <span class=main>(</span>If <span class=free>p</span> <span class=free>u</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>=</span> <span class=free>u</span> <span class=keyword1>else</span> <span class=free>y</span> <span class=main>=</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> if_same_eq_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>If <span class=free>p</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> If <span class=free>p</span> <span class=free>u</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>p</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>u</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> the_elemI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>⟹</span> the_elem <span class=free>y</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nonemptyE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=free>R</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> xtr1 <span class=main>=</span> xtrans<span class=main>(</span>1<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr2 <span class=main>=</span> xtrans<span class=main>(</span>2<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr3 <span class=main>=</span> xtrans<span class=main>(</span>3<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr4 <span class=main>=</span> xtrans<span class=main>(</span>4<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr5 <span class=main>=</span> xtrans<span class=main>(</span>5<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr6 <span class=main>=</span> xtrans<span class=main>(</span>6<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr7 <span class=main>=</span> xtrans<span class=main>(</span>7<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> xtr8 <span class=main>=</span> xtrans<span class=main>(</span>8<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> if_fun_split <span class=main>=</span> if_apply_def2

<span class=keyword1><span class=command>lemma</span></span> not_empty_eq<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>S</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>S</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> range_subset_lower<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>c</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span>linorder"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> subsetD<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> classical<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_subset_upper<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>c</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span>linorder"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> subsetD<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> classical<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_subset_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> non_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>c</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> non_empty<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> range_subset_lower <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> range_subset_upper <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> non_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> <span class=free>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> atLeastatMost_subset_iff eq_iff non_empty<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> range_strict_subset_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> non_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>..</span><span class=free>b</span><span class=main>}</span> <span class=main>⊂</span> <span class=main>{</span><span class=free>c</span><span class=main>..</span><span class=free>d</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>c</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span> <span class=main>∧</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>c</span> <span class=main>⟶</span> <span class=free>b</span> <span class=main>≠</span> <span class=free>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> non_empty<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> psubset_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> range_subset_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> range_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> range_subsetI<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> order"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> xX<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>≤</span> <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span>     yY<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=free>Y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>   <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>x</span> <span class=main>..</span> <span class=free>y</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>X</span> <span class=main>..</span> <span class=free>Y</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> xX yY <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> set_False <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>set <span class=free>bs</span> <span class=main>⊆</span> <span class=main>{</span>False<span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>True <span class=main>∉</span> set <span class=free>bs</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> int_not_emptyD<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> contrapos_np<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> disjoint_iff_not_equal<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>sum_map</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'c</span> <span class=main>⇒</span> <span class=tfree>'d</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>+</span> <span class=tfree>'c</span> <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>+</span> <span class=tfree>'d</span>"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>sum_map</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>g</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>of</span> Inl <span class=bound>v</span> <span class=main>⇒</span> Inl <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>v</span><span class=main>)</span> <span class=main>|</span> Inr <span class=bound>v'</span> <span class=main>⇒</span> Inr <span class=main>(</span><span class=free><span class=bound><span class=entity>g</span></span></span> <span class=bound>v'</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> sum_map_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"sum_map <span class=free>f</span> <span class=free>g</span> <span class=main>(</span>Inl <span class=free>v</span><span class=main>)</span> <span class=main>=</span> Inl <span class=main>(</span><span class=free>f</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"sum_map <span class=free>f</span> <span class=free>g</span> <span class=main>(</span>Inr <span class=free>w</span><span class=main>)</span> <span class=main>=</span> Inr <span class=main>(</span><span class=free>g</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sum_map_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> if_Some_None_eq_None<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> Some <span class=free>v</span> <span class=keyword1>else</span> None<span class=main>)</span> <span class=main>=</span> None<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> CollectPairFalse <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>a</span><span class=main>,</span><span class=bound>b</span><span class=main>)</span><span class=main>.</span> False<span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> if_conj_dist<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=keyword1>else</span> <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> <span class=free>y</span> <span class=keyword1>else</span> <span class=free>z</span><span class=main>)</span> <span class=main>∧</span> <span class=free>X</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=keyword1>then</span> <span class=free>w</span> <span class=main>∧</span> <span class=free>y</span> <span class=keyword1>else</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>z</span><span class=main>)</span> <span class=main>∧</span> <span class=free>X</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_P_True1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> True <span class=keyword1>else</span> <span class=free>Q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_P_True2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>Q</span> <span class=keyword1>else</span> True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> nat_simps <span class=main>=</span> diff_add_inverse2 diff_add_inverse

<span class=keyword1><span class=command>lemmas</span></span> nat_iffs <span class=main>=</span> le_add1 le_add2

<span class=keyword1><span class=command>lemma</span></span> nat_min_simps<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> min <span class=free>b</span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> min <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemmas</span></span> zadd_diff_inverse <span class=main>=</span>
  trans <span class=main>[</span><span class=operator>OF</span> diff_add_cancel <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> add.commute<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> add_diff_cancel2 <span class=main>=</span>
  add.commute <span class=main>[</span><span class=operator>THEN</span> diff_eq_eq <span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> mcl <span class=main>=</span> mult_cancel_left <span class=main>[</span><span class=operator>THEN</span> iffD1<span class=main>,</span> <span class=operator>THEN</span> make_pos_rule<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> pl_pl_rels<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=free>c</span> <span class=main>+</span> <span class=free>d</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≥</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>d</span> <span class=main>∨</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≥</span> <span class=free>d</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemmas</span></span> pl_pl_rels' <span class=main>=</span> add.commute <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main>[</span></span>2<span class=main><span class=main>]</span></span> trans<span class=main>,</span> <span class=operator>THEN</span> pl_pl_rels<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> iszero_minus<span class=main>:</span>
  <span class=quoted><span class=quoted>‹iszero <span class=main>(</span><span class=main>-</span> <span class=free>z</span><span class=main>)</span> <span class=main>⟷</span> iszero <span class=free>z</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iszero_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> diff_le_eq'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> zless2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> zero_less_numeral<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> zless2p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> zle2p<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> ex_eq_or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>∨</span> <span class=free>P</span> <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=free>k</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=bound>m</span> <span class=main>∧</span> <span class=free>P</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> power_minus_simp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>^</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span> <span class=main>*</span> <span class=free>a</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> gr0_implies_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> n2s_ths<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>+</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=quoted><span class=quoted>‹<span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>=</span> Suc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span> add_2_eq_Suc add_2_eq_Suc'<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> s2n_ths<span class=main>:</span>
  <span class=quoted><span class=quoted>‹Suc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>+</span> <span class=free>n</span>›</span></span>
  <span class=quoted><span class=quoted>‹Suc <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=numeral>2</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> gt_or_eq_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>∨</span> <span class=main>0</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> sum_imp_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>=</span> <span class=free>k</span> <span class=main>+</span> <span class=free>i</span> <span class=main>⟹</span> <span class=free>j</span> <span class=main>-</span> <span class=free>i</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> le_diff_eq'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>-</span> <span class=free>b</span> <span class=main>⟷</span> <span class=free>b</span> <span class=main>+</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> less_diff_eq'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>-</span> <span class=free>b</span> <span class=main>⟷</span> <span class=free>b</span> <span class=main>+</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> diff_less_eq'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟷</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> axxbyy<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=main>+</span> <span class=free>n</span> <span class=main>+</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>a</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>b</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span> <span class=main>∧</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>m</span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> minus_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>⟷</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>k</span> <span class=free>m</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> pl_pl_mm<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=free>c</span> <span class=main>+</span> <span class=free>d</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>-</span> <span class=free>c</span> <span class=main>=</span> <span class=free>d</span> <span class=main>-</span> <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemmas</span></span> pl_pl_mm' <span class=main>=</span> add.commute <span class=main>[</span><span class=operator>THEN</span> <span class=main><span class=main>[</span></span>2<span class=main><span class=main>]</span></span> trans<span class=main>,</span> <span class=operator>THEN</span> pl_pl_mm<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> less_le_mult'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>w</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>*</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>c</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mult_right_mono<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> zless_imp_add1_zle<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult_right_less_imp_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_le_mult<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>+</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>c</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>using</span></span> less_le_mult' <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> less_le_mult_minus <span class=main>=</span> iffD2 <span class=main>[</span><span class=operator>OF</span> le_diff_eq less_le_mult<span class=main>,</span>
  <span class=operator>simplified</span> left_diff_distrib<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> gen_minus<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> mpl_lem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>≤</span> <span class=free>i</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>-</span> <span class=free>j</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>i</span> <span class=free>j</span> <span class=free>k</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemmas</span></span> dme <span class=main>=</span> div_mult_mod_eq
<span class=keyword1><span class=command>lemmas</span></span> dtle <span class=main>=</span> div_times_less_eq_dividend
<span class=keyword1><span class=command>lemmas</span></span> th2 <span class=main>=</span> order_trans <span class=main>[</span><span class=operator>OF</span> order_refl <span class=main><span class=main>[</span></span><span class=operator>THEN</span> <span class=main><span class=main>[</span></span>2<span class=main><span class=main>]</span></span> mult_le_mono<span class=main><span class=main>]</span></span> div_times_less_eq_dividend<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sdl <span class=main>=</span> div_nat_eqI

<span class=keyword1><span class=command>lemma</span></span> given_quot<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>*</span> <span class=free>l</span> <span class=main>+</span> <span class=main>(</span><span class=free>f</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>f</span> <span class=main>=</span> <span class=free>l</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>f</span> <span class=free>l</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> div_nat_eqI<span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> given_quot_alt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>l</span> <span class=main>*</span> <span class=free>f</span> <span class=main>+</span> <span class=free>f</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>f</span> <span class=main>=</span> <span class=free>l</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>f</span> <span class=free>l</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> given_quot<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> asm_rl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=keyword1>div</span> <span class=free>f</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span> <span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> x_power_minus_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> <span class=main>{</span>ab_group_add<span class=main>,</span> power<span class=main>,</span> numeral<span class=main>,</span> one<span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nat_diff_add<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>i</span> <span class=main>+</span> <span class=free>j</span> <span class=main>=</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>=</span> <span class=free>k</span> <span class=main>-</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> pow_2_gt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>⟹</span> <span class=main>(</span><span class=numeral>2</span><span class=main>::</span>int<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> sum_to_zero<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=tfree>'a</span> <span class=main>::</span> ring<span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>λ</span></span></span> <span class=bound><span class=bound><span class=bound>x</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=bound><span class=bound><span class=bound>x</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> arith_is_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> Suc <span class=main>0</span><span class=main>;</span> <span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> suc_le_pow_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> Suc <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
     <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>=</span> <span class=main>1</span>"</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>clarsimp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_le_Suc_less_imp<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> power_sub_int<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>^</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=main>^</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>^</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n'</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=bound>n'</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> exI<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>n</span></span> <span class=main><span class=main>-</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> nat_Suc_less_le_imp<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> Suc <span class=free>n</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> nat_add_less_by_max<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>xmax</span> <span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>-</span> <span class=free>xmax</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> nat_le_Suc_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> nat_power_minus_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> nat<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> order_less_le_trans<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> less_le_mult_nat'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>==&gt;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>==&gt;</span> Suc <span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mult_right_mono<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Suc_leI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult_right_less_imp_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> less_le_mult_nat<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>∧</span> <span class=free>w</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>c</span> <span class=main>+</span> <span class=free>w</span> <span class=main>*</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=free>c</span> <span class=free>w</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword1><span class=command>using</span></span> less_le_mult_nat' <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> p_assoc_help<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span><span class=main>{</span>ring<span class=main>,</span>power<span class=main>,</span>numeral<span class=main>,</span>one<span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>^</span><span class=free>sz</span> <span class=main>-</span> <span class=main>1</span> <span class=main>=</span> <span class=free>p</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>2</span><span class=main>^</span><span class=free>sz</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> pow_mono_leq_imp_lt<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_less_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> small_powers_of_2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≥</span> <span class=numeral>3</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>x</span></span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> suc_le_pow_2<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_less_power_trans2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>k</span>  <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> <span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> nat_less_power_trans<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> nat_move_sub_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>-</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>arith</span>

<span class=keyword1><span class=command>lemma</span></span> plus_minus_one_rewrite<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>::</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> <span class=main>{</span>ring<span class=main>,</span> one<span class=main>,</span> uminus<span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>≡</span> <span class=free>v</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> Suc_0_lt_2p_len_of<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span> <span class=main>::</span> len<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def len_gt_0 lessI numeral_2_eq_2 one_less_power<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_Lib_Sumo><div class=head><h1>Theory Word_Lib_Sumo</h1></div><pre class=source><span class=comment1>(*
 * Copyright Florian Haftmann
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Ancient comprehensive Word Library›</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_Lib_Sumo
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>"</span>
  <a href=Aligned.html>Aligned</a>
  <a href=Ancient_Numeral.html>Ancient_Numeral</a>
  <a href=Bit_Comprehension.html>Bit_Comprehension</a>
  <a href=Bits_Int.html>Bits_Int</a>
  <a href=Bitwise_Signed.html>Bitwise_Signed</a>
  <a href=Bitwise.html>Bitwise</a>
  <a href=Enumeration_Word.html>Enumeration_Word</a>
  <a href=Generic_set_bit.html>Generic_set_bit</a>
  <a href=Hex_Words.html>Hex_Words</a>
  <a href=Least_significant_bit.html>Least_significant_bit</a>
  <a href=More_Arithmetic.html>More_Arithmetic</a>
  <a href=More_Divides.html>More_Divides</a>
  <a href=More_Sublist.html>More_Sublist</a>
  <a href=Even_More_List.html>Even_More_List</a>
  <a href=More_Misc.html>More_Misc</a>
  <a href=Strict_part_mono.html>Strict_part_mono</a>
  <a href=Legacy_Aliases.html>Legacy_Aliases</a>
  <a href=Most_significant_bit.html>Most_significant_bit</a>
  <a href=Next_and_Prev.html>Next_and_Prev</a>
  <a href=Norm_Words.html>Norm_Words</a>
  <a href=Reversed_Bit_Lists.html>Reversed_Bit_Lists</a>
  <a href=Rsplit.html>Rsplit</a>
  <a href=Signed_Words.html>Signed_Words</a>
  <a href=Traditional_Infix_Syntax.html>Traditional_Infix_Syntax</a>
  <a href=Typedef_Morphisms.html>Typedef_Morphisms</a>
  <a href=Type_Syntax.html>Type_Syntax</a>
  <a href=Word_EqI.html>Word_EqI</a>
  <a href=Word_Lemmas.html>Word_Lemmas</a>
  <a href=Word_8.html>Word_8</a>
  <a href=Word_16.html>Word_16</a>
  <a href=Word_32.html>Word_32</a>
  <a href=Word_Syntax.html>Word_Syntax</a>
  <a href=Signed_Division_Word.html>Signed_Division_Word</a>
  <a href=More_Word_Operations.html>More_Word_Operations</a>
  <a href=Many_More.html>Many_More</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>declare</span></span> word_induct2<span class=main>[</span><span class=operator>induct</span> <span class=quasi_keyword>type</span><span class=main>]</span>
<span class=keyword1><span class=command>declare</span></span> word_nat_cases<span class=main>[</span><span class=operator>cases</span> <span class=quasi_keyword>type</span><span class=main>]</span>

<span class=keyword1><span class=command>declare</span></span> signed_take_bit_Suc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=comment1>(* these generate take_bit terms, which we often don't want for concrete lengths *)</span>
<span class=keyword1><span class=command>lemmas</span></span> of_int_and_nat <span class=main>=</span> unsigned_of_nat unsigned_of_int signed_of_int signed_of_nat

<span class=keyword1><span class=command>bundle</span></span> no_take_bit
<span class=keyword2><span class=keyword>begin</span></span>
  <span class=keyword1><span class=command>declare</span></span> of_int_and_nat<span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>del</span></span></span></span><span class=main>]</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>lemmas</span></span> bshiftr1_def <span class=main>=</span> bshiftr1_eq
<span class=keyword1><span class=command>lemmas</span></span> is_down_def <span class=main>=</span> is_down_eq
<span class=keyword1><span class=command>lemmas</span></span> is_up_def <span class=main>=</span> is_up_eq
<span class=keyword1><span class=command>lemmas</span></span> mask_def <span class=main>=</span> mask_eq
<span class=keyword1><span class=command>lemmas</span></span> scast_def <span class=main>=</span> scast_eq
<span class=keyword1><span class=command>lemmas</span></span> shiftl1_def <span class=main>=</span> shiftl1_eq
<span class=keyword1><span class=command>lemmas</span></span> shiftr1_def <span class=main>=</span> shiftr1_eq
<span class=keyword1><span class=command>lemmas</span></span> sshiftr1_def <span class=main>=</span> sshiftr1_eq
<span class=keyword1><span class=command>lemmas</span></span> sshiftr_def <span class=main>=</span> sshiftr_eq_funpow_sshiftr1
<span class=keyword1><span class=command>lemmas</span></span> to_bl_def <span class=main>=</span> to_bl_eq
<span class=keyword1><span class=command>lemmas</span></span> ucast_def <span class=main>=</span> ucast_eq
<span class=keyword1><span class=command>lemmas</span></span> unat_def <span class=main>=</span> unat_eq_nat_uint
<span class=keyword1><span class=command>lemmas</span></span> word_cat_def <span class=main>=</span> word_cat_eq
<span class=keyword1><span class=command>lemmas</span></span> word_reverse_def <span class=main>=</span> word_reverse_eq_of_bl_rev_to_bl
<span class=keyword1><span class=command>lemmas</span></span> word_roti_def <span class=main>=</span> word_roti_eq_word_rotr_word_rotl
<span class=keyword1><span class=command>lemmas</span></span> word_rotl_def <span class=main>=</span> word_rotl_eq
<span class=keyword1><span class=command>lemmas</span></span> word_rotr_def <span class=main>=</span> word_rotr_eq
<span class=keyword1><span class=command>lemmas</span></span> word_sle_def <span class=main>=</span> word_sle_eq
<span class=keyword1><span class=command>lemmas</span></span> word_sless_def <span class=main>=</span> word_sless_eq

<span class=keyword1><span class=command>lemmas</span></span> uint_0 <span class=main>=</span> uint_nonnegative
<span class=keyword1><span class=command>lemmas</span></span> uint_lt <span class=main>=</span> uint_bounded
<span class=keyword1><span class=command>lemmas</span></span> uint_mod_same <span class=main>=</span> uint_idem
<span class=keyword1><span class=command>lemmas</span></span> of_nth_def <span class=main>=</span> word_set_bits_def

<span class=keyword1><span class=command>lemmas</span></span> of_nat_word_eq_iff <span class=main>=</span> word_of_nat_eq_iff
<span class=keyword1><span class=command>lemmas</span></span> of_nat_word_eq_0_iff <span class=main>=</span> word_of_nat_eq_0_iff
<span class=keyword1><span class=command>lemmas</span></span> of_int_word_eq_iff <span class=main>=</span> word_of_int_eq_iff
<span class=keyword1><span class=command>lemmas</span></span> of_int_word_eq_0_iff <span class=main>=</span> word_of_int_eq_0_iff

<span class=keyword1><span class=command>lemmas</span></span> word_next_def <span class=main>=</span> word_next_unfold

<span class=keyword1><span class=command>lemmas</span></span> word_prev_def <span class=main>=</span> word_prev_unfold

<span class=keyword1><span class=command>lemmas</span></span> is_aligned_def <span class=main>=</span> is_aligned_iff_dvd_nat

<span class=keyword1><span class=command>lemma</span></span> shiftl_transfer <span class=main>[</span><span class=operator>transfer_rule</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>includes</span></span> lifting_syntax
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>pcr_word <span class=main>===&gt;</span> <span class=main>(=)</span> <span class=main>===&gt;</span> pcr_word<span class=main>)</span> <span class=main>(&lt;&lt;)</span> <span class=main>(&lt;&lt;)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> shiftl_eq_push_bit<span class=main>)</span> <span class=operator>transfer_prover</span>

<span class=keyword1><span class=command>lemmas</span></span> word_and_max_simps <span class=main>=</span>
  word8_and_max_simp
  word16_and_max_simp
  word32_and_max_simp

<span class=keyword1><span class=command>lemma</span></span> distinct_lemma<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>f</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> and_bang <span class=main>=</span> word_and_nth

<span class=keyword1><span class=command>lemmas</span></span> sdiv_int_def <span class=main>=</span> signed_divide_int_def
<span class=keyword1><span class=command>lemmas</span></span> smod_int_def <span class=main>=</span> signed_modulo_int_def

<span class=comment1>(* shortcut for some specific lengths *)</span>
<span class=keyword1><span class=command>lemma</span></span> word_fixed_sint_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>16</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sint_word_ariths<span class=main>)</span>

<span class=keyword1><span class=command>declare</span></span> of_nat_diff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=comment1>(* Haskellish names/syntax *)</span>
<span class=keyword1><span class=command>notation</span></span> <span class=main>(</span>input<span class=main>)</span>
  test_bit <span class=main>(</span><span class=quoted>"<span class=keyword1>testBit</span>"</span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> cast_simps <span class=main>=</span> cast_simps ucast_down_bl

<span class=comment1>(* shadows the slightly weaker Word.nth_ucast *)</span>
<span class=keyword1><span class=command>lemma</span></span> nth_ucast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span><span class=free>w</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span><span class=main>::</span><span class=tfree>'b</span><span class=main>::</span>len word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span>
   <span class=main>(</span><span class=free>w</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> min <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'a</span><span class=main>)</span> <span class=keyword1>LENGTH</span><span class=main>(</span><span class=tfree>'b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bit_take_bit_iff <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Word_64><div class=head><h1>Theory Word_64</h1></div><pre class=source><span class=comment1>(*
 * Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Words of Length 64"</span></span>

<span class=keyword1><span class=command>theory</span></span> Word_64
  <span class=keyword2><span class=keyword>imports</span></span>
    <a href=Word_Lemmas.html>Word_Lemmas</a>
    <a href=Word_Names.html>Word_Names</a>
    <a href=Word_Syntax.html>Word_Syntax</a>
    <a href=Rsplit.html>Rsplit</a>
    <a href=More_Word_Operations.html>More_Word_Operations</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>lemma</span></span> len64<span class=main>:</span> <span class=quoted><span class=quoted>"len_of <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>64</span> itself<span class=main>)</span> <span class=main>=</span> <span class=numeral>64</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>type_synonym</span></span> machine_word_len <span class=main>=</span> <span class=quoted><span class=numeral>64</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> machine_word <span class=main>=</span> <span class=quoted><span class=quoted>"machine_word_len word"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_bits</span> <span class=main>::</span> <span class=quoted>nat</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_bits</span> <span class=main>=</span> <span class=keyword1>LENGTH</span><span class=main>(</span>machine_word_len<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following two are numerals so they can be used as nats and words.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_size_bits</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> numeral"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_size_bits</span> <span class=main>=</span> <span class=numeral>3</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>word_size</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>::</span> numeral"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>word_size</span> <span class=main>=</span> <span class=numeral>8</span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_conv<span class=main>[</span><span class=operator>code</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"word_bits <span class=main>=</span> <span class=numeral>64</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_size_word_size_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>word_size<span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> word_size_bits"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_size_def word_size_bits_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_word_size_conv<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_bits <span class=main>=</span> word_size <span class=main>*</span> <span class=numeral>8</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def word_size_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_8_64_inj<span class=main>:</span>
  <span class=quoted><span class=quoted>"inj <span class=main>(</span>ucast <span class=main>::</span>  <span class=numeral>8</span> word <span class=main>⇒</span> <span class=numeral>64</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> down_ucast_inj<span class=main>)</span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> is_down_def target_size source_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> upto_2_helper<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=numeral>2</span> <span class=main>::</span> <span class=numeral>64</span> word<span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>;</span></span> <span class=operator>simp</span><span class=main>)</span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>lemmas</span></span> upper_bits_unset_is_l2p_64 <span class=main>=</span> upper_bits_unset_is_l2p <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> le_2p_upper_bits_64 <span class=main>=</span> le_2p_upper_bits <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> le2p_bits_unset_64 <span class=main>=</span> le2p_bits_unset<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_len_of<span class=main>:</span>
  <span class=quoted><span class=quoted>"len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>64</span><span class=main>)</span> <span class=main>=</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_power_lower64' <span class=main>=</span> unat_power_lower<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_power_lower64 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> unat_power_lower64'<span class=main>[</span><span class=operator>unfolded</span> word_bits_len_of<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word64_less_sub_le' <span class=main>=</span> word_less_sub_le<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main>=</span></span> <span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word64_less_sub_le<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> word64_less_sub_le' <span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word_bits_size<span class=main>:</span>
  <span class=quoted><span class=quoted>"size <span class=main>(</span><span class=free>w</span><span class=main>::</span>word64<span class=main>)</span> <span class=main>=</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> word64_power_less_1' <span class=main>=</span> word_power_less_1<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main>=</span></span> <span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word64_power_less_1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> word64_power_less_1'<span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat64_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span>of_nat <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>word64<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits<span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> of_nat_0<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_mask_2_less_4<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>p</span> <span class=main>&amp;&amp;</span> mask <span class=numeral>2</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>4</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_less_helper<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_le_less_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> word_and_le1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> unat_of_nat64' <span class=main>=</span> unat_of_nat_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_of_nat64 <span class=main>=</span> unat_of_nat64'<span class=main>[</span><span class=operator>unfolded</span> word_bits_len_of<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> word_power_nonzero_64 <span class=main>=</span> word_power_nonzero <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_mult_simple <span class=main>=</span> iffD1 <span class=main>[</span><span class=operator>OF</span> unat_mult_lem <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main><span class=main>=</span></span></span> <span class=quoted><span class=numeral>64</span></span><span class=main><span class=main>,</span></span> <span class=operator>unfolded</span> word_bits_len_of<span class=main><span class=main>]</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> div_power_helper_64 <span class=main>=</span> div_power_helper <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> n_less_word_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> word_bits<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>64</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> of_nat_less_pow_64 <span class=main>=</span> of_nat_power <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> lt_word_bits_lt_pow<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> word_bits <span class=main>⟹</span> <span class=free>sz</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_bits_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_word_bits<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>word64</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> unat <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> word_bits_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_trans <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ unat_lt2p<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> unat_mask_word64' <span class=main>=</span> unat_mask<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> unat_mask_word64 <span class=main>=</span> unat_mask_word64'<span class=main>[</span><span class=operator>folded</span> word_bits_def<span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> unat_less_2p_word_bits<span class=main>:</span>
  <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>64</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> word_bits"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_bits_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> unat_lt2p<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> Suc_unat_mask_div<span class=main>:</span>
  <span class=quoted><span class=quoted>"Suc <span class=main>(</span>unat <span class=main>(</span>mask <span class=free>sz</span> <span class=keyword1>div</span> word_size<span class=main>::</span>word64<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>min <span class=free>sz</span> word_bits <span class=main>-</span> <span class=numeral>3</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>sz</span> <span class=main>&lt;</span> word_bits"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=numeral>3</span> <span class=main>≤</span> <span class=free>sz</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size_def word_bits_def min_def mask_eq<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> <span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> Suc_div_unat_helper
           <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>64</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> sz<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>sz</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> us<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=numeral>3</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_le word_size_def word_bits_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>sz</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>nat</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths
                                  unat_mask_word64 min_def word_bits_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>nata</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths unat_mask_word64 word_bits_def<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unat_word_ariths
                   unat_mask_word64 min_def word_bits_def word_size_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word64_minus_one_le' <span class=main>=</span> word_minus_one_le<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> word64_minus_one_le <span class=main>=</span> word64_minus_one_le'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_not_helper<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span><span class=main>::</span><span class=quoted><span class=quoted>"<span class=numeral>8</span> word"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=numeral>0xFF</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ucast <span class=free>a</span> <span class=main>≠</span> <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word64<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ucast <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word64<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span>word64<span class=main>)</span> <span class=main>=</span> ucast <span class=main>(</span><span class=numeral>0xFF</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>using</span></span> a
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> up_ucast_inj<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> less_4_cases<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span>word64<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>4</span> <span class=main>⟹</span> <span class=free>x</span><span class=main>=</span><span class=main>0</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=main>1</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=numeral>2</span> <span class=main>∨</span> <span class=free>x</span><span class=main>=</span><span class=numeral>3</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> word_less_cases<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> if_then_1_else_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word64<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> if_then_0_else_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word64<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> if_then_simps <span class=main>=</span> if_then_0_else_1 if_then_1_else_0

<span class=keyword1><span class=command>lemma</span></span> ucast_le_ucast_8_64<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span>ucast <span class=free>y</span> <span class=main>::</span> word64<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ucast_le_ucast<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> in_16_range<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>r</span> <span class=main>+</span> <span class=bound>x</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>16</span> <span class=main>::</span> word64<span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>S</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> <span class=main>1</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>r</span> <span class=main>+</span> <span class=main>(</span><span class=numeral>16</span> <span class=main>*</span> <span class=free>n</span> <span class=main>-</span> <span class=numeral>16</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span> <span class=main>::</span> word64<span class=main>.</span> <span class=free>r</span> <span class=main>+</span> <span class=bound>x</span> <span class=main>*</span> <span class=numeral>16</span><span class=main>)</span> <span class=main>`</span> <span class=free>S</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> image_def <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> bexI<span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemma</span></span> eq_2_64_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=numeral>64</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> x_less_2_0_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>word64</span> <span class=keyword2><span class=keyword>shows</span></span>
  <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> x_less_2_0_1'<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> mask_64_max_word  <span class=main>=</span> max_word_mask <span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> of_nat64_n_less_equal_power_2<span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=numeral>64</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span>of_nat <span class=free>n</span><span class=main>)</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> of_nat_n_less_equal_power_2<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_rsplit_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"word_rsplit <span class=main>(</span><span class=main>0</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>]</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_rsplit_def bin_rsplit_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> unat_ucast_10_64 <span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>10</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span>ucast <span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>=</span> unat <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> bool_mask <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>word64</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>&amp;&amp;</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> bool_mask'<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemma</span></span> word64_bounds<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>9223372036854775808</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>9223372036854775807</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>64</span> signed word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>9223372036854775808</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span> <span class=main>^</span> <span class=main>(</span>size <span class=main>(</span><span class=free>y</span> <span class=main>::</span> <span class=numeral>64</span> signed word<span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>9223372036854775807</span> <span class=main>::</span> int<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> word_ge_min<span class=main>:</span><span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>64</span> word<span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=numeral>9223372036854775808</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> sint_ge word64_bounds<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> word_size<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_arith_ineq_checks_to_eq_word64'
    <span class=main>=</span> signed_arith_ineq_checks_to_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span></span></span><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral><span class=quoted><span class=numeral>64</span></span></span></span></span></span></span></span></span></span></span></span><span class=main>]</span>
      signed_arith_ineq_checks_to_eq<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>=</span></span></span></span></span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=numeral><span class=numeral><span class=numeral><span class=numeral><span class=numeral><span class=numeral>64</span></span></span></span></span></span> signed"</span></span></span></span></span></span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_arith_ineq_checks_to_eq_word64
    <span class=main>=</span> signed_arith_ineq_checks_to_eq_word64' <span class=main>[</span><span class=operator>unfolded</span> word64_bounds<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_mult_eq_checks64_to_64'
    <span class=main>=</span> signed_mult_eq_checks_double_size<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'b</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
      signed_mult_eq_checks_double_size<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>64</span> signed"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> <span class=tfree>'b</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_mult_eq_checks64_to_64 <span class=main>=</span> signed_mult_eq_checks64_to_64'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sdiv_word64_max' <span class=main>=</span> sdiv_word_max <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span> sdiv_word_max <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>64</span> signed"</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sdiv_word64_max <span class=main>=</span> sdiv_word64_max'<span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sdiv_word64_min' <span class=main>=</span> sdiv_word_min <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span> sdiv_word_min <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>64</span> signed"</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sdiv_word64_min <span class=main>=</span> sdiv_word64_min' <span class=main>[</span><span class=operator>simplified</span> word_size<span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sint64_of_int_eq' <span class=main>=</span> sint_of_int_eq <span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> sint64_of_int_eq <span class=main>=</span> sint64_of_int_eq' <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> ucast_of_nats <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>::</span> sword64<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>::</span> <span class=numeral>16</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>ucast <span class=main>(</span>of_nat <span class=free>x</span> <span class=main>::</span> word64<span class=main>)</span> <span class=main>::</span> <span class=numeral>8</span> sword<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>of_nat <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_nat_take_bit take_bit_word_eq_self<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_simpler_64'
    <span class=main>=</span> power_strict_increasing_iff<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> b<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>::</span> nat"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>31</span></span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_simpler_64 <span class=main>=</span> signed_shift_guard_simpler_64'<span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word64_31_less<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>64</span> signed<span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> nat<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&lt;</span> len_of <span class=keyword1>TYPE</span> <span class=main>(</span><span class=numeral>64</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>31</span> <span class=main>&gt;</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> nat<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> signed_shift_guard_to_word_64
    <span class=main>=</span> signed_shift_guard_to_word<span class=main>[</span><span class=operator>OF</span> word64_31_less<span class=main><span class=main>(</span></span>1-2<span class=main><span class=main>)</span></span><span class=main>]</span>
    signed_shift_guard_to_word<span class=main>[</span><span class=operator>OF</span> word64_31_less<span class=main><span class=main>(</span></span>3-4<span class=main><span class=main>)</span></span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> le_step_down_word_3<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>64</span> word"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>x</span> <span class=main>≤</span>  <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>≠</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>^</span> <span class=numeral>64</span> <span class=main>-</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_step_down_word_2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_1<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span>word64<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_drop_bit drop_bit_Suc<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> mask_step_down_64<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span>›</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=numeral>64</span> <span class=main>∧</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>64</span>word›</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>&amp;&amp;</span> <span class=main>1</span> <span class=main>=</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹odd <span class=free>b</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_2_eq_odd and_one_eq<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> odd_iff_mod_2_eq_one <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=numeral>64</span> <span class=main>∧</span> mask <span class=bound>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>&lt;</span> <span class=numeral>64</span>›</span></span> <span class=quoted><span class=quoted>‹mask <span class=skolem>x</span> <span class=main>=</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹mask <span class=skolem>x</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=numeral>2</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> shiftr1_is_div_2 <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=numeral>2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=main>…</span> <span class=main>=</span> <span class=free>b</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_div_mod_eq<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=free>b</span>›</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>‹mask <span class=main>(</span>Suc <span class=skolem>x</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> mask <span class=skolem>x</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mask_Suc_rec<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> unat_of_int_64<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>i</span> <span class=main>≥</span> <span class=main>0</span><span class=main>;</span> <span class=free>i</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>^</span> <span class=numeral>63</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>unat <span class=main>(</span><span class=main>(</span>of_int <span class=free>i</span><span class=main>)</span><span class=main>::</span>sword64<span class=main>)</span><span class=main>)</span> <span class=main>=</span> nat <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unat_eq_nat_uint
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> eq_nat_nat_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_bit_int_eq_self<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> word_ctz_not_minus_1_64 <span class=main>=</span> word_ctz_not_minus_1<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>64</span></span><span class=main>,</span> <span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>lemma</span></span> word64_and_max_simp<span class=main>:</span>
  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xFFFFFFFFFFFFFFFF</span> <span class=main>=</span> <span class=free>x</span>›</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>64</span> word›</span></span>
  <span class=keyword1><span class=command>using</span></span> word_and_full_mask_simp <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc mask_Suc_exp<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Guide><div class=head><h1>Theory Guide</h1></div><pre class=source><span class=comment1>(*
 * Copyright Florian Haftmann
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=comment1>(*&lt;*)</span>
<span class=keyword1><span class=command>theory</span></span> Guide
  <span class=keyword2><span class=keyword>imports</span></span> <a href=Word_Lib_Sumo.html>Word_Lib_Sumo</a> <a href=Word_64.html>Word_64</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>hide_const</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> Generic_set_bit.set_bit

<span class=comment1>(*&gt;*)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹A short overview over bit operations and word types›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Basic theories and key ideas›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  When formalizing bit operations, it is tempting to represent
  bit values as explicit lists over a binary type. This however
  is a bad idea, mainly due to the inherent ambiguities in
  representation concerning repeating leading bits.

  Hence this approach avoids such explicit lists altogether
  following an algebraic path:

    <span class=antiquoted><span class=antiquoted>▪</span></span> Bit values are represented by numeric types: idealized
      unbounded bit values can be represented by type <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>,
      bounded bit values by quotient types over <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>, aka <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=tfree><span class=tfree>'a</span></span> word›</span></span></span></span>.

    <span class=antiquoted><span class=antiquoted>▪</span></span> (A special case are idealized unbounded bit values ending
      in <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> which can be represented by type <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹nat›</span></span></span></span> but
      only support a restricted set of operations).

  The most fundamental ideas are developed in theory <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=../../HOL/HOL/Parity.html></a><a href=../../HOL/HOL/Parity.html>HOL.Parity</a>›</span></span>
  (which is part of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=../../HOL/HOL/Main.html></a><a href=../../HOL/HOL/Main.html>Main</a>›</span></span>):

    <span class=antiquoted><span class=antiquoted>▪</span></span> Multiplication by <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=numeral><span class=numeral>2</span></span> <span class=main><span class=main>::</span></span> int›</span></span></span></span> is a bit shift to the left and

    <span class=antiquoted><span class=antiquoted>▪</span></span> Division by <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=numeral><span class=numeral>2</span></span> <span class=main><span class=main>::</span></span> int›</span></span></span></span> is a bit shift to the right.

    <span class=antiquoted><span class=antiquoted>▪</span></span> Concerning bounded bit values, iterated shifts to the left
    may result in eliminating all bits by shifting them all
    beyond the boundary.  The property <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>prop</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=numeral><span class=numeral>2</span></span> <span class=main><span class=main>::</span></span> int<span class=main><span class=main>)</span></span> <span class=main><span class=main>^</span></span> <span class=free><span class=free>n</span></span> <span class=main><span class=main>≠</span></span> <span class=main><span class=main>0</span></span>›</span></span></span></span>
    represents that <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>n</span></span>›</span></span></span></span> is <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator>∗</span></span>‹not›</span></span> beyond that boundary.

    <span class=antiquoted><span class=antiquoted>▪</span></span> The projection on a single bit is then <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] bit_iff_odd <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.

    <span class=antiquoted><span class=antiquoted>▪</span></span> This leads to the most fundamental properties of bit values:

      <span class=antiquoted><span class=antiquoted>▪</span></span> Equality rule: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [display, mode=iff] bit_eq_iff <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>▪</span></span> Induction rule: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [display, mode=iff] bits_induct <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Characteristic properties <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>prop</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹bit <span class=main><span class=main>(</span></span><span class=free><span class=free>f</span></span> <span class=free><span class=free>x</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>n</span></span> <span class=main><span class=main>⟷</span></span> <span class=free><span class=free>P</span></span> <span class=free><span class=free>x</span></span> <span class=free><span class=free>n</span></span>›</span></span></span></span>
      are available in fact collection <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹bit_simps›</span></span></span></span>.

  On top of this, the following generic operations are provided
  after import of theory <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=../../HOL/HOL-Library/Bit_Operations.html></a><a href=../../HOL/HOL-Library/Bit_Operations.html>HOL-Library.Bit_Operations</a>›</span></span>:

    <span class=antiquoted><span class=antiquoted>▪</span></span> Singleton <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>n</span></span>›</span></span></span></span>th bit: <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>(</span></span><span class=numeral><span class=numeral>2</span></span> <span class=main><span class=main>::</span></span> int<span class=main><span class=main>)</span></span> <span class=main><span class=main>^</span></span> <span class=free><span class=free>n</span></span>›</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Bit mask upto bit <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=free><span class=free>n</span></span>›</span></span></span></span>: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> mask_eq_exp_minus_1 <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Left shift: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> push_bit_eq_mult <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Right shift: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> drop_bit_eq_div <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Truncation: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> take_bit_eq_mod <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Negation: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] bit_not_iff <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> And: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] bit_and_iff <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Or: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] bit_or_iff <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Xor: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] bit_xor_iff <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Set a single bit: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> set_bit_def <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Unset a single bit: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> unset_bit_def <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Flip a single bit: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> flip_bit_def <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Signed truncation, or modulus centered around <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>term</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=main><span class=main>0</span></span><span class=main><span class=main>::</span></span>int›</span></span></span></span>:
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [display] signed_take_bit_def <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> (Bounded) conversion from and to a list of bits:
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [display] horner_sum_bit_eq_take_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

  Proper word types are introduced in theory <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=../../HOL/HOL-Library/Word.html></a><a href=../../HOL/HOL-Library/Word.html>HOL-Library.Word</a>›</span></span>, with
  the following specific operations:

    <span class=antiquoted><span class=antiquoted>▪</span></span> Standard arithmetic:
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹<span class=main><span class=main>(+)</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹uminus <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹<span class=main><span class=main>(-)</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹<span class=main><span class=main>(*)</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹<span class=main><span class=main>0</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>‹<span class=main><span class=main>1</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, numerals etc.

    <span class=antiquoted><span class=antiquoted>▪</span></span> Standard bit operations: see above.

    <span class=antiquoted><span class=antiquoted>▪</span></span> Conversion with unsigned interpretation of words:

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹unsigned <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>::</span></span>semiring_1›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> Important special cases as abbreviations:

            <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹unat <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> nat›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

            <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹uint <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> int›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

            <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹ucast <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>::</span></span>len word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Conversion with signed interpretation of words:

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹signed <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>::</span></span>ring_1›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> Important special cases as abbreviations:

            <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹sint <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> int›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

            <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹scast <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>::</span></span>len word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Operations with unsigned interpretation of words:

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] word_le_nat_alt <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] word_less_nat_alt <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> unat_div_distrib <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> unat_drop_bit_eq <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> unat_mod_distrib <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] udvd_iff_dvd <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Operations with signed interpretation of words:

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] word_sle_eq <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] word_sless_alt <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> sint_signed_drop_bit_eq <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Rotation and reversal:

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹word_rotl <span class=main><span class=main>::</span></span> nat <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹word_rotr <span class=main><span class=main>::</span></span> nat <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹word_roti <span class=main><span class=main>::</span></span> int <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

        <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹word_reverse <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted>▪</span></span> Concatenation: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source, display] <span class=quoted><span class=quoted>‹word_cat <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'b</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'c</span></span><span class=main><span class=main>::</span></span>len word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

  For proofs about words the following default strategies are applicable:

    <span class=antiquoted><span class=antiquoted>▪</span></span> Using bit extensionality (facts <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹bit_eq_iff›</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹bit_eqI›</span></span></span></span>; fact
      collection <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹bit_simps›</span></span></span></span>).

    <span class=antiquoted><span class=antiquoted>▪</span></span> Using the <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>method</span></span> transfer<span class=antiquote><span class=antiquote>}</span></span></span></span> method.
›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹More library theories›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Note: currently, the theories listed here are hardly separate
  entities since they import each other in various ways.
  Always inspect them to understand what you pull in if you
  want to import one.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Syntax]

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Hex_Words.html></a><a href=Hex_Words.html>Word_Lib.Hex_Words</a>›</span></span>]
        Printing word numerals as hexadecimal numerals.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Type_Syntax.html></a><a href=Type_Syntax.html>Word_Lib.Type_Syntax</a>›</span></span>]
        Pretty type-sensitive syntax for cast operations.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_Syntax.html></a><a href=Word_Syntax.html>Word_Lib.Word_Syntax</a>›</span></span>]
        Specific ASCII syntax for prominent bit operations on word.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Proof tools]

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Norm_Words.html></a><a href=Norm_Words.html>Word_Lib.Norm_Words</a>›</span></span>]
        Rewriting word numerals to normal forms.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Bitwise.html></a><a href=Bitwise.html>Word_Lib.Bitwise</a>›</span></span>]
        Method <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>method</span></span> word_bitwise<span class=antiquote><span class=antiquote>}</span></span></span></span> decomposes word equalities and inequalities into bit propositions.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_EqI.html></a><a href=Word_EqI.html>Word_Lib.Word_EqI</a>›</span></span>]
        Method <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>method</span></span> word_eqI_solve<span class=antiquote><span class=antiquote>}</span></span></span></span> decomposes word equalities and inequalities into bit propositions.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Operations]

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Signed_Division_Word.html></a><a href=Signed_Division_Word.html>Word_Lib.Signed_Division_Word</a>›</span></span>]

        Signed division on word:

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>(sdiv)</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> [source] <span class=quoted><span class=quoted>‹<span class=keyword1><span class=keyword1>(smod)</span></span> <span class=main><span class=main>::</span></span> <span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span> word›</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Aligned.html></a><a href=Aligned.html>Word_Lib.Aligned</a>›</span></span>] \

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] is_aligned_iff_udvd <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Least_significant_bit.html></a><a href=Least_significant_bit.html>Word_Lib.Least_significant_bit</a>›</span></span>]

        The least significant bit as an alias:
        <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] lsb_odd <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Most_significant_bit.html></a><a href=Most_significant_bit.html>Word_Lib.Most_significant_bit</a>›</span></span>]

        The most significant bit:

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] msb_int_def <span class=main><span class=main>[</span></span><span class=operator><span class=operator>of</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] word_msb_sint <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] msb_word_iff_sless_0 <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [mode=iff] msb_word_iff_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Traditional_Infix_Syntax.html></a><a href=Traditional_Infix_Syntax.html>Word_Lib.Traditional_Infix_Syntax</a>›</span></span>]

        Clones of existing operations decorated with
        traditional syntax:

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> test_bit_eq_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> shiftl_eq_push_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> shiftr_eq_drop_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> sshiftr_eq <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Next_and_Prev.html></a><a href=Next_and_Prev.html>Word_Lib.Next_and_Prev</a>›</span></span>] \

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> word_next_unfold <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

          <span class=antiquoted><span class=antiquoted>▪</span></span> <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> word_prev_unfold <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Enumeration_Word.html></a><a href=Enumeration_Word.html>Word_Lib.Enumeration_Word</a>›</span></span>]

        More on explicit enumeration of word types.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=More_Word_Operations.html></a><a href=More_Word_Operations.html>Word_Lib.More_Word_Operations</a>›</span></span>]

        Even more operations on word.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Types]

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Signed_Words.html></a><a href=Signed_Words.html>Word_Lib.Signed_Words</a>›</span></span>]

          Formal tagging of word types with a <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹signed›</span></span></span></span> marker.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Lemmas]

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=More_Word.html></a><a href=More_Word.html>Word_Lib.More_Word</a>›</span></span>]

          More lemmas on words.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_Lemmas.html></a><a href=Word_Lemmas.html>Word_Lib.Word_Lemmas</a>›</span></span>]

          More lemmas on words, covering many other theories mentioned here.

    <span class=antiquoted><span class=antiquoted>➧</span></span>[Words of popular lengths].

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_8.html></a><a href=Word_8.html>Word_Lib.Word_8</a>›</span></span>]

          for 8-bit words.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_16.html></a><a href=Word_16.html>Word_Lib.Word_16</a>›</span></span>]

          for 16-bit words.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_32.html></a><a href=Word_32.html>Word_Lib.Word_32</a>›</span></span>]

          for 32-bit words.

      <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_64.html></a><a href=Word_64.html>Word_Lib.Word_64</a>›</span></span>]

          for 64-bit words. This theory is not part of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹Word_Lib_Sumo›</span></span></span></span>, because it shadows
          names from <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_32.html></a><a href=Word_32.html>Word_Lib.Word_32</a>›</span></span>. They can be used together, but then will have
          to use qualified names in applications.
›</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹More library sessions›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹Native_Word›</span></span></span></span>] Makes machine words and machine arithmetic available for code generation.
  It provides a common abstraction that hides the differences between the different target languages.
  The code generator maps these operations to the APIs of the target languages.
›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Legacy theories›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The following theories contain material which has been
  factored out since it is not recommended to use it in
  new applications, mostly because matters can be expressed
  succinctly using already existing operations.

  This section gives some indication how to migrate away
  from those theories.  However theorem coverage may still
  be terse in some cases.

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_Lib_Sumo.html></a><a href=Word_Lib_Sumo.html>Word_Lib.Word_Lib_Sumo</a>›</span></span>]

    An entry point importing any relevant theory in that session.  Intended
    for backward compatibility: start importing this theory when
    migrating applications to Isabelle2021, and later sort out
    what you really need. You may need to include
   <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_32.html></a><a href=Word_32.html>Word_Lib.Word_32</a>›</span></span> or <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Word_64.html></a><a href=Word_64.html>Word_Lib.Word_64</a>›</span></span> separately.

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Generic_set_bit.html></a><a href=Generic_set_bit.html>Word_Lib.Generic_set_bit</a>›</span></span>]

    Kind of an alias: <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> set_bit_eq <span class=main><span class=main>[</span></span><span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Typedef_Morphisms.html></a><a href=Typedef_Morphisms.html>Word_Lib.Typedef_Morphisms</a>›</span></span>]

    A low-level extension to HOL typedef providing
    conversions along type morphisms.  The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>method</span></span> transfer<span class=antiquote><span class=antiquote>}</span></span></span></span> method
    seems to be sufficient for most applications though.

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Bit_Comprehension.html></a><a href=Bit_Comprehension.html>Word_Lib.Bit_Comprehension</a>›</span></span>]

    Comprehension syntax for bit values over predicates
    <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹nat <span class=main><span class=main>⇒</span></span> bool›</span></span></span></span>.  For <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹<span class=tfree><span class=tfree>'a</span></span><span class=main><span class=main>::</span></span>len word›</span></span></span></span>, straightforward
    alternatives exist; difficult to handle for <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>typ</span><span class=hidden>&gt;</span></span></span><span class=quoted><span class=quoted>‹int›</span></span></span></span>.

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Reversed_Bit_Lists.html></a><a href=Reversed_Bit_Lists.html>Word_Lib.Reversed_Bit_Lists</a>›</span></span>]

    Representation of bit values as explicit list in
    <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator>∗</span></span>‹reversed›</span></span> order.

    This should rarely be necessary: the <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>const</span><span class=hidden>&gt;</span></span></span>‹bit›</span></span> projection
    should be sufficient in most cases.  In case explicit lists
    are needed, existing operations can be used:

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> [display] horner_sum_bit_eq_take_bit <span class=main><span class=main>[</span></span><span class=operator><span class=operator>where</span></span> ?'a <span class=main><span class=main><span class=main><span class=main>=</span></span></span></span> <span class=quoted><span class=quoted>int</span></span><span class=main><span class=main>,</span></span> <span class=operator><span class=operator>no_vars</span></span><span class=main><span class=main>]</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

  <span class=antiquoted><span class=antiquoted>➧</span></span>[<span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>theory</span><span class=hidden>&gt;</span></span></span>‹<a href=Many_More.html></a><a href=Many_More.html>Word_Lib.Many_More</a>›</span></span>]

    Collection of operations and theorems which are kept for backward
    compatibility and not used in other theories in session <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹Word_Lib›</span></span></span></span>.
    They are used in applications of <span class=antiquoted><span class=antiquoted><span class=operator><span class=operator><span class=hidden>\&lt;^</span><span class=control>text</span><span class=hidden>&gt;</span></span></span><span class=raw_text><span class=raw_text>‹Word_Lib›</span></span></span></span>, but should be migrated to there.
›</span></span>

<span class=comment1>(*&lt;*)</span>
<span class=keyword2><span class=keyword>end</span></span>
<span class=comment1>(*&gt;*)</span>
</pre></div><div id=Examples><div class=head><h1>Theory Examples</h1></div><pre class=source><span class=comment1>(*
 * Copyright Data61, CSIRO (ABN 41 687 119 230)
 *
 * SPDX-License-Identifier: BSD-2-Clause
 *)</span>

<span class=keyword1><span class=command>theory</span></span> Examples
  <span class=keyword2><span class=keyword>imports</span></span> <a href=Bitwise.html>Bitwise</a> <a href=Next_and_Prev.html>Next_and_Prev</a> <a href=Generic_set_bit.html>Generic_set_bit</a> <a href=Word_Syntax.html>Word_Syntax</a> <a href=Signed_Division_Word.html>Signed_Division_Word</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"modulus"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>27</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=numeral>5</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>27</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>11</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>27</span> <span class=main>≠</span> <span class=main>(</span><span class=numeral>11</span> <span class=main>::</span> <span class=numeral>6</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"signed"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>127</span> <span class=main>::</span> <span class=numeral>6</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"number ring simps"</span></span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>27</span> <span class=main>+</span> <span class=numeral>11</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>38</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>27</span> <span class=main>+</span> <span class=numeral>11</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>6</span><span class=main>::</span><span class=numeral>5</span> word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>7</span> <span class=main>*</span> <span class=numeral>3</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>21</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=numeral>11</span> <span class=main>-</span> <span class=numeral>27</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>16</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span><span class=main>-</span> <span class=numeral>11</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>11</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>40</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>39</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_pred <span class=numeral>2</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_succ <span class=main>(</span><span class=main>-</span> <span class=numeral>3</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=numeral>2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>23</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>27</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>23</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>27</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=numeral>23</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>27</span><span class=main>::</span><span class=numeral>2</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>4</span><span class=main>::</span><span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>4</span><span class=main>::</span><span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"ring operations"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>b</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>a</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"casting"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"uint <span class=main>(</span><span class=numeral>234567</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>71</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"uint <span class=main>(</span><span class=main>-</span><span class=numeral>234567</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>953</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=numeral>234567</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>71</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"sint <span class=main>(</span><span class=main>-</span><span class=numeral>234567</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=numeral>71</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"uint <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>-</span><span class=numeral>234567</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>953</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"unat <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=numeral>0b1010</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b10</span> <span class=main>::</span> <span class=numeral>2</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=numeral>0b1010</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1010</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"scast <span class=main>(</span><span class=numeral>0b1010</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b111010</span> <span class=main>::</span> <span class=numeral>6</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"ucast <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>2</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"reducing goals to nat or int and arith:"</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>+</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>i</span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>+</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>i</span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>len word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>unat_arith</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"bool lists"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"of_bl <span class=main>[</span>True<span class=main>,</span> False<span class=main>,</span> True<span class=main>,</span> True<span class=main>]</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1011</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"to_bl <span class=main>(</span><span class=numeral>0b110</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>[</span>False<span class=main>,</span> True<span class=main>,</span> True<span class=main>,</span> False<span class=main>]</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"of_bl <span class=main>(</span>replicate <span class=numeral>32</span> True<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0xFFFFFFFF</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> numeral_eq_Suc<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"bit operations"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0b110</span> <span class=keyword1>AND</span> <span class=numeral>0b101</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b100</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0b110</span> <span class=keyword1>OR</span> <span class=numeral>0b011</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b111</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0xF0</span> <span class=keyword1>XOR</span> <span class=numeral>0xFF</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0x0F</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>(</span><span class=numeral>0xF0</span> <span class=main>::</span> <span class=numeral>16</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>0xFF0F</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>AND</span> <span class=numeral>5</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>AND</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>AND</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>AND</span> <span class=numeral>5</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>OR</span> <span class=numeral>6</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>7</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>OR</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>XOR</span> <span class=numeral>7</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>6</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>XOR</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>254</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>NOT</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>255</span> <span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>0xFFFFFFFF</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>0b0010</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>!!</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=numeral>0b0010</span> <span class=main>::</span> <span class=numeral>4</span> word<span class=main>)</span> <span class=main>!!</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=numeral>0b1000</span> <span class=main>::</span> <span class=numeral>3</span> word<span class=main>)</span> <span class=main>!!</span> <span class=numeral>4</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>1</span> <span class=main>::</span> <span class=numeral>3</span> word<span class=main>)</span> <span class=main>!!</span> <span class=numeral>2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>0b11000</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span> <span class=main>!!</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>=</span> <span class=numeral>3</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bin_nth_Bit0 bin_nth_Bit1<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=numeral>55</span> <span class=numeral>7</span> True <span class=main>=</span> <span class=main>(</span><span class=numeral>183</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=numeral>0b0010</span> <span class=numeral>7</span> True <span class=main>=</span> <span class=main>(</span><span class=numeral>0b10000010</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=numeral>0b0010</span> <span class=main>1</span> False <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=main>1</span> <span class=numeral>3</span> True <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1001</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=main>1</span> <span class=main>0</span> False <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=main>0</span> <span class=numeral>3</span> True <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1000</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"set_bit <span class=main>0</span> <span class=numeral>3</span> False <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=numeral>0b0101</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"even <span class=main>(</span><span class=numeral>0b1000</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"odd <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"even <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=main>(</span><span class=numeral>0b0101</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span>   <span class=quoted><span class=quoted>"msb <span class=main>(</span><span class=numeral>0b1000</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> msb <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_cat <span class=main>(</span><span class=numeral>27</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span> <span class=main>(</span><span class=numeral>27</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>2843</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_cat <span class=main>(</span><span class=numeral>0b0011</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span> <span class=main>(</span><span class=numeral>0b1111</span><span class=main>::</span><span class=numeral>6</span>word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b0011001111</span> <span class=main>::</span> <span class=numeral>10</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0b1011</span> <span class=main>&lt;&lt;</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b101100</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0b1011</span> <span class=main>&gt;&gt;</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b10</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0b1011</span> <span class=main>&gt;&gt;&gt;</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b10</span><span class=main>::</span><span class=numeral>8</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;&lt;</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b100</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>len word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span> <span class=keyword1><span class=command>oops</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"slice <span class=numeral>3</span> <span class=main>(</span><span class=numeral>0b101111</span><span class=main>::</span><span class=numeral>6</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b101</span><span class=main>::</span><span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"slice <span class=numeral>3</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span><span class=numeral>6</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=numeral>3</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span> <span class=keyword1><span class=command>oops</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_rotr <span class=numeral>2</span> <span class=numeral>0b0110</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1001</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_rotl <span class=main>1</span> <span class=numeral>0b1110</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1101</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_roti <span class=numeral>2</span> <span class=numeral>0b1110</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1011</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_roti <span class=main>(</span><span class=main>-</span> <span class=numeral>2</span><span class=main>)</span> <span class=numeral>0b0110</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b1001</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_rotr <span class=numeral>2</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_rotr <span class=numeral>2</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b0100</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span> <span class=keyword1><span class=command>oops</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_rotl <span class=numeral>2</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b0100</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span> <span class=keyword1><span class=command>oops</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_roti <span class=main>(</span><span class=main>-</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>1</span> <span class=main>=</span> <span class=main>(</span><span class=numeral>0b0100</span><span class=main>::</span><span class=numeral>4</span> word<span class=main>)</span>"</span></span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>?</span></span> <span class=keyword1><span class=command>oops</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xff00</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0x00ff</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>16</span> word<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xff00</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0x00ff</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>AND</span> <span class=main>(</span><span class=numeral>0xff00</span> <span class=keyword1>OR</span> <span class=numeral>0x00ff</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> word_ao_dist2<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>0xff00</span> <span class=keyword1>OR</span> <span class=numeral>0x00ff</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>::</span><span class=numeral>16</span> word<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>AND</span> <span class=main>-</span><span class=main>1</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_next <span class=main>(</span><span class=numeral>2</span><span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>3</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>eval</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_next <span class=main>(</span><span class=numeral>255</span><span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=numeral>255</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>eval</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_prev <span class=main>(</span><span class=numeral>2</span><span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>eval</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"word_prev <span class=main>(</span><span class=main>0</span><span class=main>::</span> <span class=numeral>8</span> word<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>eval</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"proofs using bitwise expansion"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0xff00</span><span class=main>)</span> <span class=keyword1>OR</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>0x00ff</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=numeral>16</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_bitwise</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=numeral>3</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=numeral>4</span> <span class=main>&lt;&lt;</span> <span class=numeral>2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>&gt;&gt;</span> <span class=numeral>2</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=keyword1>NOT</span> <span class=numeral>3</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>10</span> word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_bitwise</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=main>-</span><span class=numeral>8</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=numeral>3</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=numeral>7</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>56</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=numeral>3</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>12</span> word"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_bitwise</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"some problems require further reasoning after bit expansion"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=numeral>42</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=numeral>89</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=numeral>8</span> word"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>word_bitwise</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>1023</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>-</span><span class=numeral>1024</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>32</span> word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>word_bitwise</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>"operations like shifts by non-numerals will expose some internal list
 representations but may still be easy to solve"</span></span>

<span class=keyword1><span class=command>lemma</span></span> shiftr_overflow<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>32</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>&gt;&gt;</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=free>b</span> <span class=main>::</span> <span class=quoted><span class=quoted>‹<span class=numeral>32</span> word›</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>word_bitwise</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* testing for presence of word_bitwise *)</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=numeral>3</span><span class=main>)</span> <span class=keyword1>AND</span> <span class=numeral>7</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>AND</span> <span class=numeral>56</span><span class=main>)</span> <span class=main>&gt;&gt;</span> <span class=numeral>3</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>word_bitwise</span>

<span class=comment1>(* Tests *)</span>
<span class=keyword1><span class=command>lemma</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>4</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span>  <span class=numeral>4</span> <span class=main>=</span>  <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span>  <span class=numeral>4</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span>  <span class=numeral>4</span> <span class=main>=</span>  <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>  <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>  <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>5</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>  <span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>5</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>sdiv</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sdiv_word_def signed_divide_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>4</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span>  <span class=numeral>4</span> <span class=main>=</span>   <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span>  <span class=numeral>4</span> <span class=main>=</span>   <span class=numeral>3</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span>  <span class=numeral>4</span> <span class=main>=</span>  <span class=main>-</span><span class=numeral>3</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>   <span class=numeral>3</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>3</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>  <span class=main>-</span><span class=numeral>3</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>5</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>  <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span> <span class=numeral>5</span> <span class=main>::</span> <span class=numeral>32</span> word<span class=main>)</span> <span class=keyword1>smod</span> <span class=main>-</span><span class=numeral>4</span> <span class=main>=</span>   <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> smod_word_def signed_modulo_int_def signed_divide_int_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>&lt;</span> <span class=main>(</span><span class=numeral>1024</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span> <span class=main>∧</span> <span class=main>1</span> <span class=main>≤</span> <span class=main>(</span><span class=numeral>1024</span><span class=main>::</span><span class=numeral>32</span> word<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div></main></div></div></body></html>