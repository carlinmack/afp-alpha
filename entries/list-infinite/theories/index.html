<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Session List-Infinite - Archive of Formal Proofs</title><meta property="og:title" content="Session List-Infinite"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/entries/list-infinite/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories"><meta property="og:site_name" content="Archive of Formal Proofs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/afp.png"><meta name=twitter:title content="Session List-Infinite"><meta name=twitter:description content><link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css><link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script><script src=/js/header-search.js></script></head><body class=mathjax_ignore><aside><div><div><a href=/><img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo></a><ul><a href=/entries/list-infinite><li>Return to entry</li></a></ul><hr><ul><li><a href=#Util_Set>Util_Set</a><ul><a href=#Util_Set-conj_disj_absorb><li>conj_disj_absorb</li></a><a href=#Util_Set-disj_eq_distribL><li>disj_eq_distribL</li></a><a href=#Util_Set-disj_eq_distribR><li>disj_eq_distribR</li></a><a href=#Util_Set-Let_swap><li>Let_swap</li></a><a href=#Util_Set-if_P%27><li>if_P'</li></a><a href=#Util_Set-if_not_P%27><li>if_not_P'</li></a><a href=#Util_Set-if_P_both><li>if_P_both</li></a><a href=#Util_Set-if_P_both_in_set><li>if_P_both_in_set</li></a><a href=#Util_Set-comp2_conv><li>comp2_conv</li></a><a href=#Util_Set-comp3_conv><li>comp3_conv</li></a><a href=#Util_Set-ball_cong2><li>ball_cong2</li></a><a href=#Util_Set-bex_cong2><li>bex_cong2</li></a><a href=#Util_Set-ball_all_cong><li>ball_all_cong</li></a><a href=#Util_Set-bex_all_cong><li>bex_all_cong</li></a><a href=#Util_Set-all_cong><li>all_cong</li></a><a href=#Util_Set-ex_cong><li>ex_cong</li></a><a href=#Util_Set-all_imp_eqI><li>all_imp_eqI</li></a><a href=#Util_Set-ex_imp_eqI><li>ex_imp_eqI</li></a><a href=#Util_Set-empty_imp_not_in><li>empty_imp_not_in</li></a><a href=#Util_Set-ex_imp_not_empty><li>ex_imp_not_empty</li></a><a href=#Util_Set-in_imp_not_empty><li>in_imp_not_empty</li></a><a href=#Util_Set-not_empty_imp_ex><li>not_empty_imp_ex</li></a><a href=#Util_Set-not_ex_in_conv><li>not_ex_in_conv</li></a><a href=#Util_Set-bex_subset_imp_bex><li>bex_subset_imp_bex</li></a><a href=#Util_Set-bex_imp_ex><li>bex_imp_ex</li></a><a href=#Util_Set-ball_subset_imp_ball><li>ball_subset_imp_ball</li></a><a href=#Util_Set-all_imp_ball><li>all_imp_ball</li></a><a href=#Util_Set-mem_Collect_eq_not><li>mem_Collect_eq_not</li></a><a href=#Util_Set-Collect_not_in_imp_not><li>Collect_not_in_imp_not</li></a><a href=#Util_Set-Collect_not_imp_not_in><li>Collect_not_imp_not_in</li></a><a href=#Util_Set-Collect_is_subset><li>Collect_is_subset</li></a></ul></li><li><a href=#Util_MinMax>Util_MinMax</a><ul><a href=#Util_MinMax-min_less_imp_conj><li>min_less_imp_conj</li></a><a href=#Util_MinMax-conj_less_imp_min><li>conj_less_imp_min</li></a><a href=#Util_MinMax-min_le_imp_conj><li>min_le_imp_conj</li></a><a href=#Util_MinMax-max_less_imp_conj><li>max_less_imp_conj</li></a><a href=#Util_MinMax-conj_less_imp_max><li>conj_less_imp_max</li></a><a href=#Util_MinMax-max_le_imp_conj><li>max_le_imp_conj</li></a><a href=#Util_MinMax-min_le_monoR><li>min_le_monoR</li></a><a href=#Util_MinMax-max_le_monoR><li>max_le_monoR</li></a></ul></li><li><a href=#Util_NatInf>Util_NatInf</a><ul><a href=#Util_NatInf-diff_eq_conv_nat><li>diff_eq_conv_nat</li></a><a href=#Util_NatInf-idiff_eq_conv><li>idiff_eq_conv</li></a><a href=#Util_NatInf-less_eq_idiff_eq_sum><li>less_eq_idiff_eq_sum</li></a><a href=#Util_NatInf-eSuc_pred><li>eSuc_pred</li></a><a href=#Util_NatInf-ile_add1><li>ile_add1</li></a><a href=#Util_NatInf-ile_add2><li>ile_add2</li></a><a href=#Util_NatInf-iadd_iless_mono><li>iadd_iless_mono</li></a><a href=#Util_NatInf-trans_ile_iadd1><li>trans_ile_iadd1</li></a><a href=#Util_NatInf-trans_ile_iadd2><li>trans_ile_iadd2</li></a><a href=#Util_NatInf-trans_iless_iadd1><li>trans_iless_iadd1</li></a><a href=#Util_NatInf-trans_iless_iadd2><li>trans_iless_iadd2</li></a><a href=#Util_NatInf-iadd_ileD1><li>iadd_ileD1</li></a><a href=#Util_NatInf-iadd_ileD2><li>iadd_ileD2</li></a><a href=#Util_NatInf-idiff_ile_mono><li>idiff_ile_mono</li></a><a href=#Util_NatInf-idiff_ile_mono2><li>idiff_ile_mono2</li></a><a href=#Util_NatInf-idiff_iless_mono><li>idiff_iless_mono</li></a><a href=#Util_NatInf-idiff_iless_mono2><li>idiff_iless_mono2</li></a><a href=#Util_NatInf-idiv_enat_enat><li>idiv_enat_enat</li></a><a href=#Util_NatInf-idiv_infinity><li>idiv_infinity</li></a><a href=#Util_NatInf-idiv_infinity_right><li>idiv_infinity_right</li></a><a href=#Util_NatInf-idiv_infinity_if><li>idiv_infinity_if</li></a><a href=#Util_NatInf-imult_infinity_if><li>imult_infinity_if</li></a><a href=#Util_NatInf-imult_infinity_right_if><li>imult_infinity_right_if</li></a><a href=#Util_NatInf-idiv_by_0><li>idiv_by_0</li></a><a href=#Util_NatInf-idiv_0><li>idiv_0</li></a><a href=#Util_NatInf-imod_by_0><li>imod_by_0</li></a><a href=#Util_NatInf-imod_0><li>imod_0</li></a><a href=#Util_NatInf-imod_enat_enat><li>imod_enat_enat</li></a><a href=#Util_NatInf-imod_infinity><li>imod_infinity</li></a><a href=#Util_NatInf-imod_infinity_right><li>imod_infinity_right</li></a><a href=#Util_NatInf-idiv_self><li>idiv_self</li></a><a href=#Util_NatInf-imod_self><li>imod_self</li></a><a href=#Util_NatInf-idiv_iless><li>idiv_iless</li></a><a href=#Util_NatInf-imod_iless><li>imod_iless</li></a><a href=#Util_NatInf-imod_iless_divisor><li>imod_iless_divisor</li></a><a href=#Util_NatInf-imod_ile_dividend><li>imod_ile_dividend</li></a><a href=#Util_NatInf-idiv_ile_dividend><li>idiv_ile_dividend</li></a><a href=#Util_NatInf-idiv_imult2_eq><li>idiv_imult2_eq</li></a><a href=#Util_NatInf-imult_ile_mono><li>imult_ile_mono</li></a><a href=#Util_NatInf-imult_ile_mono1><li>imult_ile_mono1</li></a><a href=#Util_NatInf-imult_ile_mono2><li>imult_ile_mono2</li></a><a href=#Util_NatInf-imult_iless_mono1><li>imult_iless_mono1</li></a><a href=#Util_NatInf-imult_iless_mono2><li>imult_iless_mono2</li></a><a href=#Util_NatInf-imod_1><li>imod_1</li></a><a href=#Util_NatInf-imod_iadd_self2><li>imod_iadd_self2</li></a><a href=#Util_NatInf-imod_iadd_self1><li>imod_iadd_self1</li></a><a href=#Util_NatInf-idiv_imod_equality><li>idiv_imod_equality</li></a><a href=#Util_NatInf-imod_idiv_equality><li>imod_idiv_equality</li></a><a href=#Util_NatInf-idiv_ile_mono><li>idiv_ile_mono</li></a><a href=#Util_NatInf-idiv_ile_mono2><li>idiv_ile_mono2</li></a></ul></li><li><a href=#Util_Nat>Util_Nat</a><ul><a href=#Util_Nat-add_1_Suc_conv><li>add_1_Suc_conv</li></a><a href=#Util_Nat-sub_Suc0_sub_Suc_conv><li>sub_Suc0_sub_Suc_conv</li></a><a href=#Util_Nat-Suc_diff_Suc><li>Suc_diff_Suc</li></a><a href=#Util_Nat-nat_grSuc0_conv><li>nat_grSuc0_conv</li></a><a href=#Util_Nat-nat_geSucSuc0_conv><li>nat_geSucSuc0_conv</li></a><a href=#Util_Nat-nat_lessSucSuc0_conv><li>nat_lessSucSuc0_conv</li></a><a href=#Util_Nat-nat_leSuc0_conv><li>nat_leSuc0_conv</li></a><a href=#Util_Nat-mult_pred><li>mult_pred</li></a><a href=#Util_Nat-mult_pred_right><li>mult_pred_right</li></a><a href=#Util_Nat-gr_implies_gr0><li>gr_implies_gr0</li></a><a href=#Util_Nat-gr0_imp_self_le_mult1><li>gr0_imp_self_le_mult1</li></a><a href=#Util_Nat-gr0_imp_self_le_mult2><li>gr0_imp_self_le_mult2</li></a><a href=#Util_Nat-less_imp_Suc_mult_le><li>less_imp_Suc_mult_le</li></a><a href=#Util_Nat-less_imp_Suc_mult_pred_less><li>less_imp_Suc_mult_pred_less</li></a><a href=#Util_Nat-ord_zero_less_diff><li>ord_zero_less_diff</li></a><a href=#Util_Nat-ord_zero_le_diff><li>ord_zero_le_diff</li></a><a href=#Util_Nat-less_add1><li>less_add1</li></a><a href=#Util_Nat-less_add2><li>less_add2</li></a><a href=#Util_Nat-add_lessD2><li>add_lessD2</li></a><a href=#Util_Nat-add_le_mono2><li>add_le_mono2</li></a><a href=#Util_Nat-add_less_mono2><li>add_less_mono2</li></a><a href=#Util_Nat-diff_less_self><li>diff_less_self</li></a><a href=#Util_Nat-ge_less_neq_conv><li>ge_less_neq_conv</li></a><a href=#Util_Nat-greater_le_neq_conv><li>greater_le_neq_conv</li></a><a href=#Util_Nat-leq_pos_imp_abs_leq><li>leq_pos_imp_abs_leq</li></a><a href=#Util_Nat-leq_neg_imp_abs_geq><li>leq_neg_imp_abs_geq</li></a><a href=#Util_Nat-abs_range><li>abs_range</li></a><a href=#Util_Nat-sgn_abs><li>sgn_abs</li></a><a href=#Util_Nat-sgn_mult_abs><li>sgn_mult_abs</li></a><a href=#Util_Nat-abs_imp_sgn_abs><li>abs_imp_sgn_abs</li></a><a href=#Util_Nat-sgn_mono><li>sgn_mono</li></a><a href=#Util_Nat-add_diff_le><li>add_diff_le</li></a><a href=#Util_Nat-less_add_diff><li>less_add_diff</li></a><a href=#Util_Nat-add_diff_less><li>add_diff_less</li></a><a href=#Util_Nat-add_le_imp_le_diff1><li>add_le_imp_le_diff1</li></a><a href=#Util_Nat-add_le_imp_le_diff2><li>add_le_imp_le_diff2</li></a><a href=#Util_Nat-diff_less_imp_less_add><li>diff_less_imp_less_add</li></a><a href=#Util_Nat-diff_less_conv><li>diff_less_conv</li></a><a href=#Util_Nat-le_diff_swap><li>le_diff_swap</li></a><a href=#Util_Nat-diff_less_imp_swap><li>diff_less_imp_swap</li></a><a href=#Util_Nat-diff_less_swap><li>diff_less_swap</li></a><a href=#Util_Nat-less_diff_imp_less><li>less_diff_imp_less</li></a><a href=#Util_Nat-le_diff_imp_le><li>le_diff_imp_le</li></a><a href=#Util_Nat-less_diff_le_imp_less><li>less_diff_le_imp_less</li></a><a href=#Util_Nat-le_diff_le_imp_le><li>le_diff_le_imp_le</li></a><a href=#Util_Nat-le_imp_diff_le><li>le_imp_diff_le</li></a><a href=#Util_Nat-diff_add_inverse_Suc><li>diff_add_inverse_Suc</li></a><a href=#Util_Nat-pred_mono><li>pred_mono</li></a><a href=#Util_Nat-Suc_less_pred_conv><li>Suc_less_pred_conv</li></a><a href=#Util_Nat-Suc_le_pred_conv><li>Suc_le_pred_conv</li></a><a href=#Util_Nat-Suc_le_imp_le_pred><li>Suc_le_imp_le_pred</li></a><a href=#Util_Nat-diff_cancel_imp_eq><li>diff_cancel_imp_eq</li></a><a href=#Util_Nat-nat_diff_left_cancel_less><li>nat_diff_left_cancel_less</li></a><a href=#Util_Nat-nat_diff_right_cancel_less><li>nat_diff_right_cancel_less</li></a><a href=#Util_Nat-nat_diff_left_cancel_le1><li>nat_diff_left_cancel_le1</li></a><a href=#Util_Nat-nat_diff_left_cancel_le2><li>nat_diff_left_cancel_le2</li></a><a href=#Util_Nat-nat_diff_right_cancel_le1><li>nat_diff_right_cancel_le1</li></a><a href=#Util_Nat-nat_diff_right_cancel_le2><li>nat_diff_right_cancel_le2</li></a><a href=#Util_Nat-nat_diff_left_cancel_eq1><li>nat_diff_left_cancel_eq1</li></a><a href=#Util_Nat-nat_diff_left_cancel_eq2><li>nat_diff_left_cancel_eq2</li></a><a href=#Util_Nat-nat_diff_right_cancel_eq1><li>nat_diff_right_cancel_eq1</li></a><a href=#Util_Nat-nat_diff_right_cancel_eq2><li>nat_diff_right_cancel_eq2</li></a><a href=#Util_Nat-eq_diff_left_iff><li>eq_diff_left_iff</li></a><a href=#Util_Nat-eq_imp_diff_eq><li>eq_imp_diff_eq</li></a></ul></li><li><a href=#Util_Div>Util_Div</a><ul><a href=#Util_Div-mod_less_dividend><li>mod_less_dividend</li></a><a href=#Util_Div-diff_mod_le><li>diff_mod_le</li></a><a href=#Util_Div-mod_0_div_mult_cancel><li>mod_0_div_mult_cancel</li></a><a href=#Util_Div-div_mult_le><li>div_mult_le</li></a><a href=#Util_Div-less_div_Suc_mult><li>less_div_Suc_mult</li></a><a href=#Util_Div-nat_ge2_conv><li>nat_ge2_conv</li></a><a href=#Util_Div-Suc0_mod><li>Suc0_mod</li></a><a href=#Util_Div-mod_Suc_conv><li>mod_Suc_conv</li></a><a href=#Util_Div-mod_Suc%27><li>mod_Suc'</li></a><a href=#Util_Div-mod_add><li>mod_add</li></a><a href=#Util_Div-mod_sub_eq_mod_0_conv><li>mod_sub_eq_mod_0_conv</li></a><a href=#Util_Div-mod_sub_eq_mod_swap><li>mod_sub_eq_mod_swap</li></a><a href=#Util_Div-le_mod_greater_imp_div_less><li>le_mod_greater_imp_div_less</li></a><a href=#Util_Div-less_mod_ge_imp_div_less><li>less_mod_ge_imp_div_less</li></a><a href=#Util_Div-mod_diff_right_eq><li>mod_diff_right_eq</li></a><a href=#Util_Div-mod_eq_imp_diff_mod_eq2><li>mod_eq_imp_diff_mod_eq2</li></a><a href=#Util_Div-divisor_add_diff_mod_if><li>divisor_add_diff_mod_if</li></a><a href=#Util_Div-mod_add_mod_if><li>mod_add_mod_if</li></a><a href=#Util_Div-mod_add1_eq_if><li>mod_add1_eq_if</li></a><a href=#Util_Div-mod_add_eq_mod_conv><li>mod_add_eq_mod_conv</li></a><a href=#Util_Div-mod_diff1_eq><li>mod_diff1_eq</li></a><a href=#Util_Div-mod_diff_self1><li>mod_diff_self1</li></a><a href=#Util_Div-mod_diff_self2><li>mod_diff_self2</li></a><a href=#Util_Div-mod_diff_mult_self1><li>mod_diff_mult_self1</li></a><a href=#Util_Div-mod_diff_mult_self2><li>mod_diff_mult_self2</li></a><a href=#Util_Div-div_diff_self1><li>div_diff_self1</li></a><a href=#Util_Div-div_diff_self2><li>div_diff_self2</li></a><a href=#Util_Div-div_diff_mult_self1><li>div_diff_mult_self1</li></a><a href=#Util_Div-div_diff_mult_self2><li>div_diff_mult_self2</li></a><a href=#Util_Div-mod_eq_imp_diff_mod_0><li>mod_eq_imp_diff_mod_0</li></a><a href=#Util_Div-mod_neq_imp_diff_mod_neq0><li>mod_neq_imp_diff_mod_neq0</li></a><a href=#Util_Div-diff_mod_0_imp_mod_eq><li>diff_mod_0_imp_mod_eq</li></a><a href=#Util_Div-mod_eq_diff_mod_0_conv><li>mod_eq_diff_mod_0_conv</li></a><a href=#Util_Div-zmod_eq_imp_diff_mod_0><li>zmod_eq_imp_diff_mod_0</li></a><a href=#Util_Div-zdiff_mod_0_imp_mod_eq__pos><li>zdiff_mod_0_imp_mod_eq__pos</li></a><a href=#Util_Div-zmod_zminus_eq_conv_pos><li>zmod_zminus_eq_conv_pos</li></a><a href=#Util_Div-zmod_zminus_eq_conv><li>zmod_zminus_eq_conv</li></a><a href=#Util_Div-zdiff_mod_0_imp_mod_eq><li>zdiff_mod_0_imp_mod_eq</li></a><a href=#Util_Div-zmod_eq_diff_mod_0_conv><li>zmod_eq_diff_mod_0_conv</li></a><a href=#Util_Div-zmult_div_leq_mono><li>zmult_div_leq_mono</li></a><a href=#Util_Div-zmult_div_leq_mono_neg><li>zmult_div_leq_mono_neg</li></a><a href=#Util_Div-zmult_div_pos_le><li>zmult_div_pos_le</li></a><a href=#Util_Div-zmult_div_neg_le><li>zmult_div_neg_le</li></a><a href=#Util_Div-zmult_div_ge_0><li>zmult_div_ge_0</li></a><a href=#Util_Div-zmult_div_abs_ge><li>zmult_div_abs_ge</li></a><a href=#Util_Div-zmult_div_plus_abs_ge><li>zmult_div_plus_abs_ge</li></a><a href=#Util_Div-less_mod_eq_imp_add_divisor_le><li>less_mod_eq_imp_add_divisor_le</li></a><a href=#Util_Div-less_div_imp_mult_add_divisor_le><li>less_div_imp_mult_add_divisor_le</li></a><a href=#Util_Div-mod_add_eq_imp_mod_0><li>mod_add_eq_imp_mod_0</li></a><a href=#Util_Div-between_imp_mod_between><li>between_imp_mod_between</li></a><a href=#Util_Div-le_less_imp_div><li>le_less_imp_div</li></a><a href=#Util_Div-div_imp_le_less><li>div_imp_le_less</li></a><a href=#Util_Div-div_le_mod_le_imp_le><li>div_le_mod_le_imp_le</li></a><a href=#Util_Div-le_mod_add_eq_imp_add_mod_le><li>le_mod_add_eq_imp_add_mod_le</li></a><a href=#Util_Div-mod_0_imp_mod_mult_right_0><li>mod_0_imp_mod_mult_right_0</li></a><a href=#Util_Div-mod_0_imp_mod_mult_left_0><li>mod_0_imp_mod_mult_left_0</li></a><a href=#Util_Div-mod_0_imp_div_mult_left_eq><li>mod_0_imp_div_mult_left_eq</li></a><a href=#Util_Div-mod_0_imp_div_mult_right_eq><li>mod_0_imp_div_mult_right_eq</li></a><a href=#Util_Div-mod_0_imp_mod_factor_0_left><li>mod_0_imp_mod_factor_0_left</li></a><a href=#Util_Div-mod_0_imp_mod_factor_0_right><li>mod_0_imp_mod_factor_0_right</li></a><a href=#Util_Div-mod_eq_mult_distrib><li>mod_eq_mult_distrib</li></a><a href=#Util_Div-mod_mult_eq_imp_mod_eq><li>mod_mult_eq_imp_mod_eq</li></a><a href=#Util_Div-mod_factor_imp_mod_0><li>mod_factor_imp_mod_0</li></a><a href=#Util_Div-mod_factor_div_mod><li>mod_factor_div_mod</li></a><a href=#Util_Div-div_add1_eq_if><li>div_add1_eq_if</li></a><a href=#Util_Div-div_Suc><li>div_Suc</li></a><a href=#Util_Div-div_Suc%27><li>div_Suc'</li></a><a href=#Util_Div-div_diff1_eq_if><li>div_diff1_eq_if</li></a><a href=#Util_Div-diff_less_divisor_imp_sub_mod_eq><li>diff_less_divisor_imp_sub_mod_eq</li></a><a href=#Util_Div-diff_ge_divisor_imp_sub_mod_less><li>diff_ge_divisor_imp_sub_mod_less</li></a><a href=#Util_Div-le_imp_sub_mod_le><li>le_imp_sub_mod_le</li></a><a href=#Util_Div-mod_less_diff_mod><li>mod_less_diff_mod</li></a><a href=#Util_Div-mod_0_imp_mod_pred><li>mod_0_imp_mod_pred</li></a><a href=#Util_Div-mod_pred><li>mod_pred</li></a><a href=#Util_Div-mod_eq_imp_diff_mod_eq_divisor><li>mod_eq_imp_diff_mod_eq_divisor</li></a><a href=#Util_Div-sub_diff_mod_eq><li>sub_diff_mod_eq</li></a><a href=#Util_Div-sub_diff_mod_eq%27><li>sub_diff_mod_eq'</li></a><a href=#Util_Div-mod_eq_Suc_0_conv><li>mod_eq_Suc_0_conv</li></a><a href=#Util_Div-mod_eq_divisor_minus_Suc_0_conv><li>mod_eq_divisor_minus_Suc_0_conv</li></a><a href=#Util_Div-sub_mod_div_eq_div><li>sub_mod_div_eq_div</li></a><a href=#Util_Div-mod_less_imp_diff_div_conv><li>mod_less_imp_diff_div_conv</li></a><a href=#Util_Div-div_le_conv><li>div_le_conv</li></a><a href=#Util_Div-le_div_conv><li>le_div_conv</li></a><a href=#Util_Div-less_mult_imp_div_less><li>less_mult_imp_div_less</li></a><a href=#Util_Div-div_less_imp_less_mult><li>div_less_imp_less_mult</li></a><a href=#Util_Div-div_less_conv><li>div_less_conv</li></a><a href=#Util_Div-div_eq_0_conv><li>div_eq_0_conv</li></a><a href=#Util_Div-div_eq_0_conv%27><li>div_eq_0_conv'</li></a><a href=#Util_Div-mod_0_less_div_conv><li>mod_0_less_div_conv</li></a><a href=#Util_Div-add_le_divisor_imp_le_Suc_div><li>add_le_divisor_imp_le_Suc_div</li></a></ul></li><li><a href=#SetInterval2>SetInterval2</a><ul><a href=#SetInterval2-mono_on_subset><li>mono_on_subset</li></a><a href=#SetInterval2-strict_mono_on_subset><li>strict_mono_on_subset</li></a><a href=#SetInterval2-mono_on_UNIV_mono_conv><li>mono_on_UNIV_mono_conv</li></a><a href=#SetInterval2-strict_mono_on_UNIV_strict_mono_conv><li>strict_mono_on_UNIV_strict_mono_conv</li></a><a href=#SetInterval2-mono_imp_mono_on><li>mono_imp_mono_on</li></a><a href=#SetInterval2-strict_mono_imp_strict_mono_on><li>strict_mono_imp_strict_mono_on</li></a><a href=#SetInterval2-strict_mono_on_imp_mono_on><li>strict_mono_on_imp_mono_on</li></a><a href=#SetInterval2-inj_imp_inj_on><li>inj_imp_inj_on</li></a><a href=#SetInterval2-strict_mono_on_imp_inj_on><li>strict_mono_on_imp_inj_on</li></a><a href=#SetInterval2-strict_mono_imp_inj><li>strict_mono_imp_inj</li></a><a href=#SetInterval2-strict_mono_on_mono_on_conv><li>strict_mono_on_mono_on_conv</li></a><a href=#SetInterval2-inj_on_image_mem_iff><li>inj_on_image_mem_iff</li></a><a href=#SetInterval2-surj_on_conv><li>surj_on_conv</li></a><a href=#SetInterval2-surj_on_image_conv><li>surj_on_image_conv</li></a><a href=#SetInterval2-surj_on_id><li>surj_on_id</li></a><a href=#SetInterval2-surj_onI><li>surj_onI</li></a><a href=#SetInterval2-comp_surj_on><li>comp_surj_on</li></a><a href=#SetInterval2-surj_on_Un_right><li>surj_on_Un_right</li></a><a href=#SetInterval2-surj_on_Un_left><li>surj_on_Un_left</li></a><a href=#SetInterval2-surj_on_diff_right><li>surj_on_diff_right</li></a><a href=#SetInterval2-surj_on_empty_right><li>surj_on_empty_right</li></a><a href=#SetInterval2-surj_on_empty_left><li>surj_on_empty_left</li></a><a href=#SetInterval2-surj_on_imageI><li>surj_on_imageI</li></a><a href=#SetInterval2-surj_on_insert_right><li>surj_on_insert_right</li></a><a href=#SetInterval2-surj_on_insert_left><li>surj_on_insert_left</li></a><a href=#SetInterval2-surj_on_subset_right><li>surj_on_subset_right</li></a><a href=#SetInterval2-surj_on_subset_left><li>surj_on_subset_left</li></a><a href=#SetInterval2-bij_betw_imp_surj_on><li>bij_betw_imp_surj_on</li></a><a href=#SetInterval2-bij_betw_inj_on_surj_on_conv><li>bij_betw_inj_on_surj_on_conv</li></a><a href=#SetInterval2-image_nat_induct><li>image_nat_induct</li></a><a href=#SetInterval2-nat_induct%27><li>nat_induct'</li></a><a href=#SetInterval2-enat_induct><li>enat_induct</li></a><a href=#SetInterval2-eSuc_imp_Suc_aux_0><li>eSuc_imp_Suc_aux_0</li></a><a href=#SetInterval2-eSuc_imp_Suc_aux_n0><li>eSuc_imp_Suc_aux_n0</li></a><a href=#SetInterval2-enat_induct%27><li>enat_induct'</li></a><a href=#SetInterval2-wf_less_interval><li>wf_less_interval</li></a><a href=#SetInterval2-interval_induct><li>interval_induct</li></a><a href=#SetInterval2-add_left_inj><li>add_left_inj</li></a><a href=#SetInterval2-add_right_inj><li>add_right_inj</li></a><a href=#SetInterval2-mult_left_inj><li>mult_left_inj</li></a><a href=#SetInterval2-mult_right_inj><li>mult_right_inj</li></a><a href=#SetInterval2-sub_left_inj_on><li>sub_left_inj_on</li></a><a href=#SetInterval2-sub_right_inj_on><li>sub_right_inj_on</li></a><a href=#SetInterval2-add_left_strict_mono><li>add_left_strict_mono</li></a><a href=#SetInterval2-add_right_strict_mono><li>add_right_strict_mono</li></a><a href=#SetInterval2-mult_left_strict_mono><li>mult_left_strict_mono</li></a><a href=#SetInterval2-mult_right_strict_mono><li>mult_right_strict_mono</li></a><a href=#SetInterval2-sub_left_strict_mono_on><li>sub_left_strict_mono_on</li></a><a href=#SetInterval2-div_right_strict_mono_on><li>div_right_strict_mono_on</li></a><a href=#SetInterval2-mod_eq_div_right_strict_mono_on><li>mod_eq_div_right_strict_mono_on</li></a><a href=#SetInterval2-iMinI><li>iMinI</li></a><a href=#SetInterval2-iMinI_ex><li>iMinI_ex</li></a><a href=#SetInterval2-iMinI2><li>iMinI2</li></a><a href=#SetInterval2-iMinI2_ex><li>iMinI2_ex</li></a><a href=#SetInterval2-iMinI2_ex2><li>iMinI2_ex2</li></a><a href=#SetInterval2-iMin_le><li>iMin_le</li></a><a href=#SetInterval2-iMin_neq_imp_greater><li>iMin_neq_imp_greater</li></a><a href=#SetInterval2-iMin_mono><li>iMin_mono</li></a><a href=#SetInterval2-not_less_iMin><li>not_less_iMin</li></a><a href=#SetInterval2-Collect_not_less_iMin><li>Collect_not_less_iMin</li></a><a href=#SetInterval2-Collect_iMin_le><li>Collect_iMin_le</li></a><a href=#SetInterval2-Collect_minI><li>Collect_minI</li></a><a href=#SetInterval2-iMin_the><li>iMin_the</li></a><a href=#SetInterval2-iMin_the2><li>iMin_the2</li></a><a href=#SetInterval2-iMin_equality><li>iMin_equality</li></a><a href=#SetInterval2-iMin_mono_on><li>iMin_mono_on</li></a><a href=#SetInterval2-iMin_mono_on2><li>iMin_mono_on2</li></a><a href=#SetInterval2-iMinI2_order><li>iMinI2_order</li></a><a href=#SetInterval2-wellorder_iMin_lemma><li>wellorder_iMin_lemma</li></a><a href=#SetInterval2-iMin_Min_conv><li>iMin_Min_conv</li></a><a href=#SetInterval2-Min_neq_imp_greater><li>Min_neq_imp_greater</li></a><a href=#SetInterval2-Max_neq_imp_less><li>Max_neq_imp_less</li></a><a href=#SetInterval2-nat_Least_mono><li>nat_Least_mono</li></a><a href=#SetInterval2-Least_disj><li>Least_disj</li></a><a href=#SetInterval2-Least_imp_le><li>Least_imp_le</li></a><a href=#SetInterval2-Least_imp_disj_eq><li>Least_imp_disj_eq</li></a><a href=#SetInterval2-Least_le_imp_le><li>Least_le_imp_le</li></a><a href=#SetInterval2-Least_le_imp_le_disj><li>Least_le_imp_le_disj</li></a><a href=#SetInterval2-Max_equality><li>Max_equality</li></a><a href=#SetInterval2-not_greater_Max><li>not_greater_Max</li></a><a href=#SetInterval2-Collect_not_greater_Max><li>Collect_not_greater_Max</li></a><a href=#SetInterval2-Collect_Max_ge><li>Collect_Max_ge</li></a><a href=#SetInterval2-MaxI><li>MaxI</li></a><a href=#SetInterval2-MaxI_ex><li>MaxI_ex</li></a><a href=#SetInterval2-MaxI_ex2><li>MaxI_ex2</li></a><a href=#SetInterval2-MaxI2><li>MaxI2</li></a><a href=#SetInterval2-MaxI2_ex><li>MaxI2_ex</li></a><a href=#SetInterval2-MaxI2_ex2><li>MaxI2_ex2</li></a><a href=#SetInterval2-Max_mono><li>Max_mono</li></a><a href=#SetInterval2-Max_mono2><li>Max_mono2</li></a><a href=#SetInterval2-Max_mono_on><li>Max_mono_on</li></a><a href=#SetInterval2-Max_mono_on2><li>Max_mono_on2</li></a><a href=#SetInterval2-Max_the><li>Max_the</li></a><a href=#SetInterval2-Max_the2><li>Max_the2</li></a><a href=#SetInterval2-wellorder_Max_lemma><li>wellorder_Max_lemma</li></a><a href=#SetInterval2-MaxI2_order><li>MaxI2_order</li></a><a href=#SetInterval2-Min_le_Max><li>Min_le_Max</li></a><a href=#SetInterval2-iMin_le_Max><li>iMin_le_Max</li></a><a href=#SetInterval2-iMax_finite_conv><li>iMax_finite_conv</li></a><a href=#SetInterval2-iMax_infinite_conv><li>iMax_infinite_conv</li></a><a href=#SetInterval2-max_Min_eq_Min_max><li>max_Min_eq_Min_max</li></a><a href=#SetInterval2-max_iMin_eq_iMin_max><li>max_iMin_eq_iMin_max</li></a><a href=#SetInterval2-iMin_subset><li>iMin_subset</li></a><a href=#SetInterval2-Max_subset><li>Max_subset</li></a><a href=#SetInterval2-Min_subset><li>Min_subset</li></a><a href=#SetInterval2-iMin_Int_ge1><li>iMin_Int_ge1</li></a><a href=#SetInterval2-iMin_Int_ge2><li>iMin_Int_ge2</li></a><a href=#SetInterval2-iMin_Int_ge><li>iMin_Int_ge</li></a><a href=#SetInterval2-Max_Int_le1><li>Max_Int_le1</li></a><a href=#SetInterval2-Max_Int_le2><li>Max_Int_le2</li></a><a href=#SetInterval2-Max_Int_le><li>Max_Int_le</li></a><a href=#SetInterval2-iMin_Un><li>iMin_Un</li></a><a href=#SetInterval2-iMin_singleton><li>iMin_singleton</li></a><a href=#SetInterval2-iMax_singleton><li>iMax_singleton</li></a><a href=#SetInterval2-Max_le_Min_imp_singleton><li>Max_le_Min_imp_singleton</li></a><a href=#SetInterval2-Max_le_Min_conv_singleton><li>Max_le_Min_conv_singleton</li></a><a href=#SetInterval2-Max_le_iMin_imp_le><li>Max_le_iMin_imp_le</li></a><a href=#SetInterval2-le_imp_Max_le_iMin><li>le_imp_Max_le_iMin</li></a><a href=#SetInterval2-Max_le_iMin_conv_le><li>Max_le_iMin_conv_le</li></a><a href=#SetInterval2-Max_less_iMin_imp_less><li>Max_less_iMin_imp_less</li></a><a href=#SetInterval2-less_imp_Max_less_iMin><li>less_imp_Max_less_iMin</li></a><a href=#SetInterval2-Max_less_iMin_conv_less><li>Max_less_iMin_conv_less</li></a><a href=#SetInterval2-Max_less_iMin_imp_disjoint><li>Max_less_iMin_imp_disjoint</li></a><a href=#SetInterval2-iMin_in_idem><li>iMin_in_idem</li></a><a href=#SetInterval2-iMin_insert><li>iMin_insert</li></a><a href=#SetInterval2-iMin_insert_remove><li>iMin_insert_remove</li></a><a href=#SetInterval2-iMin_remove><li>iMin_remove</li></a><a href=#SetInterval2-iMin_subset_idem><li>iMin_subset_idem</li></a><a href=#SetInterval2-iMin_union_inter><li>iMin_union_inter</li></a><a href=#SetInterval2-iMin_ge_iff><li>iMin_ge_iff</li></a><a href=#SetInterval2-iMin_gr_iff><li>iMin_gr_iff</li></a><a href=#SetInterval2-iMin_le_iff><li>iMin_le_iff</li></a><a href=#SetInterval2-iMin_less_iff><li>iMin_less_iff</li></a><a href=#SetInterval2-hom_iMin_commute><li>hom_iMin_commute</li></a><a href=#SetInterval2-singleton_not_empty><li>singleton_not_empty</li></a><a href=#SetInterval2-singleton_finite><li>singleton_finite</li></a><a href=#SetInterval2-singleton_ball><li>singleton_ball</li></a><a href=#SetInterval2-singleton_bex><li>singleton_bex</li></a><a href=#SetInterval2-subset_singleton_conv><li>subset_singleton_conv</li></a><a href=#SetInterval2-singleton_subset_conv><li>singleton_subset_conv</li></a><a href=#SetInterval2-singleton_eq_conv><li>singleton_eq_conv</li></a><a href=#SetInterval2-singleton_subset_singleton_conv><li>singleton_subset_singleton_conv</li></a><a href=#SetInterval2-singleton_Int1_if><li>singleton_Int1_if</li></a><a href=#SetInterval2-singleton_Int2_if><li>singleton_Int2_if</li></a><a href=#SetInterval2-singleton_image><li>singleton_image</li></a><a href=#SetInterval2-inj_on_singleton><li>inj_on_singleton</li></a><a href=#SetInterval2-strict_mono_on_singleton><li>strict_mono_on_singleton</li></a><a href=#SetInterval2-infinite_imp_not_singleton><li>infinite_imp_not_singleton</li></a><a href=#SetInterval2-infinite_insert><li>infinite_insert</li></a><a href=#SetInterval2-infinite_Diff_insert><li>infinite_Diff_insert</li></a><a href=#SetInterval2-subset_finite_imp_finite><li>subset_finite_imp_finite</li></a><a href=#SetInterval2-infinite_not_subset_finite><li>infinite_not_subset_finite</li></a><a href=#SetInterval2-Un_infinite_right><li>Un_infinite_right</li></a><a href=#SetInterval2-Un_infinite_iff><li>Un_infinite_iff</li></a><a href=#SetInterval2-cartesian_product_infiniteL_imp_infinite><li>cartesian_product_infiniteL_imp_infinite</li></a><a href=#SetInterval2-cartesian_product_infiniteR_imp_infinite><li>cartesian_product_infiniteR_imp_infinite</li></a><a href=#SetInterval2-finite_nat_iff_bounded2><li>finite_nat_iff_bounded2</li></a><a href=#SetInterval2-finite_nat_iff_bounded_le2><li>finite_nat_iff_bounded_le2</li></a><a href=#SetInterval2-nat_asc_chain_imp_unbounded><li>nat_asc_chain_imp_unbounded</li></a><a href=#SetInterval2-infinite_nat_iff_asc_chain><li>infinite_nat_iff_asc_chain</li></a><a href=#SetInterval2-infinite_imp_asc_chain><li>infinite_imp_asc_chain</li></a><a href=#SetInterval2-infinite_image_imp_infinite><li>infinite_image_imp_infinite</li></a><a href=#SetInterval2-inj_on_imp_infinite_image><li>inj_on_imp_infinite_image</li></a><a href=#SetInterval2-inj_on_infinite_image_iff><li>inj_on_infinite_image_iff</li></a><a href=#SetInterval2-inj_on_finite_image_iff><li>inj_on_finite_image_iff</li></a><a href=#SetInterval2-nat_ex_greater_finite_Max_conv><li>nat_ex_greater_finite_Max_conv</li></a><a href=#SetInterval2-disjoint_iff_in_not_in1><li>disjoint_iff_in_not_in1</li></a><a href=#SetInterval2-disjoint_iff_in_not_in2><li>disjoint_iff_in_not_in2</li></a><a href=#SetInterval2-disjoint_in_Un><li>disjoint_in_Un</li></a><a href=#SetInterval2-partition_Union><li>partition_Union</li></a><a href=#SetInterval2-disjoint_partition_Int><li>disjoint_partition_Int</li></a><a href=#SetInterval2-card_partition><li>card_partition</li></a><a href=#SetInterval2-subset_image_Int><li>subset_image_Int</li></a><a href=#SetInterval2-image_diff_disjoint_image_Int><li>image_diff_disjoint_image_Int</li></a><a href=#SetInterval2-subset_imp_Int_subset1><li>subset_imp_Int_subset1</li></a><a href=#SetInterval2-subset_imp_Int_subset2><li>subset_imp_Int_subset2</li></a><a href=#SetInterval2-image_add_atLeast><li>image_add_atLeast</li></a><a href=#SetInterval2-image_add_atMost><li>image_add_atMost</li></a><a href=#SetInterval2-atMost_atLeastAtMost_0_conv><li>atMost_atLeastAtMost_0_conv</li></a><a href=#SetInterval2-atLeastAtMost_subset_atMost><li>atLeastAtMost_subset_atMost</li></a><a href=#SetInterval2-lessThan_insert><li>lessThan_insert</li></a><a href=#SetInterval2-greaterThan_insert><li>greaterThan_insert</li></a><a href=#SetInterval2-atMost_remove><li>atMost_remove</li></a><a href=#SetInterval2-atLeast_remove><li>atLeast_remove</li></a><a href=#SetInterval2-atMost_lessThan_conv><li>atMost_lessThan_conv</li></a><a href=#SetInterval2-atLeastAtMost_atLeastLessThan_conv><li>atLeastAtMost_atLeastLessThan_conv</li></a><a href=#SetInterval2-atLeast_greaterThan_conv><li>atLeast_greaterThan_conv</li></a><a href=#SetInterval2-atLeastAtMost_greaterThanAtMost_conv><li>atLeastAtMost_greaterThanAtMost_conv</li></a><a href=#SetInterval2-finite_subset_atLeastAtMost><li>finite_subset_atLeastAtMost</li></a><a href=#SetInterval2-Max_le_imp_subset_atMost><li>Max_le_imp_subset_atMost</li></a><a href=#SetInterval2-subset_atMost_imp_Max_le><li>subset_atMost_imp_Max_le</li></a><a href=#SetInterval2-subset_atMost_Max_le_conv><li>subset_atMost_Max_le_conv</li></a><a href=#SetInterval2-iMin_atLeast><li>iMin_atLeast</li></a><a href=#SetInterval2-iMin_greaterThan><li>iMin_greaterThan</li></a><a href=#SetInterval2-iMin_atMost><li>iMin_atMost</li></a><a href=#SetInterval2-iMin_lessThan><li>iMin_lessThan</li></a><a href=#SetInterval2-Max_atMost><li>Max_atMost</li></a><a href=#SetInterval2-Max_lessThan><li>Max_lessThan</li></a><a href=#SetInterval2-iMin_atLeastLessThan><li>iMin_atLeastLessThan</li></a><a href=#SetInterval2-Max_atLeastLessThan><li>Max_atLeastLessThan</li></a><a href=#SetInterval2-iMin_greaterThanLessThan><li>iMin_greaterThanLessThan</li></a><a href=#SetInterval2-Max_greaterThanLessThan><li>Max_greaterThanLessThan</li></a><a href=#SetInterval2-iMin_greaterThanAtMost><li>iMin_greaterThanAtMost</li></a><a href=#SetInterval2-Max_greaterThanAtMost><li>Max_greaterThanAtMost</li></a><a href=#SetInterval2-iMin_atLeastAtMost><li>iMin_atLeastAtMost</li></a><a href=#SetInterval2-Max_atLeastAtMost><li>Max_atLeastAtMost</li></a><a href=#SetInterval2-infinite_atLeast><li>infinite_atLeast</li></a><a href=#SetInterval2-infinite_greaterThan><li>infinite_greaterThan</li></a><a href=#SetInterval2-infinite_atLeast_int><li>infinite_atLeast_int</li></a><a href=#SetInterval2-infinite_greaterThan_int><li>infinite_greaterThan_int</li></a><a href=#SetInterval2-infinite_atMost_int><li>infinite_atMost_int</li></a><a href=#SetInterval2-infinite_lessThan_int><li>infinite_lessThan_int</li></a><a href=#SetInterval2-sum_singleton><li>sum_singleton</li></a><a href=#SetInterval2-card_singleton><li>card_singleton</li></a><a href=#SetInterval2-card_cartesian_product_singleton_right><li>card_cartesian_product_singleton_right</li></a><a href=#SetInterval2-card_1_imp_singleton><li>card_1_imp_singleton</li></a><a href=#SetInterval2-card_1_singleton_conv><li>card_1_singleton_conv</li></a><a href=#SetInterval2-card_gr0_imp_finite><li>card_gr0_imp_finite</li></a><a href=#SetInterval2-card_gr0_imp_not_empty><li>card_gr0_imp_not_empty</li></a><a href=#SetInterval2-not_empty_card_gr0_conv><li>not_empty_card_gr0_conv</li></a><a href=#SetInterval2-nat_card_le_Max><li>nat_card_le_Max</li></a><a href=#SetInterval2-Int_card1><li>Int_card1</li></a><a href=#SetInterval2-Int_card2><li>Int_card2</li></a><a href=#SetInterval2-Un_card1><li>Un_card1</li></a><a href=#SetInterval2-Un_card2><li>Un_card2</li></a><a href=#SetInterval2-card_Un_conv><li>card_Un_conv</li></a><a href=#SetInterval2-card_Int_conv><li>card_Int_conv</li></a><a href=#SetInterval2-pigeonhole_principle><li>pigeonhole_principle</li></a></ul></li><li><a href=#SetIntervalCut>SetIntervalCut</a><ul><a href=#SetIntervalCut-set_restrictionD><li>set_restrictionD</li></a><a href=#SetIntervalCut-set_restrictionD_spec><li>set_restrictionD_spec</li></a><a href=#SetIntervalCut-set_restrictionI><li>set_restrictionI</li></a><a href=#SetIntervalCut-set_restriction_comp><li>set_restriction_comp</li></a><a href=#SetIntervalCut-set_restriction_commute><li>set_restriction_commute</li></a><a href=#SetIntervalCut-set_restriction_fun_is_set_restriction><li>set_restriction_fun_is_set_restriction</li></a><a href=#SetIntervalCut-set_restriction_Int_conv><li>set_restriction_Int_conv</li></a><a href=#SetIntervalCut-set_restriction_Un><li>set_restriction_Un</li></a><a href=#SetIntervalCut-set_restriction_Int><li>set_restriction_Int</li></a><a href=#SetIntervalCut-set_restriction_Diff><li>set_restriction_Diff</li></a><a href=#SetIntervalCut-set_restriction_mono><li>set_restriction_mono</li></a><a href=#SetIntervalCut-set_restriction_absorb><li>set_restriction_absorb</li></a><a href=#SetIntervalCut-set_restriction_empty><li>set_restriction_empty</li></a><a href=#SetIntervalCut-set_restriction_non_empty_imp><li>set_restriction_non_empty_imp</li></a><a href=#SetIntervalCut-set_restriction_subset><li>set_restriction_subset</li></a><a href=#SetIntervalCut-set_restriction_finite><li>set_restriction_finite</li></a><a href=#SetIntervalCut-set_restriction_card><li>set_restriction_card</li></a><a href=#SetIntervalCut-set_restriction_card_le><li>set_restriction_card_le</li></a><a href=#SetIntervalCut-set_restriction_not_in_imp><li>set_restriction_not_in_imp</li></a><a href=#SetIntervalCut-set_restriction_in_imp><li>set_restriction_in_imp</li></a><a href=#SetIntervalCut-set_restriction_fun_singleton><li>set_restriction_fun_singleton</li></a><a href=#SetIntervalCut-set_restriction_fun_all_conv><li>set_restriction_fun_all_conv</li></a><a href=#SetIntervalCut-set_restriction_fun_empty_conv><li>set_restriction_fun_empty_conv</li></a><a href=#SetIntervalCut-cut_le_mem_iff><li>cut_le_mem_iff</li></a><a href=#SetIntervalCut-cut_less_mem_iff><li>cut_less_mem_iff</li></a><a href=#SetIntervalCut-cut_ge_mem_iff><li>cut_ge_mem_iff</li></a><a href=#SetIntervalCut-cut_greater_mem_iff><li>cut_greater_mem_iff</li></a><a href=#SetIntervalCut-cut_leI><li>cut_leI</li></a><a href=#SetIntervalCut-cut_leE><li>cut_leE</li></a><a href=#SetIntervalCut-cut_less_bound><li>cut_less_bound</li></a><a href=#SetIntervalCut-cut_le_Int_conv><li>cut_le_Int_conv</li></a><a href=#SetIntervalCut-cut_le_Diff_conv><li>cut_le_Diff_conv</li></a><a href=#SetIntervalCut-cut_less_eq_set_restriction_fun%27><li>cut_less_eq_set_restriction_fun'</li></a><a href=#SetIntervalCut-cut_less_eq_set_restriction_fun><li>cut_less_eq_set_restriction_fun</li></a><a href=#SetIntervalCut-i_cut_set_restriction_disj><li>i_cut_set_restriction_disj</li></a><a href=#SetIntervalCut-i_cut_commute_disj><li>i_cut_commute_disj</li></a><a href=#SetIntervalCut-cut_less_empty><li>cut_less_empty</li></a><a href=#SetIntervalCut-cut_less_not_empty_imp><li>cut_less_not_empty_imp</li></a><a href=#SetIntervalCut-cut_less_singleton><li>cut_less_singleton</li></a><a href=#SetIntervalCut-cut_less_subset><li>cut_less_subset</li></a><a href=#SetIntervalCut-i_cut_Un_disj><li>i_cut_Un_disj</li></a><a href=#SetIntervalCut-i_cut_Int_disj><li>i_cut_Int_disj</li></a><a href=#SetIntervalCut-cut_less_Int><li>cut_less_Int</li></a><a href=#SetIntervalCut-cut_less_Int_left><li>cut_less_Int_left</li></a><a href=#SetIntervalCut-cut_less_Int_right><li>cut_less_Int_right</li></a><a href=#SetIntervalCut-i_cut_Diff_disj><li>i_cut_Diff_disj</li></a><a href=#SetIntervalCut-i_cut_subset_mono_disj><li>i_cut_subset_mono_disj</li></a><a href=#SetIntervalCut-cut_less_mono><li>cut_less_mono</li></a><a href=#SetIntervalCut-cut_cut_le><li>cut_cut_le</li></a><a href=#SetIntervalCut-i_cut_absorb_disj><li>i_cut_absorb_disj</li></a><a href=#SetIntervalCut-cut_less_0_empty><li>cut_less_0_empty</li></a><a href=#SetIntervalCut-cut_le_all_iff><li>cut_le_all_iff</li></a><a href=#SetIntervalCut-cut_le_empty_iff><li>cut_le_empty_iff</li></a><a href=#SetIntervalCut-cut_le_not_empty_iff><li>cut_le_not_empty_iff</li></a><a href=#SetIntervalCut-nat_cut_ge_infinite_not_empty><li>nat_cut_ge_infinite_not_empty</li></a><a href=#SetIntervalCut-nat_cut_greater_infinite_not_empty><li>nat_cut_greater_infinite_not_empty</li></a><a href=#SetIntervalCut-Collect_minI_cut><li>Collect_minI_cut</li></a><a href=#SetIntervalCut-cut_le_cut_greater_ident><li>cut_le_cut_greater_ident</li></a><a href=#SetIntervalCut-cut_less_cut_ge_ident><li>cut_less_cut_ge_ident</li></a><a href=#SetIntervalCut-cut_le_cut_ge_ident><li>cut_le_cut_ge_ident</li></a><a href=#SetIntervalCut-cut_less_cut_greater_ident><li>cut_less_cut_greater_ident</li></a><a href=#SetIntervalCut-insert_eq_cut_less_cut_greater><li>insert_eq_cut_less_cut_greater</li></a><a href=#SetIntervalCut-insert_Int_conv_if><li>insert_Int_conv_if</li></a><a href=#SetIntervalCut-cut_le_less_conv_if><li>cut_le_less_conv_if</li></a><a href=#SetIntervalCut-cut_le_less_conv><li>cut_le_less_conv</li></a><a href=#SetIntervalCut-cut_less_le_conv><li>cut_less_le_conv</li></a><a href=#SetIntervalCut-cut_less_le_conv_if><li>cut_less_le_conv_if</li></a><a href=#SetIntervalCut-cut_ge_greater_conv_if><li>cut_ge_greater_conv_if</li></a><a href=#SetIntervalCut-cut_ge_greater_conv><li>cut_ge_greater_conv</li></a><a href=#SetIntervalCut-cut_greater_ge_conv><li>cut_greater_ge_conv</li></a><a href=#SetIntervalCut-cut_greater_ge_conv_if><li>cut_greater_ge_conv_if</li></a><a href=#SetIntervalCut-nat_cut_le_less_conv><li>nat_cut_le_less_conv</li></a><a href=#SetIntervalCut-nat_cut_less_le_conv><li>nat_cut_less_le_conv</li></a><a href=#SetIntervalCut-nat_cut_ge_greater_conv><li>nat_cut_ge_greater_conv</li></a><a href=#SetIntervalCut-nat_cut_greater_ge_conv><li>nat_cut_greater_ge_conv</li></a><a href=#SetIntervalCut-cut_less_image><li>cut_less_image</li></a><a href=#SetIntervalCut-cut_le_image><li>cut_le_image</li></a><a href=#SetIntervalCut-cut_greater_image><li>cut_greater_image</li></a><a href=#SetIntervalCut-cut_ge_image><li>cut_ge_image</li></a><a href=#SetIntervalCut-cut_le_finite><li>cut_le_finite</li></a><a href=#SetIntervalCut-nat_cut_le_finite><li>nat_cut_le_finite</li></a><a href=#SetIntervalCut-nat_cut_less_finite><li>nat_cut_less_finite</li></a><a href=#SetIntervalCut-nat_cut_ge_finite_iff><li>nat_cut_ge_finite_iff</li></a><a href=#SetIntervalCut-nat_cut_greater_finite_iff><li>nat_cut_greater_finite_iff</li></a><a href=#SetIntervalCut-cut_le_card><li>cut_le_card</li></a><a href=#SetIntervalCut-nat_cut_greater_card><li>nat_cut_greater_card</li></a><a href=#SetIntervalCut-nat_cut_ge_card><li>nat_cut_ge_card</li></a><a href=#SetIntervalCut-cut_greater_Min_eq_Diff><li>cut_greater_Min_eq_Diff</li></a><a href=#SetIntervalCut-cut_less_Max_eq_Diff><li>cut_less_Max_eq_Diff</li></a><a href=#SetIntervalCut-cut_le_Min_empty><li>cut_le_Min_empty</li></a><a href=#SetIntervalCut-cut_less_Min_empty><li>cut_less_Min_empty</li></a><a href=#SetIntervalCut-cut_le_Min_not_empty><li>cut_le_Min_not_empty</li></a><a href=#SetIntervalCut-cut_less_Min_not_empty><li>cut_less_Min_not_empty</li></a><a href=#SetIntervalCut-cut_ge_Min_all><li>cut_ge_Min_all</li></a><a href=#SetIntervalCut-cut_greater_Min_all><li>cut_greater_Min_all</li></a><a href=#SetIntervalCut-cut_ge_Max_empty><li>cut_ge_Max_empty</li></a><a href=#SetIntervalCut-cut_greater_Max_empty><li>cut_greater_Max_empty</li></a><a href=#SetIntervalCut-cut_ge_Max_not_empty><li>cut_ge_Max_not_empty</li></a><a href=#SetIntervalCut-cut_greater_Max_not_empty><li>cut_greater_Max_not_empty</li></a><a href=#SetIntervalCut-cut_le_Max_all><li>cut_le_Max_all</li></a><a href=#SetIntervalCut-cut_less_Max_all><li>cut_less_Max_all</li></a><a href=#SetIntervalCut-cut_less_Max_less><li>cut_less_Max_less</li></a><a href=#SetIntervalCut-cut_le_Max_le><li>cut_le_Max_le</li></a><a href=#SetIntervalCut-nat_cut_less_Max_less><li>nat_cut_less_Max_less</li></a><a href=#SetIntervalCut-nat_cut_le_Max_le><li>nat_cut_le_Max_le</li></a><a href=#SetIntervalCut-cut_greater_Min_greater><li>cut_greater_Min_greater</li></a><a href=#SetIntervalCut-cut_ge_Min_greater><li>cut_ge_Min_greater</li></a><a href=#SetIntervalCut-cut_less_Min_eq><li>cut_less_Min_eq</li></a><a href=#SetIntervalCut-cut_le_Min_eq><li>cut_le_Min_eq</li></a><a href=#SetIntervalCut-cut_ge_Max_eq><li>cut_ge_Max_eq</li></a><a href=#SetIntervalCut-cut_greater_Max_eq><li>cut_greater_Max_eq</li></a><a href=#SetIntervalCut-UNIV_cut_le><li>UNIV_cut_le</li></a><a href=#SetIntervalCut-lessThan_cut_le><li>lessThan_cut_le</li></a><a href=#SetIntervalCut-greaterThanLessThan_cut_le><li>greaterThanLessThan_cut_le</li></a><a href=#SetIntervalCut-nat_mirror_commute><li>nat_mirror_commute</li></a><a href=#SetIntervalCut-nat_mirror_inj_on><li>nat_mirror_inj_on</li></a><a href=#SetIntervalCut-nat_mirror_nat_mirror_ident><li>nat_mirror_nat_mirror_ident</li></a><a href=#SetIntervalCut-nat_mirror_add><li>nat_mirror_add</li></a><a href=#SetIntervalCut-nat_mirror_diff><li>nat_mirror_diff</li></a><a href=#SetIntervalCut-nat_mirror_le><li>nat_mirror_le</li></a><a href=#SetIntervalCut-nat_mirror_le_conv><li>nat_mirror_le_conv</li></a><a href=#SetIntervalCut-nat_mirror_less><li>nat_mirror_less</li></a><a href=#SetIntervalCut-nat_mirror_less_imp_less><li>nat_mirror_less_imp_less</li></a><a href=#SetIntervalCut-nat_mirror_less_conv><li>nat_mirror_less_conv</li></a><a href=#SetIntervalCut-nat_mirror_eq_conv><li>nat_mirror_eq_conv</li></a><a href=#SetIntervalCut-mirror_elem_inj_on><li>mirror_elem_inj_on</li></a><a href=#SetIntervalCut-mirror_elem_add><li>mirror_elem_add</li></a><a href=#SetIntervalCut-mirror_elem_diff><li>mirror_elem_diff</li></a><a href=#SetIntervalCut-mirror_elem_Min><li>mirror_elem_Min</li></a><a href=#SetIntervalCut-mirror_elem_Max><li>mirror_elem_Max</li></a><a href=#SetIntervalCut-mirror_elem_mirror_elem_ident><li>mirror_elem_mirror_elem_ident</li></a><a href=#SetIntervalCut-mirror_elem_le_conv><li>mirror_elem_le_conv</li></a><a href=#SetIntervalCut-mirror_elem_less_conv><li>mirror_elem_less_conv</li></a><a href=#SetIntervalCut-mirror_elem_eq_conv><li>mirror_elem_eq_conv</li></a><a href=#SetIntervalCut-mirror_elem_eq_conv%27><li>mirror_elem_eq_conv'</li></a><a href=#SetIntervalCut-imirror_eq_nat_mirror_image><li>imirror_eq_nat_mirror_image</li></a><a href=#SetIntervalCut-imirror_eq_mirror_elem_image><li>imirror_eq_mirror_elem_image</li></a><a href=#SetIntervalCut-imirror_eq_imirror_bounds><li>imirror_eq_imirror_bounds</li></a><a href=#SetIntervalCut-imirror_empty><li>imirror_empty</li></a><a href=#SetIntervalCut-imirror_is_empty><li>imirror_is_empty</li></a><a href=#SetIntervalCut-imirror_not_empty><li>imirror_not_empty</li></a><a href=#SetIntervalCut-imirror_singleton><li>imirror_singleton</li></a><a href=#SetIntervalCut-imirror_finite><li>imirror_finite</li></a><a href=#SetIntervalCut-imirror_bounds_iMin><li>imirror_bounds_iMin</li></a><a href=#SetIntervalCut-imirror_bounds_Max><li>imirror_bounds_Max</li></a><a href=#SetIntervalCut-imirror_iMin><li>imirror_iMin</li></a><a href=#SetIntervalCut-imirror_Max><li>imirror_Max</li></a><a href=#SetIntervalCut-imirror_bounds_iff><li>imirror_bounds_iff</li></a><a href=#SetIntervalCut-imirror_iff><li>imirror_iff</li></a><a href=#SetIntervalCut-imirror_bounds_imirror_bounds_ident><li>imirror_bounds_imirror_bounds_ident</li></a><a href=#SetIntervalCut-imirror_imirror_ident><li>imirror_imirror_ident</li></a><a href=#SetIntervalCut-mirror_elem_imirror><li>mirror_elem_imirror</li></a><a href=#SetIntervalCut-imirror_card><li>imirror_card</li></a><a href=#SetIntervalCut-imirror_bounds_elem_conv><li>imirror_bounds_elem_conv</li></a><a href=#SetIntervalCut-imirror_mem_conv><li>imirror_mem_conv</li></a><a href=#SetIntervalCut-imirror_cut_less><li>imirror_cut_less</li></a><a href=#SetIntervalCut-imirror_cut_le><li>imirror_cut_le</li></a><a href=#SetIntervalCut-imirror_cut_ge><li>imirror_cut_ge</li></a><a href=#SetIntervalCut-imirror_cut_greater><li>imirror_cut_greater</li></a><a href=#SetIntervalCut-imirror_bounds_Un><li>imirror_bounds_Un</li></a><a href=#SetIntervalCut-imirror_bounds_Int><li>imirror_bounds_Int</li></a></ul></li><li><a href=#SetIntervalStep>SetIntervalStep</a><ul><a href=#SetIntervalStep-inext_UNIV><li>inext_UNIV</li></a><a href=#SetIntervalStep-iprev_UNIV><li>iprev_UNIV</li></a><a href=#SetIntervalStep-inext_empty><li>inext_empty</li></a><a href=#SetIntervalStep-iprev_empty><li>iprev_empty</li></a><a href=#SetIntervalStep-not_in_inext_fix><li>not_in_inext_fix</li></a><a href=#SetIntervalStep-not_in_iprev_fix><li>not_in_iprev_fix</li></a><a href=#SetIntervalStep-inext_all_le_fix><li>inext_all_le_fix</li></a><a href=#SetIntervalStep-iprev_all_ge_fix><li>iprev_all_ge_fix</li></a><a href=#SetIntervalStep-inext_Max><li>inext_Max</li></a><a href=#SetIntervalStep-iprev_iMin><li>iprev_iMin</li></a><a href=#SetIntervalStep-inext_ge_Max><li>inext_ge_Max</li></a><a href=#SetIntervalStep-iprev_le_iMin><li>iprev_le_iMin</li></a><a href=#SetIntervalStep-inext_singleton><li>inext_singleton</li></a><a href=#SetIntervalStep-iprev_singleton><li>iprev_singleton</li></a><a href=#SetIntervalStep-inext_closed><li>inext_closed</li></a><a href=#SetIntervalStep-iprev_closed><li>iprev_closed</li></a><a href=#SetIntervalStep-inext_in_imp_in><li>inext_in_imp_in</li></a><a href=#SetIntervalStep-inext_in_iff><li>inext_in_iff</li></a><a href=#SetIntervalStep-subset_inext_closed><li>subset_inext_closed</li></a><a href=#SetIntervalStep-subset_inext_in_imp_in><li>subset_inext_in_imp_in</li></a><a href=#SetIntervalStep-subset_inext_in_iff><li>subset_inext_in_iff</li></a><a href=#SetIntervalStep-iprev_in_imp_in><li>iprev_in_imp_in</li></a><a href=#SetIntervalStep-iprev_in_iff><li>iprev_in_iff</li></a><a href=#SetIntervalStep-subset_iprev_closed><li>subset_iprev_closed</li></a><a href=#SetIntervalStep-subset_iprev_in_imp_in><li>subset_iprev_in_imp_in</li></a><a href=#SetIntervalStep-subset_iprev_in_iff><li>subset_iprev_in_iff</li></a><a href=#SetIntervalStep-inext_mono><li>inext_mono</li></a><a href=#SetIntervalStep-inext_mono2><li>inext_mono2</li></a><a href=#SetIntervalStep-inext_mono2_infin><li>inext_mono2_infin</li></a><a href=#SetIntervalStep-inext_mono2_fin><li>inext_mono2_fin</li></a><a href=#SetIntervalStep-inext_mono2_infin_fin><li>inext_mono2_infin_fin</li></a><a href=#SetIntervalStep-inext_neq_iMin><li>inext_neq_iMin</li></a><a href=#SetIntervalStep-inext_neq_iMin_infin><li>inext_neq_iMin_infin</li></a><a href=#SetIntervalStep-Max_le_iMin_imp_singleton><li>Max_le_iMin_imp_singleton</li></a><a href=#SetIntervalStep-inext_neq_iMin_not_singleton><li>inext_neq_iMin_not_singleton</li></a><a href=#SetIntervalStep-inext_neq_imp_Max><li>inext_neq_imp_Max</li></a><a href=#SetIntervalStep-inext_less_conv><li>inext_less_conv</li></a><a href=#SetIntervalStep-inext_min_step><li>inext_min_step</li></a><a href=#SetIntervalStep-min_step_inext><li>min_step_inext</li></a><a href=#SetIntervalStep-between_empty_imp_inext_eq><li>between_empty_imp_inext_eq</li></a><a href=#SetIntervalStep-inext_le_mono><li>inext_le_mono</li></a><a href=#SetIntervalStep-inext_less_mono><li>inext_less_mono</li></a><a href=#SetIntervalStep-inext_less_mono_fin><li>inext_less_mono_fin</li></a><a href=#SetIntervalStep-inext_less_mono_infin><li>inext_less_mono_infin</li></a><a href=#SetIntervalStep-inext_less_mono_infin_fin><li>inext_less_mono_infin_fin</li></a><a href=#SetIntervalStep-inext_le_mono_rev><li>inext_le_mono_rev</li></a><a href=#SetIntervalStep-inext_le_mono_fin_rev><li>inext_le_mono_fin_rev</li></a><a href=#SetIntervalStep-inext_le_mono_infin_rev><li>inext_le_mono_infin_rev</li></a><a href=#SetIntervalStep-inext_le_mono_infin_fin_rev><li>inext_le_mono_infin_fin_rev</li></a><a href=#SetIntervalStep-inext_less_mono_rev><li>inext_less_mono_rev</li></a><a href=#SetIntervalStep-less_imp_inext_le><li>less_imp_inext_le</li></a><a href=#SetIntervalStep-iprev_mono><li>iprev_mono</li></a><a href=#SetIntervalStep-iprev_mono2><li>iprev_mono2</li></a><a href=#SetIntervalStep-iprev_mono2_if_neq_iMin><li>iprev_mono2_if_neq_iMin</li></a><a href=#SetIntervalStep-iprev_neq_Max><li>iprev_neq_Max</li></a><a href=#SetIntervalStep-iprev_neq_Max_not_singleton><li>iprev_neq_Max_not_singleton</li></a><a href=#SetIntervalStep-iprev_neq_imp_iMin><li>iprev_neq_imp_iMin</li></a><a href=#SetIntervalStep-iprev_greater_conv><li>iprev_greater_conv</li></a><a href=#SetIntervalStep-inext_fix_iff><li>inext_fix_iff</li></a><a href=#SetIntervalStep-iprev_fix_iff><li>iprev_fix_iff</li></a><a href=#SetIntervalStep-iprev_min_step><li>iprev_min_step</li></a><a href=#SetIntervalStep-min_step_iprev><li>min_step_iprev</li></a><a href=#SetIntervalStep-between_empty_imp_iprev_eq><li>between_empty_imp_iprev_eq</li></a><a href=#SetIntervalStep-iprev_le_mono><li>iprev_le_mono</li></a><a href=#SetIntervalStep-iprev_less_mono><li>iprev_less_mono</li></a><a href=#SetIntervalStep-iprev_less_mono_if_neq_iMin><li>iprev_less_mono_if_neq_iMin</li></a><a href=#SetIntervalStep-iprev_le_mono_rev><li>iprev_le_mono_rev</li></a><a href=#SetIntervalStep-iprev_less_mono_rev><li>iprev_less_mono_rev</li></a><a href=#SetIntervalStep-set_restriction_inext_eq><li>set_restriction_inext_eq</li></a><a href=#SetIntervalStep-set_restriction_inext_singleton_eq><li>set_restriction_inext_singleton_eq</li></a><a href=#SetIntervalStep-inext_iprev><li>inext_iprev</li></a><a href=#SetIntervalStep-iprev_inext_infin><li>iprev_inext_infin</li></a><a href=#SetIntervalStep-iprev_inext_fin><li>iprev_inext_fin</li></a><a href=#SetIntervalStep-iprev_inext><li>iprev_inext</li></a><a href=#SetIntervalStep-inext_eq_infin><li>inext_eq_infin</li></a><a href=#SetIntervalStep-inext_eq_fin><li>inext_eq_fin</li></a><a href=#SetIntervalStep-inext_eq_infin_fin><li>inext_eq_infin_fin</li></a><a href=#SetIntervalStep-inext_eq><li>inext_eq</li></a><a href=#SetIntervalStep-iprev_eq_if_neq_iMin><li>iprev_eq_if_neq_iMin</li></a><a href=#SetIntervalStep-iprev_eq><li>iprev_eq</li></a><a href=#SetIntervalStep-greater_imp_iprev_ge><li>greater_imp_iprev_ge</li></a><a href=#SetIntervalStep-inext_cut_less_conv><li>inext_cut_less_conv</li></a><a href=#SetIntervalStep-inext_cut_le_conv><li>inext_cut_le_conv</li></a><a href=#SetIntervalStep-inext_cut_greater_conv><li>inext_cut_greater_conv</li></a><a href=#SetIntervalStep-inext_cut_ge_conv><li>inext_cut_ge_conv</li></a><a href=#SetIntervalStep-iprev_cut_greater_conv><li>iprev_cut_greater_conv</li></a><a href=#SetIntervalStep-iprev_cut_ge_conv><li>iprev_cut_ge_conv</li></a><a href=#SetIntervalStep-iprev_cut_less_conv><li>iprev_cut_less_conv</li></a><a href=#SetIntervalStep-iprev_cut_le_conv><li>iprev_cut_le_conv</li></a><a href=#SetIntervalStep-inext_cut_less_fix><li>inext_cut_less_fix</li></a><a href=#SetIntervalStep-inext_cut_le_fix><li>inext_cut_le_fix</li></a><a href=#SetIntervalStep-iprev_cut_greater_fix><li>iprev_cut_greater_fix</li></a><a href=#SetIntervalStep-iprev_cut_ge_fix><li>iprev_cut_ge_fix</li></a><a href=#SetIntervalStep-CommuteWithIntervalCut4_imp_2><li>CommuteWithIntervalCut4_imp_2</li></a><a href=#SetIntervalStep-nat_CommuteWithIntervalCut2_4_eq><li>nat_CommuteWithIntervalCut2_4_eq</li></a><a href=#SetIntervalStep-cut_less_CommuteWithIntervalCut4><li>cut_less_CommuteWithIntervalCut4</li></a><a href=#SetIntervalStep-inext_image><li>inext_image</li></a><a href=#SetIntervalStep-iprev_image><li>iprev_image</li></a><a href=#SetIntervalStep-inext_image2><li>inext_image2</li></a><a href=#SetIntervalStep-iprev_image2><li>iprev_image2</li></a><a href=#SetIntervalStep-inext_imirror_iprev_conv><li>inext_imirror_iprev_conv</li></a><a href=#SetIntervalStep-iprev_imirror_inext_conv><li>iprev_imirror_inext_conv</li></a><a href=#SetIntervalStep-inext_insert_ge_Max><li>inext_insert_ge_Max</li></a><a href=#SetIntervalStep-iprev_insert_le_iMin><li>iprev_insert_le_iMin</li></a><a href=#SetIntervalStep-cut_less_le_iprev_conv><li>cut_less_le_iprev_conv</li></a><a href=#SetIntervalStep-neq_Max_imp_inext_neq_iMin><li>neq_Max_imp_inext_neq_iMin</li></a><a href=#SetIntervalStep-cut_le_less_inext_conv><li>cut_le_less_inext_conv</li></a><a href=#SetIntervalStep-cut_ge_greater_iprev_conv><li>cut_ge_greater_iprev_conv</li></a><a href=#SetIntervalStep-cut_greater_ge_inext_conv><li>cut_greater_ge_inext_conv</li></a><a href=#SetIntervalStep-inext_append><li>inext_append</li></a><a href=#SetIntervalStep-iprev_append><li>iprev_append</li></a><a href=#SetIntervalStep-inext_predicate_change_exists_aux><li>inext_predicate_change_exists_aux</li></a><a href=#SetIntervalStep-inext_predicate_change_exists><li>inext_predicate_change_exists</li></a><a href=#SetIntervalStep-iprev_predicate_change_exists><li>iprev_predicate_change_exists</li></a><a href=#SetIntervalStep-inext_predicate_change_exists2_all><li>inext_predicate_change_exists2_all</li></a><a href=#SetIntervalStep-iprev_predicate_change_exists2_all><li>iprev_predicate_change_exists2_all</li></a><a href=#SetIntervalStep-inext_nth_closed><li>inext_nth_closed</li></a><a href=#SetIntervalStep-inext_nth_image><li>inext_nth_image</li></a><a href=#SetIntervalStep-inext_nth_Suc_mono><li>inext_nth_Suc_mono</li></a><a href=#SetIntervalStep-inext_nth_mono><li>inext_nth_mono</li></a><a href=#SetIntervalStep-inext_nth_Suc_mono2><li>inext_nth_Suc_mono2</li></a><a href=#SetIntervalStep-inext_nth_mono2><li>inext_nth_mono2</li></a><a href=#SetIntervalStep-inext_nth_mono2_infin><li>inext_nth_mono2_infin</li></a><a href=#SetIntervalStep-inext_nth_Max_fix><li>inext_nth_Max_fix</li></a><a href=#SetIntervalStep-inext_nth_cut_less_conv><li>inext_nth_cut_less_conv</li></a><a href=#SetIntervalStep-remove_Min_inext_nth_Suc_conv><li>remove_Min_inext_nth_Suc_conv</li></a><a href=#SetIntervalStep-remove_Max_eq><li>remove_Max_eq</li></a><a href=#SetIntervalStep-remove_iMin_eq><li>remove_iMin_eq</li></a><a href=#SetIntervalStep-remove_Min_eq><li>remove_Min_eq</li></a><a href=#SetIntervalStep-Max_le_iMin_conv_singleton><li>Max_le_iMin_conv_singleton</li></a><a href=#SetIntervalStep-inext_nth_card_less_Max><li>inext_nth_card_less_Max</li></a><a href=#SetIntervalStep-inext_nth_card_less_Max%27><li>inext_nth_card_less_Max'</li></a><a href=#SetIntervalStep-inext_nth_card_Max_aux><li>inext_nth_card_Max_aux</li></a><a href=#SetIntervalStep-inext_nth_card_Max_aux%27><li>inext_nth_card_Max_aux'</li></a><a href=#SetIntervalStep-inext_nth_card_Max><li>inext_nth_card_Max</li></a><a href=#SetIntervalStep-inext_nth_card_Max%27><li>inext_nth_card_Max'</li></a><a href=#SetIntervalStep-inext_nth_singleton><li>inext_nth_singleton</li></a><a href=#SetIntervalStep-inext_nth_eq_Min_conv><li>inext_nth_eq_Min_conv</li></a><a href=#SetIntervalStep-inext_nth_gr_Min_conv><li>inext_nth_gr_Min_conv</li></a><a href=#SetIntervalStep-inext_nth_gr_Min_conv_infinite><li>inext_nth_gr_Min_conv_infinite</li></a><a href=#SetIntervalStep-inext_nth_cut_ge_inext_nth><li>inext_nth_cut_ge_inext_nth</li></a><a href=#SetIntervalStep-inext_nth_append_eq1><li>inext_nth_append_eq1</li></a><a href=#SetIntervalStep-inext_nth_card_append_eq1><li>inext_nth_card_append_eq1</li></a><a href=#SetIntervalStep-inext_nth_card_append_eq3><li>inext_nth_card_append_eq3</li></a><a href=#SetIntervalStep-inext_nth_card_append_eq2><li>inext_nth_card_append_eq2</li></a><a href=#SetIntervalStep-inext_nth_card_append><li>inext_nth_card_append</li></a><a href=#SetIntervalStep-inext_nth_insert_Suc><li>inext_nth_insert_Suc</li></a><a href=#SetIntervalStep-inext_nth_cut_less_eq><li>inext_nth_cut_less_eq</li></a><a href=#SetIntervalStep-less_card_cut_less_imp_inext_nth_less><li>less_card_cut_less_imp_inext_nth_less</li></a><a href=#SetIntervalStep-inext_nth_less_less_card_conv><li>inext_nth_less_less_card_conv</li></a><a href=#SetIntervalStep-cut_less_inext_nth_card_eq1><li>cut_less_inext_nth_card_eq1</li></a><a href=#SetIntervalStep-cut_less_inext_nth_card_eq2><li>cut_less_inext_nth_card_eq2</li></a><a href=#SetIntervalStep-cut_less_inext_nth_card_if><li>cut_less_inext_nth_card_if</li></a><a href=#SetIntervalStep-cut_le_inext_nth_card_eq1><li>cut_le_inext_nth_card_eq1</li></a><a href=#SetIntervalStep-cut_le_inext_nth_card_eq2><li>cut_le_inext_nth_card_eq2</li></a><a href=#SetIntervalStep-cut_le_inext_nth_card_if><li>cut_le_inext_nth_card_if</li></a><a href=#SetIntervalStep-iprev_nth_closed><li>iprev_nth_closed</li></a><a href=#SetIntervalStep-iprev_nth_image><li>iprev_nth_image</li></a><a href=#SetIntervalStep-iprev_nth_Suc_mono><li>iprev_nth_Suc_mono</li></a><a href=#SetIntervalStep-iprev_nth_mono><li>iprev_nth_mono</li></a><a href=#SetIntervalStep-iprev_nth_Suc_mono2><li>iprev_nth_Suc_mono2</li></a><a href=#SetIntervalStep-iprev_nth_mono2><li>iprev_nth_mono2</li></a><a href=#SetIntervalStep-iprev_nth_iMin_fix><li>iprev_nth_iMin_fix</li></a><a href=#SetIntervalStep-iprev_nth_singleton><li>iprev_nth_singleton</li></a><a href=#SetIntervalStep-inext_nth_surj_aux1><li>inext_nth_surj_aux1</li></a><a href=#SetIntervalStep-inext_nth_surj_on><li>inext_nth_surj_on</li></a><a href=#SetIntervalStep-inext_induct><li>inext_induct</li></a><a href=#SetIntervalStep-iprev_nth_surj_aux1><li>iprev_nth_surj_aux1</li></a><a href=#SetIntervalStep-iprev_nth_surj_on><li>iprev_nth_surj_on</li></a><a href=#SetIntervalStep-iprev_induct><li>iprev_induct</li></a><a href=#SetIntervalStep-inext_atLeast><li>inext_atLeast</li></a><a href=#SetIntervalStep-iprev_atLeast%27><li>iprev_atLeast'</li></a><a href=#SetIntervalStep-iprev_atLeast><li>iprev_atLeast</li></a><a href=#SetIntervalStep-inext_atMost><li>inext_atMost</li></a><a href=#SetIntervalStep-iprev_atMost><li>iprev_atMost</li></a><a href=#SetIntervalStep-inext_lessThan><li>inext_lessThan</li></a><a href=#SetIntervalStep-iprev_lessThan><li>iprev_lessThan</li></a><a href=#SetIntervalStep-inext_atLeastAtMost><li>inext_atLeastAtMost</li></a><a href=#SetIntervalStep-iprev_atLeastAtMost><li>iprev_atLeastAtMost</li></a><a href=#SetIntervalStep-iprev_atLeastAtMost%27><li>iprev_atLeastAtMost'</li></a><a href=#SetIntervalStep-inext_nth_atLeast><li>inext_nth_atLeast</li></a><a href=#SetIntervalStep-inext_nth_atLeastAtMost><li>inext_nth_atLeastAtMost</li></a><a href=#SetIntervalStep-iprev_nth_atLeastAtMost><li>iprev_nth_atLeastAtMost</li></a><a href=#SetIntervalStep-inext_nth_atMost><li>inext_nth_atMost</li></a><a href=#SetIntervalStep-iprev_nth_atMost><li>iprev_nth_atMost</li></a><a href=#SetIntervalStep-inext_nth_lessThan><li>inext_nth_lessThan</li></a><a href=#SetIntervalStep-iprev_nth_lessThan><li>iprev_nth_lessThan</li></a><a href=#SetIntervalStep-inext_nth_UNIV><li>inext_nth_UNIV</li></a><a href=#SetIntervalStep-inext_iprev_nth_Suc><li>inext_iprev_nth_Suc</li></a><a href=#SetIntervalStep-inext_iprev_nth_pred><li>inext_iprev_nth_pred</li></a><a href=#SetIntervalStep-iprev_inext_nth_Suc><li>iprev_inext_nth_Suc</li></a><a href=#SetIntervalStep-iprev_inext_nth_pred><li>iprev_inext_nth_pred</li></a><a href=#SetIntervalStep-inext_nth_imirror_iprev_nth_conv><li>inext_nth_imirror_iprev_nth_conv</li></a><a href=#SetIntervalStep-iprev_nth_imirror_inext_nth_conv><li>iprev_nth_imirror_inext_nth_conv</li></a><a href=#SetIntervalStep-iprev_nth_card_greater_iMin><li>iprev_nth_card_greater_iMin</li></a><a href=#SetIntervalStep-iprev_nth_card_iMin><li>iprev_nth_card_iMin</li></a><a href=#SetIntervalStep-iprev_nth_card_iMin%27><li>iprev_nth_card_iMin'</li></a></ul></li><li><a href=#List2>List2</a><ul><a href=#List2-append_eq_Cons><li>append_eq_Cons</li></a><a href=#List2-length_Cons><li>length_Cons</li></a><a href=#List2-length_snoc><li>length_snoc</li></a><a href=#List2-length_greater_imp_not_empty><li>length_greater_imp_not_empty</li></a><a href=#List2-length_ge_Suc_imp_not_empty><li>length_ge_Suc_imp_not_empty</li></a><a href=#List2-length_take_le><li>length_take_le</li></a><a href=#List2-take_not_empty_conv><li>take_not_empty_conv</li></a><a href=#List2-drop_not_empty_conv><li>drop_not_empty_conv</li></a><a href=#List2-zip_eq_Nil><li>zip_eq_Nil</li></a><a href=#List2-zip_not_empty_conv><li>zip_not_empty_conv</li></a><a href=#List2-nth_tl_eq_nth_Suc><li>nth_tl_eq_nth_Suc</li></a><a href=#List2-hd_eq_first><li>hd_eq_first</li></a><a href=#List2-last_take><li>last_take</li></a><a href=#List2-drop_eq_tl><li>drop_eq_tl</li></a><a href=#List2-drop_take_1><li>drop_take_1</li></a><a href=#List2-upt_append><li>upt_append</li></a><a href=#List2-nth_append1><li>nth_append1</li></a><a href=#List2-nth_append2><li>nth_append2</li></a><a href=#List2-list_all_conv><li>list_all_conv</li></a><a href=#List2-expand_list_eq><li>expand_list_eq</li></a><a href=#List2-list_take_drop_imp_eq><li>list_take_drop_imp_eq</li></a><a href=#List2-list_take_drop_eq_conv><li>list_take_drop_eq_conv</li></a><a href=#List2-list_take_eq_conv><li>list_take_eq_conv</li></a><a href=#List2-list_drop_eq_conv><li>list_drop_eq_conv</li></a><a href=#List2-replicate_snoc><li>replicate_snoc</li></a><a href=#List2-eq_replicate_conv><li>eq_replicate_conv</li></a><a href=#List2-replicate_Cons_length><li>replicate_Cons_length</li></a><a href=#List2-replicate_pred_Cons_length><li>replicate_pred_Cons_length</li></a><a href=#List2-replicate_le_diff><li>replicate_le_diff</li></a><a href=#List2-replicate_le_diff2><li>replicate_le_diff2</li></a><a href=#List2-append_constant_length_induct_aux><li>append_constant_length_induct_aux</li></a><a href=#List2-append_constant_length_induct><li>append_constant_length_induct</li></a><a href=#List2-zip_swap><li>zip_swap</li></a><a href=#List2-zip_takeL><li>zip_takeL</li></a><a href=#List2-zip_takeR><li>zip_takeR</li></a><a href=#List2-zip_take><li>zip_take</li></a><a href=#List2-hd_zip><li>hd_zip</li></a><a href=#List2-map_id><li>map_id</li></a><a href=#List2-map_id_subst><li>map_id_subst</li></a><a href=#List2-map_one><li>map_one</li></a><a href=#List2-map_last><li>map_last</li></a><a href=#List2-filter_list_all><li>filter_list_all</li></a><a href=#List2-filter_snoc><li>filter_snoc</li></a><a href=#List2-filter_filter_eq><li>filter_filter_eq</li></a><a href=#List2-filter_nth><li>filter_nth</li></a><a href=#List2-list_ord_Nil><li>list_ord_Nil</li></a><a href=#List2-list_ord_one><li>list_ord_one</li></a><a href=#List2-list_ord_Cons><li>list_ord_Cons</li></a><a href=#List2-list_ord_Cons_imp><li>list_ord_Cons_imp</li></a><a href=#List2-list_ord_append><li>list_ord_append</li></a><a href=#List2-list_ord_snoc><li>list_ord_snoc</li></a><a href=#List2-list_ord_all_conv><li>list_ord_all_conv</li></a><a href=#List2-list_ord_imp><li>list_ord_imp</li></a><a href=#List2-list_ord_trans_imp><li>list_ord_trans_imp</li></a><a href=#List2-list_ord_trans><li>list_ord_trans</li></a><a href=#List2-list_ord_trans_refl_le><li>list_ord_trans_refl_le</li></a><a href=#List2-list_ord_trans_refl_le_imp><li>list_ord_trans_refl_le_imp</li></a><a href=#List2-list_ord_le_sorted_eq><li>list_ord_le_sorted_eq</li></a><a href=#List2-list_strict_asc_upt><li>list_strict_asc_upt</li></a><a href=#List2-list_ord_distinct_aux><li>list_ord_distinct_aux</li></a><a href=#List2-list_ord_distinct><li>list_ord_distinct</li></a><a href=#List2-list_strict_asc_distinct><li>list_strict_asc_distinct</li></a><a href=#List2-list_strict_desc_distinct><li>list_strict_desc_distinct</li></a><a href=#List2-sublist_list_length><li>sublist_list_length</li></a><a href=#List2-sublist_list_append><li>sublist_list_append</li></a><a href=#List2-sublist_list_Nil><li>sublist_list_Nil</li></a><a href=#List2-sublist_list_is_Nil_conv><li>sublist_list_is_Nil_conv</li></a><a href=#List2-sublist_list_eq_imp_length_eq><li>sublist_list_eq_imp_length_eq</li></a><a href=#List2-sublist_list_nth><li>sublist_list_nth</li></a><a href=#List2-take_drop_eq_sublist_list><li>take_drop_eq_sublist_list</li></a><a href=#List2-sublist_list_if_sublist_list_filter_conv><li>sublist_list_if_sublist_list_filter_conv</li></a><a href=#List2-sublist_list_if_Nil_left><li>sublist_list_if_Nil_left</li></a><a href=#List2-sublist_list_if_Nil_right><li>sublist_list_if_Nil_right</li></a><a href=#List2-sublist_list_if_length><li>sublist_list_if_length</li></a><a href=#List2-sublist_list_if_append><li>sublist_list_if_append</li></a><a href=#List2-sublist_list_if_snoc><li>sublist_list_if_snoc</li></a><a href=#List2-sublist_list_if_is_Nil_conv><li>sublist_list_if_is_Nil_conv</li></a><a href=#List2-sublist_list_if_nth><li>sublist_list_if_nth</li></a><a href=#List2-take_drop_eq_sublist_list_if><li>take_drop_eq_sublist_list_if</li></a><a href=#List2-nths_empty_conv><li>nths_empty_conv</li></a><a href=#List2-nths_singleton2><li>nths_singleton2</li></a><a href=#List2-nths_take_eq><li>nths_take_eq</li></a><a href=#List2-nths_drop_eq><li>nths_drop_eq</li></a><a href=#List2-nths_cut_less_eq><li>nths_cut_less_eq</li></a><a href=#List2-nths_disjoint_Un><li>nths_disjoint_Un</li></a><a href=#List2-nths_all><li>nths_all</li></a><a href=#List2-sublist_list_nths_eq><li>sublist_list_nths_eq</li></a><a href=#List2-set_sublist_list_if><li>set_sublist_list_if</li></a><a href=#List2-set_sublist_list><li>set_sublist_list</li></a><a href=#List2-set_sublist_list_if_eq_set_sublist><li>set_sublist_list_if_eq_set_sublist</li></a><a href=#List2-set_sublist_list_eq_set_sublist><li>set_sublist_list_eq_set_sublist</li></a><a href=#List2-f_image_eqI><li>f_image_eqI</li></a><a href=#List2-f_imageI><li>f_imageI</li></a><a href=#List2-rev_f_imageI><li>rev_f_imageI</li></a><a href=#List2-f_imageE><li>f_imageE</li></a><a href=#List2-f_image_Un><li>f_image_Un</li></a><a href=#List2-f_image_mono><li>f_image_mono</li></a><a href=#List2-f_image_iff><li>f_image_iff</li></a><a href=#List2-f_image_subset_iff><li>f_image_subset_iff</li></a><a href=#List2-subset_f_image_iff><li>subset_f_image_iff</li></a><a href=#List2-f_image_subsetI><li>f_image_subsetI</li></a><a href=#List2-f_image_empty><li>f_image_empty</li></a><a href=#List2-f_image_insert_if><li>f_image_insert_if</li></a><a href=#List2-f_image_insert_eq1><li>f_image_insert_eq1</li></a><a href=#List2-f_image_insert_eq2><li>f_image_insert_eq2</li></a><a href=#List2-insert_f_image><li>insert_f_image</li></a><a href=#List2-f_image_is_empty><li>f_image_is_empty</li></a><a href=#List2-f_image_Collect><li>f_image_Collect</li></a><a href=#List2-f_image_eq_set><li>f_image_eq_set</li></a><a href=#List2-f_range_eq_set><li>f_range_eq_set</li></a><a href=#List2-f_image_eq_set_nths><li>f_image_eq_set_nths</li></a><a href=#List2-f_image_eq_set_sublist_list_if><li>f_image_eq_set_sublist_list_if</li></a><a href=#List2-f_image_eq_set_sublist_list><li>f_image_eq_set_sublist_list</li></a><a href=#List2-f_range_eqI><li>f_range_eqI</li></a><a href=#List2-f_rangeI><li>f_rangeI</li></a><a href=#List2-f_rangeE><li>f_rangeE</li></a><a href=#List2-map_list_Nil><li>map_list_Nil</li></a><a href=#List2-map_list_Cons_Cons><li>map_list_Cons_Cons</li></a><a href=#List2-map_list_length><li>map_list_length</li></a><a href=#List2-map_list_nth><li>map_list_nth</li></a><a href=#List2-map_list_xs_take><li>map_list_xs_take</li></a><a href=#List2-map_list_take><li>map_list_take</li></a><a href=#List2-map_list_take_take><li>map_list_take_take</li></a><a href=#List2-map_list_drop><li>map_list_drop</li></a><a href=#List2-map_list_append_append><li>map_list_append_append</li></a><a href=#List2-map_list_snoc_snoc><li>map_list_snoc_snoc</li></a><a href=#List2-map_list_snoc><li>map_list_snoc</li></a><a href=#List2-map_list_Cons_if><li>map_list_Cons_if</li></a><a href=#List2-map_list_Cons_not_empty><li>map_list_Cons_not_empty</li></a><a href=#List2-map_eq_map_list_take><li>map_eq_map_list_take</li></a><a href=#List2-map_eq_map_list_take2><li>map_eq_map_list_take2</li></a><a href=#List2-map_eq_map_list_replicate><li>map_eq_map_list_replicate</li></a><a href=#List2-map2_map_list_conv><li>map2_map_list_conv</li></a><a href=#List2-map2_Nil><li>map2_Nil</li></a><a href=#List2-map2_Cons_Cons><li>map2_Cons_Cons</li></a><a href=#List2-map2_length><li>map2_length</li></a><a href=#List2-map2_nth><li>map2_nth</li></a><a href=#List2-map2_ys_take><li>map2_ys_take</li></a><a href=#List2-map2_take><li>map2_take</li></a><a href=#List2-map2_take_take><li>map2_take_take</li></a><a href=#List2-map2_drop><li>map2_drop</li></a><a href=#List2-map2_append_append><li>map2_append_append</li></a><a href=#List2-map2_snoc_snoc><li>map2_snoc_snoc</li></a><a href=#List2-map2_snoc><li>map2_snoc</li></a><a href=#List2-map2_Cons_if><li>map2_Cons_if</li></a><a href=#List2-map2_Cons_not_empty><li>map2_Cons_not_empty</li></a><a href=#List2-map2_append1_take_drop><li>map2_append1_take_drop</li></a><a href=#List2-map2_append2_take_drop><li>map2_append2_take_drop</li></a><a href=#List2-map2_cong><li>map2_cong</li></a><a href=#List2-map2_eq_conv><li>map2_eq_conv</li></a><a href=#List2-map2_replicate><li>map2_replicate</li></a><a href=#List2-map2_zip_conv><li>map2_zip_conv</li></a><a href=#List2-map2_rev><li>map2_rev</li></a></ul></li><li><a href=#InfiniteSet2>InfiniteSet2</a><ul><a href=#InfiniteSet2-icard_UNIV_nat><li>icard_UNIV_nat</li></a><a href=#InfiniteSet2-icard_finite_conv><li>icard_finite_conv</li></a><a href=#InfiniteSet2-icard_infinite_conv><li>icard_infinite_conv</li></a><a href=#InfiniteSet2-icard_eq_enat_imp><li>icard_eq_enat_imp</li></a><a href=#InfiniteSet2-icard_eq_Infty_imp><li>icard_eq_Infty_imp</li></a><a href=#InfiniteSet2-icard_the_enat><li>icard_the_enat</li></a><a href=#InfiniteSet2-icard_eq_enat_imp_card><li>icard_eq_enat_imp_card</li></a><a href=#InfiniteSet2-icard_eq_enat_card_conv><li>icard_eq_enat_card_conv</li></a><a href=#InfiniteSet2-icard_empty><li>icard_empty</li></a><a href=#InfiniteSet2-icard_empty_iff><li>icard_empty_iff</li></a><a href=#InfiniteSet2-icard_not_empty_iff><li>icard_not_empty_iff</li></a><a href=#InfiniteSet2-icard_singleton><li>icard_singleton</li></a><a href=#InfiniteSet2-icard_1_imp_singleton><li>icard_1_imp_singleton</li></a><a href=#InfiniteSet2-icard_1_singleton_conv><li>icard_1_singleton_conv</li></a><a href=#InfiniteSet2-icard_insert_disjoint><li>icard_insert_disjoint</li></a><a href=#InfiniteSet2-icard_insert_if><li>icard_insert_if</li></a><a href=#InfiniteSet2-icard_Suc_Diff1><li>icard_Suc_Diff1</li></a><a href=#InfiniteSet2-icard_Diff_singleton><li>icard_Diff_singleton</li></a><a href=#InfiniteSet2-icard_Diff_singleton_if><li>icard_Diff_singleton_if</li></a><a href=#InfiniteSet2-icard_insert><li>icard_insert</li></a><a href=#InfiniteSet2-icard_insert_le><li>icard_insert_le</li></a><a href=#InfiniteSet2-icard_mono><li>icard_mono</li></a><a href=#InfiniteSet2-not_icard_seteq><li>not_icard_seteq</li></a><a href=#InfiniteSet2-not_psubset_icard_mono><li>not_psubset_icard_mono</li></a><a href=#InfiniteSet2-icard_Un_Int><li>icard_Un_Int</li></a><a href=#InfiniteSet2-icard_Un_disjoint><li>icard_Un_disjoint</li></a><a href=#InfiniteSet2-not_icard_Diff_subset><li>not_icard_Diff_subset</li></a><a href=#InfiniteSet2-not_icard_Diff1_less><li>not_icard_Diff1_less</li></a><a href=#InfiniteSet2-not_icard_Diff2_less><li>not_icard_Diff2_less</li></a><a href=#InfiniteSet2-icard_Diff1_le><li>icard_Diff1_le</li></a><a href=#InfiniteSet2-icard_psubset><li>icard_psubset</li></a><a href=#InfiniteSet2-icard_partition><li>icard_partition</li></a><a href=#InfiniteSet2-icard_image_le><li>icard_image_le</li></a><a href=#InfiniteSet2-icard_image><li>icard_image</li></a><a href=#InfiniteSet2-not_eq_icard_imp_inj_on><li>not_eq_icard_imp_inj_on</li></a><a href=#InfiniteSet2-not_inj_on_iff_eq_icard><li>not_inj_on_iff_eq_icard</li></a><a href=#InfiniteSet2-icard_inj_on_le><li>icard_inj_on_le</li></a><a href=#InfiniteSet2-icard_bij_eq><li>icard_bij_eq</li></a><a href=#InfiniteSet2-icard_cartesian_product><li>icard_cartesian_product</li></a><a href=#InfiniteSet2-icard_cartesian_product_singleton><li>icard_cartesian_product_singleton</li></a><a href=#InfiniteSet2-icard_cartesian_product_singleton_right><li>icard_cartesian_product_singleton_right</li></a><a href=#InfiniteSet2-icard_lessThan><li>icard_lessThan</li></a><a href=#InfiniteSet2-icard_atLeast><li>icard_atLeast</li></a><a href=#InfiniteSet2-icard_greaterThan><li>icard_greaterThan</li></a><a href=#InfiniteSet2-icard_atLeastZeroLessThan_int><li>icard_atLeastZeroLessThan_int</li></a><a href=#InfiniteSet2-icard_atLeast_int><li>icard_atLeast_int</li></a><a href=#InfiniteSet2-icard_greaterThan_int><li>icard_greaterThan_int</li></a><a href=#InfiniteSet2-icard_atMost_int><li>icard_atMost_int</li></a><a href=#InfiniteSet2-icard_lessThan_int><li>icard_lessThan_int</li></a></ul></li><li><a href=#ListInf>ListInf</a><ul><a href=#ListInf-i_append_nth><li>i_append_nth</li></a><a href=#ListInf-i_append_nth1><li>i_append_nth1</li></a><a href=#ListInf-i_append_nth2><li>i_append_nth2</li></a><a href=#ListInf-i_append_Nil><li>i_append_Nil</li></a><a href=#ListInf-i_append_assoc><li>i_append_assoc</li></a><a href=#ListInf-i_append_Cons><li>i_append_Cons</li></a><a href=#ListInf-i_append_eq_i_append_conv><li>i_append_eq_i_append_conv</li></a><a href=#ListInf-i_append_eq_i_append_conv2_aux><li>i_append_eq_i_append_conv2_aux</li></a><a href=#ListInf-i_append_eq_i_append_conv2><li>i_append_eq_i_append_conv2</li></a><a href=#ListInf-same_i_append_eq><li>same_i_append_eq</li></a><a href=#ListInf-NOT_i_append_same_eq><li>NOT_i_append_same_eq</li></a><a href=#ListInf-i_append_hd><li>i_append_hd</li></a><a href=#ListInf-i_append_hd2><li>i_append_hd2</li></a><a href=#ListInf-eq_Nil_i_appendI><li>eq_Nil_i_appendI</li></a><a href=#ListInf-i_append_eq_i_appendI><li>i_append_eq_i_appendI</li></a><a href=#ListInf-o_ext><li>o_ext</li></a><a href=#ListInf-i_append_o><li>i_append_o</li></a><a href=#ListInf-o_eq_conv><li>o_eq_conv</li></a><a href=#ListInf-o_cong><li>o_cong</li></a><a href=#ListInf-ex_o_conv><li>ex_o_conv</li></a><a href=#ListInf-o_inj_on><li>o_inj_on</li></a><a href=#ListInf-inj_on_o_eq_o><li>inj_on_o_eq_o</li></a><a href=#ListInf-o_injective><li>o_injective</li></a><a href=#ListInf-inj_o_eq_o><li>inj_o_eq_o</li></a><a href=#ListInf-inj_oI><li>inj_oI</li></a><a href=#ListInf-inj_oD><li>inj_oD</li></a><a href=#ListInf-inj_o><li>inj_o</li></a><a href=#ListInf-inj_on_oI><li>inj_on_oI</li></a><a href=#ListInf-o_idI><li>o_idI</li></a><a href=#ListInf-o_fun_upd><li>o_fun_upd</li></a><a href=#ListInf-range_i_append><li>range_i_append</li></a><a href=#ListInf-set_subset_i_append><li>set_subset_i_append</li></a><a href=#ListInf-range_subset_i_append><li>range_subset_i_append</li></a><a href=#ListInf-range_ConsD><li>range_ConsD</li></a><a href=#ListInf-range_o><li>range_o</li></a><a href=#ListInf-in_range_conv_decomp><li>in_range_conv_decomp</li></a><a href=#ListInf-i_append_nth_Cons_0><li>i_append_nth_Cons_0</li></a><a href=#ListInf-i_append_nth_Cons_Suc><li>i_append_nth_Cons_Suc</li></a><a href=#ListInf-i_append_nth_Cons><li>i_append_nth_Cons</li></a><a href=#ListInf-i_append_nth_Cons%27><li>i_append_nth_Cons'</li></a><a href=#ListInf-i_append_nth_length><li>i_append_nth_length</li></a><a href=#ListInf-i_append_nth_length_plus><li>i_append_nth_length_plus</li></a><a href=#ListInf-range_iff><li>range_iff</li></a><a href=#ListInf-range_ball_nth><li>range_ball_nth</li></a><a href=#ListInf-all_nth_imp_all_range><li>all_nth_imp_all_range</li></a><a href=#ListInf-all_range_conv_all_nth><li>all_range_conv_all_nth</li></a><a href=#ListInf-i_append_update1><li>i_append_update1</li></a><a href=#ListInf-i_append_update2><li>i_append_update2</li></a><a href=#ListInf-i_append_update><li>i_append_update</li></a><a href=#ListInf-i_append_update_length><li>i_append_update_length</li></a><a href=#ListInf-range_update_subset_insert><li>range_update_subset_insert</li></a><a href=#ListInf-range_update_subsetI><li>range_update_subsetI</li></a><a href=#ListInf-range_update_memI><li>range_update_memI</li></a><a href=#ListInf-i_take_first><li>i_take_first</li></a><a href=#ListInf-i_drop_i_take_1><li>i_drop_i_take_1</li></a><a href=#ListInf-i_take_take_eq1><li>i_take_take_eq1</li></a><a href=#ListInf-i_take_take_eq2><li>i_take_take_eq2</li></a><a href=#ListInf-i_take_take><li>i_take_take</li></a><a href=#ListInf-i_drop_nth><li>i_drop_nth</li></a><a href=#ListInf-i_drop_nth_sub><li>i_drop_nth_sub</li></a><a href=#ListInf-i_take_length><li>i_take_length</li></a><a href=#ListInf-i_take_0><li>i_take_0</li></a><a href=#ListInf-i_drop_0><li>i_drop_0</li></a><a href=#ListInf-i_take_eq_Nil><li>i_take_eq_Nil</li></a><a href=#ListInf-i_take_not_empty_conv><li>i_take_not_empty_conv</li></a><a href=#ListInf-last_i_take><li>last_i_take</li></a><a href=#ListInf-last_i_take2><li>last_i_take2</li></a><a href=#ListInf-nth_0_i_drop><li>nth_0_i_drop</li></a><a href=#ListInf-i_take_const><li>i_take_const</li></a><a href=#ListInf-i_drop_const><li>i_drop_const</li></a><a href=#ListInf-i_append_i_take_eq1><li>i_append_i_take_eq1</li></a><a href=#ListInf-i_append_i_take_eq2><li>i_append_i_take_eq2</li></a><a href=#ListInf-i_append_i_take_if><li>i_append_i_take_if</li></a><a href=#ListInf-i_append_i_take><li>i_append_i_take</li></a><a href=#ListInf-i_append_i_drop_eq1><li>i_append_i_drop_eq1</li></a><a href=#ListInf-i_append_i_drop_eq2><li>i_append_i_drop_eq2</li></a><a href=#ListInf-i_append_i_drop_if><li>i_append_i_drop_if</li></a><a href=#ListInf-i_append_i_drop><li>i_append_i_drop</li></a><a href=#ListInf-i_append_i_take_i_drop_id><li>i_append_i_take_i_drop_id</li></a><a href=#ListInf-ilist_i_take_i_drop_imp_eq><li>ilist_i_take_i_drop_imp_eq</li></a><a href=#ListInf-ilist_i_take_i_drop_eq_conv><li>ilist_i_take_i_drop_eq_conv</li></a><a href=#ListInf-ilist_i_take_eq_conv><li>ilist_i_take_eq_conv</li></a><a href=#ListInf-ilist_i_drop_eq_conv><li>ilist_i_drop_eq_conv</li></a><a href=#ListInf-i_take_the_conv><li>i_take_the_conv</li></a><a href=#ListInf-i_drop_the_conv><li>i_drop_the_conv</li></a><a href=#ListInf-i_take_Suc_append><li>i_take_Suc_append</li></a><a href=#ListInf-i_drop_Suc_append><li>i_drop_Suc_append</li></a><a href=#ListInf-i_take_Suc><li>i_take_Suc</li></a><a href=#ListInf-i_take_Suc_conv_app_nth><li>i_take_Suc_conv_app_nth</li></a><a href=#ListInf-i_drop_i_drop><li>i_drop_i_drop</li></a><a href=#ListInf-i_take_commute><li>i_take_commute</li></a><a href=#ListInf-i_drop_commute><li>i_drop_commute</li></a><a href=#ListInf-nth_via_i_drop><li>nth_via_i_drop</li></a><a href=#ListInf-i_drop_Suc_conv_tl><li>i_drop_Suc_conv_tl</li></a><a href=#ListInf-i_drop_Suc_conv_tl%27><li>i_drop_Suc_conv_tl'</li></a><a href=#ListInf-i_take_i_drop><li>i_take_i_drop</li></a><a href=#ListInf-i_take_int_append><li>i_take_int_append</li></a><a href=#ListInf-i_take_drop_map_empty_iff><li>i_take_drop_map_empty_iff</li></a><a href=#ListInf-i_take_drop_map><li>i_take_drop_map</li></a><a href=#ListInf-i_take_drop><li>i_take_drop</li></a><a href=#ListInf-i_take_o><li>i_take_o</li></a><a href=#ListInf-i_drop_o><li>i_drop_o</li></a><a href=#ListInf-set_i_take_subset><li>set_i_take_subset</li></a><a href=#ListInf-range_i_drop_subset><li>range_i_drop_subset</li></a><a href=#ListInf-in_set_i_takeD><li>in_set_i_takeD</li></a><a href=#ListInf-in_range_i_takeD><li>in_range_i_takeD</li></a><a href=#ListInf-i_append_eq_conv_conj><li>i_append_eq_conv_conj</li></a><a href=#ListInf-i_take_add><li>i_take_add</li></a><a href=#ListInf-i_append_eq_i_append_conv_if_aux><li>i_append_eq_i_append_conv_if_aux</li></a><a href=#ListInf-i_append_eq_i_append_conv_if><li>i_append_eq_i_append_conv_if</li></a><a href=#ListInf-i_take_hd_i_drop><li>i_take_hd_i_drop</li></a><a href=#ListInf-id_i_take_nth_i_drop><li>id_i_take_nth_i_drop</li></a><a href=#ListInf-upd_conv_i_take_nth_i_drop><li>upd_conv_i_take_nth_i_drop</li></a><a href=#ListInf-i_take_drop_eq_map><li>i_take_drop_eq_map</li></a><a href=#ListInf-o_eq_i_append_imp><li>o_eq_i_append_imp</li></a><a href=#ListInf-i_zip_nth><li>i_zip_nth</li></a><a href=#ListInf-i_zip_swap><li>i_zip_swap</li></a><a href=#ListInf-i_zip_i_take><li>i_zip_i_take</li></a><a href=#ListInf-i_zip_i_drop><li>i_zip_i_drop</li></a><a href=#ListInf-fst_o_izip><li>fst_o_izip</li></a><a href=#ListInf-snd_o_i_zip><li>snd_o_i_zip</li></a><a href=#ListInf-update_i_zip><li>update_i_zip</li></a><a href=#ListInf-i_zip_Cons_Cons><li>i_zip_Cons_Cons</li></a><a href=#ListInf-i_zip_i_append1><li>i_zip_i_append1</li></a><a href=#ListInf-i_zip_i_append2><li>i_zip_i_append2</li></a><a href=#ListInf-i_zip_append><li>i_zip_append</li></a><a href=#ListInf-i_zip_range><li>i_zip_range</li></a><a href=#ListInf-i_zip_update><li>i_zip_update</li></a><a href=#ListInf-i_zip_const><li>i_zip_const</li></a><a href=#ListInf-i_map2_nth><li>i_map2_nth</li></a><a href=#ListInf-i_map2_Cons_Cons><li>i_map2_Cons_Cons</li></a><a href=#ListInf-i_map2_take_ge><li>i_map2_take_ge</li></a><a href=#ListInf-i_map2_take_take><li>i_map2_take_take</li></a><a href=#ListInf-i_map2_drop><li>i_map2_drop</li></a><a href=#ListInf-i_map2_append_append><li>i_map2_append_append</li></a><a href=#ListInf-i_map2_Cons_left><li>i_map2_Cons_left</li></a><a href=#ListInf-i_map2_Cons_right><li>i_map2_Cons_right</li></a><a href=#ListInf-i_map2_append_take_drop_left><li>i_map2_append_take_drop_left</li></a><a href=#ListInf-i_map2_append_take_drop_right><li>i_map2_append_take_drop_right</li></a><a href=#ListInf-i_map2_cong><li>i_map2_cong</li></a><a href=#ListInf-i_map2_eq_conv><li>i_map2_eq_conv</li></a><a href=#ListInf-i_map2_replicate><li>i_map2_replicate</li></a><a href=#ListInf-i_map2_i_zip_conv><li>i_map2_i_zip_conv</li></a><a href=#ListInf-glength_fin><li>glength_fin</li></a><a href=#ListInf-glength_infin><li>glength_infin</li></a><a href=#ListInf-gappend_glength><li>gappend_glength</li></a><a href=#ListInf-gmap_glength><li>gmap_glength</li></a><a href=#ListInf-glength_0_conv><li>glength_0_conv</li></a><a href=#ListInf-glength_greater_0_conv><li>glength_greater_0_conv</li></a><a href=#ListInf-glength_gSuc_conv><li>glength_gSuc_conv</li></a><a href=#ListInf-gSuc_glength_conv><li>gSuc_glength_conv</li></a><a href=#ListInf-gappend_Nil><li>gappend_Nil</li></a><a href=#ListInf-gappend_Nil2><li>gappend_Nil2</li></a><a href=#ListInf-gappend_is_Nil_conv><li>gappend_is_Nil_conv</li></a><a href=#ListInf-Nil_is_gappend_conv><li>Nil_is_gappend_conv</li></a><a href=#ListInf-gappend_assoc><li>gappend_assoc</li></a><a href=#ListInf-gappend_infin><li>gappend_infin</li></a><a href=#ListInf-same_gappend_eq_disj><li>same_gappend_eq_disj</li></a><a href=#ListInf-same_gappend_eq><li>same_gappend_eq</li></a><a href=#ListInf-gmap_gappend><li>gmap_gappend</li></a><a href=#ListInf-gmap_eq_conv><li>gmap_eq_conv</li></a><a href=#ListInf-gmap_is_Nil_conv><li>gmap_is_Nil_conv</li></a><a href=#ListInf-gmap_eq_imp_glength_eq><li>gmap_eq_imp_glength_eq</li></a><a href=#ListInf-gset_gappend><li>gset_gappend</li></a><a href=#ListInf-gset_gappend_if><li>gset_gappend_if</li></a><a href=#ListInf-gset_empty><li>gset_empty</li></a><a href=#ListInf-icard_glength><li>icard_glength</li></a><a href=#ListInf-gnth_gCons_0><li>gnth_gCons_0</li></a><a href=#ListInf-gnth_gCons_Suc><li>gnth_gCons_Suc</li></a><a href=#ListInf-gnth_gappend><li>gnth_gappend</li></a><a href=#ListInf-gnth_gappend_length_plus><li>gnth_gappend_length_plus</li></a><a href=#ListInf-gmap_gnth><li>gmap_gnth</li></a><a href=#ListInf-in_gset_cong_gnth><li>in_gset_cong_gnth</li></a><a href=#ListInf-gtake_0><li>gtake_0</li></a><a href=#ListInf-gdrop_0><li>gdrop_0</li></a><a href=#ListInf-gtake_Infty><li>gtake_Infty</li></a><a href=#ListInf-gdrop_Infty><li>gdrop_Infty</li></a><a href=#ListInf-gtake_all><li>gtake_all</li></a><a href=#ListInf-gdrop_all><li>gdrop_all</li></a><a href=#ListInf-gtake_eSuc_gCons><li>gtake_eSuc_gCons</li></a><a href=#ListInf-gdrop_eSuc_gCons><li>gdrop_eSuc_gCons</li></a><a href=#ListInf-gtake_eSuc><li>gtake_eSuc</li></a><a href=#ListInf-gdrop_eSuc><li>gdrop_eSuc</li></a><a href=#ListInf-gnth_via_grop><li>gnth_via_grop</li></a><a href=#ListInf-gtake_eSuc_conv_gapp_gnth><li>gtake_eSuc_conv_gapp_gnth</li></a><a href=#ListInf-gdrop_eSuc_conv_tl><li>gdrop_eSuc_conv_tl</li></a><a href=#ListInf-glength_gtake><li>glength_gtake</li></a><a href=#ListInf-glength_drop><li>glength_drop</li></a></ul></li><li><a href=#ListInf_Prefix>ListInf_Prefix</a><ul><a href=#ListInf_Prefix-prefix_eq_prefix_take_ex><li>prefix_eq_prefix_take_ex</li></a><a href=#ListInf_Prefix-prefix_take_eq_prefix_take_ex><li>prefix_take_eq_prefix_take_ex</li></a><a href=#ListInf_Prefix-prefix_eq_prefix_take><li>prefix_eq_prefix_take</li></a><a href=#ListInf_Prefix-strict_prefix_take_eq_strict_prefix_take_ex><li>strict_prefix_take_eq_strict_prefix_take_ex</li></a><a href=#ListInf_Prefix-strict_prefix_eq_strict_prefix_take_ex><li>strict_prefix_eq_strict_prefix_take_ex</li></a><a href=#ListInf_Prefix-strict_prefix_eq_strict_prefix_take><li>strict_prefix_eq_strict_prefix_take</li></a><a href=#ListInf_Prefix-take_imp_prefix><li>take_imp_prefix</li></a><a href=#ListInf_Prefix-eq_imp_prefix><li>eq_imp_prefix</li></a><a href=#ListInf_Prefix-le_take_imp_prefix><li>le_take_imp_prefix</li></a><a href=#ListInf_Prefix-take_prefix_imp_le><li>take_prefix_imp_le</li></a><a href=#ListInf_Prefix-take_prefixeq_le_conv><li>take_prefixeq_le_conv</li></a><a href=#ListInf_Prefix-append_imp_prefix><li>append_imp_prefix</li></a><a href=#ListInf_Prefix-prefix_imp_take_eq><li>prefix_imp_take_eq</li></a><a href=#ListInf_Prefix-prefix_length_le_eq_conv><li>prefix_length_le_eq_conv</li></a><a href=#ListInf_Prefix-take_length_prefix_conv><li>take_length_prefix_conv</li></a><a href=#ListInf_Prefix-append_eq_imp_take><li>append_eq_imp_take</li></a><a href=#ListInf_Prefix-take_the_conv><li>take_the_conv</li></a><a href=#ListInf_Prefix-prefix_refl><li>prefix_refl</li></a><a href=#ListInf_Prefix-prefix_trans><li>prefix_trans</li></a><a href=#ListInf_Prefix-prefixeq_antisym><li>prefixeq_antisym</li></a><a href=#ListInf_Prefix-zip_mirror><li>zip_mirror</li></a><a href=#ListInf_Prefix-mirror_pair_equal><li>mirror_pair_equal</li></a><a href=#ListInf_Prefix-equal_pair_count_le><li>equal_pair_count_le</li></a><a href=#ListInf_Prefix-equal_pair_count_0><li>equal_pair_count_0</li></a><a href=#ListInf_Prefix-equal_pair_count_Suc><li>equal_pair_count_Suc</li></a><a href=#ListInf_Prefix-equal_pair_count_eq_pairwise><li>equal_pair_count_eq_pairwise</li></a><a href=#ListInf_Prefix-equal_pair_count_mirror_pairwise><li>equal_pair_count_mirror_pairwise</li></a><a href=#ListInf_Prefix-equal_pair_count_correct><li>equal_pair_count_correct</li></a><a href=#ListInf_Prefix-equal_pair_count_maximality_aux><li>equal_pair_count_maximality_aux</li></a><a href=#ListInf_Prefix-equal_pair_count_maximality2a><li>equal_pair_count_maximality2a</li></a><a href=#ListInf_Prefix-inf_prefix_length_commute><li>inf_prefix_length_commute</li></a><a href=#ListInf_Prefix-inf_prefix_length_leL><li>inf_prefix_length_leL</li></a><a href=#ListInf_Prefix-inf_prefix_length_le_min><li>inf_prefix_length_le_min</li></a><a href=#ListInf_Prefix-hd_inf_prefix_length_0><li>hd_inf_prefix_length_0</li></a><a href=#ListInf_Prefix-inf_prefix_length_NilL><li>inf_prefix_length_NilL</li></a><a href=#ListInf_Prefix-inf_prefix_length_NilR><li>inf_prefix_length_NilR</li></a><a href=#ListInf_Prefix-inf_prefix_length_Suc><li>inf_prefix_length_Suc</li></a><a href=#ListInf_Prefix-inf_prefix_length_correct><li>inf_prefix_length_correct</li></a><a href=#ListInf_Prefix-inf_prefix_length_maximality1><li>inf_prefix_length_maximality1</li></a><a href=#ListInf_Prefix-inf_prefix_length_append><li>inf_prefix_length_append</li></a><a href=#ListInf_Prefix-inf_prefix_length_take_correct><li>inf_prefix_length_take_correct</li></a><a href=#ListInf_Prefix-inf_prefix_length_0_imp_hd_neq><li>inf_prefix_length_0_imp_hd_neq</li></a><a href=#ListInf_Prefix-length_inf_prefix><li>length_inf_prefix</li></a><a href=#ListInf_Prefix-inf_prefix_commute><li>inf_prefix_commute</li></a><a href=#ListInf_Prefix-inf_prefix_takeL><li>inf_prefix_takeL</li></a><a href=#ListInf_Prefix-inf_prefix_takeR><li>inf_prefix_takeR</li></a><a href=#ListInf_Prefix-inf_prefix_correct><li>inf_prefix_correct</li></a><a href=#ListInf_Prefix-inf_prefix_take_correct><li>inf_prefix_take_correct</li></a><a href=#ListInf_Prefix-is_inf_prefix><li>is_inf_prefix</li></a><a href=#ListInf_Prefix-hd_inf_prefix_Nil><li>hd_inf_prefix_Nil</li></a><a href=#ListInf_Prefix-inf_prefix_Nil_imp_hd_neq><li>inf_prefix_Nil_imp_hd_neq</li></a><a href=#ListInf_Prefix-length_inf_prefix_append><li>length_inf_prefix_append</li></a><a href=#ListInf_Prefix-inf_prefix_append><li>inf_prefix_append</li></a><a href=#ListInf_Prefix-hd_neq_inf_prefix_append><li>hd_neq_inf_prefix_append</li></a><a href=#ListInf_Prefix-inf_prefix_NilL><li>inf_prefix_NilL</li></a><a href=#ListInf_Prefix-inf_prefix_Cons><li>inf_prefix_Cons</li></a><a href=#ListInf_Prefix-inf_prefix_le1><li>inf_prefix_le1</li></a><a href=#ListInf_Prefix-inf_prefix_le2><li>inf_prefix_le2</li></a><a href=#ListInf_Prefix-le_inf_prefix_iff><li>le_inf_prefix_iff</li></a><a href=#ListInf_Prefix-le_imp_le_inf_prefix><li>le_imp_le_inf_prefix</li></a><a href=#ListInf_Prefix-iprefix_eq_iprefix_take><li>iprefix_eq_iprefix_take</li></a><a href=#ListInf_Prefix-iprefix_take_eq_iprefix_take_ex><li>iprefix_take_eq_iprefix_take_ex</li></a><a href=#ListInf_Prefix-iprefix_eq_iprefix_take_ex><li>iprefix_eq_iprefix_take_ex</li></a><a href=#ListInf_Prefix-i_take_imp_iprefix><li>i_take_imp_iprefix</li></a><a href=#ListInf_Prefix-i_take_prefix_le_conv><li>i_take_prefix_le_conv</li></a><a href=#ListInf_Prefix-i_append_imp_iprefix><li>i_append_imp_iprefix</li></a><a href=#ListInf_Prefix-iprefix_imp_take_eq><li>iprefix_imp_take_eq</li></a><a href=#ListInf_Prefix-prefixeq_iprefix_trans><li>prefixeq_iprefix_trans</li></a><a href=#ListInf_Prefix-i_take_length_prefix_conv><li>i_take_length_prefix_conv</li></a><a href=#ListInf_Prefix-iprefixI><li>iprefixI</li></a><a href=#ListInf_Prefix-iprefixE><li>iprefixE</li></a><a href=#ListInf_Prefix-Nil_iprefix><li>Nil_iprefix</li></a><a href=#ListInf_Prefix-same_prefix_iprefix><li>same_prefix_iprefix</li></a><a href=#ListInf_Prefix-prefix_iprefix><li>prefix_iprefix</li></a><a href=#ListInf_Prefix-append_iprefixD><li>append_iprefixD</li></a><a href=#ListInf_Prefix-iprefix_length_le_imp_prefix><li>iprefix_length_le_imp_prefix</li></a><a href=#ListInf_Prefix-iprefix_i_append><li>iprefix_i_append</li></a><a href=#ListInf_Prefix-i_append_one_iprefix><li>i_append_one_iprefix</li></a><a href=#ListInf_Prefix-iprefix_same_length_le><li>iprefix_same_length_le</li></a><a href=#ListInf_Prefix-iprefix_same_cases><li>iprefix_same_cases</li></a><a href=#ListInf_Prefix-set_mono_iprefix><li>set_mono_iprefix</li></a></ul></li><li><a href=#ListInfinite>ListInfinite</a></li></ul></div><ul><a href=https://www.isa-afp.org/browser_info/current/AFP/List-Infinite/outline.pdf><li>Proof
outline</li></a><a href=https://www.isa-afp.org/browser_info/current/AFP/List-Infinite/document.pdf><li>Proof
document</li></a><a href=https://www.isa-afp.org/browser_info/current/AFP/List-Infinite/session_graph.pdf><li>Theory dependencies</li></a></ul></div></aside><div class="content theories"><header><form action=/%20search><div class=form-container><input id=searchInput type=search size=31 maxlength=255><button id=searchButton type=button><img src=/images/search.svg alt=Search></button><div id=searchInputautocomplete-list style=display:none><div></div></div></div></form><h1><span class=first>S</span>ession <span class=first>L</span>ist-<span class=first>I</span>nfinite</h1><div></div></header><div><main><div id=Util_Set><div class=head><h1>Theory Util_Set</h1></div><pre class=source><span class=comment1>(*  Title:      Util_Set.thy
    Date:       Feb 2008
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Convenience results for set quantifiers›</span></span>

<span class=keyword1><span class=command>theory</span></span> Util_Set
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for HOL rules›</span></span>

<span class=keyword1 id=Util_Set-conj_disj_absorb><span class=command>lemma</span></span> conj_disj_absorb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>P</span> <span class=main>∧</span> <span class=free>Q</span> <span class=main>∨</span> <span class=free>Q</span><span class=main>)</span> <span class=main>=</span> <span class=free>Q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-disj_eq_distribL><span class=command>lemma</span></span> disj_eq_distribL<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=main>(</span><span class=free>b</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-disj_eq_distribR><span class=command>lemma</span></span> disj_eq_distribR<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span> <span class=main>∨</span> <span class=free>c</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for  <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Let›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Set-Let_swap><span class=command>lemma</span></span> Let_swap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>x</span><span class=main>=</span><span class=free>a</span> <span class=keyword1>in</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>x</span><span class=main>=</span><span class=free>a</span> <span class=keyword1>in</span> <span class=free>f</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>if›</span></span></span></span>-rules›</span></span>

<span class=keyword1 id="Util_Set-if_P'"><span class=command>lemma</span></span> if_P'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>P</span><span class=main>;</span> <span class=free>x</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id="Util_Set-if_not_P'"><span class=command>lemma</span></span> if_not_P'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>¬</span> <span class=free>P</span><span class=main>;</span> <span class=free>y</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Set-if_P_both><span class=command>lemma</span></span> if_P_both<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>Q</span> <span class=free>x</span><span class=main>;</span> <span class=free>Q</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Set-if_P_both_in_set><span class=command>lemma</span></span> if_P_both_in_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>s</span><span class=main>;</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>s</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>y</span><span class=main>)</span> <span class=main>∈</span> <span class=free>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary rules for function composition›</span></span>

<span class=keyword1 id=Util_Set-comp2_conv><span class=command>lemma</span></span> comp2_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f1</span> <span class=main>∘</span> <span class=free>f2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>f1</span> <span class=main>(</span><span class=free>f2</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_def<span class=main>)</span>
<span class=keyword1 id=Util_Set-comp3_conv><span class=command>lemma</span></span> comp3_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f1</span> <span class=main>∘</span> <span class=free>f2</span> <span class=main>∘</span> <span class=free>f3</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>f1</span> <span class=main>(</span><span class=free>f2</span> <span class=main>(</span><span class=free>f3</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_def<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary lemmata for quantifiers›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for universal and existential quantifiers›</span></span>

<span class=keyword1 id=Util_Set-ball_cong2><span class=command>lemma</span></span> ball_cong2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=Util_Set-bex_cong2><span class=command>lemma</span></span> bex_cong2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Set-ball_all_cong><span class=command>lemma</span></span> ball_all_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Set-bex_all_cong><span class=command>lemma</span></span> bex_all_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Set-all_cong><span class=command>lemma</span></span> all_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Set-ex_cong><span class=command>lemma</span></span> ex_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(*lemma all_eqI: "(⋀x. P x = Q x) ⟹ (∀x. P x) = (∀x. Q x)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> all_eqI <span class=main>=</span> iff_allI
<span class=comment1>(*lemma ex_eqI: "(⋀x. P x = Q x) ⟹ (∃x. P x) = (∃x. Q x)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> ex_eqI <span class=main>=</span> iff_exI

<span class=keyword1 id=Util_Set-all_imp_eqI><span class=command>lemma</span></span> all_imp_eqI<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>=</span> <span class=free>P'</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>Q'</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P'</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=free>Q'</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-ex_imp_eqI><span class=command>lemma</span></span> ex_imp_eqI<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>=</span> <span class=free>P'</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>Q'</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P'</span> <span class=bound>x</span> <span class=main>∧</span> <span class=free>Q'</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>empty›</span></span></span></span> sets›</span></span>

<span class=keyword1 id=Util_Set-empty_imp_not_in><span class=command>lemma</span></span> empty_imp_not_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-ex_imp_not_empty><span class=command>lemma</span></span> ex_imp_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-in_imp_not_empty><span class=command>lemma</span></span> in_imp_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-not_empty_imp_ex><span class=command>lemma</span></span> not_empty_imp_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-not_ex_in_conv><span class=command>lemma</span></span> not_ex_in_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for subset and membership relation›</span></span>

<span class=keyword1 id=Util_Set-bex_subset_imp_bex><span class=command>lemma</span></span> bex_subset_imp_bex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-bex_imp_ex><span class=command>lemma</span></span> bex_imp_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-ball_subset_imp_ball><span class=command>lemma</span></span> ball_subset_imp_ball<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-all_imp_ball><span class=command>lemma</span></span> all_imp_ball<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Util_Set-mem_Collect_eq_not><span class=command>lemma</span></span> mem_Collect_eq_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>∉</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-Collect_not_in_imp_not><span class=command>lemma</span></span> Collect_not_in_imp_not<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∉</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-Collect_not_imp_not_in><span class=command>lemma</span></span> Collect_not_imp_not_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>P</span> <span class=free>a</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>∉</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=Util_Set-Collect_is_subset><span class=command>lemma</span></span> Collect_is_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>⊆</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Util_MinMax><div class=head><h1>Theory Util_MinMax</h1></div><pre class=source><span class=comment1>(*  Title:      Util_MinMax.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Order and linear order: min and max›</span></span>

<span class=keyword1><span class=command>theory</span></span> Util_MinMax
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional lemmata about <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>min</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>max</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_MinMax-min_less_imp_conj><span class=command>lemma</span></span> min_less_imp_conj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>&lt;</span> min <span class=free>x</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_MinMax-conj_less_imp_min><span class=command>lemma</span></span> conj_less_imp_min<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=free>x</span><span class=main>;</span> <span class=free>z</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>z</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>&lt;</span> min <span class=free>x</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(*lemma min_le_iff_conj: "((z::'a::linorder) ≤ min x y) = (z ≤ x ∧ z ≤ y)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> min_le_iff_conj <span class=main>=</span> min.bounded_iff
<span class=keyword1 id=Util_MinMax-min_le_imp_conj><span class=command>lemma</span></span> min_le_imp_conj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> min <span class=free>x</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>≤</span> <span class=free>y</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=comment1>(*lemma conj_le_imp_min: "⟦ z ≤ x; z ≤ y ⟧ ⟹ (z::'a::linorder) ≤ min x y"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> conj_le_imp_min <span class=main>=</span> min.boundedI

<span class=comment1>(*lemma min_eqL:"⟦ (x::('a::linorder)) ≤ y ⟧ ⟹ min x y = x"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> min_eqL <span class=main>=</span> min.absorb1
<span class=comment1>(*lemma min_eqR:"⟦ (y::('a::linorder)) ≤ x ⟧ ⟹ min x y = y"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> min_eqR <span class=main>=</span> min.absorb2
<span class=keyword1><span class=command>lemmas</span></span> min_eq <span class=main>=</span> min_eqL min_eqR

<span class=keyword1 id=Util_MinMax-max_less_imp_conj><span class=command>lemma</span></span> max_less_imp_conj<span class=main>:</span><span class=quoted><span class=quoted>"max <span class=free>x</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_MinMax-conj_less_imp_max><span class=command>lemma</span></span> conj_less_imp_max<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> max <span class=free>x</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(*lemma max_le_iff_conj: "(max x y ≤ b) = (x ≤ (b::('a::linorder)) ∧ y ≤ b)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> max_le_iff_conj <span class=main>=</span> max.bounded_iff
<span class=keyword1 id=Util_MinMax-max_le_imp_conj><span class=command>lemma</span></span> max_le_imp_conj<span class=main>:</span><span class=quoted><span class=quoted>"max <span class=free>x</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>b</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=comment1>(*lemma conj_le_imp_max:"⟦ x ≤ (b::('a::linorder)); y ≤ b ⟧ ⟹ max x y ≤ b"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> conj_le_imp_max <span class=main>=</span>  max.boundedI

<span class=comment1>(*lemma max_eqL:"⟦ (y::('a::linorder)) ≤ x ⟧ ⟹ max x y = x"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> max_eqL <span class=main>=</span> max.absorb1
<span class=comment1>(*lemma max_eqR:"⟦ (x::('a::linorder)) ≤ y ⟧ ⟹ max x y = y"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> max_eqR <span class=main>=</span>  max.absorb2
<span class=keyword1><span class=command>lemmas</span></span> max_eq <span class=main>=</span> max_eqL max_eqR

<span class=comment1>(*lemma le_minI1:"min x y ≤ (x::('a::linorder))"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> le_minI1 <span class=main>=</span> min.cobounded1
<span class=comment1>(*lemma le_minI2:"min x y ≤ (y::('a::linorder))"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> le_minI2 <span class=main>=</span> min.cobounded2


<span class=keyword1 id=Util_MinMax-min_le_monoR><span class=command>lemma</span></span>
  min_le_monoR<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> min <span class=free>x</span> <span class=free>a</span> <span class=main>≤</span> min <span class=free>x</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  min_le_monoL<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> min <span class=free>a</span> <span class=free>x</span> <span class=main>≤</span> min <span class=free>b</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> min.mono min_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1 id=Util_MinMax-max_le_monoR><span class=command>lemma</span></span>
  max_le_monoR<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> max <span class=free>x</span> <span class=free>a</span> <span class=main>≤</span> max <span class=free>x</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  max_le_monoL<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> max <span class=free>a</span> <span class=free>x</span> <span class=main>≤</span> max <span class=free>b</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> max.mono max_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Util_NatInf><div class=head><h1>Theory Util_NatInf</h1></div><pre class=source><span class=comment1>(*  Title:      Util_NatInf.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Results for natural arithmetics with infinity›</span></span>

<span class=keyword1><span class=command>theory</span></span> Util_NatInf
<span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Extended_Nat.html>HOL-Library.Extended_Nat</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Arithmetic operations with <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=quoted>enat</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Additional definitions›</span></span>

<span class=keyword1><span class=command>instantiation</span></span> enat <span class=main>::</span> <span class=quoted>modulo</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  div_enat_def <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>del</span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>div</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    <span class=main>(</span>enat <span class=bound>x</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>of</span> <span class=main>(</span>enat <span class=bound>y</span><span class=main>)</span> <span class=main>⇒</span> enat <span class=main>(</span><span class=bound>x</span> <span class=keyword1>div</span> <span class=bound>y</span><span class=main>)</span> <span class=main>|</span> <span class=main>∞</span> <span class=main>⇒</span> <span class=main>0</span><span class=main>)</span> <span class=main>|</span>
    <span class=main>∞</span> <span class=main>⇒</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>of</span> <span class=main>(</span>enat <span class=bound>y</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=keyword1>case</span> <span class=bound>y</span> <span class=keyword1>of</span> <span class=main>0</span> <span class=main>⇒</span> <span class=main>0</span> <span class=main>|</span> Suc <span class=bound>n</span> <span class=main>⇒</span> <span class=main>∞</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span> <span class=main>∞</span> <span class=main>⇒</span> <span class=main>∞</span> <span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span>
  mod_enat_def <span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>del</span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>mod</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    <span class=main>(</span>enat <span class=bound>x</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>of</span> <span class=main>(</span>enat <span class=bound>y</span><span class=main>)</span> <span class=main>⇒</span> enat <span class=main>(</span><span class=bound>x</span> <span class=keyword1>mod</span> <span class=bound>y</span><span class=main>)</span> <span class=main>|</span> <span class=main>∞</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=main>|</span>
    <span class=main>∞</span> <span class=main>⇒</span> <span class=main>∞</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>

<span class=keyword2><span class=keyword>end</span></span>


<span class=keyword1><span class=command>lemmas</span></span> enat_arith_defs <span class=main>=</span>
  zero_enat_def one_enat_def
  plus_enat_def diff_enat_def times_enat_def div_enat_def mod_enat_def
<span class=keyword1><span class=command>declare</span></span> zero_enat_def<span class=main>[</span><span class=operator>simp</span><span class=main>]</span>


<span class=keyword1><span class=command>lemmas</span></span> ineq0_conv_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> i0_less<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> iless_eSuc0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> iless_eSuc0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Addition, difference, order›</span></span>

<span class=keyword1 id=Util_NatInf-diff_eq_conv_nat><span class=command>lemma</span></span> diff_eq_conv_nat<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>+</span> <span class=free>z</span> <span class=keyword1>else</span> <span class=free>z</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1 id=Util_NatInf-idiff_eq_conv><span class=command>lemma</span></span> idiff_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span><span class=main>::</span>enat<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>+</span> <span class=free>z</span> <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free>x</span> <span class=main>≠</span> <span class=main>∞</span> <span class=keyword1>then</span> <span class=free>z</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=free>z</span> <span class=main>=</span> <span class=main>∞</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>y</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> idiff_eq_conv_enat <span class=main>=</span> idiff_eq_conv<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-less_eq_idiff_eq_sum><span class=command>lemma</span></span> less_eq_idiff_eq_sum<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≤</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>z</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>+</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>y</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>


<span class=keyword1 id=Util_NatInf-eSuc_pred><span class=command>lemma</span></span> eSuc_pred<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> eSuc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> eSuc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lemmas</span></span> eSuc_pred_enat <span class=main>=</span> eSuc_pred<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> iadd_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> add_0_left<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span> <span class=main><span class=main>=</span></span> <span class=quoted>enat</span><span class=main>,</span> <span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> iadd_0_right_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> add_0_right<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted>enat</span><span class=main>,</span> <span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-ile_add1><span class=command>lemma</span></span> ile_add1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-ile_add2><span class=command>lemma</span></span> ile_add2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span> ile_add1<span class=main>)</span>

<span class=keyword1 id=Util_NatInf-iadd_iless_mono><span class=command>lemma</span></span> iadd_iless_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>l</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>j</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-trans_ile_iadd1><span class=command>lemma</span></span> trans_ile_iadd1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>+</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ ile_add1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-trans_ile_iadd2><span class=command>lemma</span></span> trans_ile_iadd2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>+</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ ile_add2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-trans_iless_iadd1><span class=command>lemma</span></span> trans_iless_iadd1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ ile_add1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-trans_iless_iadd2><span class=command>lemma</span></span> trans_iless_iadd2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>+</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ ile_add2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-iadd_ileD1><span class=command>lemma</span></span> iadd_ileD1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-iadd_ileD2><span class=command>lemma</span></span> iadd_ileD2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iadd_ileD1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1 id=Util_NatInf-idiff_ile_mono><span class=command>lemma</span></span> idiff_ile_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> <span class=free>l</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiff_ile_mono2><span class=command>lemma</span></span> idiff_ile_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>l</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>-</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiff_iless_mono><span class=command>lemma</span></span> idiff_iless_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span><span class=main>;</span> <span class=free>l</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> <span class=free>l</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>-</span> <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiff_iless_mono2><span class=command>lemma</span></span> idiff_iless_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>l</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>l</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>-</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Multiplication and division›</span></span>

<span class=keyword1><span class=command>lemmas</span></span> imult_infinity_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> imult_infinity<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> imult_infinity_right_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> imult_infinity_right<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-idiv_enat_enat><span class=command>lemma</span></span> idiv_enat_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"enat <span class=free>a</span> <span class=keyword1>div</span> enat <span class=free>b</span> <span class=main>=</span> enat <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_NatInf-idiv_infinity><span class=command>lemma</span></span> idiv_infinity<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n1<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>n1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> idiv_infinity_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> idiv_infinity<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-idiv_infinity_right><span class=command>lemma</span></span> idiv_infinity_right<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=main>(</span><span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiv_infinity_if><span class=command>lemma</span></span> idiv_infinity_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>div</span> <span class=main>∞</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> <span class=main>∞</span> <span class=keyword1>then</span> <span class=main>∞</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>::</span>enat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> idiv_infinity_if_enat <span class=main>=</span> idiv_infinity_if<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> imult_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> mult_zero_left<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted>enat</span><span class=main>,</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> imult_0_right_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> mult_zero_right<span class=main>[</span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> <span class=tfree>'a</span><span class=main><span class=main>=</span></span><span class=quoted>enat</span><span class=main>,</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> imult_is_0_enat <span class=main>=</span> imult_is_0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> enat_0_less_mult_iff_enat <span class=main>=</span> enat_0_less_mult_iff<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-imult_infinity_if><span class=command>lemma</span></span> imult_infinity_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∞</span> <span class=main>*</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imult_infinity_right_if><span class=command>lemma</span></span> imult_infinity_right_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>*</span> <span class=main>∞</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> <span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> imult_infinity_if_enat <span class=main>=</span> imult_infinity_if<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> imult_infinity_right_if_enat <span class=main>=</span> imult_infinity_right_if<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> imult_is_infinity_enat <span class=main>=</span> imult_is_infinity<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-idiv_by_0><span class=command>lemma</span></span> idiv_by_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> idiv_by_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> idiv_by_0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-idiv_0><span class=command>lemma</span></span> idiv_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> div_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> idiv_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> idiv_0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-imod_by_0><span class=command>lemma</span></span> imod_by_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>0</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mod_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> imod_by_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> imod_by_0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-imod_0><span class=command>lemma</span></span> imod_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mod_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> imod_0_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> imod_0<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-imod_enat_enat><span class=command>lemma</span></span> imod_enat_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"enat <span class=free>a</span> <span class=keyword1>mod</span> enat <span class=free>b</span> <span class=main>=</span> enat <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mod_enat_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_NatInf-imod_infinity><span class=command>lemma</span></span> imod_infinity<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∞</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mod_enat_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_NatInf-imod_infinity_right><span class=command>lemma</span></span> imod_infinity_right<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=main>∞</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mod_enat_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=Util_NatInf-idiv_self><span class=command>lemma</span></span> idiv_self<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> one_enat_def<span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imod_self><span class=command>lemma</span></span> imod_self<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiv_iless><span class=command>lemma</span></span> idiv_iless<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imod_iless><span class=command>lemma</span></span> imod_iless<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-imod_iless_divisor><span class=command>lemma</span></span> imod_iless_divisor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟧</span>  <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imod_ile_dividend><span class=command>lemma</span></span> imod_ile_dividend<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-idiv_ile_dividend><span class=command>lemma</span></span> idiv_ile_dividend<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiv_imult2_eq><span class=command>lemma</span></span> idiv_imult2_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>c</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_mult2_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imult_infinity_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> idiv_infinity<span class=main><span class=main>[</span></span><span class=operator>OF</span> enat_0_less_mult_iff<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_NatInf-imult_ile_mono><span class=command>lemma</span></span> imult_ile_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>≤</span> <span class=free>j</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>j</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_le_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>l</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_NatInf-imult_ile_mono1><span class=command>lemma</span></span> imult_ile_mono1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imult_ile_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ order_refl<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-imult_ile_mono2><span class=command>lemma</span></span> imult_ile_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>*</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>*</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imult_ile_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> order_refl<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-imult_iless_mono1><span class=command>lemma</span></span> imult_iless_mono1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span><span class=main>;</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>j</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imult_iless_mono2><span class=command>lemma</span></span> imult_iless_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span><span class=main>;</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>∞</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>*</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>*</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> imult_iless_mono1<span class=main>)</span>

<span class=keyword1 id=Util_NatInf-imod_1><span class=command>lemma</span></span> imod_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>enat <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> eSuc <span class=main>0</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> imod_1_enat<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> imod_1<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=Util_NatInf-imod_iadd_self2><span class=command>lemma</span></span> imod_iadd_self2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span> <span class=main>+</span> enat <span class=free>n</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-imod_iadd_self1><span class=command>lemma</span></span> imod_iadd_self1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>enat <span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span> imod_iadd_self2<span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiv_imod_equality><span class=command>lemma</span></span> idiv_imod_equality<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>*</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>+</span> <span class=free>k</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_NatInf-imod_idiv_equality><span class=command>lemma</span></span> imod_idiv_equality<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span><span class=main>::</span>enat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>*</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> idiv_imod_equality<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Util_NatInf-idiv_ile_mono><span class=command>lemma</span></span> idiv_ile_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_le_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> idiv_infinity<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i0_lb<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> zero_enat_def<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=Util_NatInf-idiv_ile_mono2><span class=command>lemma</span></span> idiv_ile_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>enat<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>k</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_le_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Util_Nat><div class=head><h1>Theory Util_Nat</h1></div><pre class=source><span class=comment1>(*  Title:      Util_Nat.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Results for natural arithmetics›</span></span>

<span class=keyword1><span class=command>theory</span></span> Util_Nat
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some convenience arithmetic lemmata›</span></span>

<span class=keyword1 id=Util_Nat-add_1_Suc_conv><span class=command>lemma</span></span> add_1_Suc_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=main>1</span> <span class=main>=</span> Suc <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-sub_Suc0_sub_Suc_conv><span class=command>lemma</span></span> sub_Suc0_sub_Suc_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=free>b</span> <span class=main>-</span> Suc <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-Suc_diff_Suc><span class=command>lemma</span></span> Suc_diff_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> sub_Suc0_sub_Suc_conv<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Suc_pred<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> zero_less_diff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Nat-nat_grSuc0_conv><span class=command>lemma</span></span> nat_grSuc0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>≠</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Nat-nat_geSucSuc0_conv><span class=command>lemma</span></span> nat_geSucSuc0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>Suc <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>≠</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Nat-nat_lessSucSuc0_conv><span class=command>lemma</span></span> nat_lessSucSuc0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> Suc <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Nat-nat_leSuc0_conv><span class=command>lemma</span></span> nat_leSuc0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>≤</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>=</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Nat-mult_pred><span class=command>lemma</span></span> mult_pred<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>*</span> <span class=free>n</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span> <span class=main>-</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mult_distrib<span class=main>)</span>

<span class=keyword1 id=Util_Nat-mult_pred_right><span class=command>lemma</span></span> mult_pred_right<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=free>n</span> <span class=main>-</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mult_distrib2<span class=main>)</span>

<span class=keyword1 id=Util_Nat-gr_implies_gr0><span class=command>lemma</span></span> gr_implies_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> mult_cancel1_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> mult_cancel2_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> mult_le_cancel1_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> mult_le_cancel2_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-gr0_imp_self_le_mult1><span class=command>lemma</span></span> gr0_imp_self_le_mult1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> Suc_leI<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> mult_le_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> order_refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-gr0_imp_self_le_mult2><span class=command>lemma</span></span> gr0_imp_self_le_mult2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> gr0_imp_self_le_mult1<span class=main>)</span>

<span class=keyword1 id=Util_Nat-less_imp_Suc_mult_le><span class=command>lemma</span></span> less_imp_Suc_mult_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> mult_le_mono1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-less_imp_Suc_mult_pred_less><span class=command>lemma</span></span> less_imp_Suc_mult_pred_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> Suc <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Suc_le_lessD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Suc_pred<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_0_less_mult_iff<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>OF</span> conjI<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>OF</span> zero_less_Suc<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_Suc_mult_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Nat-ord_zero_less_diff><span class=command>lemma</span></span> ord_zero_less_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_ab_group_add<span class=main>)</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_diff_eq<span class=main>)</span>

<span class=keyword1 id=Util_Nat-ord_zero_le_diff><span class=command>lemma</span></span> ord_zero_le_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_ab_group_add<span class=main>)</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> le_diff_eq<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>diff_diff_right›</span></span></span></span> in rule format›</span></span>
<span class=keyword1><span class=command>lemmas</span></span> diff_diff_right <span class=main>=</span> Nat.diff_diff_right<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span>


<span class=keyword1 id=Util_Nat-less_add1><span class=command>lemma</span></span> less_add1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>+</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-less_add2><span class=command>lemma</span></span> less_add2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>+</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-add_lessD2><span class=command>lemma</span></span> add_lessD2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-add_le_mono2><span class=command>lemma</span></span> add_le_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≤</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>+</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>+</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-add_less_mono2><span class=command>lemma</span></span> add_less_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>j</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>+</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>+</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=Util_Nat-diff_less_self><span class=command>lemma</span></span> diff_less_self<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>;</span>  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>-</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-ge_less_neq_conv><span class=command>lemma</span></span>
  ge_less_neq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>⟶</span> <span class=free>n</span> <span class=main>≠</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  le_greater_neq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=free>n</span> <span class=main>≠</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> linorder_not_less<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1 id=Util_Nat-greater_le_neq_conv><span class=command>lemma</span></span>
  greater_le_neq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟶</span> <span class=free>n</span> <span class=main>≠</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  less_ge_neq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=free>n</span> <span class=main>≠</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> linorder_not_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>



<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Lemmas for @term{abs} function›</span></span>

<span class=keyword1 id=Util_Nat-leq_pos_imp_abs_leq><span class=command>lemma</span></span> leq_pos_imp_abs_leq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_ab_group_add_abs<span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¦</span><span class=free>a</span><span class=main>¦</span> <span class=main>≤</span> <span class=main>¦</span><span class=free>b</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-leq_neg_imp_abs_geq><span class=command>lemma</span></span> leq_neg_imp_abs_geq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_ab_group_add_abs<span class=main>)</span> <span class=main>≤</span> <span class=main>0</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¦</span><span class=free>a</span><span class=main>¦</span> <span class=main>≤</span> <span class=main>¦</span><span class=free>b</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-abs_range><span class=command>lemma</span></span> abs_range<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span><span class=main>{</span>ordered_ab_group_add_abs<span class=main>,</span>abs_if<span class=main>}</span><span class=main>)</span><span class=main>;</span> <span class=main>-</span><span class=free>a</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¦</span><span class=free>x</span><span class=main>¦</span> <span class=main>≤</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> abs_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> neg_le_iff_le<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Lemmas for @term{sgn} function›</span></span>

<span class=keyword1 id=Util_Nat-sgn_abs><span class=command>lemma</span></span> sgn_abs<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linordered_idom<span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>¦</span>sgn <span class=free>x</span><span class=main>¦</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=Util_Nat-sgn_mult_abs><span class=command>lemma</span></span> sgn_mult_abs<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>¦</span><span class=free>x</span><span class=main>¦</span> <span class=main>*</span> <span class=main>¦</span>sgn <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linordered_idom<span class=main>)</span><span class=main>¦</span> <span class=main>=</span> <span class=main>¦</span><span class=free>x</span> <span class=main>*</span> sgn <span class=free>a</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_if abs_if<span class=main>)</span>
<span class=keyword1 id=Util_Nat-abs_imp_sgn_abs><span class=command>lemma</span></span> abs_imp_sgn_abs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¦</span><span class=free>a</span><span class=main>¦</span> <span class=main>=</span> <span class=main>¦</span><span class=free>b</span><span class=main>¦</span> <span class=main>⟹</span> <span class=main>¦</span>sgn <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linordered_idom<span class=main>)</span><span class=main>¦</span> <span class=main>=</span> <span class=main>¦</span>sgn <span class=free>b</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_if<span class=main>)</span>
<span class=keyword1 id=Util_Nat-sgn_mono><span class=command>lemma</span></span> sgn_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> sgn <span class=main>(</span><span class=free>a</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span><span class=main>{</span>linordered_idom<span class=main>,</span>linordered_semidom<span class=main>}</span><span class=main>)</span> <span class=main>≤</span> sgn <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_if<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional facts about inequalities›</span></span>

<span class=keyword1 id=Util_Nat-add_diff_le><span class=command>lemma</span></span> add_diff_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-less_add_diff><span class=command>lemma</span></span> less_add_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span>"</span></span>

<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> add_less_imp_less_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-add_diff_less><span class=command>lemma</span></span> add_diff_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>-</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>


<span class=keyword1 id=Util_Nat-add_le_imp_le_diff1><span class=command>lemma</span></span> add_le_imp_le_diff1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> <span class=free>j</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-add_le_imp_le_diff2><span class=command>lemma</span></span> add_le_imp_le_diff2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>+</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-diff_less_imp_less_add><span class=command>lemma</span></span> diff_less_imp_less_add<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>⟹</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>+</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-diff_less_conv><span class=command>lemma</span></span> diff_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>j</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-le_diff_swap><span class=command>lemma</span></span> le_diff_swap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>i</span> <span class=main>≤</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>j</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>j</span> <span class=main>≤</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-diff_less_imp_swap><span class=command>lemma</span></span> diff_less_imp_swap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>-</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-diff_less_swap><span class=command>lemma</span></span> diff_less_swap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>j</span> <span class=main>&lt;</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> diff_less_imp_swap<span class=main>)</span>

<span class=keyword1 id=Util_Nat-less_diff_imp_less><span class=command>lemma</span></span> less_diff_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>-</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-le_diff_imp_le><span class=command>lemma</span></span> le_diff_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>-</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-less_diff_le_imp_less><span class=command>lemma</span></span> less_diff_le_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>-</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>-</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-le_diff_le_imp_le><span class=command>lemma</span></span> le_diff_le_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>i</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>-</span> <span class=free>m</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>≤</span> <span class=free>j</span> <span class=main>-</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-le_imp_diff_le><span class=command>lemma</span></span> le_imp_diff_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>j</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>j</span> <span class=main>-</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Inequalities for Suc and pred›</span></span>

<span class=keyword1><span class=command>corollary</span></span> less_eq_le_pred<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> less_imp_le_pred<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> le_pred_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>corollary</span></span> pred_less_eq_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> pred_less_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> le_imp_pred_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-diff_add_inverse_Suc><span class=command>lemma</span></span> diff_add_inverse_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-pred_mono><span class=command>lemma</span></span> pred_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> pred_Suc_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> Suc <span class=free>n</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-Suc_less_pred_conv><span class=command>lemma</span></span> Suc_less_pred_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>Suc <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_Nat-Suc_le_pred_conv><span class=command>lemma</span></span> Suc_le_pred_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span>Suc <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_Nat-Suc_le_imp_le_pred><span class=command>lemma</span></span> Suc_le_imp_le_pred<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional facts about cancellation in (in-)equalities›</span></span>

<span class=keyword1 id=Util_Nat-diff_cancel_imp_eq><span class=command>lemma</span></span> diff_cancel_imp_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span>  <span class=free>n</span> <span class=main>+</span> <span class=free>i</span> <span class=main>-</span> <span class=free>j</span> <span class=main>=</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>=</span> <span class=free>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-nat_diff_left_cancel_less><span class=command>lemma</span></span> nat_diff_left_cancel_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-nat_diff_right_cancel_less><span class=command>lemma</span></span> nat_diff_right_cancel_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>-</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-nat_diff_left_cancel_le1><span class=command>lemma</span></span> nat_diff_left_cancel_le1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-nat_diff_left_cancel_le2><span class=command>lemma</span></span> nat_diff_left_cancel_le2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-nat_diff_right_cancel_le1><span class=command>lemma</span></span> nat_diff_right_cancel_le1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-nat_diff_right_cancel_le2><span class=command>lemma</span></span> nat_diff_right_cancel_le2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-nat_diff_left_cancel_eq1><span class=command>lemma</span></span> nat_diff_left_cancel_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-nat_diff_left_cancel_eq2><span class=command>lemma</span></span> nat_diff_left_cancel_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-nat_diff_right_cancel_eq1><span class=command>lemma</span></span> nat_diff_right_cancel_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Nat-nat_diff_right_cancel_eq2><span class=command>lemma</span></span> nat_diff_right_cancel_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Nat-eq_diff_left_iff><span class=command>lemma</span></span> eq_diff_left_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>k</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>k</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Util_Nat-eq_imp_diff_eq><span class=command>lemma</span></span> eq_imp_diff_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>-</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹List of definitions and lemmas›</span></span>

<span class=keyword1><span class=command>thm</span></span>
  Nat.add_Suc_right
  add_1_Suc_conv
  sub_Suc0_sub_Suc_conv

<span class=keyword1><span class=command>thm</span></span>
  Nat.mult_cancel1
  Nat.mult_cancel2
  mult_cancel1_gr0
  mult_cancel2_gr0

<span class=keyword1><span class=command>thm</span></span>
  Nat.add_lessD1
  add_lessD2

<span class=keyword1><span class=command>thm</span></span>
  Nat.zero_less_diff
  ord_zero_less_diff
  ord_zero_le_diff

<span class=keyword1><span class=command>thm</span></span>
  le_add_diff
  add_diff_le
  less_add_diff
  add_diff_less

<span class=keyword1><span class=command>thm</span></span>
  Nat.le_diff_conv le_diff_conv2
  Nat.less_diff_conv
  diff_less_imp_less_add
  diff_less_conv

<span class=keyword1><span class=command>thm</span></span>
  le_diff_swap
  diff_less_imp_swap
  diff_less_swap

<span class=keyword1><span class=command>thm</span></span>
  less_diff_imp_less
  le_diff_imp_le

<span class=keyword1><span class=command>thm</span></span>
  less_diff_le_imp_less
  le_diff_le_imp_le

<span class=keyword1><span class=command>thm</span></span>
  Nat.less_imp_diff_less
  le_imp_diff_le

<span class=keyword1><span class=command>thm</span></span>
  Nat.less_Suc_eq_le
  less_eq_le_pred
  less_imp_le_pred
  le_pred_imp_less

<span class=keyword1><span class=command>thm</span></span>
  Nat.Suc_le_eq
  pred_less_eq_le
  pred_less_imp_le
  le_imp_pred_less

<span class=keyword1><span class=command>thm</span></span>
  diff_cancel_imp_eq
<span class=keyword1><span class=command>thm</span></span>
  diff_add_inverse_Suc
<span class=keyword1><span class=command>thm</span></span>
  Nat.nat_add_left_cancel_less
  Nat.nat_add_left_cancel_le
  add_right_cancel
  add_left_cancel
  Nat.eq_diff_iff
  Nat.less_diff_iff
  Nat.le_diff_iff
<span class=keyword1><span class=command>thm</span></span>
  nat_diff_left_cancel_less
  nat_diff_right_cancel_less
<span class=keyword1><span class=command>thm</span></span>
  nat_diff_left_cancel_le1
  nat_diff_left_cancel_le2
  nat_diff_right_cancel_le1
  nat_diff_right_cancel_le2
<span class=keyword1><span class=command>thm</span></span>
  nat_diff_left_cancel_eq1
  nat_diff_left_cancel_eq2
  nat_diff_right_cancel_eq1
  nat_diff_right_cancel_eq2

<span class=keyword1><span class=command>thm</span></span>
  Nat.eq_diff_iff
  eq_diff_left_iff

<span class=keyword1><span class=command>thm</span></span>
  add_right_cancel add_left_cancel
  Nat.diff_le_mono
  eq_imp_diff_eq

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Util_Div><div class=head><h1>Theory Util_Div</h1></div><pre class=source><span class=comment1>(*  Title:      Util_Div.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Results for division and modulo operators on integers›</span></span>

<span class=keyword1><span class=command>theory</span></span> Util_Div
<span class=keyword2><span class=keyword>imports</span></span> <a href=Util_Nat.html>Util_Nat</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional (in-)equalities with <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>corollary</span></span> Suc_mod_le_divisor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> Suc <span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>≤</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Suc_leI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> mod_less_divisor<span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_less_dividend><span class=command>lemma</span></span> mod_less_dividend<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=comment1>(*lemma mod_le_dividend: "n mod m ≤ (n::nat)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> mod_le_dividend <span class=main>=</span> mod_less_eq_dividend



<span class=keyword1 id=Util_Div-diff_mod_le><span class=command>lemma</span></span> diff_mod_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_le_dividend<span class=main><span class=main>,</span></span> <span class=operator>OF</span> diff_le_self<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=comment1>(*corollary div_mult_cancel: "m div n * n = m - m mod (n::nat)"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> div_mult_cancel <span class=main>=</span> minus_mod_eq_div_mult <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>

<span class=keyword1 id=Util_Div-mod_0_div_mult_cancel><span class=command>lemma</span></span> mod_0_div_mult_cancel<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> eq_diff_left_iff<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_le_dividend le0<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult.commute minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_mult_le><span class=command>lemma</span></span> div_mult_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult.commute minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=Util_Div-less_div_Suc_mult><span class=command>lemma</span></span> less_div_Suc_mult<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> Suc <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult.commute minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_add_diff<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> mod_less_divisor<span class=main>)</span>

<span class=keyword1 id=Util_Div-nat_ge2_conv><span class=command>lemma</span></span> nat_ge2_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=numeral>2</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Div-Suc0_mod><span class=command>lemma</span></span> Suc0_mod<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≠</span> Suc <span class=main>0</span> <span class=main>⟹</span> Suc <span class=main>0</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> Suc0_mod_subst<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>m</span> <span class=main>≠</span> Suc <span class=main>0</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Suc <span class=main>0</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc0_mod<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>symmetric</span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> Suc0_mod_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>≠</span> Suc <span class=main>0</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=main>0</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> arg_cong<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc0_mod<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional results for addition and subtraction with <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-mod_Suc_conv><span class=command>lemma</span></span> mod_Suc_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span>Suc <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span>Suc <span class=free>b</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_Suc<span class=main>)</span>

<span class=keyword1 id="Util_Div-mod_Suc'"><span class=command>lemma</span></span> mod_Suc'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=keyword1>then</span> Suc <span class=main>(</span><span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_Suc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> le_neq_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> Suc_leI<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_add><span class=command>lemma</span></span> mod_add<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=quoted>"<span class=free>k</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_Suc_conv<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> mod_sub_add<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>k</span> <span class=main>≤</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> m<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>m</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>-</span><span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> b<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>b</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> k<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>k</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1 id=Util_Div-mod_sub_eq_mod_0_conv><span class=command>lemma</span></span> mod_sub_eq_mod_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>+</span> <span class=free>b</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> mod_add<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>n</span></span></span><span class=main><span class=main><span class=main>-</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>+</span></span></span><span class=free><span class=free><span class=free>b</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1 id=Util_Div-mod_sub_eq_mod_swap><span class=command>lemma</span></span> mod_sub_eq_mod_swap<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_sub_add add.commute<span class=main>)</span>

<span class=keyword1 id=Util_Div-le_mod_greater_imp_div_less><span class=command>lemma</span></span> le_mod_greater_imp_div_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&gt;</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mult_le_mono1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span>"</span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> add_less_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=free><span class=free>m</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-less_mod_ge_imp_div_less><span class=command>lemma</span></span> less_mod_ge_imp_div_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≥</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mult_less_cancel1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> conjunct2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span> <span class=main><span class=main>-</span></span> <span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_less_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> less_mod_0_imp_div_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_mod_ge_imp_div_less<span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_diff_right_eq><span class=command>lemma</span></span> mod_diff_right_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> a_as<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> a_as <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_diff_left<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_eq_imp_diff_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>;</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff_right_eq<span class=main>)</span>
<span class=keyword1 id=Util_Div-mod_eq_imp_diff_mod_eq2><span class=command>lemma</span></span> mod_eq_imp_diff_mod_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>t</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>t</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_mult_self2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>x</span></span> <span class=main><span class=main>-</span></span> <span class=free><span class=free>t</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_mult_self2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>y</span></span> <span class=main><span class=main>-</span></span> <span class=free><span class=free>t</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_diff_assoc2 diff_add_assoc gr0_imp_self_le_mult2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_add<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-divisor_add_diff_mod_if><span class=command>lemma</span></span> divisor_add_diff_mod_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span><span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>
  <span class=keyword1>then</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>
  <span class=keyword1>else</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> diff_add_assoc<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_add_self1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_imp_diff_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> divisor_add_diff_mod_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> divisor_add_diff_mod_if<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> divisor_add_diff_mod_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> divisor_add_diff_mod_if<span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_add_mod_if><span class=command>lemma</span></span> mod_add_mod_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span><span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>m</span>
  <span class=keyword1>then</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>
  <span class=keyword1>else</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_if<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_less_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_less_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_add_mod_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_mod_if<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> mod_add_mod_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>⟹</span>
  <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_mod_if<span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_add1_eq_if><span class=command>lemma</span></span> mod_add1_eq_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>then</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>
  <span class=keyword1>else</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span> mod_add_mod_if<span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_add_eq_mod_conv><span class=command>lemma</span></span> mod_add_eq_mod_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_add_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>a</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_mod_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_left_eq le_add_diff_inverse2<span class=main><span class=main>[</span></span><span class=operator>OF</span> trans_le_add1<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> mod_le_divisor<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>




<span class=keyword1 id=Util_Div-mod_diff1_eq><span class=command>lemma</span></span> mod_diff1_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> a_as<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> m_as<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> a_mod_le_b_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_le_dividend<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> a_as<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a_as <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff_right_eq<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a_mod_le_b_s <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_add_assoc<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_le_divisor<span class=main><span class=main>,</span></span> <span class=operator>OF</span> m_as<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_diff1_eq_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>
    <span class=keyword1>else</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff1_eq divisor_add_diff_mod_if<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> mod_diff1_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff1_eq_if<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> mod_diff1_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>⟧</span>
  <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff1_eq_if<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Divisor subtraction with <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-mod_diff_self1><span class=command>lemma</span></span> mod_diff_self1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_Div-mod_diff_self2><span class=command>lemma</span></span> mod_diff_self2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff_right_eq<span class=main>)</span>
<span class=keyword1 id=Util_Div-mod_diff_mult_self1><span class=command>lemma</span></span> mod_diff_mult_self1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff_right_eq<span class=main>)</span>
<span class=keyword1 id=Util_Div-mod_diff_mult_self2><span class=command>lemma</span></span> mod_diff_mult_self2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>k</span></span><span class=main><span class=main>]</span></span> mod_diff_mult_self1<span class=main>)</span>

<span class=keyword1 id=Util_Div-div_diff_self1><span class=command>lemma</span></span> div_diff_self1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>m</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=Util_Div-div_diff_self2><span class=command>lemma</span></span> div_diff_self2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> <span class=free>m</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_diff_mult_self1><span class=command>lemma</span></span> div_diff_mult_self1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_le<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffD1<span class=main><span class=main>[</span></span><span class=operator>OF</span> mult_cancel1_gr0<span class=main><span class=main><span class=main>[</span></span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> k<span class=main><span class=main><span class=main><span class=main>=</span></span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> diff_mult_distrib2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span><span class=main>*</span><span class=free>m</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff_mult_self1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=Util_Div-div_diff_mult_self2><span class=command>lemma</span></span> div_diff_mult_self2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute div_diff_mult_self1<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Modulo equality and modulo of difference›</span></span>

<span class=keyword1 id=Util_Div-mod_eq_imp_diff_mod_0><span class=command>lemma</span></span> mod_eq_imp_diff_mod_0<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> as1<span class=main>:</span> <span class=var><span class=quoted><span class=var>?P</span></span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as1 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_add_inverse2<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_mult_distrib<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_mult_self2_is_0<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_eq_imp_diff_dvd<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> dvd_eq_mod_eq_0<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>,</span></span> <span class=operator>OF</span> mod_eq_imp_diff_mod_0<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_neq_imp_diff_mod_neq0><span class=command>lemma</span></span> mod_neq_imp_diff_mod_neq0<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≠</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_imp_less_or_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff1_eq1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff1_eq2<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_le<span class=main><span class=main>]</span></span> trans_less_add1<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_neq_imp_diff_not_dvd<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≠</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dvd_eq_mod_eq_0 mod_neq_imp_diff_mod_neq0<span class=main>)</span>

<span class=keyword1 id=Util_Div-diff_mod_0_imp_mod_eq><span class=command>lemma</span></span> diff_mod_0_imp_mod_eq<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mod_neq_imp_diff_mod_neq0<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> diff_dvd_imp_mod_eq<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> dvd_eq_mod_eq_0<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> diff_mod_0_imp_mod_eq<span class=main><span class=main>]</span></span><span class=main>)</span>



<span class=keyword1 id=Util_Div-mod_eq_diff_mod_0_conv><span class=command>lemma</span></span> mod_eq_diff_mod_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_eq_imp_diff_mod_0<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> diff_mod_0_imp_mod_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_eq_diff_dvd_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=keyword1>dvd</span> <span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> dvd_eq_mod_eq_0<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> subst<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> mod_eq_diff_mod_0_conv<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some additional lemmata about integer <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-zmod_eq_imp_diff_mod_0><span class=command>lemma</span></span> zmod_eq_imp_diff_mod_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>m</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff_cong<span class=main>)</span>
  
<span class=comment1>(*lemma int_mod_distrib: "int (n mod m) = int n mod int m"*)</span>
<span class=keyword1><span class=command>lemmas</span></span> int_mod_distrib <span class=main>=</span> zmod_int

<span class=keyword1 id=Util_Div-zdiff_mod_0_imp_mod_eq__pos><span class=command>lemma</span></span> zdiff_mod_0_imp_mod_eq__pos<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>int<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=var>?P</span><span class=main>;</span> <span class=var>?Pm</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> as1<span class=main>:</span> <span class=var><span class=quoted><span class=var>?P</span></span></span>
    <span class=keyword2><span class=keyword>and</span></span> as2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r1</span></span> <span class=keyword2><span class=keyword>where</span></span> a_r1<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>r1</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r2</span></span> <span class=keyword2><span class=keyword>where</span></span> b_r2<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q1</span></span> <span class=keyword2><span class=keyword>where</span></span> a_q1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q1</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q2</span></span> <span class=keyword2><span class=keyword>where</span></span> b_q2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>q2</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> a_r1_q1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>r1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a_r1 a_q1 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> b_r2_q2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span> <span class=main>+</span> <span class=skolem>r2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> b_r2 b_q2 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span> <span class=main>+</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>r1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a_r1_q1 b_r2_q2 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span> <span class=main>+</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>-</span> <span class=skolem>r1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q2</span> <span class=main>-</span> <span class=free>m</span> <span class=main>*</span> <span class=skolem>q1</span> <span class=main>+</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=free>m</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>q2</span> <span class=main>-</span> <span class=skolem>q1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> right_diff_distrib<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_eq<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> r2_r1_mod_m_0<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?R1</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> as1<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r1</span> <span class=main>=</span> <span class=skolem>r2</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem>r1</span></span> <span class=main><span class=main>≠</span></span> <span class=skolem><span class=skolem>r2</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> as1'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>r1</span> <span class=main>≠</span> <span class=skolem>r2</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> diff_le_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span> <span class=bound>b</span> <span class=main>(</span><span class=bound>m</span><span class=main>::</span>int<span class=main>)</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>0</span> <span class=main>≤</span> <span class=bound>a</span><span class=main>;</span> <span class=bound>b</span> <span class=main>&lt;</span> <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>b</span> <span class=main>-</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> s_r1<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=skolem>r1</span> <span class=main>∧</span> <span class=skolem>r1</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> s_r2<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=skolem>r2</span> <span class=main>∧</span> <span class=skolem>r2</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> as2 a_r1 b_r2 pos_mod_conj<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>have</span></span> mr2r1<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>m</span> <span class=main>&lt;</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> r2r1m<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minus_less_iff<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span> s_r1 s_r2 diff_le_s<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>⟹</span> <span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> r2r1m <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> mod_pos_pos_trivial<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> s1_pos<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>⟹</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> r2_r1_mod_m_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>r2</span><span class=main>-</span><span class=skolem>r1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>-</span><span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_zminus2_eq_if<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>r2</span><span class=main>-</span><span class=skolem>r1</span>"</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span> r2_r1_mod_m_0<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>≤</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>-</span><span class=free>m</span> <span class=main>=</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mr2r1
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_neg_neg_trivial<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> s1_neg<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>≤</span> <span class=main>0</span> <span class=main>⟹</span> <span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>-</span> <span class=skolem>r1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> s1_pos s1_neg linorder_linear <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r1</span> <span class=main>=</span> <span class=skolem>r2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>using</span></span> as1' <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> a_r1 b_r2 <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Util_Div-zmod_zminus_eq_conv_pos><span class=command>lemma</span></span> zmod_zminus_eq_conv_pos<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>int<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_minus_right neg_equal_iff_equal<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> zmod_zminus1_eq_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> pos_mod_bound<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span> pos_mod_bound<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=Util_Div-zmod_zminus_eq_conv><span class=command>lemma</span></span> zmod_zminus_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span>int<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>-</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> linorder_less_linear<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> disjE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> zmod_zminus_eq_conv_pos<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_zminus_eq_conv_pos<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>m</span>"</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-zdiff_mod_0_imp_mod_eq><span class=command>lemma</span></span> zdiff_mod_0_imp_mod_eq<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>int<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dvd_eq_mod_eq_0 mod_eq_dvd_iff<span class=main>)</span>

<span class=keyword1 id=Util_Div-zmod_eq_diff_mod_0_conv><span class=command>lemma</span></span> zmod_eq_diff_mod_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>::</span>int<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> zmod_eq_imp_diff_mod_0<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> zdiff_mod_0_imp_mod_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=main>(</span><span class=bound>a</span><span class=main>::</span>int<span class=main>)</span> <span class=bound>b</span> <span class=bound>m</span><span class=main>.</span> <span class=main>(</span><span class=bound>b</span> <span class=main>-</span> <span class=bound>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=bound>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>a</span> <span class=keyword1>mod</span> <span class=bound>m</span> <span class=main>≠</span> <span class=bound>b</span> <span class=keyword1>mod</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zmod_eq_diff_mod_0_conv<span class=main>)</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=bound>b</span> <span class=bound>m</span><span class=main>.</span> <span class=main>(</span><span class=bound>b</span> <span class=main>-</span> <span class=bound>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=bound>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>a</span> <span class=keyword1>mod</span> <span class=bound>m</span> <span class=main>≠</span> <span class=bound>b</span> <span class=keyword1>mod</span> <span class=bound>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=numeral>2</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1 id=Util_Div-zmult_div_leq_mono><span class=command>lemma</span></span> zmult_div_leq_mono<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>d</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>d</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>d</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_right_mono zdiv_mono1 mult.commute<span class=main>)</span>

<span class=keyword1 id=Util_Div-zmult_div_leq_mono_neg><span class=command>lemma</span></span> zmult_div_leq_mono_neg<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>d</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>d</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>*</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>d</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_left_mono_neg zdiv_mono1<span class=main>)</span>

<span class=keyword1 id=Util_Div-zmult_div_pos_le><span class=command>lemma</span></span> zmult_div_pos_le<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>*</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>*</span> <span class=free>a</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_right_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span> <span class=keyword1>div</span> <span class=free>c</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> zdiv_mono1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-zmult_div_neg_le><span class=command>lemma</span></span> zmult_div_neg_le<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span><span class=main>;</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>*</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>c</span> <span class=main>*</span> <span class=free>a</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_right_mono_neg<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span> <span class=keyword1>div</span> <span class=free>c</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> zdiv_mono1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-zmult_div_ge_0><span class=command>lemma</span></span> zmult_div_ge_0<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>*</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>c</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pos_imp_zdiv_nonneg_iff split_mult_pos_le<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> zmult_div_plus_ge_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>*</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>+</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> zmult_div_ge_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>


<span class=keyword1 id=Util_Div-zmult_div_abs_ge><span class=command>lemma</span></span> zmult_div_abs_ge<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>b'</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span><span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>¦</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span><span class=main>¦</span> <span class=main>≤</span> <span class=main>¦</span><span class=free>a</span> <span class=main>*</span> <span class=free>b'</span> <span class=keyword1>div</span> <span class=free>c</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> zmult_div_ge_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span><span class=main><span class=main>]</span></span> zmult_div_ge_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b'</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> zmult_div_leq_mono<span class=main>)</span>

<span class=keyword1 id=Util_Div-zmult_div_plus_abs_ge><span class=command>lemma</span></span> zmult_div_plus_abs_ge<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>int<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>b'</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> <span class=free>a</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>¦</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>+</span> <span class=free>a</span><span class=main>¦</span> <span class=main>≤</span> <span class=main>¦</span><span class=free>a</span> <span class=main>*</span> <span class=free>b'</span> <span class=keyword1>div</span> <span class=free>c</span> <span class=main>+</span> <span class=free>a</span><span class=main>¦</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> zmult_div_plus_ge_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span><span class=main><span class=main>]</span></span> zmult_div_plus_ge_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b'</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> zmult_div_leq_mono<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some further (in-)equality results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-less_mod_eq_imp_add_divisor_le><span class=command>lemma</span></span> less_mod_eq_imp_add_divisor_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>+</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> contrapos_pp<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>x</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>y</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> not_not<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> m_greater_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> x_less_y<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> y_x_greater_0<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>-</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> y_x_mod_m<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_eq_imp_diff_mod_0<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>x</span> <span class=main>+</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>-</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>+</span> <span class=free>m</span> <span class=main>-</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_add_inverse diff_less_conv m_greater_0<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> y_x_less_m<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>-</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=main>-</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> y_x_less_m <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>-</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> y_x_mod_m <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>using</span></span> y_x_greater_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Util_Div-less_div_imp_mult_add_divisor_le><span class=command>lemma</span></span> less_div_imp_mult_add_divisor_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_self<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mult_le_mono2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_1_right minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_imp_le_pred<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mult_le_mono2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mult_distrib2 minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> diff_diff_left<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> le_diff_conv2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_diff_imp_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=free><span class=free>x</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_add_eq_imp_mod_0><span class=command>lemma</span></span> mod_add_eq_imp_mod_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_eq_if mod_add mod_add_self1 mod_self add.commute<span class=main>)</span>

<span class=keyword1 id=Util_Div-between_imp_mod_between><span class=command>lemma</span></span> between_imp_mod_between<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>∧</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> gr_implies_gr0<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> div_nat_eqI<span class=main>)</span> <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_le_imp_le_left<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> c<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=main><span class=main>(</span></span><span class=free><span class=free>n</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> between_imp_mod_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> between_imp_mod_between<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> between_imp_mod_gr0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>*</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Suc_le_lessD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> between_imp_mod_between<span class=main><span class=main>[</span></span><span class=operator>THEN</span> conjunct1<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main>0</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> le_less_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> Suc <span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> div_nat_eqI dividend_less_times_div<span class=main>)</span>

<span class=keyword1 id=Util_Div-le_less_imp_div><span class=command>lemma</span></span> le_less_imp_div<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> Suc <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> div_nat_eqI<span class=main>)</span>  

<span class=keyword1 id=Util_Div-div_imp_le_less><span class=command>lemma</span></span> div_imp_le_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> Suc <span class=free>k</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> dividend_less_times_div<span class=main>)</span>

<span class=keyword1 id=Util_Div-div_le_mod_le_imp_le><span class=command>lemma</span></span> div_le_mod_le_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> mult_div_mod_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> mult_div_mod_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_le_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mult_le_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-le_mod_add_eq_imp_add_mod_le><span class=command>lemma</span></span> le_mod_add_eq_imp_add_mod_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>+</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_le_mono2 diff_add_inverse le_add1 le_add_diff_inverse mod_diff1_eq mod_less_eq_dividend<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> mult_divisor_le_mod_ge_imp_ge<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>*</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> le_mod_add_eq_imp_add_mod_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=free><span class=free>k</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>n</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>*</span> <span class=free>k</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional multiplication results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-mod_0_imp_mod_mult_right_0><span class=command>lemma</span></span> mod_0_imp_mod_mult_right_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=Util_Div-mod_0_imp_mod_mult_left_0><span class=command>lemma</span></span> mod_0_imp_mod_mult_left_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Util_Div-mod_0_imp_div_mult_left_eq><span class=command>lemma</span></span> mod_0_imp_div_mult_left_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>*</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=Util_Div-mod_0_imp_div_mult_right_eq><span class=command>lemma</span></span> mod_0_imp_div_mult_right_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>


<span class=keyword1 id=Util_Div-mod_0_imp_mod_factor_0_left><span class=command>lemma</span></span> mod_0_imp_mod_factor_0_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>m'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=Util_Div-mod_0_imp_mod_factor_0_right><span class=command>lemma</span></span> mod_0_imp_mod_factor_0_right<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>m'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m'</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some factor distribution facts for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-mod_eq_mult_distrib><span class=command>lemma</span></span> mod_eq_mult_distrib<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=free>a</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Util_Div-mod_mult_eq_imp_mod_eq><span class=command>lemma</span></span> mod_mult_eq_imp_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_mult2_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_eq_mod_0_imp_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m'</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m'</span><span class=main>;</span> <span class=free>m'</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mod_mod_cancel <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>m'</span></span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> mod_mod_cancel <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span> <span class=quoted><span class=free>m'</span></span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Util_Div-mod_factor_imp_mod_0><span class=command>lemma</span></span> mod_factor_imp_mod_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span><span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=var>?P1</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=var>?Q</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> as1<span class=main>:</span> <span class=var><span class=quoted><span class=var>?P1</span></span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as1 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>div</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>+</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?l1</span> <span class=main>=</span> <span class=var>?r1</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span> mod_mult2_eq<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=var>?r1</span> <span class=keyword1>mod</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=var>?r1</span> <span class=keyword1>mod</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_add_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_factor_div<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span><span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>k</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> mod_factor_imp_mod_0<span class=main><span class=main>[</span></span><span class=operator>THEN</span> mod_0_div_mult_cancel<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Util_Div-mod_factor_div_mod><span class=command>lemma</span></span> mod_factor_div_mod<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>y</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=var>?P1</span><span class=main>;</span> <span class=var>?P2</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=var>?L</span> <span class=main>=</span> <span class=var>?R</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> as1<span class=main>:</span> <span class=var><span class=quoted><span class=var>?P1</span></span></span>
  <span class=keyword3><span class=command>assume</span></span> as2<span class=main>:</span> <span class=var><span class=quoted><span class=var>?P2</span></span></span>
  <span class=keyword1><span class=command>have</span></span> x_mod_k_0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as1 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> mod_factor_imp_mod_0<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?L</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_mult2_eq mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>k</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?L</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> x_mod_k_0 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?L</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>y</span> <span class=main>*</span> <span class=free>k</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as1 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?L</span> <span class=main>*</span> <span class=free>k</span> <span class=main>=</span> <span class=free>y</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>*</span> <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_mod_left<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> as2 <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹More results about quotient <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> with addition and subtraction›</span></span>

<span class=keyword1 id=Util_Div-div_add1_eq_if><span class=command>lemma</span></span> div_add1_eq_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_add1_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span><span class=main><span class=main>)</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_less_imp_div<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main>0</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_less_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor mod_less_divisor<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> div_add1_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_add1_eq_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> div_add1_eq1_mod_0_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_add1_eq1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> div_add1_eq1_mod_0_right<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> div_add1_eq1_mod_0_left<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> div_add1_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_add1_eq_if<span class=main>)</span>

<span class=keyword1 id=Util_Div-div_Suc><span class=command>lemma</span></span> div_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> Suc <span class=main>(</span><span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>then</span> Suc <span class=main>(</span><span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Suc_leI<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> le_imp_less_or_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> conjI impI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> div_add1_eq2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> le_neq_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> Suc_leI<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=free>m</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> div_add1_eq1<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id="Util_Div-div_Suc'"><span class=command>lemma</span></span> div_Suc'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>m</span> <span class=keyword1>mod</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=keyword1>then</span> <span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span> <span class=keyword1>else</span> Suc <span class=main>(</span><span class=free>m</span> <span class=keyword1>div</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_Suc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> le_neq_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_less_divisor<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> Suc_leI<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_diff1_eq_if><span class=command>lemma</span></span> div_diff1_eq_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span>
  <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>0</span> <span class=keyword1>else</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>&lt;</span> <span class=free>a</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> less_imp_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> linorder_not_less neq0_conv<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> le_as<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> m_as<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> div_le<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> le_as <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_le_mono<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_add_assoc2<span class=main><span class=main>[</span></span><span class=operator>OF</span> mult_le_mono1<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> div_le<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> b_a_s1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?b_a</span> <span class=main>=</span> <span class=var>?b_a1</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_mult_distrib<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> b_a_div_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> as'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=var>?b_a1</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b_a_div_s <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> as' <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_mult_self1<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_neq<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> m_as<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>THEN</span> not_sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> b_a_div_s'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>…</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> div_less<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> less_imp_diff_less<span class=main><span class=keyword3>,</span></span>
          <span class=operator>rule</span> mod_less_divisor<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> m_as<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> b_a_div_s' as'
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> as1'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>hence</span></span> as'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>have</span></span> a_div_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> le_as as'
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_mod_greater_imp_div_less<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span>Suc <span class=main>0</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>+</span> Suc <span class=main>0</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>+</span> Suc <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_add_assoc2
        a_div_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> zero_less_diff<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> Suc_le_eq<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> b_a_div_s'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>…</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=var>?b_a1</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b_a_div_s <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>+</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>
      <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> b_a_div_s' <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>
      <span class=main>+</span> Suc <span class=main>0</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_mult_distrib<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>
      <span class=main>+</span> <span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>*</span> <span class=free>m</span>
      <span class=main>+</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.assoc m_as
        diff_add_assoc<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span><span class=main><span class=main>]</span></span>
        trans_le_add1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> mod_le_divisor<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>
      <span class=main>+</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add.commute div_mult_self1<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_neq<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> m_as<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>THEN</span> not_sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> b_a_div_s'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>…</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

    <span class=keyword1><span class=command>have</span></span> div_0_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> div_less<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> add_diff_less m_as as'<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> as1' b_a_div_s' div_0_s<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> div_diff1_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span>
  <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=main>(</span><span class=free>m</span> <span class=main>+</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>(</span><span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> neq0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span>
  <span class=quoted><span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>if</span></span> <span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>≤</span></span> <span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=keyword1><span class=keyword1>then</span></span> <span class=main><span class=main>0</span></span> <span class=keyword1><span class=keyword1>else</span></span> Suc <span class=main><span class=main>0</span></span>"</span></span></span>
  <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>m</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>a</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span> <span class=main><span class=main>-</span></span> Suc<span class=main><span class=main>(</span></span><span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span> <span class=keyword1><span class=keyword1>div</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_diff1_eq_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Suc_le_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_add_assoc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_add_self1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_imp_diff_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> div_diff1_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_diff1_eq_if<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> div_diff1_eq1_mod_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> <span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_diff1_eq1<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> div_diff1_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>(</span><span class=free>a</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_diff1_eq_if<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Further results about <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary facts about <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>mod›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-diff_less_divisor_imp_sub_mod_eq><span class=command>lemma</span></span> diff_less_divisor_imp_sub_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>y</span> <span class=main>-</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=Util_Div-diff_ge_divisor_imp_sub_mod_less><span class=command>lemma</span></span> diff_ge_divisor_imp_sub_mod_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>y</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> less_diff_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> le_diff_conv2 add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>x</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-le_imp_sub_mod_le><span class=command>lemma</span></span> le_imp_sub_mod_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=main>(</span><span class=free>y</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>-</span> <span class=free>x</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> diff_ge_divisor_imp_sub_mod_less<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>y</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_less_diff_mod><span class=command>lemma</span></span> mod_less_diff_mod<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>r</span><span class=main>;</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>r</span> <span class=main>≤</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>=</span> <span class=free>m</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff_self2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_diff1_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>r</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_0_imp_mod_pred><span class=command>lemma</span></span> mod_0_imp_mod_pred<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Suc_le_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff1_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_pred><span class=command>lemma</span></span> mod_pred<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_0_imp_mod_pred<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc0_mod<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>≤</span></span> <span class=free><span class=free>n</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_diff1_eq1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc0_mod<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_pred_Suc_mod<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Suc <span class=main>(</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_pred<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> diff_mod_pred<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>b</span> <span class=main>-</span> Suc <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> Suc <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>-</span> <span class=free>a</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mod_pred<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_eq_diff_mod_0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> diff_mod_pred_Suc_mod<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟹</span> Suc <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> Suc <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> diff_mod_pred mod_eq_diff_mod_0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_eq_imp_diff_mod_eq_divisor><span class=command>lemma</span></span> mod_eq_imp_diff_mod_eq_divisor<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>a</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Suc <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> Suc <span class=free>a</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mod_eq_imp_diff_mod_0<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iffD2<span class=main><span class=main>[</span></span><span class=operator>OF</span> zero_less_diff<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mod_0_imp_mod_pred<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span><span class=main><span class=main>-</span></span><span class=free><span class=free>a</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=Util_Div-sub_diff_mod_eq><span class=command>lemma</span></span> sub_diff_mod_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>r</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>r</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mod_diff_right_eq diff_diff_cancel diff_le_self<span class=main>)</span>

<span class=keyword1 id="Util_Div-sub_diff_mod_eq'"><span class=command>lemma</span></span> sub_diff_mod_eq'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>r</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>+</span> <span class=free>t</span> <span class=main>-</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>r</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_mod_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>r</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> add_diff_assoc<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sub_diff_mod_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_eq_Suc_0_conv><span class=command>lemma</span></span> mod_eq_Suc_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>k</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_pred<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_eq_divisor_minus_Suc_0_conv><span class=command>lemma</span></span> mod_eq_divisor_minus_Suc_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>0</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=free>k</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Suc <span class=free>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mod_Suc<span class=main><span class=keyword3>,</span></span> <span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary facts about <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>div›</span></span></span></span>›</span></span>

<span class=keyword1 id=Util_Div-sub_mod_div_eq_div><span class=command>lemma</span></span> sub_mod_div_eq_div<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>-</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minus_mod_eq_mult_div<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_less_imp_diff_div_conv><span class=command>lemma</span></span> mod_less_imp_diff_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>r</span><span class=main>;</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> neq0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_nat_eqI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span> minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> mod_0_le_imp_diff_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>r</span><span class=main>;</span> <span class=free>r</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_less_imp_diff_div_conv<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> mod_0_less_imp_diff_Suc_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span><span class=main>;</span> <span class=free>r</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=free>r</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> mod_0_le_imp_diff_div_conv<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> r<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"Suc <span class=free><span class=free><span class=free>r</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> mod_0_imp_diff_Suc_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=free>r</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>r</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> Suc <span class=free>r</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>-</span> <span class=free>r</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_0_le_imp_diff_div_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> mod_0_imp_sub_1_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_0_less_imp_diff_Suc_div_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> sub_Suc_mod_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>(</span><span class=free>n</span> <span class=keyword1>mod</span> <span class=free>m</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>=</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_less_imp_diff_div_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=Util_Div-div_le_conv><span class=command>lemma</span></span> div_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> Suc <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mult_le_mono1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span> minus_mod_eq_mult_div <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_diff_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span> <span class=main><span class=main>*</span></span> <span class=free><span class=free>k</span></span> <span class=main><span class=main>+</span></span> <span class=free><span class=free>n</span></span> <span class=keyword1><span class=keyword1>mod</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>m</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> diff_add_assoc<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc_leI<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_le_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> le_refl<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_le_pred<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mod_less_divisor<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_0_imp_sub_1_div_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-le_div_conv><span class=command>lemma</span></span> le_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> <span class=free>k</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>*</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> mult_le_mono1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_mult_cancel<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-less_mult_imp_div_less><span class=command>lemma</span></span> less_mult_imp_div_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>⟹</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_imp_le_pred<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mod_0_imp_sub_1_div_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_less_imp_less_mult><span class=command>lemma</span></span> div_less_imp_less_mult<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_less_conv><span class=command>lemma</span></span> div_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>*</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_less_imp_less_mult<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_mult_imp_div_less<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-div_eq_0_conv><span class=command>lemma</span></span> div_eq_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>m</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id="Util_Div-div_eq_0_conv'"><span class=command>lemma</span></span> div_eq_0_conv'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_eq_0_conv<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> div_gr_imp_gr_divisor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>⟹</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> gr_implies_gr0<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> neq0_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_eq_0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-mod_0_less_div_conv><span class=command>lemma</span></span> mod_0_less_div_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=keyword1>mod</span> <span class=main>(</span><span class=free>m</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=keyword1>div</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Util_Div-add_le_divisor_imp_le_Suc_div><span class=command>lemma</span></span> add_le_divisor_imp_le_Suc_div<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>y</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span> <span class=keyword1>div</span> <span class=free>m</span> <span class=main>≤</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> div_add1_eq_if<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>x</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>y</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹List of definitions and lemmas›</span></span>

<span class=keyword1><span class=command>thm</span></span>
  minus_mod_eq_mult_div <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  mod_0_div_mult_cancel
  div_mult_le
  less_div_Suc_mult
<span class=keyword1><span class=command>thm</span></span>
  Suc0_mod
  Suc0_mod_subst
  Suc0_mod_cong

<span class=keyword1><span class=command>thm</span></span>
  mod_Suc_conv

<span class=keyword1><span class=command>thm</span></span>
  mod_add
  mod_sub_add

<span class=keyword1><span class=command>thm</span></span>
  mod_sub_eq_mod_0_conv
  mod_sub_eq_mod_swap

<span class=keyword1><span class=command>thm</span></span>
  le_mod_greater_imp_div_less
<span class=keyword1><span class=command>thm</span></span>
  mod_diff_right_eq
  mod_eq_imp_diff_mod_eq

<span class=keyword1><span class=command>thm</span></span>
  divisor_add_diff_mod_if
  divisor_add_diff_mod_eq1
  divisor_add_diff_mod_eq2

<span class=keyword1><span class=command>thm</span></span>
  mod_add_eq
  mod_add1_eq_if
<span class=keyword1><span class=command>thm</span></span>
  mod_diff1_eq_if
  mod_diff1_eq
  mod_diff1_eq1
  mod_diff1_eq2

<span class=keyword1><span class=command>thm</span></span>
  nat_mod_distrib
  int_mod_distrib

<span class=keyword1><span class=command>thm</span></span>
  zmod_zminus_eq_conv

<span class=keyword1><span class=command>thm</span></span>
  mod_eq_imp_diff_mod_0
  zmod_eq_imp_diff_mod_0

<span class=keyword1><span class=command>thm</span></span>
  mod_neq_imp_diff_mod_neq0
  diff_mod_0_imp_mod_eq
  zdiff_mod_0_imp_mod_eq

<span class=keyword1><span class=command>thm</span></span>
  zmod_eq_diff_mod_0_conv
  mod_eq_diff_mod_0_conv

<span class=keyword1><span class=command>thm</span></span>
  less_mod_eq_imp_add_divisor_le
<span class=keyword1><span class=command>thm</span></span>
  mod_add_eq_imp_mod_0
<span class=keyword1><span class=command>thm</span></span>
  mod_eq_mult_distrib
  mod_factor_imp_mod_0
  mod_factor_div
  mod_factor_div_mod


<span class=keyword1><span class=command>thm</span></span>
  mod_diff_self1
  mod_diff_self2
  mod_diff_mult_self1
  mod_diff_mult_self2

<span class=keyword1><span class=command>thm</span></span>
  div_diff_self1
  div_diff_self2
  div_diff_mult_self1
  div_diff_mult_self2

<span class=keyword1><span class=command>thm</span></span>
  le_less_imp_div
  div_imp_le_less
<span class=keyword1><span class=command>thm</span></span>
  le_less_div_conv

<span class=keyword1><span class=command>thm</span></span>
  diff_less_divisor_imp_sub_mod_eq
  diff_ge_divisor_imp_sub_mod_less
  le_imp_sub_mod_le

<span class=keyword1><span class=command>thm</span></span>
  sub_mod_div_eq_div

<span class=keyword1><span class=command>thm</span></span>
  mod_less_imp_diff_div_conv
  mod_0_le_imp_diff_div_conv
  mod_0_less_imp_diff_Suc_div_conv
  mod_0_imp_sub_1_div_conv


<span class=keyword1><span class=command>thm</span></span>
  sub_Suc_mod_div_conv

<span class=keyword1><span class=command>thm</span></span>
  mod_less_diff_mod
  mod_0_imp_mod_pred

<span class=keyword1><span class=command>thm</span></span>
  mod_pred
  mod_pred_Suc_mod

<span class=keyword1><span class=command>thm</span></span>
  mod_eq_imp_diff_mod_eq_divisor

<span class=keyword1><span class=command>thm</span></span>
  diff_mod_le
  sub_diff_mod_eq
  sub_diff_mod_eq'

<span class=keyword1><span class=command>thm</span></span>
  div_diff1_eq_if
  div_diff1_eq
  div_diff1_eq1
  div_diff1_eq2


<span class=keyword1><span class=command>thm</span></span>
  div_le_conv

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=SetInterval2><div class=head><h1>Theory SetInterval2</h1></div><pre class=source><span class=comment1>(*  Title:      SetInterval2.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Sets of natural numbers›</span></span>

<span class=keyword1><span class=command>theory</span></span> SetInterval2
<span class=keyword2><span class=keyword>imports</span></span>
  <span class=quoted>"<a href=../../HOL/HOL-Library/Infinite_Set.html>HOL-Library.Infinite_Set</a>"</span>
  <a href=Util_Set.html>Util_Set</a>
  <span class=quoted>"<a href=Util_MinMax.html>../CommonArith/Util_MinMax</a>"</span>
  <span class=quoted>"<a href=Util_NatInf.html>../CommonArith/Util_NatInf</a>"</span>
  <span class=quoted>"<a href=Util_Div.html>../CommonArith/Util_Div</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for monotonic, injective and surjective functions over sets›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Monotonicity›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mono_on</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>order <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>order<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> set <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>mono_on</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=bound>a</span> <span class=main>≤</span> <span class=bound>b</span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>a</span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>b</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>strict_mono_on</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>order <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>order<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> set <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>strict_mono_on</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=bound>b</span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>b</span>"</span></span>


<span class=keyword1 id=SetInterval2-mono_on_subset><span class=command>lemma</span></span> mono_on_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> mono_on <span class=free>f</span> <span class=free>A</span> <span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> mono_on <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mono_on_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-strict_mono_on_subset><span class=command>lemma</span></span> strict_mono_on_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> strict_mono_on <span class=free>f</span> <span class=free>A</span> <span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> strict_mono_on <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> strict_mono_on_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1 id=SetInterval2-mono_on_UNIV_mono_conv><span class=command>lemma</span></span> mono_on_UNIV_mono_conv<span class=main>:</span> <span class=quoted><span class=quoted>"mono_on <span class=free>f</span> UNIV <span class=main>=</span> mono <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mono_on_def mono_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-strict_mono_on_UNIV_strict_mono_conv><span class=command>lemma</span></span> strict_mono_on_UNIV_strict_mono_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono_on <span class=free>f</span> UNIV <span class=main>=</span> strict_mono <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> strict_mono_on_def strict_mono_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-mono_imp_mono_on><span class=command>lemma</span></span> mono_imp_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"mono <span class=free>f</span> <span class=main>⟹</span> mono_on <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mono_on_def mono_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-strict_mono_imp_strict_mono_on><span class=command>lemma</span></span> strict_mono_imp_strict_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono <span class=free>f</span> <span class=main>⟹</span> strict_mono_on <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> strict_mono_on_def strict_mono_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-strict_mono_on_imp_mono_on><span class=command>lemma</span></span> strict_mono_on_imp_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono_on <span class=free>f</span> <span class=free>A</span> <span class=main>⟹</span> mono_on <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_on_def mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> order_le_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Injectivity›</span></span>

<span class=keyword1 id=SetInterval2-inj_imp_inj_on><span class=command>lemma</span></span> inj_imp_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=free>f</span> <span class=main>⟹</span> inj_on <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inj_on_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-strict_mono_on_imp_inj_on><span class=command>lemma</span></span> strict_mono_on_imp_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono_on <span class=free>f</span> <span class=main>(</span><span class=free>A</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder set<span class=main>)</span> <span class=main>⟹</span> inj_on <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_on_def inj_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_neq_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1 id=SetInterval2-strict_mono_imp_inj><span class=command>lemma</span></span> strict_mono_imp_inj<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>order<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> inj <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> strict_mono_imp_inj_on<span class=main>)</span>

<span class=keyword1 id=SetInterval2-strict_mono_on_mono_on_conv><span class=command>lemma</span></span> strict_mono_on_mono_on_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono_on <span class=free>f</span> <span class=main>(</span><span class=free>A</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder set<span class=main>)</span> <span class=main>=</span> <span class=main>(</span>mono_on <span class=free>f</span> <span class=free>A</span> <span class=main>∧</span> inj_on <span class=free>f</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> strict_mono_on_imp_mono_on<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> strict_mono_on_imp_inj_on<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> conjE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inj_on_def mono_on_def strict_mono_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> strict_mono_mono_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>::</span>order<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>mono <span class=free>f</span> <span class=main>∧</span> inj <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> strict_mono_on_UNIV_strict_mono_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
  mono_on_UNIV_mono_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> strict_mono_on_mono_on_conv<span class=main>)</span>


<span class=keyword1 id=SetInterval2-inj_on_image_mem_iff><span class=command>lemma</span></span> inj_on_image_mem_iff<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inj_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>f</span> <span class=main>`</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inj_on_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>corollary</span></span> inj_on_union_image_Int<span class=main>:</span> <span class=quoted><span class=quoted>"
  inj_on <span class=free>f</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>f</span> <span class=main>`</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_image_Int<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Un_upper1 Un_upper2<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Surjectivity›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>surj_on</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> set <span class=main>⇒</span> <span class=tfree>'b</span> set <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>surj_on</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>B</span></span></span><span class=main>.</span> <span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=bound>b</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>a</span>"</span></span>

<span class=keyword1 id=SetInterval2-surj_on_conv><span class=command>lemma</span></span> surj_on_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>b</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_def <span class=keyword1><span class=command>..</span></span>

<span class=keyword1 id=SetInterval2-surj_on_image_conv><span class=command>lemma</span></span> surj_on_image_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>B</span> <span class=main>⊆</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_id><span class=command>lemma</span></span> surj_on_id<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on id <span class=free>A</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> id_def surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_onI><span class=command>lemma</span></span>
  surj_onI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∀</span><span class=bound>b</span> <span class=main>∈</span> <span class=free>B</span><span class=main>.</span> <span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>b</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  surj_onD2<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>b</span> <span class=main>∈</span> <span class=free>B</span><span class=main>.</span> <span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>b</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  surj_onD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>b</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>a</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetInterval2-comp_surj_on><span class=command>lemma</span></span> comp_surj_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>;</span> surj_on <span class=free>g</span> <span class=free>B</span> <span class=free>C</span> <span class=main>⟧</span> <span class=main>⟹</span> surj_on <span class=main>(</span><span class=free>g</span> <span class=main>∘</span> <span class=free>f</span><span class=main>)</span> <span class=free>A</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> comp_def surj_on_image_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_Un_right><span class=command>lemma</span></span> surj_on_Un_right<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>(</span><span class=free>B1</span> <span class=main>∪</span> <span class=free>B2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B1</span> <span class=main>∧</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_image_conv
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_Un_left><span class=command>lemma</span></span> surj_on_Un_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  surj_on <span class=free>f</span> <span class=main>(</span><span class=free>A1</span> <span class=main>∪</span> <span class=free>A2</span><span class=main>)</span> <span class=free>B</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>B1</span><span class=main>.</span> <span class=main>∃</span><span class=bound>B2</span><span class=main>.</span> <span class=free>B</span> <span class=main>⊆</span> <span class=bound>B1</span> <span class=main>∪</span> <span class=bound>B2</span> <span class=main>∧</span> surj_on <span class=free>f</span> <span class=free>A1</span> <span class=bound>B1</span> <span class=main>∧</span> surj_on <span class=free>f</span> <span class=free>A2</span> <span class=bound>B2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_image_conv
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=free>A1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=free>A2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-surj_on_diff_right><span class=command>lemma</span></span> surj_on_diff_right<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>⟹</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>(</span><span class=free>B</span> <span class=main>-</span> <span class=free>B'</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_empty_right><span class=command>lemma</span></span> surj_on_empty_right<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_empty_left><span class=command>lemma</span></span> surj_on_empty_left<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=main>{}</span> <span class=free>B</span> <span class=main>=</span> <span class=main>(</span><span class=free>B</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_imageI><span class=command>lemma</span></span> surj_on_imageI<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=main>(</span><span class=free>g</span> <span class=main>∘</span> <span class=free>f</span><span class=main>)</span> <span class=free>A</span> <span class=free>B</span> <span class=main>⟹</span> surj_on <span class=free>g</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetInterval2-surj_on_insert_right><span class=command>lemma</span></span> surj_on_insert_right<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>(</span>insert <span class=free>b</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>∧</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>{</span><span class=free>b</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_insert_left><span class=command>lemma</span></span> surj_on_insert_left<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> <span class=main>(</span>insert <span class=free>a</span> <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>=</span> <span class=main>(</span>surj_on <span class=free>f</span> <span class=free>A</span> <span class=main>(</span><span class=free>B</span> <span class=main>-</span> <span class=main>{</span><span class=free>f</span> <span class=free>a</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_subset_right><span class=command>lemma</span></span> surj_on_subset_right<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>;</span> <span class=free>B'</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B'</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-surj_on_subset_left><span class=command>lemma</span></span> surj_on_subset_left<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>A'</span> <span class=main>⟧</span> <span class=main>⟹</span> surj_on <span class=free>f</span> <span class=free>A'</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> surj_on_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-bij_betw_imp_surj_on><span class=command>lemma</span></span> bij_betw_imp_surj_on<span class=main>:</span> <span class=quoted><span class=quoted>"bij_betw <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>⟹</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> bij_betw_def surj_on_image_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetInterval2-bij_betw_inj_on_surj_on_conv><span class=command>lemma</span></span> bij_betw_inj_on_surj_on_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  bij_betw <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>=</span> <span class=main>(</span>inj_on <span class=free>f</span> <span class=free>A</span> <span class=main>∧</span> surj_on <span class=free>f</span> <span class=free>A</span> <span class=free>B</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> bij_betw_def surj_on_image_conv <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Induction over natural sets›</span></span>

<span class=keyword1 id=SetInterval2-image_nat_induct><span class=command>lemma</span></span> image_nat_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>0</span><span class=main>)</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> surj_on <span class=free>f</span> UNIV <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> as_P0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>0</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span>  as_IA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span>  as_surj_f<span class=main>:</span> <span class=quoted><span class=quoted>"surj_on <span class=free>f</span> UNIV <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span>  as_a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> P_n<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper>n</span></span></span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> as_P0<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> as_IA<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_surj_f
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> surj_on_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>a</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>n</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_a <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> P_n <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="SetInterval2-nat_induct'"><span class=command>lemma</span></span> nat_induct'<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=free>n0</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>n0</span> <span class=main>≤</span> <span class=bound>n</span><span class=main>;</span>  <span class=free>P</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n0</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> nat_induct<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>n</span></span></span><span class=main><span class=main><span class=main>-</span></span></span><span class=free><span class=free><span class=free>n0</span></span></span>"</span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>λ</span></span></span><span class=bound><span class=bound><span class=bound>n</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>P</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>n0</span></span></span><span class=main><span class=main><span class=main>+</span></span></span><span class=bound><span class=bound><span class=bound>n</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-enat_induct><span class=command>lemma</span></span> enat_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>0</span><span class=main>;</span> <span class=free>P</span> <span class=main>∞</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>eSuc <span class=bound>n</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> enat_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper>n1</span></span></span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> enat.splits<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetInterval2-eSuc_imp_Suc_aux_0><span class=command>lemma</span></span> eSuc_imp_Suc_aux_0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>eSuc <span class=bound>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n0'</span> <span class=main>≤</span> <span class=free>n'</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>enat <span class=free>n'</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>enat <span class=main>(</span>Suc <span class=free>n'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> enat_defs enat.splits<span class=main>)</span>

<span class=keyword1 id=SetInterval2-eSuc_imp_Suc_aux_n0><span class=command>lemma</span></span> eSuc_imp_Suc_aux_n0<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span>enat <span class=free>n0'</span> <span class=main>≤</span> <span class=bound>n</span><span class=main>;</span> <span class=free>P</span> <span class=bound>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>eSuc <span class=bound>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n0'</span> <span class=main>≤</span> <span class=free>n'</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>enat <span class=free>n'</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>enat <span class=main>(</span>Suc <span class=free>n'</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>assume</span></span> IA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span>enat <span class=free>n0'</span> <span class=main>≤</span> <span class=bound>n</span><span class=main>;</span> <span class=free>P</span> <span class=bound>n</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>eSuc <span class=bound>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> n0_n<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n0'</span> <span class=main>≤</span> <span class=free>n'</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> Pn<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>enat <span class=free>n'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> n0_n
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>enat <span class=free>n0'</span> <span class=main>≤</span> enat <span class=free>n'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>with</span></span> Pn IA
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>eSuc <span class=main>(</span>enat <span class=free>n'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>enat <span class=main>(</span>Suc <span class=free>n'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="SetInterval2-enat_induct'"><span class=command>lemma</span></span> enat_induct'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>n0</span><span class=main>::</span>enat<span class=main>)</span><span class=main>;</span> <span class=free>P</span> <span class=main>∞</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>n0</span> <span class=main>≤</span> <span class=bound>n</span><span class=main>;</span>  <span class=free>P</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>eSuc <span class=bound>n</span><span class=main>)</span><span class=main>;</span> <span class=free>n0</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n0</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n' n0'<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> <span class=var>?n0.0</span><span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>n0'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n'</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> P<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>enat <span class=bound>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> nat_induct'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-wf_less_interval><span class=command>lemma</span></span> wf_less_interval<span class=main>:</span><span class=quoted><span class=quoted>"
  wf <span class=main>{</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span><span class=free>I</span><span class=main>::</span>nat set<span class=main>)</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> wf_subset<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span>
  p<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span> <span class=main><span class=main>(</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>,</span></span><span class=bound><span class=bound>y</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>I</span></span> <span class=main><span class=main>∧</span></span> <span class=bound><span class=bound>y</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>I</span></span> <span class=main><span class=main>∧</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>&lt;</span></span> <span class=bound><span class=bound>y</span></span> <span class=main><span class=main>}</span></span>"</span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span>
  r<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span><span class=main><span class=main>(</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>,</span></span><span class=bound><span class=bound>y</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>&lt;</span></span> <span class=bound><span class=bound>y</span></span><span class=main><span class=main>}</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> wf_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-interval_induct><span class=command>lemma</span></span> interval_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>∈</span><span class=main>(</span><span class=free>I</span><span class=main>::</span>nat set<span class=main>)</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=free>a</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=var>?IA</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>a</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> r<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> wf_induct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> wf_less_interval<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> interval_induct_rule<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>⋀</span><span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>∈</span><span class=main>(</span><span class=free>I</span><span class=main>::</span>nat set<span class=main>)</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> interval_induct<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Monotonicity and injectivity of artithmetic operators›</span></span>

<span class=keyword1 id=SetInterval2-add_left_inj><span class=command>lemma</span></span> add_left_inj<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>cancel_ab_semigroup_add<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-add_right_inj><span class=command>lemma</span></span> add_right_inj<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>cancel_ab_semigroup_add<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-mult_left_inj><span class=command>lemma</span></span> mult_left_inj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> inj <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>*</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-mult_right_inj><span class=command>lemma</span></span> mult_right_inj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> inj <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>*</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-sub_left_inj_on><span class=command>lemma</span></span> sub_left_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>{</span><span class=free>k</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inj_onI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-sub_right_inj_on><span class=command>lemma</span></span> sub_right_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>k</span> <span class=main>-</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>{..</span><span class=free>k</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inj_onI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-add_left_strict_mono><span class=command>lemma</span></span> add_left_strict_mono<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>n</span> <span class=main>+</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_cancel_ab_semigroup_add<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> add_strict_left_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-add_right_strict_mono><span class=command>lemma</span></span> add_right_strict_mono<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>ordered_cancel_ab_semigroup_add<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> add_strict_right_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-mult_left_strict_mono><span class=command>lemma</span></span> mult_left_strict_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> strict_mono <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-mult_right_strict_mono><span class=command>lemma</span></span> mult_right_strict_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> strict_mono <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>*</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-sub_left_strict_mono_on><span class=command>lemma</span></span> sub_left_strict_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>{</span><span class=free>k</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> strict_mono_on_mono_on_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mono_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sub_left_inj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-div_right_strict_mono_on><span class=command>lemma</span></span> div_right_strict_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>⟶</span> <span class=bound>x</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  strict_mono_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>div</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> div_le_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>k</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-mod_eq_div_right_strict_mono_on><span class=command>lemma</span></span> mod_eq_div_right_strict_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=bound>y</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  strict_mono_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>div</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_right_strict_mono_on<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> less_mod_eq_imp_add_divisor_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> div_right_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>⟶</span> <span class=bound>x</span> <span class=main>+</span> <span class=free>k</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>div</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> strict_mono_on_imp_inj_on<span class=main><span class=main>[</span></span><span class=operator>OF</span> div_right_strict_mono_on<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> mod_eq_imp_div_right_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>;</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>=</span> <span class=bound>y</span> <span class=keyword1>mod</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=keyword1>div</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> strict_mono_on_imp_inj_on<span class=main><span class=main>[</span></span><span class=operator>OF</span> mod_eq_div_right_strict_mono_on<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Min›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Max›</span></span></span></span> elements of a set›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A special minimum operator is required for dealing with infinite wellordered sets
  because the standard operator <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"Min"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is usable only with finite sets.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>iMin</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>wellorder set <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>iMin</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> <span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic results, as for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Least›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetInterval2-iMinI><span class=command>lemma</span></span> iMinI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iMin_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=free>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> LeastI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMinI_ex><span class=command>lemma</span></span> iMinI_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span>  iMinI_ex2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMinI2><span class=command>lemma</span></span> iMinI2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMinI2_ex><span class=command>lemma</span></span> iMinI2_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMinI2_ex2><span class=command>lemma</span></span> iMinI2_ex2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_le><span class=command>lemma</span></span> iMin_le<span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> iMin_def Least_le<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_neq_imp_greater><span class=command>lemma</span></span> iMin_neq_imp_greater<span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>≠</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_neq_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> not_sym iMin_le<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_mono><span class=command>lemma</span></span> iMin_mono<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> mono <span class=free>f</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iMin_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>f</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iMin_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> mono <span class=free>f</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-not_less_iMin><span class=command>lemma</span></span> not_less_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> iMin <span class=free>I</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>∉</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iMin_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> not_less_Least<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Collect_not_less_iMin><span class=command>lemma</span></span> Collect_not_less_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> iMin <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> not_less_iMin<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Collect_iMin_le><span class=command>lemma</span></span> Collect_iMin_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>k</span> <span class=main>⟹</span> iMin <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_le<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Collect_minI><span class=command>lemma</span></span> Collect_minI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=main>{</span><span class=bound><span class=bound>y</span></span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>y</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ iMinI<span class=main><span class=main>,</span></span> <span class=operator>OF</span> Collect_is_subset<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> Collect_minI_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> bexE<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Collect_minI<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> Collect_minI_ex2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound><span class=bound>k</span></span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> ex_in_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Collect_minI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_the><span class=command>lemma</span></span> iMin_the<span class=main>:</span>  <span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟶</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_def Least_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_the2><span class=command>lemma</span></span> iMin_the2<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_the<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟶</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span><span class=main>)</span> "</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-iMin_equality><span class=command>lemma</span></span> iMin_equality<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iMin_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Least_equality<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_mono_on><span class=command>lemma</span></span> iMin_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> mono_on <span class=free>f</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-iMin_mono_on2><span class=command>lemma</span></span> iMin_mono_on2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> mono_on <span class=free>f</span> <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_mono_on<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMinI2_order><span class=command>lemma</span></span> iMinI2_order<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> <span class=bound>y</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>P</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_def LeastI2_order<span class=main>)</span>

<span class=keyword1 id=SetInterval2-wellorder_iMin_lemma><span class=command>lemma</span></span> wellorder_iMin_lemma<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI iMin_le<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_Min_conv><span class=command>lemma</span></span> iMin_Min_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>=</span> Min <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_antisym<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Min_ge_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Min_le_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Min_neq_imp_greater><span class=command>lemma</span></span> Min_neq_imp_greater<span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>≠</span> Min <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> Min <span class=free>I</span> <span class=main>&lt;</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_neq_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> not_sym Min_le<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_neq_imp_less><span class=command>lemma</span></span> Max_neq_imp_less<span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>&lt;</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> order_neq_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Max_ge<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-nat_Least_mono><span class=command>lemma</span></span> nat_Least_mono<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> mono <span class=main>(</span><span class=free>f</span><span class=main>::</span><span class=main>(</span>nat<span class=main>⇒</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iMin_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_mono2<span class=main>)</span>


<span class=keyword1 id=SetInterval2-Least_disj><span class=command>lemma</span></span> Least_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>P</span> <span class=bound>x</span> <span class=main>∨</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> min <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>elim</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x1 x2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x1</span> <span class=bound>x2</span> <span class=bound>P</span> <span class=bound>Q</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>P</span> <span class=bound>x1</span><span class=main>;</span> <span class=bound>Q</span> <span class=bound>x2</span><span class=main>;</span> Least <span class=bound>P</span> <span class=main>≤</span> Least <span class=bound>Q</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>x</span> <span class=main>∨</span> <span class=bound>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> Least <span class=bound>P</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> LeastI Least_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> min_def<span class=main><span class=keyword3>,</span></span> <span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> disj_commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Least_imp_le><span class=command>lemma</span></span> Least_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Least_le LeastI2_ex<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Least_imp_disj_eq><span class=command>lemma</span></span> Least_imp_disj_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∨</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>x</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Least_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> min.commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min.absorb_iff1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Least_imp_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Least_le_imp_le><span class=command>lemma</span></span> Least_le_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=free>Q</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> LeastI<span class=main>)</span>
<span class=keyword1 id=SetInterval2-Least_le_imp_le_disj><span class=command>lemma</span></span> Least_le_imp_le_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> <span class=free>Q</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>≤</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∨</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=main>(</span><span class=bound>x</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Least_disj min.absorb_iff1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>OF</span> Least_le_imp_le<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetInterval2-Max_equality><span class=command>lemma</span></span> Max_equality<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Max <span class=free>A</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_eqI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-not_greater_Max><span class=command>lemma</span></span> not_greater_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span>  <span class=main>⟹</span> <span class=free>k</span> <span class=main>∉</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Collect_not_greater_Max><span class=command>lemma</span></span> Collect_not_greater_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>;</span> Max <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> not_greater_Max<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> Collect_not_in_imp_not<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Collect_Max_ge><span class=command>lemma</span></span> Collect_Max_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>;</span> <span class=free>P</span> <span class=free>k</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>≤</span> Max <span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_ge<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> CollectI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI><span class=command>lemma</span></span> MaxI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI_ex><span class=command>lemma</span></span> MaxI_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI_ex2><span class=command>lemma</span></span> MaxI_ex2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI<span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI2><span class=command>lemma</span></span> MaxI2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> Max_in<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI2_ex><span class=command>lemma</span></span> MaxI2_ex<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI2_ex2><span class=command>lemma</span></span> MaxI2_ex2<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_mono><span class=command>lemma</span></span> Max_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> mono <span class=free>f</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mono_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_in<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Max_mono2><span class=command>lemma</span></span> Max_mono2<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>⟦</span> mono <span class=free>f</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_mono_on><span class=command>lemma</span></span> Max_mono_on<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> finite_imageI<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in Max_ge<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Max_mono_on2><span class=command>lemma</span></span> Max_mono_on2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_mono_on<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_the><span class=command>lemma</span></span> Max_the<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Max <span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffD1<span class=main><span class=main>[</span></span><span class=operator>OF</span> eq_commute<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Max_the2><span class=command>lemma</span></span> Max_the2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Max <span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>y</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_the<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>y</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span> "</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-wellorder_Max_lemma><span class=command>lemma</span></span> wellorder_Max_lemma<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=free>k</span> <span class=main>≤</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-MaxI2_order><span class=command>lemma</span></span> MaxI2_order<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> finite <span class=free>A</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=bound>y</span> <span class=main>≤</span> <span class=free>k</span><span class=main>;</span>
  <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>y</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_equality<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Min_le_Max><span class=command>lemma</span></span> Min_le_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> Min <span class=free>A</span> <span class=main>≤</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Min_in<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_le_Max><span class=command>lemma</span></span> iMin_le_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>A</span> <span class=main>≤</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ssubst<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMin_Min_conv<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Min_le_Max<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Max›</span></span></span></span> for sets over <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>enat›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>iMax</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set <span class=main>⇒</span> enat"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>iMax</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> <span class=main>(</span>finite <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span> <span class=keyword1>then</span> <span class=main>(</span>enat <span class=main>(</span>Max <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>∞</span>"</span></span>

<span class=keyword1 id=SetInterval2-iMax_finite_conv><span class=command>lemma</span></span> iMax_finite_conv<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>=</span> <span class=main>(</span>iMax <span class=free>I</span> <span class=main>≠</span> <span class=main>∞</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMax_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMax_infinite_conv><span class=command>lemma</span></span> iMax_infinite_conv<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>=</span> <span class=main>(</span>iMax <span class=free>I</span> <span class=main>=</span> <span class=main>∞</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMax_def<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"class.distrib_lattice <span class=main>(</span>min<span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span><span class=main>)</span><span class=main>)</span> <span class=main>(≤)</span> <span class=main>(&lt;)</span> max"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"class.order <span class=main>(≤)</span> <span class=main>(&lt;)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.order.intro<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.preorder.intro<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_not_le<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_refl<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.order_axioms.intro<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_antisym<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"class.linorder <span class=main>(≤)</span> <span class=main>(&lt;)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.linorder.intro<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.linorder_axioms.intro<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> linorder_class.linear<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.distrib_lattice.intro<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.lattice.intro<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.semilattice_inf.intro<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.semilattice_inf_axioms.intro<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_minI1<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_minI2<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conj_le_imp_min<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.semilattice_sup.intro<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.semilattice_sup_axioms.intro<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> max.cobounded1<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> max.cobounded2<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conj_le_imp_max<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.distrib_lattice_axioms.intro<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> max_min_distrib2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>print_locale</span></span> Lattices.distrib_lattice

<span class=keyword1 id=SetInterval2-max_Min_eq_Min_max><span class=command>lemma</span></span> max_Min_eq_Min_max<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>A</span> <span class=main>⟹</span>
  <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟶</span>
  max <span class=free>x</span> <span class=main>(</span>Min <span class=free>A</span><span class=main>)</span> <span class=main>=</span> Min <span class=main>{</span>max <span class=free>x</span> <span class=bound>a</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> finite.induct<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> insert_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> A1 a<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>A1</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span>max <span class=free>x</span> <span class=bound>b</span> <span class=main>|</span><span class=bound>b</span><span class=main>.</span> <span class=bound>b</span> <span class=main>∈</span> insert <span class=improper>a</span> <span class=improper>A1</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"insert <span class=main>(</span>max <span class=free>x</span> <span class=improper>a</span><span class=main>)</span> <span class=main>{</span>max <span class=free>x</span> <span class=bound>b</span> <span class=main>|</span><span class=bound>b</span><span class=main>.</span> <span class=bound>b</span> <span class=main>∈</span> <span class=improper>A1</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Min_insert<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a</span> <span class=main>≤</span> Min <span class=improper>A1</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> max_le_monoR<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> min_eqL<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> max_le_monoR<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> less_imp_le<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-max_iMin_eq_iMin_max><span class=command>lemma</span></span> max_iMin_eq_iMin_max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  max <span class=free>x</span> <span class=main>(</span>iMin <span class=free>A</span><span class=main>)</span> <span class=main>=</span> iMin <span class=main>{</span>max <span class=free>x</span> <span class=bound>a</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Min_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> iMin_Min_conv<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span>max <span class=free><span class=free>x</span></span> <span class=bound><span class=bound>a</span></span> <span class=main><span class=main>|</span></span><span class=bound><span class=bound>a</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>a</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>A</span></span><span class=main><span class=main>}</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"finite <span class=main>{</span>max <span class=free>x</span> <span class=bound>a</span> <span class=main>|</span><span class=bound>a</span><span class=main>.</span> <span class=bound>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> max_Min_eq_Min_max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span><span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Min›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Max›</span></span></span></span> for set operations›</span></span>

<span class=keyword1 id=SetInterval2-iMin_subset><span class=command>lemma</span></span> iMin_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>B</span> <span class=main>≤</span> iMin <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_le iMinI_ex2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_subset><span class=command>lemma</span></span> Max_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>≤</span> Max <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> linorder_class.Max_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Min_subset><span class=command>lemma</span></span> Min_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> Min <span class=free>B</span> <span class=main>≤</span> Min <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> linorder_class.Min_antimono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_Int_ge1><span class=command>lemma</span></span> iMin_Int_ge1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=free>A</span> <span class=main>≤</span> iMin <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_subset<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Int_lower1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_Int_ge2><span class=command>lemma</span></span> iMin_Int_ge2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=free>B</span> <span class=main>≤</span> iMin <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_subset<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Int_lower2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_Int_ge><span class=command>lemma</span></span> iMin_Int_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> max <span class=main>(</span>iMin <span class=free>A</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> iMin <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conj_le_imp_max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_Int_ge1<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_Int_ge2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Max_Int_le1><span class=command>lemma</span></span> Max_Int_le1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_subset<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Int_lower1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_Int_le2><span class=command>lemma</span></span> Max_Int_le2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Max <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_subset<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Int_lower2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_Int_le><span class=command>lemma</span></span> Max_Int_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Max <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> min <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conj_le_imp_min<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_Int_le1<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_Int_le2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>





<span class=keyword1 id=SetInterval2-iMin_Un><span class=command>lemma</span></span> iMin_Un<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iMin <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> min <span class=main>(</span>iMin <span class=free>A</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_antisym<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_subset<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_le_iff_disj<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> iMinI_ex2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>A</span></span><span class=main><span class=main>∪</span></span><span class=free><span class=free>B</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-iMin_singleton><span class=command>lemma</span></span> iMin_singleton<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> singletonI<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iMinI<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> singletonD<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMax_singleton><span class=command>lemma</span></span> iMax_singleton<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"iMax <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> enat <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMax_def<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_le_Min_imp_singleton><span class=command>lemma</span></span> Max_le_Min_imp_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>≤</span> Min <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span>Min <span class=free>A</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_le_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"Min <span class=free><span class=free>A</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Min_ge_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"Min <span class=free><span class=free>A</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> Ball_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_antisym Min_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetInterval2-Max_le_Min_conv_singleton><span class=command>lemma</span></span> Max_le_Min_conv_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>Max <span class=free>A</span> <span class=main>≤</span> Min <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Min <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_le_Min_imp_singleton<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1 id=SetInterval2-Max_le_iMin_imp_le><span class=command>lemma</span></span> Max_le_iMin_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>≤</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_ge <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_trans<span class=main>)</span>

<span class=keyword1 id=SetInterval2-le_imp_Max_le_iMin><span class=command>lemma</span></span> le_imp_Max_le_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≤</span> <span class=bound>b</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>≤</span> iMin <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in iMinI_ex2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_le_iMin_conv_le><span class=command>lemma</span></span> Max_le_iMin_conv_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>Max <span class=free>A</span> <span class=main>≤</span> iMin <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≤</span> <span class=bound>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_le_iMin_imp_le le_imp_Max_le_iMin<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_less_iMin_imp_less><span class=command>lemma</span></span> Max_less_iMin_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_less_iff <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_less_le_trans iMin_le<span class=main>)</span>

<span class=keyword1 id=SetInterval2-less_imp_Max_less_iMin><span class=command>lemma</span></span> less_imp_Max_less_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=bound>b</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in iMinI_ex2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_less_iMin_conv_less><span class=command>lemma</span></span> Max_less_iMin_conv_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∀</span><span class=bound>b</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=bound>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_less_iMin_imp_less less_imp_Max_less_iMin<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_less_iMin_imp_disjoint><span class=command>lemma</span></span> Max_less_iMin_imp_disjoint<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjoint_iff_not_equal<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> ballI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_less_iMin_imp_less<span class=main>)</span>


<span class=keyword1 id=SetInterval2-iMin_in_idem><span class=command>lemma</span></span> iMin_in_idem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> min <span class=free>n</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_le min_eqR<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_insert><span class=command>lemma</span></span> iMin_insert<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=main>(</span>insert <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> min <span class=free>n</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> insert_is_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iMin_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-iMin_insert_remove><span class=command>lemma</span></span> iMin_insert_remove<span class=main>:</span> <span class=quoted><span class=quoted>"
  iMin <span class=main>(</span>insert <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span> <span class=keyword1>then</span> <span class=free>n</span> <span class=keyword1>else</span> min <span class=free>n</span> <span class=main>(</span>iMin <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iMin_insert iMin_singleton insert_Diff_single<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_remove><span class=command>lemma</span></span> iMin_remove<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span> <span class=keyword1>then</span> <span class=free>n</span> <span class=keyword1>else</span> min <span class=free>n</span> <span class=main>(</span>iMin <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iMin_insert_remove insert_absorb<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_subset_idem><span class=command>lemma</span></span> iMin_subset_idem<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> min <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>A</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iMin_subset min.absorb2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_union_inter><span class=command>lemma</span></span> iMin_union_inter<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> min <span class=main>(</span>iMin <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>iMin <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> min <span class=main>(</span>iMin <span class=free>A</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Int_empty_left Int_lower2 Un_absorb2 Un_assoc Un_empty iMin_Un<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_ge_iff><span class=command>lemma</span></span> iMin_ge_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>≤</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Collect_iMin_le Collect_mem_eq iMinI_ex2 order_trans<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_gr_iff><span class=command>lemma</span></span> iMin_gr_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iMinI_ex2 iMin_neq_imp_greater order_less_trans<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_le_iff><span class=command>lemma</span></span> iMin_le_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span>iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Collect_iMin_le Collect_mem_eq iMinI_ex2 order_trans<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_less_iff><span class=command>lemma</span></span> iMin_less_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span>iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iMinI_ex2 iMin_neq_imp_greater order_less_trans<span class=main>)</span>

<span class=keyword1 id=SetInterval2-hom_iMin_commute><span class=command>lemma</span></span> hom_iMin_commute<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>h</span> <span class=main>(</span>min <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> min <span class=main>(</span><span class=free>h</span> <span class=bound>x</span><span class=main>)</span> <span class=main>(</span><span class=free>h</span> <span class=bound>y</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>h</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>h</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> y<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> image_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>h</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"min <span class=main>(</span><span class=free>h</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>h</span> <span class=improper>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqL<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMin_le<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Synonyms for similarity with theorem names for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>Min</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>"›</span></span>

<span class=keyword1><span class=command>lemmas</span></span> iMin_eqI <span class=main>=</span> iMin_equality

<span class=keyword1><span class=command>lemmas</span></span> iMin_in <span class=main>=</span> iMinI_ex2


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for set operations›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some additional abbreviations for relations›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Abbreviations for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>refl›</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>sym›</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>equiv›</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>refl›</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>trans›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>reflP</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>reflP</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>≡</span> refl <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>x</span> <span class=bound>y</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>symP</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>=&gt;</span> <span class=tfree>'a</span> <span class=main>=&gt;</span> bool<span class=main>)</span> <span class=main>=&gt;</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>symP</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>==</span> sym <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>x</span> <span class=bound>y</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>transP</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>=&gt;</span> <span class=tfree>'a</span> <span class=main>=&gt;</span> bool<span class=main>)</span> <span class=main>=&gt;</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>transP</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>==</span> trans <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>x</span> <span class=bound>y</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>equivP</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>equivP</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>≡</span> reflP <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>∧</span> symP <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>∧</span> transp <span class=free><span class=bound><span class=entity>r</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=main>(</span>input<span class=main>)</span> <span class=entity>irreflP</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>irreflP</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>≡</span> irrefl <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=bound>x</span> <span class=bound>y</span><span class=main>}</span>"</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Example for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>reflP›</span></span></span></span>›</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"reflP <span class=main>(</span><span class=main>(≤)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>preorder <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> refl_on_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Example for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>symP›</span></span></span></span>›</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"symP <span class=main>(=)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sym_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Example for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>equivP›</span></span></span></span>›</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"equivP <span class=main>(=)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_def refl_on_def sym_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Example for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>irreflP›</span></span></span></span>›</span></span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"irreflP <span class=main>(</span><span class=main>(&lt;)</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>preorder <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> irrefl_def<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>singletons›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetInterval2-singleton_not_empty><span class=command>lemma</span></span> singleton_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-singleton_finite><span class=command>lemma</span></span> singleton_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>{</span><span class=free>a</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-singleton_ball><span class=command>lemma</span></span> singleton_ball<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=free>a</span><span class=main>}</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-singleton_bex><span class=command>lemma</span></span> singleton_bex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=free>a</span><span class=main>}</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-subset_singleton_conv><span class=command>lemma</span></span> subset_singleton_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>∨</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-singleton_subset_conv><span class=command>lemma</span></span> singleton_subset_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-singleton_eq_conv><span class=command>lemma</span></span> singleton_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>b</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-singleton_subset_singleton_conv><span class=command>lemma</span></span> singleton_subset_singleton_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{</span><span class=free>b</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-singleton_Int1_if><span class=command>lemma</span></span> singleton_Int1_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>∩</span> <span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-singleton_Int2_if><span class=command>lemma</span></span> singleton_Int2_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∩</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-singleton_image><span class=command>lemma</span></span> singleton_image<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>`</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>f</span> <span class=free>a</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-inj_on_singleton><span class=command>lemma</span></span> inj_on_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-strict_mono_on_singleton><span class=command>lemma</span></span> strict_mono_on_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"strict_mono_on <span class=free>f</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> strict_mono_on_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>finite›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>infinite›</span></span></span></span> sets›</span></span>

<span class=keyword1 id=SetInterval2-infinite_imp_not_singleton><span class=command>lemma</span></span> infinite_imp_not_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-infinite_insert><span class=command>lemma</span></span> infinite_insert<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>insert <span class=free>a</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> infinite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetInterval2-infinite_Diff_insert><span class=command>lemma</span></span> infinite_Diff_insert<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span><span class=free>A</span> <span class=main>-</span> insert <span class=free>a</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> infinite <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetInterval2-subset_finite_imp_finite><span class=command>lemma</span></span> subset_finite_imp_finite<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> finite <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main>)</span>

<span class=keyword1 id=SetInterval2-infinite_not_subset_finite><span class=command>lemma</span></span> infinite_not_subset_finite<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> infinite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>¬</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subset_finite_imp_finite<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Un_infinite_right><span class=command>lemma</span></span> Un_infinite_right<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>T</span> <span class=main>⟹</span> infinite <span class=main>(</span><span class=free>S</span> <span class=main>∪</span> <span class=free>T</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-Un_infinite_iff><span class=command>lemma</span></span> Un_infinite_iff<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span><span class=free>S</span> <span class=main>∪</span> <span class=free>T</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>infinite <span class=free>S</span> <span class=main>∨</span> infinite <span class=free>T</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Give own name to the lemma about finiteness of the integer image of a nat set›</span></span>
<span class=keyword1><span class=command>corollary</span></span> finite_A_int_A_conv<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>=</span> finite <span class=main>(</span>int <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inj_on int <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inj_onI<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> finite_image_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Corresponding fact fo infinite sets›</span></span>
<span class=keyword1><span class=command>corollary</span></span> infinite_A_int_A_conv<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span> <span class=main>=</span> infinite <span class=main>(</span>int <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> finite_A_int_A_conv<span class=main>)</span>


<span class=keyword1 id=SetInterval2-cartesian_product_infiniteL_imp_infinite><span class=command>lemma</span></span> cartesian_product_infiniteL_imp_infinite<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> infinite <span class=free>A</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> infinite <span class=main>(</span><span class=free>A</span> <span class=main>×</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_cartesian_productD1<span class=main>)</span>

<span class=keyword1 id=SetInterval2-cartesian_product_infiniteR_imp_infinite><span class=command>lemma</span></span> cartesian_product_infiniteR_imp_infinite<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> infinite <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> infinite <span class=main>(</span><span class=free>A</span> <span class=main>×</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> finite_cartesian_productD2<span class=main>)</span>

<span class=keyword1 id=SetInterval2-finite_nat_iff_bounded2><span class=command>lemma</span></span> finite_nat_iff_bounded2<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>S</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=main>(</span><span class=bound>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>.</span><span class=main>∀</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> finite_nat_iff_bounded<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-finite_nat_iff_bounded_le2><span class=command>lemma</span></span> finite_nat_iff_bounded_le2<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>S</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=main>(</span><span class=bound>k</span><span class=main>::</span>nat<span class=main>)</span><span class=main>.</span><span class=main>∀</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>n</span> <span class=main>≤</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> finite_nat_iff_bounded_le<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-nat_asc_chain_imp_unbounded><span class=command>lemma</span></span> nat_asc_chain_imp_unbounded<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>S</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>m</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>m</span> <span class=main>≤</span> <span class=bound>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> allI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct_tac</span> <span class=quoted><span class=improper><span class=quoted><span class=improper>m</span></span></span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> bexE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ballE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-infinite_nat_iff_asc_chain><span class=command>lemma</span></span> infinite_nat_iff_asc_chain<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>S</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> infinite <span class=free>S</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Max_in infinite_nat_iff_unbounded not_greater_Max<span class=main>)</span>

<span class=keyword1 id=SetInterval2-infinite_imp_asc_chain><span class=command>lemma</span></span> infinite_imp_asc_chain<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>S</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>m</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>S</span><span class=main>.</span> <span class=bound>m</span> <span class=main>&lt;</span> <span class=main>(</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> infinite_nat_iff_asc_chain<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>OF</span> infinite_imp_nonempty<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1 id=SetInterval2-infinite_image_imp_infinite><span class=command>lemma</span></span> infinite_image_imp_infinite<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>⟹</span> infinite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetInterval2-inj_on_imp_infinite_image><span class=command>lemma</span></span> inj_on_imp_infinite_image<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> infinite <span class=free>A</span><span class=main>;</span> inj_on <span class=free>f</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> infinite <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> card_eq_0_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-inj_on_infinite_image_iff><span class=command>lemma</span></span> inj_on_infinite_image_iff<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=free>A</span> <span class=main>⟹</span> infinite <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> infinite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_imp_infinite_image<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-inj_on_finite_image_iff><span class=command>lemma</span></span> inj_on_finite_image_iff<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=free>A</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> finite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> inj_on_infinite_image_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-nat_ex_greater_finite_Max_conv><span class=command>lemma</span></span> nat_ex_greater_finite_Max_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>finite <span class=free>A</span> <span class=main>⟶</span> <span class=free>n</span> <span class=main>&lt;</span> Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_less_le_trans Max_ge<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> infinite_nat_iff_unbounded<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_ex_greater_infinite_finite_Max_conv'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>finite <span class=free>A</span> <span class=main>∧</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> Max <span class=free>A</span> <span class=main>∨</span> infinite <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> nat_ex_greater_finite_Max_conv<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for disjoint sets›</span></span>

<span class=keyword1 id=SetInterval2-disjoint_iff_in_not_in1><span class=command>lemma</span></span> disjoint_iff_in_not_in1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∉</span> <span class=free>B</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetInterval2-disjoint_iff_in_not_in2><span class=command>lemma</span></span> disjoint_iff_in_not_in2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>B</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∉</span> <span class=free>A</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-disjoint_in_Un><span class=command>lemma</span></span> disjoint_in_Un<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∪</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>A</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> disjoint_iff_in_not_in1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1 id=SetInterval2-partition_Union><span class=command>lemma</span></span> partition_Union<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=main>⋃</span><span class=free>C</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>c</span><span class=main>∈</span><span class=free>C</span><span class=main>.</span> <span class=free>A</span> <span class=main>∩</span> <span class=bound>c</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetInterval2-disjoint_partition_Int><span class=command>lemma</span></span> disjoint_partition_Int<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>∀</span><span class=bound>c1</span><span class=main>∈</span><span class=free>C</span><span class=main>.</span> <span class=main>∀</span><span class=bound>c2</span><span class=main>∈</span><span class=free>C</span><span class=main>.</span> <span class=bound>c1</span> <span class=main>≠</span> <span class=bound>c2</span> <span class=main>⟶</span> <span class=bound>c1</span> <span class=main>∩</span> <span class=bound>c2</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟹</span>
  <span class=main>∀</span><span class=bound>a1</span><span class=main>∈</span><span class=main>{</span><span class=free>A</span> <span class=main>∩</span> <span class=bound>c</span><span class=main>|</span> <span class=bound>c</span><span class=main>.</span> <span class=bound>c</span> <span class=main>∈</span> <span class=free>C</span><span class=main>}</span><span class=main>.</span> <span class=main>∀</span><span class=bound>a2</span><span class=main>∈</span><span class=main>{</span><span class=free>A</span> <span class=main>∩</span> <span class=bound>c</span><span class=main>|</span> <span class=bound>c</span><span class=main>.</span> <span class=bound>c</span> <span class=main>∈</span> <span class=free>C</span><span class=main>}</span><span class=main>.</span>
    <span class=bound>a1</span> <span class=main>≠</span> <span class=bound>a2</span> <span class=main>⟶</span> <span class=bound>a1</span> <span class=main>∩</span> <span class=bound>a2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>f</span> <span class=bound>x</span> <span class=main>|</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span><span class=main>}</span> <span class=main>=</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>{</span><span class=free>f</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹This lemma version drops the superfluous precondition <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"finite <span class=main><span class=main>(</span></span><span class=main><span class=main>⋃</span></span><span class=free><span class=free>C</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  (and turns the resulting equation to the sensible order <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>card .. = k * card ..›</span></span></span></span>).›</span></span>
<span class=keyword1 id=SetInterval2-card_partition><span class=command>lemma</span></span> card_partition<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>C</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>c</span><span class=main>.</span> <span class=bound>c</span> <span class=main>∈</span> <span class=free>C</span> <span class=main>⟹</span> card <span class=bound>c</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>c1</span> <span class=bound>c2</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>c1</span> <span class=main>∈</span> <span class=free>C</span><span class=main>;</span> <span class=bound>c2</span> <span class=main>∈</span> <span class=free>C</span><span class=main>;</span> <span class=bound>c1</span> <span class=main>≠</span> <span class=bound>c2</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>c1</span> <span class=main>∩</span> <span class=bound>c2</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  card <span class=main>(</span><span class=main>⋃</span><span class=free>C</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> card <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card.infinite card_partition finite_Union mult_eq_if<span class=main>)</span>



<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Some auxiliary results for subset relation›</span></span>

<span class=keyword1 id=SetInterval2-subset_image_Int><span class=command>lemma</span></span> subset_image_Int<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>f</span> <span class=main>`</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Int_absorb2 image_mono<span class=main>)</span>

<span class=keyword1 id=SetInterval2-image_diff_disjoint_image_Int><span class=command>lemma</span></span> image_diff_disjoint_image_Int<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>∩</span> <span class=free>f</span> <span class=main>`</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>f</span> <span class=main>`</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-subset_imp_Int_subset1><span class=command>lemma</span></span> subset_imp_Int_subset1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>C</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subset_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>C</span></span></span> <span class=main><span class=main><span class=main>∩</span></span></span> <span class=free><span class=free><span class=free>B</span></span></span>"</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> Int_mono<span class=main><span class=main>,</span></span> <span class=operator>OF</span> _ subset_refl Int_lower1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-subset_imp_Int_subset2><span class=command>lemma</span></span> subset_imp_Int_subset2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>⊆</span> <span class=free>C</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Int_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> subset_imp_Int_subset1<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for intervals from <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>SetInterval›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>lemmas</span></span> set_interval_defs <span class=main>=</span>
  lessThan_def atMost_def
  greaterThan_def atLeast_def
  greaterThanLessThan_def atLeastLessThan_def
  greaterThanAtMost_def atLeastAtMost_def

<span class=keyword1 id=SetInterval2-image_add_atLeast><span class=command>lemma</span></span> image_add_atLeast<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>.</span> <span class=bound>n</span><span class=main>+</span><span class=free>k</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=free>i</span><span class=main>..}</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>+</span><span class=free>k</span><span class=main>..}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=var>?B</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>⊆</span> <span class=var>?B</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>⊆</span> <span class=var>?A</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n</span> <span class=keyword3><span class=command>assume</span></span> a<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>:</span> <span class=var>?B</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>-</span> <span class=free>k</span> <span class=main>∈</span> <span class=main>{</span><span class=free>i</span><span class=main>..}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>+</span> <span class=free>k</span>"</span></span> <span class=keyword1><span class=command>using</span></span> a <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>n</span> <span class=main>∈</span> <span class=var>?A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SetInterval2-image_add_atMost><span class=command>lemma</span></span> image_add_atMost<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>::</span>nat<span class=main>.</span> <span class=bound>n</span><span class=main>+</span><span class=free>k</span><span class=main>)</span> <span class=main>`</span> <span class=main>{..</span><span class=free>i</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>k</span><span class=main>..</span><span class=free>i</span><span class=main>+</span><span class=free>k</span><span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=var>?B</span>"</span></span><span class=main>)</span>
  
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> s1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>i</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>i</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_interval_defs<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>=</span> <span class=var>?B</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> image_Suc_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>`</span> <span class=main>{</span><span class=free>i</span><span class=main>..}</span> <span class=main>=</span> <span class=main>{</span>Suc <span class=free>i</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> image_add_atLeast<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main><span class=main>0</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> image_Suc_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>`</span> <span class=main>{..</span><span class=free>i</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span>Suc <span class=main>0</span><span class=main>..</span>Suc <span class=free>i</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> image_add_atMost<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main><span class=main>0</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> image_add_lemmas <span class=main>=</span>
  image_add_atLeastAtMost
  image_add_atLeast
  image_add_atMost
<span class=keyword1><span class=command>lemmas</span></span> image_Suc_lemmas <span class=main>=</span>
  image_Suc_atLeastAtMost
  image_Suc_atLeast
  image_Suc_atMost

<span class=keyword1 id=SetInterval2-atMost_atLeastAtMost_0_conv><span class=command>lemma</span></span> atMost_atLeastAtMost_0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>i</span><span class=main>::</span>nat<span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>0</span><span class=main>..</span><span class=free>i</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_interval_defs<span class=main>)</span>

<span class=keyword1 id=SetInterval2-atLeastAtMost_subset_atMost><span class=command>lemma</span></span> atLeastAtMost_subset_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>order<span class=main>)</span> <span class=main>≤</span> <span class=free>k'</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>k</span><span class=main>}</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>k'</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-lessThan_insert><span class=command>lemma</span></span> lessThan_insert<span class=main>:</span> <span class=quoted><span class=quoted>"insert <span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>order<span class=main>)</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> order_le_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-greaterThan_insert><span class=command>lemma</span></span> greaterThan_insert<span class=main>:</span> <span class=quoted><span class=quoted>"insert <span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>order<span class=main>)</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> order_le_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-atMost_remove><span class=command>lemma</span></span> atMost_remove<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>-</span> <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>order<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> lessThan_insert<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Diff_insert_absorb<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-atLeast_remove><span class=command>lemma</span></span> atLeast_remove<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>-</span> <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>order<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> greaterThan_insert<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Diff_insert_absorb<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetInterval2-atMost_lessThan_conv><span class=command>lemma</span></span> atMost_lessThan_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=main>{..&lt;</span>Suc <span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atMost_def lessThan_def less_Suc_eq_le<span class=main>)</span>

<span class=keyword1 id=SetInterval2-atLeastAtMost_atLeastLessThan_conv><span class=command>lemma</span></span> atLeastAtMost_atLeastLessThan_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>..&lt;</span>Suc <span class=free>u</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeastAtMost_def atLeastLessThan_def atMost_lessThan_conv<span class=main>)</span>

<span class=keyword1 id=SetInterval2-atLeast_greaterThan_conv><span class=command>lemma</span></span> atLeast_greaterThan_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span>Suc <span class=free>n</span><span class=main>..}</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeast_def greaterThan_def Suc_le_eq<span class=main>)</span>

<span class=keyword1 id=SetInterval2-atLeastAtMost_greaterThanAtMost_conv><span class=command>lemma</span></span> atLeastAtMost_greaterThanAtMost_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span>Suc <span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>&lt;..</span><span class=free>u</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> greaterThanAtMost_def atLeastAtMost_def atLeast_greaterThan_conv<span class=main>)</span>



<span class=keyword1 id=SetInterval2-finite_subset_atLeastAtMost><span class=command>lemma</span></span> finite_subset_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>⊆</span> <span class=main>{</span>Min <span class=free>A</span><span class=main>..</span>Max <span class=free>A</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subset_eq<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_le_imp_subset_atMost><span class=command>lemma</span></span> Max_le_imp_subset_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span>  Max <span class=free>A</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subset_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_subset_atLeastAtMost atLeastAtMost_subset_atMost<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-subset_atMost_imp_Max_le><span class=command>lemma</span></span> subset_atMost_imp_Max_le<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=free>A</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subset_iff<span class=main>)</span>

<span class=keyword1 id=SetInterval2-subset_atMost_Max_le_conv><span class=command>lemma</span></span> subset_atMost_Max_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>A</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Max <span class=free>A</span> <span class=main>≤</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subset_atMost_imp_Max_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_le_imp_subset_atMost<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetInterval2-iMin_atLeast><span class=command>lemma</span></span> iMin_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_greaterThan><span class=command>lemma</span></span> iMin_greaterThan<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeast_Suc_greaterThan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iMin_atLeast<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_atMost><span class=command>lemma</span></span> iMin_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=main>{..</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_lessThan><span class=command>lemma</span></span> iMin_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=main>{..&lt;</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_atMost><span class=command>lemma</span></span> Max_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"Max <span class=main>{..</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ finite_atMost<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_lessThan><span class=command>lemma</span></span> Max_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Max <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ finite_lessThan<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_atLeastLessThan><span class=command>lemma</span></span> iMin_atLeastLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_atLeastLessThan><span class=command>lemma</span></span> Max_atLeastLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Max <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ finite_atLeastLessThan<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_imp_le_pred<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_greaterThanLessThan><span class=command>lemma</span></span> iMin_greaterThanLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> Suc <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeastSucLessThan_greaterThanLessThan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iMin_atLeastLessThan<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_greaterThanLessThan><span class=command>lemma</span></span> Max_greaterThanLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Max <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeastSucLessThan_greaterThanLessThan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> Max_atLeastLessThan<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_greaterThanAtMost><span class=command>lemma</span></span> iMin_greaterThanAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> Suc <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeastSucAtMost_greaterThanAtMost<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> atLeastLessThanSuc_atLeastAtMost<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iMin_atLeastLessThan<span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_greaterThanAtMost><span class=command>lemma</span></span> Max_greaterThanAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> Max <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeastSucAtMost_greaterThanAtMost<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> atLeastLessThanSuc_atLeastAtMost<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> Max_atLeastLessThan<span class=main>)</span>

<span class=keyword1 id=SetInterval2-iMin_atLeastAtMost><span class=command>lemma</span></span> iMin_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-Max_atLeastAtMost><span class=command>lemma</span></span> Max_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> Max <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ finite_atLeastAtMost<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-infinite_atLeast><span class=command>lemma</span></span> infinite_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> unbounded_k_infinite<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>

<span class=keyword1 id=SetInterval2-infinite_greaterThan><span class=command>lemma</span></span> infinite_greaterThan<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>nat<span class=main>)</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeast_Suc_greaterThan<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> infinite_atLeast<span class=main>)</span>

<span class=keyword1 id=SetInterval2-infinite_atLeast_int><span class=command>lemma</span></span> infinite_atLeast_int<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>int<span class=main>)</span><span class=main>..}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> nat <span class=main>(</span><span class=bound>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> inj_on_infinite_image_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> nat <span class=main>(</span><span class=bound>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff image_iff Bex_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> n1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>+</span> int <span class=improper>n1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-infinite_greaterThan_int><span class=command>lemma</span></span> infinite_greaterThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>int<span class=main>)</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atLeast_remove<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Diff_infinite_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> infinite_atLeast_int<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-infinite_atMost_int><span class=command>lemma</span></span> infinite_atMost_int<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{..</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>int<span class=main>)</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>n</span> <span class=main>-</span> <span class=bound>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> inj_on_infinite_image_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(-)</span> <span class=free>n</span> <span class=main>`</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff image_iff Bex_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> infinite_atLeast_int<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-infinite_lessThan_int><span class=command>lemma</span></span> infinite_lessThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=main>{..&lt;</span><span class=main>(</span><span class=free>n</span><span class=main>::</span>int<span class=main>)</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atMost_remove<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Diff_infinite_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> infinite_atMost_int<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Auxiliary results for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>card</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1 id=SetInterval2-sum_singleton><span class=command>lemma</span></span> sum_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∑</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=free>a</span><span class=main>}</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetInterval2-card_singleton><span class=command>lemma</span></span> card_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetInterval2-card_cartesian_product_singleton_right><span class=command>lemma</span></span> card_cartesian_product_singleton_right<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=free>A</span> <span class=main>×</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> card <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_cartesian_product<span class=main>)</span>

<span class=keyword1 id=SetInterval2-card_1_imp_singleton><span class=command>lemma</span></span> card_1_imp_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>=</span> Suc <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card_eq_SucD<span class=main>)</span>

<span class=keyword1 id=SetInterval2-card_1_singleton_conv><span class=command>lemma</span></span> card_1_singleton_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>card <span class=free>A</span> <span class=main>=</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_1_imp_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-card_gr0_imp_finite><span class=command>lemma</span></span> card_gr0_imp_finite<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> card <span class=free>A</span> <span class=main>⟹</span> finite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1 id=SetInterval2-card_gr0_imp_not_empty><span class=command>lemma</span></span> card_gr0_imp_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> card <span class=free>A</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1 id=SetInterval2-not_empty_card_gr0_conv><span class=command>lemma</span></span> not_empty_card_gr0_conv<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> card <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetInterval2-nat_card_le_Max><span class=command>lemma</span></span> nat_card_le_Max<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=free>A</span><span class=main>::</span>nat set<span class=main>)</span> <span class=main>≤</span> Suc <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> card_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_atMost<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"Max <span class=free><span class=free>A</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetInterval2-Int_card1><span class=command>lemma</span></span> Int_card1<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=SetInterval2-Int_card2><span class=command>lemma</span></span> Int_card2<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>B</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Int_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Int_card1<span class=main>)</span>
<span class=keyword1 id=SetInterval2-Un_card1><span class=command>lemma</span></span> Un_card1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> card <span class=free>A</span> <span class=main>≤</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=SetInterval2-Un_card2><span class=command>lemma</span></span> Un_card2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> card <span class=free>B</span> <span class=main>≤</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> Un_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Un_card1<span class=main>)</span>

<span class=keyword1 id=SetInterval2-card_Un_conv><span class=command>lemma</span></span> card_Un_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  card <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> card <span class=free>A</span> <span class=main>+</span> card <span class=free>B</span> <span class=main>-</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> card_Un_Int diff_add_inverse2<span class=main>)</span>
<span class=keyword1 id=SetInterval2-card_Int_conv><span class=command>lemma</span></span> card_Int_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> finite <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  card <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> card <span class=free>A</span> <span class=main>+</span> card <span class=free>B</span> <span class=main>-</span> card <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> card_Un_Int diff_add_inverse<span class=main>)</span>



<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Pigeonhole principle, dirichlet's box principle›</span></span>
<span class=keyword1 id=SetInterval2-pigeonhole_principle><span class=command>lemma</span></span> pigeonhole_principle<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  card <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=free>A</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∃</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> finite.induct<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> A1 a<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a</span> <span class=main>∈</span> <span class=improper>A1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> insert_absorb<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=improper>a</span> <span class=main>∈</span> <span class=free>f</span> <span class=main>`</span> <span class=improper>A1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> pigeonhole_principle_linorder<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  card <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>&lt;</span> card <span class=main>(</span><span class=free>A</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>linorder set<span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∃</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>∧</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> pigeonhole_principle<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> pigeonhole_mod<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>&lt;</span> card <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>∃</span><span class=bound>y</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=bound>y</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> pigeonhole_principle_linorder<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"card <span class=main><span class=main>{..&lt;</span></span><span class=free><span class=free>m</span></span><span class=main><span class=main>}</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> pigeonhole_mod2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>&lt;</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>c</span><span class=main>;</span> inj_on <span class=free>f</span> <span class=main>{..</span><span class=free>c</span><span class=main>}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound><span class=bound>x</span></span><span class=main>≤</span><span class=free>c</span><span class=main>.</span> <span class=main>∃</span><span class=bound><span class=bound>y</span></span><span class=main>≤</span><span class=free>c</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>y</span> <span class=main>∧</span> <span class=free>f</span> <span class=bound>x</span> <span class=keyword1>mod</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>y</span> <span class=keyword1>mod</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> pigeonhole_mod<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>f</span></span> <span class=main><span class=main>`</span></span> <span class=main><span class=main>{..</span></span><span class=free><span class=free>c</span></span><span class=main><span class=main>}</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_image<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x y<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>≠</span> <span class=improper>y</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> eq_commute<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=SetIntervalCut><div class=head><h1>Theory SetIntervalCut</h1></div><pre class=source><span class=comment1>(*  Title:      SetIntervalCut.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Cutting linearly ordered and natural sets›</span></span>

<span class=keyword1><span class=command>theory</span></span> SetIntervalCut
<span class=keyword2><span class=keyword>imports</span></span> <a href=SetInterval2.html>SetInterval2</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Set restriction›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  A set to set function <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>f›</span></span></span></span> is a <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>set restriction›</span></span></span></span>,
  if there exists a predicate <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>P›</span></span></span></span>,
  so that for every set <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>s›</span></span></span></span> the function result <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>f s›</span></span></span></span>
  contains all its elements fulfilling <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>P›</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>set_restriction</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> set <span class=main>⇒</span> <span class=tfree>'a</span> set<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>set_restriction</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main>∃</span><span class=bound>P</span><span class=main>.</span> <span class=main>∀</span><span class=bound>A</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=SetIntervalCut-set_restrictionD><span class=command>lemma</span></span> set_restrictionD<span class=main>:</span> <span class=quoted><span class=quoted>"set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>P</span><span class=main>.</span> <span class=main>∀</span><span class=bound>A</span><span class=main>.</span> <span class=free>f</span> <span class=bound>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=bound>A</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restrictionD_spec><span class=command>lemma</span></span> set_restrictionD_spec<span class=main>:</span> <span class=quoted><span class=quoted>"set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>P</span><span class=main>.</span> <span class=free>f</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>A</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>x</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restrictionI><span class=command>lemma</span></span> set_restrictionI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>A</span><span class=main>.</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=bound>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=main>⟹</span> set_restriction <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalCut-set_restriction_comp><span class=command>lemma</span></span> set_restriction_comp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> set_restriction <span class=free>g</span> <span class=main>⟧</span> <span class=main>⟹</span> set_restriction <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> set_restriction_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>elim</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> P1 P2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=improper>P1</span> <span class=bound>x</span> <span class=main>∧</span> <span class=improper>P2</span> <span class=bound>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalCut-set_restriction_commute><span class=command>lemma</span></span> set_restriction_commute<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> set_restriction <span class=free>g</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>g</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=main>(</span><span class=free>f</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Constructs a set restriction function with the given restriction predicate›</span></span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>set_restriction_fun</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> set <span class=main>⇒</span> <span class=tfree>'a</span> set<span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>set_restriction_fun</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>λ</span><span class=bound>A</span><span class=main>.</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=bound>A</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>x</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=SetIntervalCut-set_restriction_fun_is_set_restriction><span class=command>lemma</span></span> set_restriction_fun_is_set_restriction<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=main>(</span>set_restriction_fun <span class=free>P</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def set_restriction_fun_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalCut-set_restriction_Int_conv><span class=command>lemma</span></span> set_restriction_Int_conv<span class=main>:</span>
  <span class=quoted><span class=quoted>"set_restriction <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>B</span><span class=main>.</span> <span class=main>∀</span><span class=bound>A</span><span class=main>.</span> <span class=free>f</span> <span class=bound>A</span> <span class=main>=</span> <span class=bound>A</span> <span class=main>∩</span> <span class=bound>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> set_restriction_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Collect <span class=improper>P</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=improper>B</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-set_restriction_Un><span class=command>lemma</span></span> set_restriction_Un<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>A</span> <span class=main>∪</span> <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_Int><span class=command>lemma</span></span> set_restriction_Int<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_Diff><span class=command>lemma</span></span> set_restriction_Diff<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>A</span> <span class=main>-</span> <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_mono><span class=command>lemma</span></span> set_restriction_mono<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>f</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_absorb><span class=command>lemma</span></span> set_restriction_absorb<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>f</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_empty><span class=command>lemma</span></span> set_restriction_empty<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>{}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_non_empty_imp><span class=command>lemma</span></span> set_restriction_non_empty_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> <span class=free>f</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_subset><span class=command>lemma</span></span> set_restriction_subset<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction <span class=free>f</span> <span class=main>⟹</span> <span class=free>f</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_finite><span class=command>lemma</span></span> set_restriction_finite<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>f</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_card><span class=command>lemma</span></span> set_restriction_card<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  card <span class=main>(</span><span class=free>f</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> card <span class=free>A</span> <span class=main>-</span> card <span class=main>{</span><span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=free>A</span><span class=main>.</span> <span class=free>f</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> set_restriction_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound><span class=bound>a</span></span> <span class=main>∈</span> <span class=free>A</span><span class=main>.</span> <span class=free>f</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>}</span> <span class=main>⊆</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> finite_subset<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> card_Diff_subset<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>card</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-set_restriction_card_le><span class=command>lemma</span></span> set_restriction_card_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> finite <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>f</span> <span class=free>A</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_restriction_card<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-set_restriction_not_in_imp><span class=command>lemma</span></span> set_restriction_not_in_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>f</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalCut-set_restriction_in_imp><span class=command>lemma</span></span> set_restriction_in_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>f</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>f</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalCut-set_restriction_fun_singleton><span class=command>lemma</span></span> set_restriction_fun_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"
  set_restriction_fun <span class=free>P</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=free>a</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_fun_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_fun_all_conv><span class=command>lemma</span></span> set_restriction_fun_all_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span>set_restriction_fun <span class=free>P</span><span class=main>)</span> <span class=free>A</span> <span class=main>=</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_fun_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-set_restriction_fun_empty_conv><span class=command>lemma</span></span> set_restriction_fun_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span>set_restriction_fun <span class=free>P</span><span class=main>)</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_fun_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Cut operators for sets/intervals›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Definitions and basic lemmata for cut operators›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cut_le</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder set <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>   <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓≤</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>↓≤</span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cut_less</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder set <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓&lt;</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>↓&lt;</span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cut_ge</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder set <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓≥</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>↓≥</span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≤</span> <span class=bound>x</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cut_greater</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>linorder set <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓&gt;</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>↓&gt;</span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=bound><span class=bound>x</span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_defs <span class=main>=</span>
  cut_le_def cut_less_def
  cut_ge_def cut_greater_def

<span class=keyword1 id=SetIntervalCut-cut_le_mem_iff><span class=command>lemma</span></span> cut_le_mem_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> cut_le_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_less_mem_iff><span class=command>lemma</span></span> cut_less_mem_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> cut_less_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_ge_mem_iff><span class=command>lemma</span></span> cut_ge_mem_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> cut_ge_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_greater_mem_iff><span class=command>lemma</span></span> cut_greater_mem_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> cut_greater_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_mem_iff <span class=main>=</span>
  cut_le_mem_iff cut_less_mem_iff
  cut_ge_mem_iff cut_greater_mem_iff

<span class=keyword1 id=SetIntervalCut-cut_leI><span class=command>lemma</span></span>
  cut_leI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_lessI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_geI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≥</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greaterI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_leE><span class=command>lemma</span></span>
  cut_leE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_lessE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_geE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>≥</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greaterE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>&gt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff<span class=main>)</span>


<span class=keyword1 id=SetIntervalCut-cut_less_bound><span class=command>lemma</span></span>
  cut_less_bound<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_bound<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_bound<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>i</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_bound<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>i</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_bound <span class=main>=</span>
  cut_less_bound cut_le_bound
  cut_greater_bound cut_ge_bound

<span class=keyword1 id=SetIntervalCut-cut_le_Int_conv><span class=command>lemma</span></span>
  cut_le_Int_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>∩</span> <span class=main>{..</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_Int_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>∩</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Int_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>∩</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Int_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>∩</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_Int_conv <span class=main>=</span>
  cut_le_Int_conv cut_less_Int_conv
  cut_ge_Int_conv cut_greater_Int_conv

<span class=keyword1 id=SetIntervalCut-cut_le_Diff_conv><span class=command>lemma</span></span>
  cut_le_Diff_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_Diff_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Diff_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Diff_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{..</span><span class=free>t</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Diff_conv <span class=main>=</span>
  cut_le_Diff_conv cut_less_Diff_conv
  cut_ge_Diff_conv cut_greater_Diff_conv


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic results for cut operators›</span></span>

<span class=keyword1 id="SetIntervalCut-cut_less_eq_set_restriction_fun'"><span class=command>lemma</span></span>
  cut_less_eq_set_restriction_fun'<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_eq_set_restriction_fun'<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_eq_set_restriction_fun'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_eq_set_restriction_fun'<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≥</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> set_restriction_fun_def i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_eq_set_restriction_fun' <span class=main>=</span>
  cut_less_eq_set_restriction_fun' cut_le_eq_set_restriction_fun'
  cut_greater_eq_set_restriction_fun' cut_ge_eq_set_restriction_fun'

<span class=keyword1 id=SetIntervalCut-cut_less_eq_set_restriction_fun><span class=command>lemma</span></span>
  cut_less_eq_set_restriction_fun<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_eq_set_restriction_fun<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_eq_set_restriction_fun<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_eq_set_restriction_fun<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> set_restriction_fun <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≥</span> <span class=free>t</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> i_cut_eq_set_restriction_fun'<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_eq_set_restriction_fun <span class=main>=</span>
  cut_less_eq_set_restriction_fun cut_le_eq_set_restriction_fun
  cut_greater_eq_set_restriction_fun cut_ge_eq_set_restriction_fun

<span class=keyword1 id=SetIntervalCut-i_cut_set_restriction_disj><span class=command>lemma</span></span> i_cut_set_restriction_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span><span class=main>;</span>
    <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=free>cut_op</span> <span class=bound>I</span> <span class=free>t</span><span class=main>)</span>  <span class=main>⟧</span> <span class=main>⟹</span> set_restriction <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> i_cut_eq_set_restriction_fun set_restriction_fun_is_set_restriction<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span>
  i_cut_less_set_restriction<span class=main>:</span>    <span class=quoted><span class=quoted>"set_restriction <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  i_cut_le_set_restriction<span class=main>:</span>      <span class=quoted><span class=quoted>"set_restriction <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  i_cut_greater_set_restriction<span class=main>:</span> <span class=quoted><span class=quoted>"set_restriction <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  i_cut_ge_set_restriction<span class=main>:</span>      <span class=quoted><span class=quoted>"set_restriction <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> i_cut_eq_set_restriction_fun set_restriction_fun_is_set_restriction<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_set_restriction <span class=main>=</span>
  i_cut_le_set_restriction i_cut_less_set_restriction
  i_cut_ge_set_restriction i_cut_greater_set_restriction

<span class=keyword1 id=SetIntervalCut-i_cut_commute_disj><span class=command>lemma</span></span> i_cut_commute_disj<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span>
  <span class=free>cut_op1</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op1</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
  <span class=free>cut_op1</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op1</span> <span class=main>=</span> <span class=main>(↓≥)</span><span class=main>;</span>
  <span class=free>cut_op2</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op2</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
  <span class=free>cut_op2</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op2</span> <span class=main>=</span> <span class=main>(↓≥)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>cut_op2</span> <span class=main>(</span><span class=free>cut_op1</span> <span class=free>I</span> <span class=free>t1</span><span class=main>)</span> <span class=free>t2</span> <span class=main>=</span> <span class=free>cut_op1</span> <span class=main>(</span><span class=free>cut_op2</span> <span class=free>I</span> <span class=free>t2</span><span class=main>)</span> <span class=free>t1</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_restriction_commute<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> i_cut_set_restriction_disj<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_less_empty><span class=command>lemma</span></span>
  cut_less_empty<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_empty<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_empty<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_empty <span class=main>=</span>
  cut_less_empty cut_le_empty
  cut_greater_empty cut_ge_empty

<span class=keyword1 id=SetIntervalCut-cut_less_not_empty_imp><span class=command>lemma</span></span>
  cut_less_not_empty_imp<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_not_empty_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_not_empty_imp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_not_empty_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1 id=SetIntervalCut-cut_less_singleton><span class=command>lemma</span></span>
  cut_less_singleton<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_singleton<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>&gt;</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_singleton<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>a</span> <span class=main>≥</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_eq_set_restriction_fun<span class=main><span class=main>[</span></span><span class=operator>THEN</span> ssubst<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> set_restriction_fun_singleton<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_singleton <span class=main>=</span>
  cut_le_singleton cut_less_singleton
  cut_ge_singleton cut_greater_singleton




<span class=keyword1 id=SetIntervalCut-cut_less_subset><span class=command>lemma</span></span>
  cut_less_subset<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_subset<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_subset<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> i_cut_set_restriction<span class=main><span class=main>[</span></span><span class=operator>THEN</span> set_restriction_subset<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_subset <span class=main>=</span>
  cut_less_subset cut_le_subset
  cut_greater_subset cut_ge_subset

<span class=keyword1 id=SetIntervalCut-i_cut_Un_disj><span class=command>lemma</span></span> i_cut_Un_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>cut_op</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=free>t</span> <span class=main>=</span> <span class=free>cut_op</span> <span class=free>A</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>cut_op</span> <span class=free>B</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> i_cut_set_restriction_disj<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>I</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>cut_op</span></span> <span class=bound><span class=bound>I</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_restriction_Un<span class=main>)</span>


<span class=keyword1><span class=command>corollary</span></span>
  cut_less_Un<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_Un<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>B</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Un<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Un<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>B</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_Un_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Un <span class=main>=</span>
  cut_less_Un cut_le_Un
  cut_greater_Un cut_ge_Un




<span class=keyword1 id=SetIntervalCut-i_cut_Int_disj><span class=command>lemma</span></span> i_cut_Int_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>cut_op</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=free>t</span> <span class=main>=</span> <span class=free>cut_op</span> <span class=free>A</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>cut_op</span> <span class=free>B</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> i_cut_set_restriction_disj<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>I</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>cut_op</span></span> <span class=bound><span class=bound>I</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_restriction_Int<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_less_Int><span class=command>lemma</span></span>
  cut_less_Int<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_Int<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Int<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Int<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Int <span class=main>=</span>
  cut_less_Int cut_le_Int
  cut_greater_Int cut_ge_Int

<span class=keyword1 id=SetIntervalCut-cut_less_Int_left><span class=command>lemma</span></span>
  cut_less_Int_left<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_Int_left<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Int_left<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Int_left<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>∩</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Int_left <span class=main>=</span>
  cut_less_Int_left cut_le_Int_left
  cut_greater_Int_left cut_ge_Int_left

<span class=keyword1 id=SetIntervalCut-cut_less_Int_right><span class=command>lemma</span></span>
  cut_less_Int_right<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_Int_right<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Int_right<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Int_right<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Int_right <span class=main>=</span>
  cut_less_Int_right cut_le_Int_right
  cut_greater_Int_right cut_ge_Int_right

<span class=keyword1 id=SetIntervalCut-i_cut_Diff_disj><span class=command>lemma</span></span> i_cut_Diff_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>cut_op</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=free>t</span> <span class=main>=</span> <span class=free>cut_op</span> <span class=free>A</span> <span class=free>t</span> <span class=main>-</span> <span class=free>cut_op</span> <span class=free>B</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> i_cut_set_restriction_disj<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>I</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>cut_op</span></span> <span class=bound><span class=bound>I</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_restriction_Diff<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span>
  cut_less_Diff<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>-</span> <span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_Diff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>-</span> <span class=free>B</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_Diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>-</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_Diff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>B</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>A</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>-</span> <span class=free>B</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_Diff_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_Diff <span class=main>=</span>
  cut_less_Diff cut_le_Diff
  cut_greater_Diff cut_ge_Diff

<span class=keyword1 id=SetIntervalCut-i_cut_subset_mono_disj><span class=command>lemma</span></span> i_cut_subset_mono_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>cut_op</span> <span class=free>A</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>cut_op</span> <span class=free>B</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> i_cut_set_restriction_disj<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>I</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>cut_op</span></span> <span class=bound><span class=bound>I</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_restriction_mono<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>λ</span></span></span><span class=bound><span class=bound><span class=bound>I</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>cut_op</span></span></span> <span class=bound><span class=bound><span class=bound>I</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span>
  cut_less_subset_mono<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_subset_mono<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_subset_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_subset_mono<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_subset_mono_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_subset_mono <span class=main>=</span>
  cut_less_subset_mono cut_le_subset_mono
  cut_greater_subset_mono cut_ge_subset_mono





<span class=keyword1 id=SetIntervalCut-cut_less_mono><span class=command>lemma</span></span>
  cut_less_mono<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> <span class=free>t'</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t'</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_mono<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> <span class=free>t'</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_mono<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>t'</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⊆</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t'</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> i_cut_defs<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_mono <span class=main>=</span>
  cut_le_mono cut_less_mono
  cut_ge_mono cut_greater_mono




<span class=keyword1 id=SetIntervalCut-cut_cut_le><span class=command>lemma</span></span>
  cut_cut_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>↓≤</span> <span class=free>a</span> <span class=main>↓≤</span> <span class=free>b</span> <span class=main>=</span> <span class=free>i</span> <span class=main>↓≤</span> min <span class=free>a</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_cut_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>↓&lt;</span> <span class=free>a</span> <span class=main>↓&lt;</span> <span class=free>b</span> <span class=main>=</span> <span class=free>i</span> <span class=main>↓&lt;</span> min <span class=free>a</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_cut_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>↓≥</span> <span class=free>a</span> <span class=main>↓≥</span> <span class=free>b</span> <span class=main>=</span> <span class=free>i</span> <span class=main>↓≥</span> max <span class=free>a</span> <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>↓&gt;</span> <span class=free>a</span> <span class=main>↓&gt;</span> <span class=free>b</span> <span class=main>=</span> <span class=free>i</span> <span class=main>↓&gt;</span> max <span class=free>a</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command>lemmas</span></span> i_cut_cut <span class=main>=</span>
  cut_cut_le cut_cut_less
  cut_cut_ge cut_cut_greater

<span class=keyword1 id=SetIntervalCut-i_cut_absorb_disj><span class=command>lemma</span></span> i_cut_absorb_disj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&lt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≤)</span> <span class=main>∨</span>
    <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓&gt;)</span> <span class=main>∨</span> <span class=free>cut_op</span> <span class=main>=</span> <span class=main>(↓≥)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>cut_op</span> <span class=main>(</span><span class=free>cut_op</span> <span class=free>I</span> <span class=free>t</span><span class=main>)</span> <span class=free>t</span> <span class=main>=</span> <span class=free>cut_op</span> <span class=free>I</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> i_cut_set_restriction_disj<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>I</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>cut_op</span></span> <span class=bound><span class=bound>I</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> set_restriction_absorb<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span>
  cut_le_absorb<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_absorb<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_absorb<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_absorb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_absorb_disj<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_absorb <span class=main>=</span>
  cut_le_absorb cut_less_absorb
  cut_ge_absorb cut_greater_absorb

<span class=keyword1 id=SetIntervalCut-cut_less_0_empty><span class=command>lemma</span></span>
  cut_less_0_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_0_all<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetIntervalCut-cut_le_all_iff><span class=command>lemma</span></span>
  cut_le_all_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_all_iff<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_all_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≥</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_all_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_all_iff <span class=main>=</span>
  cut_le_all_iff cut_less_all_iff
  cut_ge_all_iff cut_greater_all_iff

<span class=keyword1 id=SetIntervalCut-cut_le_empty_iff><span class=command>lemma</span></span>
  cut_le_empty_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_empty_iff<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>t</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_empty_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_empty_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_empty_iff <span class=main>=</span>
  cut_le_empty_iff cut_less_empty_iff
  cut_ge_empty_iff cut_greater_empty_iff

<span class=keyword1 id=SetIntervalCut-cut_le_not_empty_iff><span class=command>lemma</span></span>
  cut_le_not_empty_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_not_empty_iff<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_not_empty_iff<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>t</span> <span class=main>≤</span> <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_not_empty_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_not_empty_iff <span class=main>=</span>
  cut_le_not_empty_iff cut_less_not_empty_iff
  cut_ge_not_empty_iff cut_greater_not_empty_iff

<span class=keyword1 id=SetIntervalCut-nat_cut_ge_infinite_not_empty><span class=command>lemma</span></span> nat_cut_ge_infinite_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> infinite_nat_iff_unbounded_le<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-nat_cut_greater_infinite_not_empty><span class=command>lemma</span></span> nat_cut_greater_infinite_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> infinite_nat_iff_unbounded<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span>
  cut_le_not_in_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_not_in_imp<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_not_in_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_not_in_imp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_set_restriction<span class=main><span class=main>[</span></span><span class=operator>THEN</span> set_restriction_not_in_imp<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_not_in_imp <span class=main>=</span>
  cut_le_not_in_imp cut_less_not_in_imp
  cut_ge_not_in_imp cut_greater_not_in_imp

<span class=keyword1><span class=command>corollary</span></span>
  cut_le_in_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_in_imp<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_in_imp<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_in_imp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_cut_set_restriction<span class=main><span class=main>[</span></span><span class=operator>THEN</span> set_restriction_in_imp<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_in_imp <span class=main>=</span>
  cut_le_in_imp cut_less_in_imp
  cut_ge_in_imp cut_greater_in_imp


<span class=keyword1 id=SetIntervalCut-Collect_minI_cut><span class=command>lemma</span></span> Collect_minI_cut<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=free>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> Collect_minI<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> Collect_minI_ex_cut<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> Collect_minI_ex<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> Collect_minI_ex2_cut<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound><span class=bound>k</span></span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>wellorder<span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> Collect_minI_ex2<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>





<span class=keyword1 id=SetIntervalCut-cut_le_cut_greater_ident><span class=command>lemma</span></span> cut_le_cut_greater_ident<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t2</span> <span class=main>≤</span> <span class=free>t1</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t1</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t2</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-cut_less_cut_ge_ident><span class=command>lemma</span></span> cut_less_cut_ge_ident<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t2</span> <span class=main>≤</span> <span class=free>t1</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t1</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t2</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-cut_le_cut_ge_ident><span class=command>lemma</span></span> cut_le_cut_ge_ident<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t2</span> <span class=main>≤</span> <span class=free>t1</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t1</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t2</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalCut-cut_less_cut_greater_ident><span class=command>lemma</span></span> cut_less_cut_greater_ident<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t2</span> <span class=main>≤</span> <span class=free>t1</span><span class=main>;</span> <span class=free>I</span> <span class=main>∩</span> <span class=main>{</span><span class=free>t1</span><span class=main>..</span><span class=free>t2</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t1</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t2</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>corollary</span></span> cut_less_cut_greater_ident'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>t</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_cut_greater_ident<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-insert_eq_cut_less_cut_greater><span class=command>lemma</span></span> insert_eq_cut_less_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"insert <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>∪</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>



<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Relations between cut operators›</span></span>

<span class=keyword1 id=SetIntervalCut-insert_Int_conv_if><span class=command>lemma</span></span> insert_Int_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∩</span> <span class=main>(</span>insert <span class=free>x</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> insert <span class=free>x</span> <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-cut_le_less_conv_if><span class=command>lemma</span></span> cut_le_less_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=keyword1>then</span> insert <span class=free>t</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_Int_conv lessThan_insert<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> insert_Int_conv_if<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_le_less_conv><span class=command>lemma</span></span> cut_le_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=main>{</span><span class=free>t</span><span class=main>}</span> <span class=main>∩</span> <span class=free>I</span><span class=main>)</span> <span class=main>∪</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalCut-cut_less_le_conv><span class=command>lemma</span></span> cut_less_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-cut_less_le_conv_if><span class=command>lemma</span></span> cut_less_le_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=keyword1>then</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> cut_less_le_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>







<span class=keyword1 id=SetIntervalCut-cut_ge_greater_conv_if><span class=command>lemma</span></span> cut_ge_greater_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=keyword1>then</span> insert <span class=free>t</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_Int_conv greaterThan_insert<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> insert_Int_conv_if<span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-cut_ge_greater_conv><span class=command>lemma</span></span> cut_ge_greater_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=main>{</span><span class=free>t</span><span class=main>}</span> <span class=main>∩</span> <span class=free>I</span><span class=main>)</span> <span class=main>∪</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> cut_ge_greater_conv_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalCut-cut_greater_ge_conv><span class=command>lemma</span></span> cut_greater_ge_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-cut_greater_ge_conv_if><span class=command>lemma</span></span> cut_greater_ge_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=keyword1>then</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=free>t</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> cut_greater_ge_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>



<span class=keyword1 id=SetIntervalCut-nat_cut_le_less_conv><span class=command>lemma</span></span> nat_cut_le_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&lt;</span> Suc <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-nat_cut_less_le_conv><span class=command>lemma</span></span> nat_cut_less_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-nat_cut_ge_greater_conv><span class=command>lemma</span></span> nat_cut_ge_greater_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> Suc <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1 id=SetIntervalCut-nat_cut_greater_ge_conv><span class=command>lemma</span></span> nat_cut_greater_ge_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span><span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Function images with cut operators›</span></span>

<span class=keyword1 id=SetIntervalCut-cut_less_image><span class=command>lemma</span></span> cut_less_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> strict_mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff Bex_def cut_less_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> not_less_iff_gr_or_eq rev_subsetD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_le_image><span class=command>lemma</span></span> cut_le_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> strict_mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>↓≤</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> strict_mono_on_imp_inj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> cut_le_less_conv_if cut_less_image inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_greater_image><span class=command>lemma</span></span> cut_greater_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> strict_mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>↓&gt;</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff Bex_def cut_greater_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> strict_mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> not_less_iff_gr_or_eq rev_subsetD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_ge_image><span class=command>lemma</span></span> cut_ge_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> strict_mono_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>↓≥</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> strict_mono_on_imp_inj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> cut_ge_greater_conv_if cut_greater_image inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_image <span class=main>=</span>
  cut_le_image cut_less_image
  cut_ge_image cut_greater_image


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Finiteness and cardinality with cut operators›</span></span>

<span class=keyword1 id=SetIntervalCut-cut_le_finite><span class=command>lemma</span></span>
  cut_le_finite<span class=main>:</span>      <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_finite<span class=main>:</span>    <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_finite<span class=main>:</span>      <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> finite_subset<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> i_cut_subset<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetIntervalCut-nat_cut_le_finite><span class=command>lemma</span></span> nat_cut_le_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> finite_nat_iff_bounded_le2 cut_le_def<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-nat_cut_less_finite><span class=command>lemma</span></span> nat_cut_less_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> finite_nat_iff_bounded2 cut_less_def<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-nat_cut_ge_finite_iff><span class=command>lemma</span></span> nat_cut_ge_finite_iff<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>=</span> finite <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cut_less_cut_ge_ident<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> order_refl<span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-nat_cut_greater_finite_iff><span class=command>lemma</span></span> nat_cut_greater_finite_iff<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>=</span> finite <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> nat_cut_ge_greater_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> nat_cut_ge_finite_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_le_card><span class=command>lemma</span></span>
  cut_le_card<span class=main>:</span>      <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_less_card<span class=main>:</span>    <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_card<span class=main>:</span>      <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_card<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> i_cut_subset<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetIntervalCut-nat_cut_greater_card><span class=command>lemma</span></span> nat_cut_greater_card<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_finite_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-nat_cut_ge_card><span class=command>lemma</span></span> nat_cut_ge_card<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span><span class=main>)</span> <span class=main>≤</span> card <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_ge_finite_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Cutting a set at  <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Min›</span></span></span></span> or <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Max›</span></span></span></span> element›</span></span>

<span class=keyword1 id=SetIntervalCut-cut_greater_Min_eq_Diff><span class=command>lemma</span></span> cut_greater_Min_eq_Diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=free>I</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1 id=SetIntervalCut-cut_less_Max_eq_Diff><span class=command>lemma</span></span> cut_less_Max_eq_Diff<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span>Max <span class=free>I</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalCut-cut_le_Min_empty><span class=command>lemma</span></span> cut_le_Min_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> iMin <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-cut_less_Min_empty><span class=command>lemma</span></span> cut_less_Min_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>


<span class=keyword1 id=SetIntervalCut-cut_le_Min_not_empty><span class=command>lemma</span></span> cut_le_Min_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_less_Min_not_empty><span class=command>lemma</span></span> cut_less_Min_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_ge_Min_all><span class=command>lemma</span></span> cut_ge_Min_all<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iMin_le<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_greater_Min_all><span class=command>lemma</span></span> cut_greater_Min_all<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> iMin <span class=free>I</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iMin_le<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_min_empty <span class=main>=</span>
  cut_le_Min_empty
  cut_less_Min_empty
  cut_le_Min_not_empty
  cut_less_Min_not_empty
<span class=keyword1><span class=command>lemmas</span></span> i_cut_min_all <span class=main>=</span>
  cut_ge_Min_all
  cut_greater_Min_all

<span class=keyword1 id=SetIntervalCut-cut_ge_Max_empty><span class=command>lemma</span></span> cut_ge_Max_empty<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> Max <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_greater_Max_empty><span class=command>lemma</span></span> cut_greater_Max_empty<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_ge_Max_not_empty><span class=command>lemma</span></span> cut_ge_Max_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> MaxI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_greater_Max_not_empty><span class=command>lemma</span></span> cut_greater_Max_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>&lt;</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> MaxI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_le_Max_all><span class=command>lemma</span></span> cut_le_Max_all<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-cut_less_Max_all><span class=command>lemma</span></span> cut_less_Max_all<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> Max <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_max_empty <span class=main>=</span>
  cut_ge_Max_empty
  cut_greater_Max_empty
  cut_ge_Max_not_empty
  cut_greater_Max_not_empty
<span class=keyword1><span class=command>lemmas</span></span> i_cut_max_all <span class=main>=</span>
  cut_le_Max_all
  cut_less_Max_all

<span class=keyword1 id=SetIntervalCut-cut_less_Max_less><span class=command>lemma</span></span> cut_less_Max_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_less_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_in<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-cut_le_Max_le><span class=command>lemma</span></span> cut_le_Max_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_le_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_in<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-nat_cut_less_Max_less><span class=command>lemma</span></span> nat_cut_less_Max_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_less_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_in<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-nat_cut_le_Max_le><span class=command>lemma</span></span> nat_cut_le_Max_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free>t</span><span class=main>::</span>nat<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_le_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_in<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_le_finite<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-cut_greater_Min_greater><span class=command>lemma</span></span> cut_greater_Min_greater<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>&gt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_greater_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMinI_ex2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-cut_ge_Min_greater><span class=command>lemma</span></span> cut_ge_Min_greater<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>≥</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cut_ge_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMinI_ex2<span class=main><span class=main>]</span></span><span class=main>)</span>



<span class=keyword1 id=SetIntervalCut-cut_less_Min_eq><span class=command>lemma</span></span> cut_less_Min_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> cut_less_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_le_Min_eq><span class=command>lemma</span></span> cut_le_Min_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> cut_le_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalCut-cut_ge_Max_eq><span class=command>lemma</span></span> cut_ge_Max_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> cut_ge_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-cut_greater_Max_eq><span class=command>lemma</span></span> cut_greater_Max_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> cut_greater_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> MaxI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Cut operators with intervals from SetInterval›</span></span>

<span class=keyword1 id=SetIntervalCut-UNIV_cut_le><span class=command>lemma</span></span>
  UNIV_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"UNIV <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{..</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  UNIV_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"UNIV <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  UNIV_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"UNIV <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  UNIV_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"UNIV <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetIntervalCut-lessThan_cut_le><span class=command>lemma</span></span>
  lessThan_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  lessThan_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  lessThan_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  lessThan_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atMost_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atMost_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atMost_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>..</span><span class=free>n</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atMost_cut_greager<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThan_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThan_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThan_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThan_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>n</span><span class=main>&lt;..}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeast_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>..</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeast_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{</span><span class=free>n</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeast_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeast_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff i_cut_mem_iff linorder_not_le linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalCut-greaterThanLessThan_cut_le><span class=command>lemma</span></span>
  greaterThanLessThan_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanLessThan_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanLessThan_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanLessThan_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastLessThan_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastLessThan_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastLessThan_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastLessThan_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..&lt;</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanAtMost_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanAtMost_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanAtMost_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  greaterThanAtMost_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastAtMost_cut_le<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastAtMost_cut_less<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>t</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastAtMost_cut_ge<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  atLeastAtMost_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>m</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{</span><span class=free>t</span><span class=main>&lt;..</span><span class=free>n</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff i_cut_mem_iff if_split linorder_not_le linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Mirroring finite natural sets between their <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>Min</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>Max</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> element›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Mirroring a number at the middle of the interval {min l r..max l r}›</span></span>
<span class=keyword1><span class=command>text_raw</span></span> <span class=quoted><span class=plain_text>‹\bigskip›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Mirroring a single element n between the interval boundaries l and r›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>nat_mirror</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat <span class=main>⇒</span> nat <span class=main>⇒</span> nat"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>nat_mirror</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_commute><span class=command>lemma</span></span> nat_mirror_commute<span class=main>:</span> <span class=quoted><span class=quoted>"nat_mirror <span class=free>n</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> nat_mirror <span class=free>n</span> <span class=free>r</span> <span class=free>l</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_inj_on><span class=command>lemma</span></span> nat_mirror_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> nat_mirror <span class=bound>x</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>{..</span><span class=free>l</span> <span class=main>+</span> <span class=free>r</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inj_on_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_nat_mirror_ident><span class=command>lemma</span></span> nat_mirror_nat_mirror_ident<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟹</span> nat_mirror <span class=main>(</span>nat_mirror <span class=free>n</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_add><span class=command>lemma</span></span> nat_mirror_add<span class=main>:</span> <span class=quoted><span class=quoted>"
  nat_mirror <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> <span class=main>(</span>nat_mirror <span class=free>n</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>-</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-nat_mirror_diff><span class=command>lemma</span></span> nat_mirror_diff<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  nat_mirror <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> <span class=main>(</span>nat_mirror <span class=free>n</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_le><span class=command>lemma</span></span> nat_mirror_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span> <span class=main>≤</span> nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-nat_mirror_le_conv><span class=command>lemma</span></span> nat_mirror_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟹</span> <span class=main>(</span>nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span> <span class=main>≤</span> nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_less><span class=command>lemma</span></span> nat_mirror_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span> <span class=main>&lt;</span> nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-nat_mirror_less_imp_less><span class=command>lemma</span></span> nat_mirror_less_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span> <span class=main>&lt;</span> nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-nat_mirror_less_conv><span class=command>lemma</span></span> nat_mirror_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>&lt;</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟹</span> <span class=main>(</span>nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span> <span class=main>&lt;</span> nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalCut-nat_mirror_eq_conv><span class=command>lemma</span></span> nat_mirror_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>nat_mirror <span class=free>a</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> nat_mirror <span class=free>b</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Mirroring a single element n between the interval boundaries of I›</span></span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>mirror_elem</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat set <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mirror_elem</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> nat_mirror <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>(</span>iMin <span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>)</span> <span class=main>(</span>Max <span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_inj_on><span class=command>lemma</span></span> mirror_elem_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> mirror_elem <span class=bound>x</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Max_le_imp_subset_atMost nat_mirror_inj_on not_add_less2 not_le_imp_less subset_inj_on<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_add><span class=command>lemma</span></span> mirror_elem_add<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>I</span> <span class=main>⟹</span> mirror_elem <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> mirror_elem <span class=free>n</span> <span class=free>I</span> <span class=main>-</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat_mirror_add<span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-mirror_elem_diff><span class=command>lemma</span></span> mirror_elem_diff<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> mirror_elem <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> mirror_elem <span class=free>n</span> <span class=free>I</span> <span class=main>+</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mirror_elem_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_mirror_diff<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_le_add2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalCut-mirror_elem_Min><span class=command>lemma</span></span> mirror_elem_Min<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> mirror_elem <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-mirror_elem_Max><span class=command>lemma</span></span> mirror_elem_Max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> mirror_elem <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_mirror_elem_ident><span class=command>lemma</span></span> mirror_elem_mirror_elem_ident<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> mirror_elem <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_le_conv><span class=command>lemma</span></span> mirror_elem_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>mirror_elem <span class=free>b</span> <span class=free>I</span> <span class=main>≤</span> mirror_elem <span class=free>a</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> mirror_elem_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_mirror_le_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_le_add2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_less_conv><span class=command>lemma</span></span> mirror_elem_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>mirror_elem <span class=free>b</span> <span class=free>I</span> <span class=main>&lt;</span> mirror_elem <span class=free>a</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> mirror_elem_def nat_mirror_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_less_mono2 nat_diff_left_cancel_less nat_ex_greater_infinite_finite_Max_conv' trans_less_add2<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_eq_conv><span class=command>lemma</span></span> mirror_elem_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>mirror_elem <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> mirror_elem <span class=free>b</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_eq_conv<span class=main>)</span>
<span class=keyword1 id="SetIntervalCut-mirror_elem_eq_conv'"><span class=command>lemma</span></span> mirror_elem_eq_conv'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>mirror_elem <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> mirror_elem <span class=free>b</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mirror_elem_eq_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_le_add2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>imirror_bounds</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set <span class=main>⇒</span> nat <span class=main>⇒</span> nat <span class=main>⇒</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>imirror_bounds</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> nat_mirror <span class=bound>x</span> <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Mirroring all elements between the interval boundaries of I›</span></span>
<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>imirror</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set <span class=main>⇒</span> nat set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>imirror</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> iMin <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>+</span> Max <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>-</span> <span class=bound>x</span><span class=main>)</span> <span class=main>`</span> <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>

<span class=keyword1 id=SetIntervalCut-imirror_eq_nat_mirror_image><span class=command>lemma</span></span> imirror_eq_nat_mirror_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  imirror <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> nat_mirror <span class=bound>x</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-imirror_eq_mirror_elem_image><span class=command>lemma</span></span> imirror_eq_mirror_elem_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  imirror <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> mirror_elem <span class=bound>x</span> <span class=free>I</span><span class=main>)</span> <span class=main>`</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def imirror_eq_nat_mirror_image<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_eq_imirror_bounds><span class=command>lemma</span></span> imirror_eq_imirror_bounds<span class=main>:</span> <span class=quoted><span class=quoted>"
  imirror <span class=free>I</span> <span class=main>=</span> imirror_bounds <span class=free>I</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def imirror_bounds_def nat_mirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>




<span class=keyword1 id=SetIntervalCut-imirror_empty><span class=command>lemma</span></span> imirror_empty<span class=main>:</span> <span class=quoted><span class=quoted>"imirror <span class=main>{}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-imirror_is_empty><span class=command>lemma</span></span> imirror_is_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>imirror <span class=free>I</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>I</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalCut-imirror_not_empty><span class=command>lemma</span></span> imirror_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> imirror <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-imirror_singleton><span class=command>lemma</span></span> imirror_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"imirror <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=SetIntervalCut-imirror_finite><span class=command>lemma</span></span> imirror_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> finite <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> imirror_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalCut-imirror_bounds_iMin><span class=command>lemma</span></span> imirror_bounds_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iMin <span class=main>(</span>imirror_bounds <span class=free>I</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>-</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> imirror_bounds_def nat_mirror_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_ge diff_le_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_bounds_Max><span class=command>lemma</span></span> imirror_bounds_Max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  Max <span class=main>(</span>imirror_bounds <span class=free>I</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>-</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> imirror_bounds_def nat_mirror_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_le diff_le_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_iMin><span class=command>lemma</span></span> imirror_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> iMin <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_eq_imirror_bounds imirror_bounds_iMin le_add1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_Max><span class=command>lemma</span></span> imirror_Max<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> Max <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_eq_imirror_bounds imirror_bounds_Max trans_le_add2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> imirror_iMin_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> imirror <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>≤</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_finite<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> imirror_iMin imirror_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_bounds_iff><span class=command>lemma</span></span> imirror_bounds_iff<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∈</span> imirror_bounds <span class=free>I</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>-</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_def nat_mirror_def image_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_iff><span class=command>lemma</span></span> imirror_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∈</span> imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>-</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_def image_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_bounds_imirror_bounds_ident><span class=command>lemma</span></span> imirror_bounds_imirror_bounds_ident<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror_bounds <span class=main>(</span>imirror_bounds <span class=free>I</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_def image_image image_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nat_mirror_nat_mirror_ident<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nat_mirror_nat_mirror_ident<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_imirror_ident><span class=command>lemma</span></span> imirror_imirror_ident<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> imirror <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_eq_imirror_bounds imirror_bounds_iMin imirror_bounds_Max
  le_add1 trans_le_add2 imirror_bounds_imirror_bounds_ident<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-mirror_elem_imirror><span class=command>lemma</span></span> mirror_elem_imirror<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>I</span> <span class=main>⟹</span> mirror_elem <span class=free>t</span> <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> mirror_elem <span class=free>t</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def imirror_iMin imirror_Max<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_card><span class=command>lemma</span></span> imirror_card<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> card <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> imirror_eq_mirror_elem_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_iff_eq_card<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mirror_elem_inj_on<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalCut-imirror_bounds_elem_conv><span class=command>lemma</span></span> imirror_bounds_elem_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>l</span> <span class=main>+</span> <span class=free>r</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>(</span>nat_mirror <span class=free>n</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>∈</span> imirror_bounds <span class=free>I</span> <span class=free>l</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> imirror_bounds_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_image_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nat_mirror_inj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_mem_conv><span class=command>lemma</span></span> imirror_mem_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>∈</span> imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def imirror_eq_imirror_bounds imirror_bounds_elem_conv<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> in_imp_mirror_elem_in<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>∈</span> imirror <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imirror_mem_conv<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ trans_le_add2<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_ge<span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_cut_less><span class=command>lemma</span></span> imirror_cut_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>I</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span>mirror_elem <span class=free>t</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> imirror_eq_imirror_bounds<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> imirror_def imirror_bounds_def mirror_elem_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Bex_def i_cut_mem_iff image_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>bestsimp</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> nat_mirror_less_imp_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>bestsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_mirror_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_cut_le><span class=command>lemma</span></span> imirror_cut_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span>mirror_elem <span class=free>t</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> nat_cut_le_less_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_0_all i_cut_empty<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> imirror_eq_imirror_bounds<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_less_Max_all<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> imirror_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_def imirror_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_ge_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"mirror_elem <span class=main><span class=main>(</span></span><span class=free><span class=free>t</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>I</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main>(</span></span>mirror_elem <span class=free><span class=free>t</span></span> <span class=free><span class=free>I</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_diff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> imirror_cut_less<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalCut-imirror_cut_ge><span class=command>lemma</span></span> imirror_cut_ge<span class=main>:</span> <span class=quoted><span class=quoted>"
  finite <span class=free>I</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span>mirror_elem <span class=free>t</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>⟹</span> <span class=var>?lhs</span> <span class=free>I</span> <span class=main>=</span> <span class=var>?rhs</span> <span class=free>I</span> <span class=free>t</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_def cut_ge_0_all cut_le_Max_all imirror_eq_imirror_bounds<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> iMin <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_le_Min_empty imirror_bounds_def mirror_elem_def nat_mirror_def cut_ge_Max_empty imirror_Max imirror_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"imirror <span class=main><span class=main>(</span></span>imirror <span class=free><span class=free>I</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>↓≤</span></span> mirror_elem <span class=main><span class=main>(</span></span>mirror_elem <span class=free><span class=free>t</span></span> <span class=free><span class=free>I</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>(</span></span>imirror <span class=free><span class=free>I</span></span><span class=main><span class=main>)</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>I</span></span> <span class=main><span class=main>↓≤</span></span> <span class=free><span class=free>t</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_imirror_ident mirror_elem_imirror mirror_elem_mirror_elem_ident<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"mirror_elem <span class=free>t</span> <span class=free>I</span> <span class=main>≤</span> Max <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_Max mirror_elem_def nat_mirror_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_le imirror_finite<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cut_ge_Max_eq cut_ge_Max_not_empty imirror_Max imirror_bounds_imirror_bounds_ident imirror_finite imirror_iMin le_add2 nat_cut_ge_finite_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalCut-imirror_cut_greater><span class=command>lemma</span></span> imirror_cut_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span>mirror_elem <span class=free>t</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_0_empty imirror_bounds_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_greater_Max_empty<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> imirror_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_Max mirror_elem_def nat_mirror_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_ge_greater_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"mirror_elem <span class=main><span class=main>(</span></span><span class=free><span class=free>t</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>I</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"Suc <span class=main><span class=main>(</span></span>mirror_elem <span class=free><span class=free>t</span></span> <span class=free><span class=free>I</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_diff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_ge nat_cut_less_le_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> imirror_cut <span class=main>=</span>
  imirror_cut_less imirror_cut_ge
  imirror_cut_le imirror_cut_greater

<span class=keyword1><span class=command>corollary</span></span> imirror_cut_le'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓≤</span> mirror_elem <span class=free>t</span> <span class=free>I</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imirror_cut_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ trans_le_add2<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_ge<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> imirror_cut_greater'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror <span class=free>I</span> <span class=main>↓&gt;</span> mirror_elem <span class=free>t</span> <span class=free>I</span> <span class=main>=</span>
  imirror_bounds <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imirror_cut_greater<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ trans_le_add2<span class=main><span class=main>[</span></span><span class=operator>OF</span> Max_ge<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> imirror_cut' <span class=main>=</span>
  imirror_cut_le' imirror_cut_greater'


<span class=keyword1 id=SetIntervalCut-imirror_bounds_Un><span class=command>lemma</span></span> imirror_bounds_Un<span class=main>:</span> <span class=quoted><span class=quoted>"
  imirror_bounds <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span>
  imirror_bounds <span class=free>A</span> <span class=free>l</span> <span class=free>r</span> <span class=main>∪</span> imirror_bounds <span class=free>B</span> <span class=free>l</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_def image_Un<span class=main>)</span>
<span class=keyword1 id=SetIntervalCut-imirror_bounds_Int><span class=command>lemma</span></span> imirror_bounds_Int<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>A</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>l</span> <span class=main>+</span> <span class=free>r</span><span class=main>}</span><span class=main>;</span> <span class=free>B</span> <span class=main>⊆</span> <span class=main>{..</span><span class=free>l</span> <span class=main>+</span> <span class=free>r</span><span class=main>}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  imirror_bounds <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span> <span class=free>l</span> <span class=free>r</span> <span class=main>=</span>
  imirror_bounds <span class=free>A</span> <span class=free>l</span> <span class=free>r</span> <span class=main>∩</span> imirror_bounds <span class=free>B</span> <span class=free>l</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> imirror_bounds_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_on_image_Int<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Un_upper1 Un_upper2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subset_inj_on<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_mirror_inj_on<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Un_least<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>B</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=SetIntervalStep><div class=head><h1>Theory SetIntervalStep</h1></div><pre class=source><span class=comment1>(*  Title:      SetIntervalStep.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Stepping through sets of natural numbers›</span></span>

<span class=keyword1><span class=command>theory</span></span> SetIntervalStep
<span class=keyword2><span class=keyword>imports</span></span> <a href=SetIntervalCut.html>SetIntervalCut</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Function <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev›</span></span></span></span> for stepping through natural sets›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inext</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat set <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>inext</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>∧</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>↓&gt;</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>then</span> iMin <span class=main>(</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>↓&gt;</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>
    <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>iprev</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> nat set <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>iprev</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>∧</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>↓&lt;</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span><span class=main>)</span>
    <span class=keyword1>then</span> Max <span class=main>(</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>↓&lt;</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>
    <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev›</span></span></span></span> can be viewed as generalisations of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Suc›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>prev›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetIntervalStep-inext_UNIV><span class=command>lemma</span></span> inext_UNIV<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> UNIV <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def cut_greater_def<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-iprev_UNIV><span class=command>lemma</span></span> iprev_UNIV<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> UNIV <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def cut_less_def<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_empty><span class=command>lemma</span></span> inext_empty<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=main>{}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalStep-iprev_empty><span class=command>lemma</span></span> iprev_empty<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=main>{}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=SetIntervalStep-not_in_inext_fix><span class=command>lemma</span></span> not_in_inext_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=SetIntervalStep-not_in_iprev_fix><span class=command>lemma</span></span> not_in_iprev_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=SetIntervalStep-inext_all_le_fix><span class=command>lemma</span></span> inext_all_le_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1 id=SetIntervalStep-iprev_all_ge_fix><span class=command>lemma</span></span> iprev_all_ge_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>≤</span> <span class=bound>x</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=SetIntervalStep-inext_Max><span class=command>lemma</span></span> inext_Max<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> inext <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def cut_greater_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_ge<span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-iprev_iMin><span class=command>lemma</span></span> iprev_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def cut_less_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalStep-inext_ge_Max><span class=command>lemma</span></span> inext_ge_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def cut_greater_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_ge<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_le_iMin><span class=command>lemma</span></span> iprev_le_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def cut_less_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalStep-inext_singleton><span class=command>lemma</span></span> inext_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inext_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalStep-iprev_singleton><span class=command>lemma</span></span> iprev_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=SetIntervalStep-inext_closed><span class=command>lemma</span></span> inext_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inext_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_greater_subset<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMinI_ex2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_closed><span class=command>lemma</span></span> iprev_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>I</span></span> <span class=main><span class=main>↓&lt;</span></span> <span class=free><span class=free>n</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_in<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_in_imp_in><span class=command>lemma</span></span> inext_in_imp_in<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_in_iff><span class=command>lemma</span></span> inext_in_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_in_imp_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-subset_inext_closed><span class=command>lemma</span></span> subset_inext_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-subset_inext_in_imp_in><span class=command>lemma</span></span> subset_inext_in_imp_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> inext <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-subset_inext_in_iff><span class=command>lemma</span></span> subset_inext_in_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=main>(</span>inext <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subset_inext_in_imp_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subset_inext_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_in_imp_in><span class=command>lemma</span></span> iprev_in_imp_in<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_in_iff><span class=command>lemma</span></span> iprev_in_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_in_imp_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-subset_iprev_closed><span class=command>lemma</span></span> subset_iprev_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprev_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-subset_iprev_in_imp_in><span class=command>lemma</span></span> subset_iprev_in_imp_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> iprev <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-subset_iprev_in_iff><span class=command>lemma</span></span> subset_iprev_in_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subset_iprev_in_imp_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subset_iprev_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_mono><span class=command>lemma</span></span> inext_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_defs iMin_ge_iff<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> inext_neq_imp_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> inext_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_mono2><span class=command>lemma</span></span> inext_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_defs iMin_gr_iff<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_mono2_infin><span class=command>lemma</span></span> inext_mono2_infin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_defs iMin_gr_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> infinite_nat_iff_unbounded<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_mono2_fin><span class=command>lemma</span></span> inext_mono2_fin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_defs iMin_gr_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_ge Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_mono2_infin_fin><span class=command>lemma</span></span> inext_mono2_infin_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_mono2_infin inext_mono2_fin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_neq_iMin><span class=command>lemma</span></span> inext_neq_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iMinI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> not_sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMin_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> _ inext_mono2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_neq_iMin_infin><span class=command>lemma</span></span> inext_neq_iMin_infin<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_neq_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> infinite_nat_iff_unbounded<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-Max_le_iMin_imp_singleton><span class=command>lemma</span></span> Max_le_iMin_imp_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span>iMin <span class=free>I</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Min_conv Max_le_Min_imp_singleton<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_neq_iMin_not_singleton><span class=command>lemma</span></span> inext_neq_iMin_not_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_neq_iMin_infin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Max_le_iMin_imp_singleton iMin_le_Max inext_Max inext_mono2_infin_fin not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> inext_neq_iMin_not_card_1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≠</span> Suc <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_neq_iMin_not_singleton card_1_singleton_conv<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_neq_imp_Max><span class=command>lemma</span></span> inext_neq_imp_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>n</span> <span class=main>&lt;</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inext_ge_Max<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_less_conv><span class=command>lemma</span></span> inext_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_mono2_infin_fin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_neq_imp_Max less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_min_step><span class=command>lemma</span></span> inext_min_step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>k</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>∉</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> contrapos_pn<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>k</span></span> <span class=main><span class=main>&lt;</span></span> inext <span class=free><span class=free>n</span></span> <span class=free><span class=free>I</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>k</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inext_min_step2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-min_step_inext><span class=command>lemma</span></span> min_step_inext<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>k</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=bound>k</span><span class=main>;</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>k</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>x</span> <span class=free>I</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_neq_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_closed inext_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> min_step_inext2<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>x</span> <span class=free>I</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> min_step_inext<span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-between_empty_imp_inext_eq><span class=command>lemma</span></span> between_empty_imp_inext_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> inext <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=free>n</span> <span class=main>↓&lt;</span> <span class=main>(</span>inext <span class=free>n</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>n</span> <span class=free>B</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> min_step_inext2<span class=main>)</span>




<span class=keyword1 id=SetIntervalStep-inext_le_mono><span class=command>lemma</span></span> inext_le_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> inext <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inext_mono<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_less_mono><span class=command>lemma</span></span> inext_less_mono<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inext_mono2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_less_mono_fin><span class=command>lemma</span></span> inext_less_mono_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_less_mono Max_in<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_less_mono_infin><span class=command>lemma</span></span> inext_less_mono_infin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_less_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> infinite_imp_asc_chain<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_less_mono_infin_fin><span class=command>lemma</span></span> inext_less_mono_infin_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_less_mono_infin inext_less_mono_fin<span class=main>)</span>


<span class=keyword1 id=SetIntervalStep-inext_le_mono_rev><span class=command>lemma</span></span> inext_le_mono_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_less_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_less_trans inext_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_le_mono_fin_rev><span class=command>lemma</span></span> inext_le_mono_fin_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≠</span> Max <span class=free>I</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_in_iff inext_le_mono_rev inext_mono2_infin_fin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_le_mono_infin_rev><span class=command>lemma</span></span> inext_le_mono_infin_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_in_iff inext_le_mono_rev inext_mono2_infin_fin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_le_mono_infin_fin_rev><span class=command>lemma</span></span> inext_le_mono_infin_fin_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_le_mono_infin_rev inext_le_mono_fin_rev<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_less_mono_rev><span class=command>lemma</span></span> inext_less_mono_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_le_mono not_le<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-less_imp_inext_le><span class=command>lemma</span></span> less_imp_inext_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_min_step not_le<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_mono><span class=command>lemma</span></span> iprev_mono<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≤</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> iprev_def i_cut_defs <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>corollary</span></span> iprev_neq_imp_greater<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≠</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> iprev_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_mono2><span class=command>lemma</span></span> iprev_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iprev_def i_cut_defs<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_nat_iff_bounded<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_mono2_if_neq_iMin><span class=command>lemma</span></span> iprev_mono2_if_neq_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>n</span><span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMinI iprev_mono2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_neq_Max><span class=command>lemma</span></span> iprev_neq_Max<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span>  <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> iprev_mono2 Max_ge<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_neq_Max_not_singleton><span class=command>lemma</span></span> iprev_neq_Max_not_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> Max_le_Min_conv_singleton iMin_Min_conv iMin_le_Max iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> iprev_mono2_if_neq_iMin not_greater_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> iprev_neq_Max_not_card_1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≠</span> Suc <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_neq_Max_not_singleton<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_1_singleton_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_neq_imp_iMin><span class=command>lemma</span></span> iprev_neq_imp_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≠</span> <span class=free>n</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprev_le_iMin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_greater_conv><span class=command>lemma</span></span> iprev_greater_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>∧</span> iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprev_mono2_if_neq_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iprev_neq_imp_iMin less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_fix_iff><span class=command>lemma</span></span> inext_fix_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>∨</span> <span class=main>(</span>finite <span class=free>I</span> <span class=main>∧</span> Max <span class=free>I</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_Max inext_min_step2 inext_mono2_infin_fin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_fix_iff><span class=command>lemma</span></span> iprev_fix_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>n</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>∨</span> iMin <span class=free>I</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_iMin iprev_mono2_if_neq_iMin less_not_refl3<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_min_step><span class=command>lemma</span></span> iprev_min_step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>k</span><span class=main>;</span> <span class=free>k</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>k</span> <span class=main>∉</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> contrapos_pn<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"iprev <span class=free><span class=free>n</span></span> <span class=free><span class=free>I</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>k</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>k</span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iprev_def i_cut_defs<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span><span class=bound><span class=bound><span class=bound><span class=bound>x</span></span></span></span> <span class=main><span class=main>∈</span></span> <span class=free><span class=free>I</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>n</span></span><span class=main><span class=main>}</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iprev_min_step2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_min_step<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-min_step_iprev><span class=command>lemma</span></span> min_step_iprev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>k</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=bound>k</span><span class=main>;</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>k</span> <span class=main>∉</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>y</span> <span class=free>I</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_neq_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_min_step<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iprev_closed iprev_mono2 iprev_min_step<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> min_step_iprev2<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>y</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>k</span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=free>y</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>y</span> <span class=free>I</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> min_step_iprev<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-between_empty_imp_iprev_eq><span class=command>lemma</span></span> between_empty_imp_iprev_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> iprev <span class=free>n</span> <span class=free>A</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> iprev <span class=free>n</span> <span class=free>A</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>B</span> <span class=main>↓&gt;</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>A</span><span class=main>)</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>n</span> <span class=free>B</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> min_step_iprev2<span class=main>)</span>



<span class=keyword1 id=SetIntervalStep-iprev_le_mono><span class=command>lemma</span></span> iprev_le_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> iprev <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> iprev_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iprev_min_step<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_less_mono><span class=command>lemma</span></span> iprev_less_mono<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> iprev <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprev_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iprev_min_step<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_less_mono_if_neq_iMin><span class=command>lemma</span></span> iprev_less_mono_if_neq_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> iprev <span class=free>b</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_in_iff iprev_less_mono iprev_mono2_if_neq_iMin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_le_mono_rev><span class=command>lemma</span></span> iprev_le_mono_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>≤</span> iprev <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> iprev <span class=free>b</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_fix_iff iprev_less_mono_if_neq_iMin less_le_not_le<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_less_mono_rev><span class=command>lemma</span></span> iprev_less_mono_rev<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>&lt;</span> iprev <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_le_mono less_le_not_le<span class=main>)</span>



<span class=keyword1 id=SetIntervalStep-set_restriction_inext_eq><span class=command>lemma</span></span> set_restriction_inext_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>interval_fun</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>interval_fun</span> <span class=free>I</span><span class=main>;</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>interval_fun</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>n</span> <span class=main>(</span><span class=free>interval_fun</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> set_restriction_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_fix_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> set_restriction_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Max <span class=main>(</span><span class=free>interval_fun</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_equality Max_ge set_restriction_in_imp<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_fix_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_neq_implies_less<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_mono<span class=main><span class=main>,</span></span> <span class=operator>OF</span> not_sym<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> between_empty_imp_inext_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_ex_in_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> i_cut_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_min_step2 set_restriction_in_imp<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-set_restriction_inext_singleton_eq><span class=command>lemma</span></span> set_restriction_inext_singleton_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> set_restriction <span class=free>interval_fun</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>interval_fun</span> <span class=free>I</span><span class=main>;</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>∈</span> <span class=free>interval_fun</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>{</span>inext <span class=free>n</span> <span class=main>(</span><span class=free>interval_fun</span> <span class=free>I</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=free>interval_fun</span> <span class=main>{</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> set_restriction_not_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> set_restrictionD<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> P<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> singleton_iff set_eq_iff<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> set_restriction_inext_eq<span class=main>)</span>



<span class=keyword1 id=SetIntervalStep-inext_iprev><span class=command>lemma</span></span> inext_iprev<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_neq_imp_greater<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ not_sym<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iMinI iprev_min_step <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> min_step_inext iprev_mono2 iprev_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_inext_infin><span class=command>lemma</span></span> iprev_inext_infin<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>⟹</span> iprev <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_in_iff inext_min_step2 inext_mono2_infin_fin min_step_iprev2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_inext_fin><span class=command>lemma</span></span> iprev_inext_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∉</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inext_in_iff inext_min_step2 inext_mono2_infin_fin min_step_iprev2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_inext><span class=command>lemma</span></span> iprev_inext<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟹</span> iprev <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprev_inext_infin iprev_inext_fin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_eq_infin><span class=command>lemma</span></span> inext_eq_infin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> iprev <span class=bound><span class=bound>x</span></span> <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_inext_infin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_eq_fin><span class=command>lemma</span></span> inext_eq_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>≠</span> Max <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> iprev <span class=bound><span class=bound>x</span></span> <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_inext_fin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_eq_infin_fin><span class=command>lemma</span></span> inext_eq_infin_fin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_eq_fin inext_eq_infin<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=SetIntervalStep-inext_eq><span class=command>lemma</span></span> inext_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inext <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> inext <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>x</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_inext not_le wellorder_Max_lemma<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_eq_if_neq_iMin><span class=command>lemma</span></span> iprev_eq_if_neq_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> iprev <span class=free>b</span> <span class=free>I</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>a</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> inext <span class=bound><span class=bound>x</span></span> <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_iprev<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_eq><span class=command>lemma</span></span> iprev_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> iprev <span class=free>a</span> <span class=free>I</span> <span class=main>=</span> iprev <span class=free>b</span> <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>a</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> iprev_eq_if_neq_iMin not_less_iMin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-greater_imp_iprev_ge><span class=command>lemma</span></span> greater_imp_iprev_ge<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>a</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>b</span> <span class=main>≤</span> iprev <span class=free>a</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> iprev_min_step<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalStep-inext_cut_less_conv><span class=command>lemma</span></span> inext_cut_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&gt;)</span>"</span></span><span class=main><span class=main>]</span></span> cut_less_mem_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> cut_less_Min_eq cut_less_Min_not_empty<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix cut_less_not_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_cut_le_conv><span class=command>lemma</span></span> inext_cut_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=free>n</span> <span class=free>I</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_le_less_conv inext_cut_less_conv<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_cut_greater_conv><span class=command>lemma</span></span> inext_cut_greater_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> cut_greater_mem_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>,</span></span> <span class=operator>OF</span> conjI<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓&gt;)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&gt;)</span>"</span></span><span class=main><span class=main>]</span></span> cut_cut_greater max_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix cut_greater_not_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_cut_ge_conv><span class=command>lemma</span></span> inext_cut_ge_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_0_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_ge_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> inext_cut_greater_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> inext_cut_conv <span class=main>=</span>
  inext_cut_less_conv inext_cut_le_conv
  inext_cut_greater_conv inext_cut_ge_conv



<span class=keyword1 id=SetIntervalStep-iprev_cut_greater_conv><span class=command>lemma</span></span> iprev_cut_greater_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ iprev_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓&gt;)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span><span class=main><span class=main>]</span></span> cut_greater_mem_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> cut_greater_Max_eq cut_greater_Max_not_empty nat_cut_less_finite<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix cut_greater_not_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_cut_ge_conv><span class=command>lemma</span></span> iprev_cut_ge_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> iprev <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_0_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_ge_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iprev_cut_greater_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_cut_less_conv><span class=command>lemma</span></span> iprev_cut_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> cut_less_mem_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>,</span></span> <span class=operator>OF</span> conjI<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span><span class=main><span class=main>]</span></span> cut_cut_less min_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix cut_less_not_in_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_cut_le_conv><span class=command>lemma</span></span> iprev_cut_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_le_less_conv iprev_cut_less_conv<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> iprev_cut_conv <span class=main>=</span>
  iprev_cut_less_conv iprev_cut_le_conv
  iprev_cut_greater_conv iprev_cut_ge_conv

<span class=keyword1 id=SetIntervalStep-inext_cut_less_fix><span class=command>lemma</span></span> inext_cut_less_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> contra_subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_less_subset<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>of</span> <span class=main><span class=main><span class=main>_</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> <span class=free>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> cut_less_mem_iff not_in_inext_fix not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=free>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ nat_cut_less_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_mem_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> cut_less_mem_iff linorder_not_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_Max nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_cut_le_fix><span class=command>lemma</span></span> inext_cut_le_fix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> inext <span class=free>n</span> <span class=free>I</span> <span class=main>⟹</span> inext <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_le_less_conv inext_cut_less_fix<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_cut_greater_fix><span class=command>lemma</span></span> iprev_cut_greater_fix<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=free>I</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> contra_subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_greater_subset<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>of</span> <span class=main><span class=main><span class=main>_</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>t</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> cut_greater_mem_iff not_in_iprev_fix not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=free>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_mem_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> cut_greater_mem_iff iprev_min_step2 not_le_imp_less order_le_less_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_cut_ge_fix><span class=command>lemma</span></span> iprev_cut_ge_fix<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=free>n</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> iprev <span class=free>n</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_0_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_ge_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iprev_cut_greater_fix<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>CommuteWithIntervalCut4</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> set <span class=main>⇒</span> <span class=tfree>'a</span> set<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>CommuteWithIntervalCut4</span> <span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=main>≡</span>
  <span class=main>∀</span><span class=bound>t</span> <span class=bound>fun2</span> <span class=bound>I</span><span class=main>.</span>
  <span class=main>(</span><span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∨</span> <span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≤</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∨</span> <span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∨</span> <span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≥</span> <span class=bound>t</span><span class=main>)</span> <span class=main>)</span> <span class=main>⟶</span>
  <span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=main>(</span><span class=bound>fun2</span> <span class=bound>I</span><span class=main>)</span> <span class=main>=</span> <span class=bound>fun2</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=bound>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>CommuteWithIntervalCut2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>linorder<span class=main>)</span> set <span class=main>⇒</span> <span class=tfree>'a</span> set<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>CommuteWithIntervalCut2</span> <span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=main>≡</span>
  <span class=main>∀</span><span class=bound>t</span> <span class=bound>fun2</span> <span class=bound>I</span><span class=main>.</span>
  <span class=main>(</span><span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∨</span> <span class=bound>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=bound>t</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
  <span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=main>(</span><span class=bound>fun2</span> <span class=bound>I</span><span class=main>)</span> <span class=main>=</span> <span class=bound>fun2</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>fun</span></span></span> <span class=bound>I</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=SetIntervalStep-CommuteWithIntervalCut4_imp_2><span class=command>lemma</span></span> CommuteWithIntervalCut4_imp_2<span class=main>:</span> <span class=quoted><span class=quoted>"CommuteWithIntervalCut4 <span class=free>fun</span> <span class=main>⟹</span> CommuteWithIntervalCut2 <span class=free>fun</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> CommuteWithIntervalCut2_def CommuteWithIntervalCut4_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=SetIntervalStep-nat_CommuteWithIntervalCut2_4_eq><span class=command>lemma</span></span> nat_CommuteWithIntervalCut2_4_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  CommuteWithIntervalCut4 <span class=main>(</span><span class=free>fun</span><span class=main>::</span>nat set <span class=main>⇒</span> nat set<span class=main>)</span> <span class=main>=</span> CommuteWithIntervalCut2 <span class=free>fun</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> CommuteWithIntervalCut2_def CommuteWithIntervalCut4_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=improper>t</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>fun2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=improper>t</span><span class=main>)</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_le_less_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>t</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_0_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_greater_ge_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_less_CommuteWithIntervalCut4><span class=command>lemma</span></span>
  cut_less_CommuteWithIntervalCut4<span class=main>:</span>    <span class=quoted><span class=quoted>"CommuteWithIntervalCut4 <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_le_CommuteWithIntervalCut4<span class=main>:</span>      <span class=quoted><span class=quoted>"CommuteWithIntervalCut4 <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≤</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_greater_CommuteWithIntervalCut4<span class=main>:</span> <span class=quoted><span class=quoted>"CommuteWithIntervalCut4 <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓&gt;</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  cut_ge_CommuteWithIntervalCut4<span class=main>:</span>      <span class=quoted><span class=quoted>"CommuteWithIntervalCut4 <span class=main>(</span><span class=main>λ</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> CommuteWithIntervalCut4_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_commute_disj<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> i_cut_CommuteWithIntervalCut4 <span class=main>=</span>
  cut_less_CommuteWithIntervalCut4 cut_le_CommuteWithIntervalCut4
  cut_greater_CommuteWithIntervalCut4 cut_ge_CommuteWithIntervalCut4

<span class=keyword1 id=SetIntervalStep-inext_image><span class=command>lemma</span></span> inext_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> strict_mono_on <span class=free>f</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=main>(</span><span class=free>f</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_mono2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> cut_greater_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def image_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_image<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> strict_mono_on_subset iMin_mono_on2 strict_mono_on_imp_mono_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> strict_mono_on_imp_mono_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_all_le_fix linorder_not_less mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_image><span class=command>lemma</span></span> iprev_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> strict_mono_on <span class=free>f</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=main>(</span><span class=free>f</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iprev_mono2<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> cut_less_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def image_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_image<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> strict_mono_on_subset Max_mono_on2 strict_mono_on_imp_mono_on nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> strict_mono_on_imp_mono_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_all_ge_fix linorder_not_less mono_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_image2><span class=command>lemma</span></span> inext_image2<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono <span class=free>f</span> <span class=main>⟹</span> inext <span class=main>(</span><span class=free>f</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> strict_mono_imp_strict_mono_on inext_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix inj_image_mem_iff strict_mono_imp_inj<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_image2><span class=command>lemma</span></span> iprev_image2<span class=main>:</span> <span class=quoted><span class=quoted>"
  strict_mono <span class=free>f</span> <span class=main>⟹</span> iprev <span class=main>(</span><span class=free>f</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> strict_mono_imp_strict_mono_on iprev_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix inj_image_mem_iff strict_mono_imp_inj<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalStep-inext_imirror_iprev_conv><span class=command>lemma</span></span> inext_imirror_iprev_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> mirror_elem <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix not_in_inext_fix imirror_mem_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> in_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> in_imp_mirror_elem_in<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Min_empty mirror_elem_Min<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> imirror_Max<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_Max_empty imirror_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_greater'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_iMin nat_cut_less_finite cut_less_Min_eq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_greater'<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Min_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inext_imirror_iprev_conv'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> mirror_elem <span class=main>(</span>iprev <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_imirror_iprev_conv trans_le_add2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_imirror_inext_conv><span class=command>lemma</span></span> iprev_imirror_inext_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>+</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> mirror_elem <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix not_in_inext_fix imirror_mem_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> in_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> in_imp_mirror_elem_in<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_Max_empty mirror_elem_Max<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> imirror_iMin<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Min_empty imirror_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_neq_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_Max cut_greater_finite cut_greater_Max_eq <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_le_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_def nat_mirror_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_cut_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_bounds_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_Max_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iprev_imirror_inext_conv'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=main>(</span>mirror_elem <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>=</span> mirror_elem <span class=main>(</span>inext <span class=free>n</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_imirror_inext_conv trans_le_add2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_insert_ge_Max><span class=command>lemma</span></span> inext_insert_ge_Max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>≤</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span> <span class=main>(</span>insert <span class=free>a</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> insert_absorb inext_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_neq_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_step_inext2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>?</span></span><span class=main>)</span> <span class=comment1>(* blast is optional for the case, that the last goal could be solved by the simplifier in a future version, making the blast command superfluous. *)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_insert_le_iMin><span class=command>lemma</span></span> iprev_insert_le_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span> <span class=main>(</span>insert <span class=free>a</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2 insert_absorb iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_neq_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_step_iprev2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Min_conv<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>?</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_less_le_iprev_conv><span class=command>lemma</span></span> cut_less_le_iprev_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span>iprev <span class=free>t</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_ge_iff nat_cut_less_finite<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> le_less_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_neq_imp_greater<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-neq_Max_imp_inext_neq_iMin><span class=command>lemma</span></span> neq_Max_imp_inext_neq_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>t</span> <span class=free>I</span> <span class=main>≠</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> inext_mono2_infin_fin not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_neq_iMin_infin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> neq_Max_imp_inext_gr_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span><span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>&lt;</span> inext <span class=free>t</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> neq_Max_imp_inext_neq_iMin<span class=main><span class=main>[</span></span><span class=operator>THEN</span> not_sym<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_le_trans<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_le_less_inext_conv><span class=command>lemma</span></span> cut_le_less_inext_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≤</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span>inext <span class=free>t</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> cut_less_le_iprev_conv<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"inext <span class=free><span class=free>t</span></span> <span class=free><span class=free>I</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> iprev_inext<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> neq_Max_imp_inext_neq_iMin<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_ge_greater_iprev_conv><span class=command>lemma</span></span> cut_ge_greater_iprev_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=main>(</span>iprev <span class=free>t</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_neq_imp_greater<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iprev_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_defs linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iMinI<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_less_finite linorder_not_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_greater_ge_inext_conv><span class=command>lemma</span></span> cut_greater_ge_inext_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>t</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>t</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=free>t</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span>inext <span class=free>t</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> cut_ge_greater_iprev_conv<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"inext <span class=free><span class=free>t</span></span> <span class=free><span class=free>I</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> iprev_inext<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> neq_Max_imp_inext_neq_iMin<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_append><span class=command>lemma</span></span> inext_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span> <span class=keyword1>then</span> inext <span class=free>n</span> <span class=free>B</span> <span class=keyword1>else</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> Max <span class=free>A</span> <span class=keyword1>then</span> iMin <span class=free>B</span> <span class=keyword1>else</span> inext <span class=free>n</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∪</span> <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_inext_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_less_iMin_imp_disjoint<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Un_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def cut_greater_Un cut_greater_Max_empty cut_greater_Min_all<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_neq_imp_less<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def cut_greater_Un cut_greater_Min_all<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_not_empty_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Max_in<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Un<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iMin_in<span class=main><span class=main>[</span></span><span class=operator>THEN</span> cut_greater_in_imp<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_eqL<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in2<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>↓&gt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_empty_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_def cut_greater_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> inext_append_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_less_iMin_imp_disjoint<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_append Max_less_iMin_imp_disjoint<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> inext_append_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> inext <span class=free>n</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_append<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> inext_append_eq3<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=main>(</span>Max <span class=free>A</span><span class=main>)</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_append not_less_iMin<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_append><span class=command>lemma</span></span> iprev_append<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> iprev <span class=free>n</span> <span class=free>A</span> <span class=keyword1>else</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> iMin <span class=free>B</span> <span class=keyword1>then</span> Max <span class=free>A</span> <span class=keyword1>else</span> iprev <span class=free>n</span> <span class=free>B</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∪</span> <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_in_iprev_fix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_less_iMin_imp_disjoint<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Un_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in1<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_empty_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def cut_less_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in2<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def cut_less_Un cut_less_Min_empty cut_less_Max_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_neq_imp_greater<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>B</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_def cut_less_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>=</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_all_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>↓&lt;</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_not_empty_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_in<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_Un nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> max_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Max_in<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> cut_less_in_imp<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iMin_le Max_in order_less_le_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iprev_append_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_append<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> iprev_append_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=free>n</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> iprev <span class=free>n</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_less_iMin_imp_disjoint<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> disjoint_iff_in_not_in2<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iprev_append_eq3<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  iprev <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_append not_greater_Max<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"iMin <span class=free>B</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>




<span class=keyword1 id=SetIntervalStep-inext_predicate_change_exists_aux><span class=command>lemma</span></span> inext_predicate_change_exists_aux<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span>
  <span class=main>⟦</span> <span class=free>c</span> <span class=main>=</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=bound>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span><span class=main>;</span> <span class=bound>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>;</span> <span class=bound>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>a</span><span class=main>;</span> <span class=free>P</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span> <span class=main>∈</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=bound>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span>inext <span class=bound>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>c</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> not_empty_card_gr0_conv<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>OF</span> in_imp_not_empty<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>c</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a</span> <span class=main>&lt;</span> inext <span class=improper>a</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inext <span class=improper>a</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> less_imp_inext_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"inext <span class=improper>a</span> <span class=free>I</span> <span class=main>&lt;</span> <span class=free>b</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=improper>a</span> <span class=main>↓&lt;</span> <span class=free>b</span> <span class=main>=</span> <span class=main>{</span><span class=improper>a</span><span class=main>}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff i_cut_mem_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a</span> <span class=main>&lt;</span> <span class=improper>x</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_min_step<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> inext <span class=improper>a</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>a</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_greater_ge_inext_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> less_imp_neq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_gr_iff in_imp_not_empty<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a</span> <span class=main>∉</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=improper>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> insert <span class=improper>a</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>
   i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓≥)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span><span class=main><span class=main>]</span></span> i_cut_commute_disj<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(↓&gt;)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(↓&lt;)</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_greater_conv_if i_cut_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_insert_disjoint<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>inext <span class=improper>a</span> <span class=free>I</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>a</span> <span class=main>↓&lt;</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> card_0_eq<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_empty_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inext <span class=improper>a</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bspec<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_predicate_change_exists><span class=command>lemma</span></span> inext_predicate_change_exists<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=free>P</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span>inext <span class=bound>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_predicate_change_exists_aux<span class=main><span class=main>[</span></span><span class=operator>OF</span> refl<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_predicate_change_exists><span class=command>lemma</span></span> iprev_predicate_change_exists<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=free>P</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span>iprev <span class=bound>n</span> <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_predicate_change_exists<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=main><span class=main>¬</span></span> <span class=free><span class=free>P</span></span> <span class=bound><span class=bound>x</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inext <span class=improper>n</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>&lt;</span> inext <span class=improper>n</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=free>a</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> z<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inext <span class=improper>n</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> le_less_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> less_imp_inext_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> I<span class=main><span class=main>=</span></span><span class=quoted><span class=free>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> iprev_inext<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_neq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_closed Max_ge order_less_le_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_Suc_predicate_change_exists<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=free>P</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>≥</span><span class=free>a</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span>Suc <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_predicate_change_exists<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ UNIV_I UNIV_I<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_UNIV<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_pred_predicate_change_exists<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=free>P</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>≤</span><span class=free>b</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=bound>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iprev_predicate_change_exists<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ UNIV_I UNIV_I<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_UNIV<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1 id=SetIntervalStep-inext_predicate_change_exists2_all><span class=command>lemma</span></span> inext_predicate_change_exists2_all<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>b</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>k</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_predicate_change_exists<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_le<span class=main><span class=main>,</span></span>
  <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>n</span></span><span class=main><span class=main>.</span></span> <span class=keyword1><span class=keyword1>if</span></span> <span class=main><span class=main>(</span></span><span class=bound><span class=bound>n</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>a</span></span><span class=main><span class=main>)</span></span> <span class=keyword1><span class=keyword1>then</span></span> <span class=free><span class=free>P</span></span> <span class=bound><span class=bound>n</span></span> <span class=keyword1><span class=keyword1>else</span></span> <span class=main><span class=main>(</span></span><span class=main><span class=main>∀</span></span><span class=bound><span class=bound>k</span></span><span class=main><span class=main>∈</span></span><span class=free><span class=free>I</span></span><span class=main><span class=main>↓≥</span></span><span class=bound><span class=bound>n</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>P</span></span> <span class=bound><span class=bound>k</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>n</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> not_sym<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ssubst<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_greater_ge_inext_conv<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_neq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_neq_imp_less<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ Max_ge<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> inext <span class=improper>n</span> <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_mono order_less_le_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> inext <span class=improper>n</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>↓&gt;</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_greater_ge_inext_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_neq<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_closed Max_ge order_less_le_trans<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_ge_conv_if<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inext_predicate_change_exists2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=free>P</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_predicate_change_exists2_all<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>I</span></span> <span class=main><span class=main>↓≤</span></span> <span class=free><span class=free>b</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_Suc_predicate_change_exists2_all<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>≥</span><span class=free>b</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>≥</span><span class=free>a</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>&gt;</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_predicate_change_exists2_all<span class=main><span class=main>[</span></span><span class=operator>rule_format</span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> _ UNIV_I UNIV_I<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff Ball_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_Suc_predicate_change_exists2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>a</span><span class=main>;</span> <span class=free>P</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>≥</span><span class=free>a</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>≤</span><span class=free>b</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> <span class=bound>k</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_predicate_change_exists2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=quoted>UNIV</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_predicate_change_exists2_all><span class=command>lemma</span></span> iprev_predicate_change_exists2_all<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=main>∀</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>↓≤</span><span class=free>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>↓&lt;</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iprev_predicate_change_exists<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_imp_le<span class=main><span class=main>,</span></span>
  <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>n</span></span><span class=main><span class=main>.</span></span> <span class=keyword1><span class=keyword1>if</span></span> <span class=main><span class=main>(</span></span><span class=bound><span class=bound>n</span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>b</span></span><span class=main><span class=main>)</span></span> <span class=keyword1><span class=keyword1>then</span></span> <span class=free><span class=free>P</span></span> <span class=bound><span class=bound>n</span></span> <span class=keyword1><span class=keyword1>else</span></span> <span class=main><span class=main>(</span></span><span class=main><span class=main>∀</span></span><span class=bound><span class=bound>k</span></span><span class=main><span class=main>∈</span></span><span class=free><span class=free>I</span></span><span class=main><span class=main>↓≤</span></span><span class=bound><span class=bound>n</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>P</span></span> <span class=bound><span class=bound>k</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_le_less_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_le_iprev_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_le_iprev_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>&lt;</span> <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>corollary</span></span> iprev_predicate_change_exists2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=free>a</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>b</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=free>P</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>k</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>a</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iprev_predicate_change_exists2_all<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>I</span></span> <span class=main><span class=main>↓≥</span></span> <span class=free><span class=free>a</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_pred_predicate_change_exists2_all<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>≤</span><span class=free>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>&gt;</span><span class=free>a</span><span class=main>.</span> <span class=bound>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>&lt;</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iprev_predicate_change_exists2_all<span class=main><span class=main>[</span></span><span class=operator>rule_format</span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> _ UNIV_I UNIV_I<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_cut_mem_iff Ball_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nat_pred_predicate_change_exists2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>(</span><span class=free>a</span><span class=main>::</span>nat<span class=main>)</span> <span class=main>≤</span> <span class=free>b</span><span class=main>;</span> <span class=main>¬</span> <span class=free>P</span> <span class=free>b</span><span class=main>;</span> <span class=free>P</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound><span class=bound>n</span></span><span class=main>&gt;</span><span class=free>a</span><span class=main>.</span> <span class=bound>n</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>∧</span> <span class=main>¬</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>k</span></span><span class=main>≥</span><span class=free>a</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=bound>n</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iprev_predicate_change_exists2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span> <span class=quoted><span class=quoted>UNIV</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext_nth›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev_nth›</span></span></span></span> -- nth element of a natural set›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>inext_nth</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set <span class=main>⇒</span> nat <span class=main>⇒</span> nat"</span></span>   <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_ <span class=keyword1>→</span> _<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 100<span class=main>]</span> 60<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>→</span></span> <span class=main>0</span> <span class=main>=</span> iMin <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>→</span></span> Suc <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> inext <span class=main>(</span><span class=free>inext_nth</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_closed><span class=command>lemma</span></span> inext_nth_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_image><span class=command>lemma</span></span> inext_nth_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> strict_mono_on <span class=free>f</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_mono_on2 strict_mono_on_imp_mono_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_image inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_Suc_mono><span class=command>lemma</span></span> inext_nth_Suc_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>≤</span> <span class=free>I</span> <span class=main>→</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_mono<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_mono><span class=command>lemma</span></span> inext_nth_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>I</span> <span class=main>→</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=improper>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> order_trans<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_Suc_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_Suc_mono2><span class=command>lemma</span></span> inext_nth_Suc_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>→</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_nth_closed inext_mono2<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_mono2><span class=command>lemma</span></span> inext_nth_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>→</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_nth_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_less_le_trans inext_nth_Suc_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> inext_nth_Suc_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_mono2_infin><span class=command>lemma</span></span> inext_nth_mono2_infin<span class=main>:</span> <span class=quoted><span class=quoted>"
  infinite <span class=free>I</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>a</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>→</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> infinite_nat_iff_unbounded<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_Max_fix><span class=command>lemma</span></span> inext_nth_Max_fix<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>I</span> <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> Max <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>b</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalStep-inext_nth_cut_less_conv><span class=command>lemma</span></span> inext_nth_cut_less_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>I</span><span class=main>.</span> <span class=bound>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span> <span class=main>⟹</span> <span class=main>(</span><span class=bound>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=bound>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Min_eq cut_less_Min_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_cut_less_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-remove_Min_inext_nth_Suc_conv><span class=command>lemma</span></span> remove_Min_inext_nth_Suc_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>I</span><span class=main>.</span>
  Suc <span class=main>0</span> <span class=main>&lt;</span> card <span class=bound>I</span> <span class=main>∨</span> infinite <span class=bound>I</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=bound>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=bound>I</span><span class=main>}</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=bound>I</span> <span class=main>→</span> Suc <span class=free>n</span>"</span></span>
<span class=comment1>(*apply (frule card_gt_0_iff[THEN iffD1, OF gr_implies_gr0], clarify)*)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> card_gr0_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> gr_implies_gr0<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> card_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subset_singleton_conv<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> infinite_imp_nonempty infinite_imp_not_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_Min_eq_Diff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> inext_def iMinI_ex2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span>inext <span class=main>(</span><span class=improper>I</span> <span class=main>→</span> <span class=improper>n</span><span class=main>)</span> <span class=improper>I</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ssubst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_def<span class=main><span class=main>[</span></span><span class=operator>THEN</span> meta_eq_to_obj_eq<span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span>inext <span class=main>(</span><span class=improper>I</span> <span class=main>→</span> <span class=improper>n</span><span class=main>)</span> <span class=improper>I</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ssubst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_def<span class=main><span class=main>[</span></span><span class=operator>THEN</span> meta_eq_to_obj_eq<span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_closed inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"inext <span class=main>(</span><span class=improper>I</span> <span class=main>→</span> <span class=improper>n</span><span class=main>)</span> <span class=improper>I</span> <span class=main>≠</span> iMin <span class=improper>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_neq_iMin_not_card_1 inext_neq_iMin_infin<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"iMin <span class=improper>I</span> <span class=main>&lt;</span> <span class=main>(</span><span class=improper>I</span> <span class=main>→</span> Suc <span class=improper>n</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> iMin_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_Diff cut_greater_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> remove_Min_inext_nth_Suc_conv_finite<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=main>0</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=free>I</span><span class=main>}</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remove_Min_inext_nth_Suc_conv<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> remove_Min_inext_nth_Suc_conv_infinite<span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>I</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=free>I</span><span class=main>}</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remove_Min_inext_nth_Suc_conv<span class=main>)</span>


<span class=keyword1 id=SetIntervalStep-remove_Max_eq><span class=command>lemma</span></span> remove_Max_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> Max <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Max_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-remove_iMin_eq><span class=command>lemma</span></span> remove_iMin_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2 iMin_le<span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-remove_Min_eq><span class=command>lemma</span></span> remove_Min_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>n</span> <span class=main>≠</span> Min <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> Min <span class=main>(</span><span class=free>I</span> <span class=main>-</span> <span class=main>{</span><span class=free>n</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> Min <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Min_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-Max_le_iMin_conv_singleton><span class=command>lemma</span></span> Max_le_iMin_conv_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>Max <span class=free>I</span> <span class=main>≤</span> iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Min_conv Max_le_Min_conv_singleton <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_le_iff Min_ge_iff<span class=main>)</span>


<span class=keyword1 id=SetIntervalStep-inext_nth_card_less_Max><span class=command>lemma</span></span> inext_nth_card_less_Max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>I</span><span class=main>.</span> Suc <span class=free>n</span> <span class=main>&lt;</span> card <span class=bound>I</span> <span class=main>⟹</span> <span class=bound>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> Max <span class=bound>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> zero_less_Suc<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> zero_less_Suc<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less iMin_Min_conv <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_le_iff Min_ge_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Max_le_Min_conv_singleton<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remove_Min_inext_nth_Suc_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=improper>I</span> <span class=main>⊆</span> <span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> card_mono<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_Diff_singleton iMin_in Suc_less_pred_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Max <span class=improper>I</span> <span class=main>≠</span> iMin <span class=improper>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Max_le_iMin_conv_singleton<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remove_Max_eq Max_le_iMin_conv_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="SetIntervalStep-inext_nth_card_less_Max'"><span class=command>lemma</span></span> inext_nth_card_less_Max'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_less_Max<span class=main>)</span>


<span class=keyword1 id=SetIntervalStep-inext_nth_card_Max_aux><span class=command>lemma</span></span> inext_nth_card_Max_aux<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>I</span><span class=main>.</span> card <span class=bound>I</span> <span class=main>=</span> Suc <span class=free>n</span> <span class=main>⟹</span> <span class=bound>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> Max <span class=bound>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_le_trans<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> zero_less_Suc<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>OF</span> eq_imp_le<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_le_trans<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> zero_less_Suc<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>OF</span> eq_imp_le<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> card_1_singleton_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cut_tac</span> I<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=improper>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"card <span class=main>(</span><span class=improper>I</span> <span class=main>↓&lt;</span> Max <span class=improper>I</span><span class=main>)</span> <span class=main>=</span> Suc <span class=improper>n</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_le_conv cut_le_Max_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> card_gr0_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> less_le_trans<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> zero_less_Suc<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>OF</span> eq_imp_le<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Max <span class=main>(</span><span class=improper>I</span> <span class=main>↓&lt;</span> Max <span class=improper>I</span><span class=main>)</span> <span class=main>&lt;</span> iMin <span class=main>{</span>Max <span class=improper>I</span><span class=main>}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"inext_nth <span class=improper>I</span> <span class=improper>n</span> <span class=main>&lt;</span> Max <span class=improper>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_less_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_nth_cut_less_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_step_inext<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> cut_less_subset<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Max_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> A<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>↓&lt;</span> Max <span class=improper>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> not_greater_Max<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="SetIntervalStep-inext_nth_card_Max_aux'"><span class=command>lemma</span></span> inext_nth_card_Max_aux'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>I</span><span class=main>.</span> <span class=main>⟦</span> finite <span class=bound>I</span><span class=main>;</span> <span class=bound>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>I</span> <span class=main>→</span> <span class=main>(</span>card <span class=bound>I</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> Max <span class=bound>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max_aux not_empty_card_gr0_conv<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_card_Max><span class=command>lemma</span></span> inext_nth_card_Max<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≤</span> Suc <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_Max_fix<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"card <span class=free><span class=free>I</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max_aux'<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="SetIntervalStep-inext_nth_card_Max'"><span class=command>lemma</span></span> inext_nth_card_Max'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_singleton><span class=command>lemma</span></span> inext_nth_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_Max_fix<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite singleton_not_empty _ le0<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_eq_Min_conv><span class=command>lemma</span></span> inext_nth_eq_Min_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> n'<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=improper>n'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span>  inext_neq_iMin_not_singleton<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> inext_nth_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_gr_Min_conv><span class=command>lemma</span></span> inext_nth_gr_Min_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span>iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"iMin <span class=free><span class=free>I</span></span> <span class=main><span class=main>≠</span></span> <span class=free><span class=free>I</span></span> <span class=main><span class=main>→</span></span> <span class=free><span class=free>n</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"iMin <span class=free><span class=free>I</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>I</span></span> <span class=main><span class=main>→</span></span> <span class=free><span class=free>n</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iMin_le<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>of</span> <span class=main><span class=main><span class=main>_</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_neq_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> neq_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"iMin <span class=free><span class=free>I</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_eq_Min_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_gr_Min_conv_infinite><span class=command>lemma</span></span> inext_nth_gr_Min_conv_infinite<span class=main>:</span> <span class=quoted><span class=quoted>"
  infinite <span class=free>I</span> <span class=main>⟹</span> <span class=main>(</span>iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_gr_Min_conv infinite_imp_nonempty infinite_imp_not_singleton<span class=main>)</span>


<span class=keyword1 id=SetIntervalStep-inext_nth_cut_ge_inext_nth><span class=command>lemma</span></span> inext_nth_cut_ge_inext_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>I</span> <span class=bound>b</span><span class=main>.</span>
  <span class=bound>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=bound>I</span> <span class=main>↓≥</span> <span class=main>(</span><span class=bound>I</span> <span class=main>→</span> <span class=free>a</span><span class=main>)</span> <span class=main>→</span> <span class=bound>b</span> <span class=main>=</span> <span class=bound>I</span> <span class=main>→</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=bound>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_Min_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"card <span class=improper>I</span> <span class=main>=</span> Suc <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> card_1_imp_singleton<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_singleton inext_singleton cut_ge_Min_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Suc <span class=main>0</span> <span class=main>&lt;</span> card <span class=improper>I</span> <span class=main>∨</span> infinite <span class=improper>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_less not_empty_card_gr0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_singleton inext_singleton cut_ge_Min_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> subset_singleton_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=improper>I</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>b</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> meta_mp<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> remove_Min_inext_nth_Suc_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_Diff cut_ge_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"iMin <span class=improper>I</span> <span class=main>&lt;</span> inext <span class=main>(</span><span class=improper>I</span> <span class=main>→</span> <span class=improper>a</span><span class=main>)</span> <span class=improper>I</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_neq_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ not_sym<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_le inext_closed inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_neq_iMin_not_card_1 inext_neq_iMin_infin<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_append_eq1><span class=command>lemma</span></span> inext_nth_append_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> <span class=free>A</span> <span class=main>→</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>A</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_Un <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_less_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_eq<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_less_imp_le order_le_less_trans iMin_le_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ inext_nth_closed<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_neq_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> order_le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_mono<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_append_eq1 inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_card_append_eq1><span class=command>lemma</span></span> inext_nth_card_append_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>A</span> <span class=bound>B</span><span class=main>.</span><span class=main>⟦</span> Max <span class=bound>A</span> <span class=main>&lt;</span> iMin <span class=bound>B</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> card <span class=bound>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=bound>A</span> <span class=main>∪</span> <span class=bound>B</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=bound>A</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> le0<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_not_empty<span class=main><span class=main>[</span></span><span class=operator>OF</span> le_less_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> le0<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Suc_leI<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> order_le_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_append_eq1<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_less_Max less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ eq_imp_le<span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> sym<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_less_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_1_imp_singleton<span class=main><span class=main>[</span></span><span class=operator>OF</span> sym<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_insert<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"inext_nth <span class=improper>A</span> <span class=improper>n</span> <span class=main>&lt;</span> Max <span class=improper>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_card_less_Max<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_append_eq1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> min_step_inext<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_closed<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>k</span> <span class=main>&lt;</span> <span class=improper>A</span> <span class=main>→</span> Suc <span class=improper>n</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>A</span> <span class=main>→</span> Suc <span class=improper>n</span> <span class=main>=</span> Max <span class=improper>A</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_card_Max<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>A</span> <span class=main>→</span> <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> inext_min_step<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=improper>A</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> order_less_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_card_append_eq3><span class=command>lemma</span></span> inext_nth_card_append_eq3<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=main>(</span>card <span class=free>A</span><span class=main>)</span> <span class=main>=</span> iMin <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> not_empty_card_gr0_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc_pred<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"card <span class=free><span class=free>A</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> inext_nth.simps<span class=main>)</span> <span class=comment1>(* just "simp" wouldn't work, because it would revert "Suc (card A - Suc 0)" to "card A" instead of applying inext_nth.simps *)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_append_eq1 inext_nth_card_Max' inext_append_eq3<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_card_append_eq2><span class=command>lemma</span></span> inext_nth_card_append_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span><span class=main>;</span> card <span class=free>A</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>B</span> <span class=main>→</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> card <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=main>(</span>card <span class=free>A</span> <span class=main>+</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> card <span class=free>A</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> inext_nth_cut_ge_inext_nth<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> inext_nth_card_append_eq3<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_ge_Un cut_ge_Max_empty cut_ge_Min_all <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Max_less_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_card_append><span class=command>lemma</span></span> inext_nth_card_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> <span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>B</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> card <span class=free>A</span> <span class=keyword1>then</span> <span class=free>A</span> <span class=main>→</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>B</span> <span class=main>→</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> card <span class=free>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_append_eq1 inext_nth_card_append_eq2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_insert_Suc><span class=command>lemma</span></span> inext_nth_insert_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>a</span> <span class=main>&lt;</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>insert <span class=free>a</span> <span class=free>I</span><span class=main>)</span> <span class=main>→</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> not_less_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span>insert <span class=free>a</span> <span class=free>I</span> <span class=main>-</span> <span class=main>{</span>iMin <span class=main>(</span>insert <span class=free>a</span> <span class=free>I</span><span class=main>)</span><span class=main>}</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_insert min_eqL<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> remove_Min_inext_nth_Suc_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_empty_card_gr0_conv<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_cut_less_eq><span class=command>lemma</span></span> inext_nth_cut_less_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_cut_ge_ident<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> inext_nth_card_append_eq1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> card_gt_0_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>OF</span> gr_implies_gr0<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Ball_def i_cut_mem_iff iMin_gr_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-less_card_cut_less_imp_inext_nth_less><span class=command>lemma</span></span> less_card_cut_less_imp_inext_nth_less<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_cut_less_eq<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_less_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_less_less_card_conv><span class=command>lemma</span></span> inext_nth_less_less_card_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_empty_iff inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Max <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>t</span><span class=main>)</span> <span class=main>&lt;</span> iMin <span class=main>(</span><span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nat_cut_less_finite iMin_gr_iff Ball_def i_cut_mem_iff<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> ssubst<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_less_cut_ge_ident<span class=main><span class=main>[</span></span><span class=operator>OF</span> order_refl<span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>→</span></span> <span class=free><span class=free>n</span></span> <span class=main><span class=main>&lt;</span></span> <span class=free><span class=free>t</span></span>"</span></span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> inext_nth_card_append_eq2<span class=main><span class=main>[</span></span><span class=operator>OF</span> nat_cut_less_finite<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>t</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>I</span></span> <span class=main><span class=main>↓≥</span></span> <span class=free><span class=free>t</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_append_eq2 nat_cut_less_finite<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=free>t</span> <span class=main>→</span> <span class=bound>x</span> <span class=main>≥</span> <span class=free>t</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_ge_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_cut_less_eq<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> cut_less_bound<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalStep-cut_less_inext_nth_card_eq1><span class=command>lemma</span></span> cut_less_inext_nth_card_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_eq_0_iff nat_cut_less_finite cut_less_Min_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=improper>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> inext_nth_card_less_Max less_imp_neq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> cut_le_less_inext_conv<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_nth_closed<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_le_less_conv_if inext_nth_closed cut_less_mem_iff card_insert_if nat_cut_less_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_less_inext_nth_card_eq2><span class=command>lemma</span></span> cut_less_inext_nth_card_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≤</span> Suc <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> card <span class=free>I</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max cut_less_Max_eq_Diff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_less_inext_nth_card_if><span class=command>lemma</span></span> cut_less_inext_nth_card_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  card <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span><span class=main>)</span> <span class=keyword1>then</span> <span class=free>n</span> <span class=keyword1>else</span> card <span class=free>I</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_inext_nth_card_eq1 cut_less_inext_nth_card_eq2<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-cut_le_inext_nth_card_eq1><span class=command>lemma</span></span> cut_le_inext_nth_card_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_le_less_conv_if inext_nth_closed card_insert_if nat_cut_less_finite cut_less_mem_iff cut_less_inext_nth_card_eq1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_le_inext_nth_card_eq2><span class=command>lemma</span></span> cut_le_inext_nth_card_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≤</span> Suc <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> card <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> card <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_le_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_Max cut_le_Max_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-cut_le_inext_nth_card_if><span class=command>lemma</span></span> cut_le_inext_nth_card_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  card <span class=main>(</span><span class=free>I</span> <span class=main>↓≤</span> <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span><span class=main>)</span> <span class=keyword1>then</span> Suc <span class=free>n</span> <span class=keyword1>else</span> card <span class=free>I</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_le_inext_nth_card_eq1 cut_le_inext_nth_card_eq2<span class=main>)</span>


<span class=keyword1><span class=command>primrec</span></span> <span class=entity>iprev_nth</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat set <span class=main>⇒</span> nat <span class=main>⇒</span> nat"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_ <span class=keyword1>←</span> _<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 100<span class=main>]</span> 60<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>←</span></span> <span class=main>0</span> <span class=main>=</span> Max <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>←</span></span> Suc <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>=</span> iprev <span class=main>(</span><span class=free>iprev_nth</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>I</span></span></span>"</span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_closed><span class=command>lemma</span></span> iprev_nth_closed<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_image><span class=command>lemma</span></span> iprev_nth_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> strict_mono_on <span class=free>f</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>I</span><span class=main>)</span> <span class=main>←</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>I</span> <span class=main>←</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_mono_on2 strict_mono_on_imp_mono_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_image iprev_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_Suc_mono><span class=command>lemma</span></span> iprev_nth_Suc_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>←</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_mono<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_mono><span class=command>lemma</span></span> iprev_nth_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=free>b</span> <span class=main>≤</span> <span class=free>I</span> <span class=main>←</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> y<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iprev_nth <span class=free>I</span> <span class=improper>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> order_trans<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_nth_Suc_mono<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_Suc_mono2><span class=command>lemma</span></span> iprev_nth_Suc_mono2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprev_nth_closed<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_mono2><span class=command>lemma</span></span> iprev_nth_mono2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>I</span> <span class=main>←</span> <span class=free>b</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>&lt;</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> iprev_nth_mono<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_le_less_trans iprev_nth_Suc_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprev_nth_Suc_mono2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_iMin_fix><span class=command>lemma</span></span> iprev_nth_iMin_fix<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>a</span> <span class=main>=</span> iMin <span class=free>I</span><span class=main>;</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=free>b</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> le_Suc_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_singleton><span class=command>lemma</span></span> iprev_nth_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>←</span> <span class=free>n</span><span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_nth_iMin_fix<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_not_empty _ le0<span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Induction over arbitrary natural sets using the functions <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_surj_aux1><span class=command>lemma</span></span> inext_nth_surj_aux1<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span> <span class=main>=</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
   <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> as_S_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> s_S<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=var>?S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> S_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_S_not_empty <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> s_not_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=var>?P</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> s_subset<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> i_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_S_not_empty <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> s_iMin_S<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=skolem>S</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> S_not_empty <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> s_iMin_i<span class=main>:</span> <span class=quoted><span class=quoted>"iMin <span class=skolem>S</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
    <span class=keyword3><span class=command>assume</span></span> as<span class=main>:</span><span class=quoted><span class=quoted>"iMin <span class=free>I</span> <span class=main>&lt;</span> iMin <span class=skolem>S</span>"</span></span>

    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>prev</span></span> <span class=keyword2><span class=keyword>where</span></span> s_prev<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>prev</span> <span class=main>=</span> iprev <span class=main>(</span>iMin <span class=skolem>S</span><span class=main>)</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> s_prev_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>prev</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> s_prev<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_closed<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> s_iMin_i<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>have</span></span> s_prev_next_min<span class=main>:</span> <span class=quoted><span class=quoted>"inext <span class=skolem>prev</span> <span class=free>I</span> <span class=main>=</span> iMin <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> s_prev<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_iprev<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> as<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>have</span></span> s_prev_min_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>prev</span> <span class=main>&lt;</span> iMin <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> s_prev<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_mono2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"iMin <span class=skolem><span class=skolem>S</span></span>"</span></span></span> <span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> s_iMin_i<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"iMin <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> as<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMinI_ex2 i_not_empty<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>hence</span></span> prev_not_in_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>prev</span> <span class=main>∉</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_less_iMin<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span> <span class=main>=</span> <span class=skolem>prev</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> prev_not_in_s s_not_ex<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>prev</span></span></span></span></span></span><span class=main><span class=main>]</span></span> s_prev_in<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>nPrev</span></span> <span class=keyword2><span class=keyword>where</span></span> s_nPrev<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=skolem>nPrev</span> <span class=main>=</span> <span class=skolem>prev</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=main>(</span>Suc <span class=skolem>nPrev</span><span class=main>)</span> <span class=main>=</span> inext <span class=skolem>prev</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>→</span> <span class=main>(</span>Suc <span class=skolem>nPrev</span><span class=main>)</span> <span class=main>=</span> iMin <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> s_prev_next_min <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span> <span class=main>=</span> iMin <span class=skolem>S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"iMin <span class=skolem>S</span> <span class=main>∉</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> s_iMin_i s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>using</span></span> s_iMin_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> as<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>iMin <span class=free>I</span> <span class=main>&lt;</span> iMin <span class=skolem>S</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"iMin <span class=skolem>S</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> s_subset S_not_empty as<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> A<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>S</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> B<span class=main><span class=main>=</span></span><span class=quoted><span class=free>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> iMin_subset<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> s_iMin_S<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_surj_on><span class=command>lemma</span></span> inext_nth_surj_on<span class=main>:</span><span class=quoted><span class=quoted>"surj_on <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span><span class=main>)</span> UNIV <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> surj_on_conv<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> inext_nth_surj_aux1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> in_imp_ex_inext_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> surj_onD<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> A<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>UNIV</span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_surj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_induct><span class=command>lemma</span></span> inext_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span>iMin <span class=free>I</span><span class=main>)</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>inext <span class=bound>n</span> <span class=free>I</span><span class=main>)</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>→</span> <span class=bound>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> I<span class=main><span class=main>=</span></span><span class=quoted><span class=free>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> image_nat_induct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_closed<span class=main><span class=main>[</span></span><span class=operator>OF</span> in_imp_not_empty<span class=main><span class=main>]</span></span> inext_nth_surj_on<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_surj_aux1><span class=command>lemma</span></span> iprev_nth_surj_aux1<span class=main>:</span><span class=quoted><span class=quoted>"
  finite <span class=free>I</span> <span class=main>⟹</span> <span class=main>{</span> <span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>=</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> as_finite_i<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?S</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound><span class=bound>x</span></span> <span class=main>∈</span> <span class=free>I</span><span class=main>.</span> <span class=main>¬</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>=</span> <span class=bound>x</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> as_S_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>S</span></span> <span class=keyword2><span class=keyword>where</span></span> s_S<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>=</span> <span class=var>?S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> S_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_S_not_empty <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> s_not_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>=</span> <span class=bound>x</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> s_subset<span class=main>:</span><span class=quoted><span class=quoted>"<span class=skolem>S</span> <span class=main>⊆</span> <span class=free>I</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> i_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> as_S_not_empty <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>from</span></span> as_finite_i
  <span class=keyword1><span class=command>have</span></span> S_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_subset <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> finite_subset<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> s_Max_S<span class=main>:</span> <span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> S_not_empty S_finite <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> s_Max_i<span class=main>:</span> <span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> s_subset <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
    <span class=keyword3><span class=command>assume</span></span> as<span class=main>:</span><span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>&lt;</span> Max <span class=free>I</span>"</span></span>

    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>next'</span></span> <span class=keyword2><span class=keyword>where</span></span> s_next<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>next'</span> <span class=main>=</span> inext <span class=main>(</span>Max <span class=skolem>S</span><span class=main>)</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>have</span></span> s_next_in<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>next'</span> <span class=main>∈</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> s_next inext_closed s_Max_i<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> s_next_prev_max<span class=main>:</span> <span class=quoted><span class=quoted>"iprev <span class=skolem>next'</span> <span class=free>I</span> <span class=main>=</span> Max <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> s_next<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_inext<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> as<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword1><span class=command>have</span></span> s_next_max_1<span class=main>:</span> <span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>&lt;</span> <span class=skolem>next'</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> s_next<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_mono2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"Max <span class=skolem><span class=skolem>S</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> s_Max_i<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Max <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> as<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> as_finite_i i_not_empty<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>hence</span></span> next_not_in_s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>next'</span> <span class=main>∉</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> S_finite S_not_empty
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Max_ge<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>next'</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>=</span> <span class=skolem>next'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> next_not_in_s s_not_ex<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>next'</span></span></span></span></span></span><span class=main><span class=main>]</span></span> s_next_in<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>nNext</span></span> <span class=keyword2><span class=keyword>where</span></span> s_nNext<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>←</span> <span class=skolem>nNext</span> <span class=main>=</span> <span class=skolem>next'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>←</span> <span class=main>(</span>Suc <span class=skolem>nNext</span><span class=main>)</span> <span class=main>=</span> iprev <span class=skolem>next'</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>←</span> <span class=main>(</span>Suc <span class=skolem>nNext</span><span class=main>)</span> <span class=main>=</span> Max <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> s_next_prev_max <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>=</span> Max <span class=skolem>S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>∉</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> s_Max_i s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>using</span></span> s_Max_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> as<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span>Max <span class=skolem>S</span> <span class=main>&lt;</span> Max <span class=free>I</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Max <span class=skolem>S</span> <span class=main>=</span> Max <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> s_subset S_not_empty as_finite_i as<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Max_subset<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span> <span class=main>∈</span> <span class=skolem>S</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> s_Max_S<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
      <span class=keyword1><span class=command>using</span></span> s_S <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_surj_on><span class=command>lemma</span></span> iprev_nth_surj_on<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>I</span> <span class=main>⟹</span> surj_on <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span><span class=main>)</span> UNIV <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> surj_on_def<span class=main>)</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> iprev_nth_surj_aux1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> in_imp_ex_iprev_nth<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span>  <span class=free>x</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span> <span class=main>=</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> surj_onD<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>UNIV</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_nth_surj_on<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_induct><span class=command>lemma</span></span> iprev_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span>Max <span class=free>I</span><span class=main>)</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>iprev <span class=bound>n</span> <span class=free>I</span><span class=main>)</span><span class=main>;</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>I</span> <span class=main>←</span> <span class=bound>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> I<span class=main><span class=main>=</span></span><span class=quoted><span class=free>I</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> image_nat_induct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_nth_closed<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ in_imp_not_empty<span class=main><span class=main>]</span></span> iprev_nth_surj_on<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Natural intervals with <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetIntervalStep-inext_atLeast><span class=command>lemma</span></span> inext_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> inext <span class=free>t</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>=</span> Suc <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inext_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Suc <span class=free>t</span> <span class=main>∈</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> in_imp_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="SetIntervalStep-iprev_atLeast'"><span class=command>lemma</span></span> iprev_atLeast'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>t</span> <span class=main>⟹</span> iprev <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_atLeast<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_inext_infin<span class=main><span class=main>[</span></span><span class=operator>OF</span> infinite_atLeast<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_atLeast><span class=command>lemma</span></span> iprev_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> <span class=free>t</span>  <span class=main>⟹</span> iprev <span class=free>t</span> <span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>=</span> <span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> iprev_atLeast'<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>t</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> Suc <span class=main><span class=main><span class=main>0</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_atMost><span class=command>lemma</span></span> inext_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=free>t</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> Suc <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inext_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"Suc <span class=free>t</span> <span class=main>∈</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>↓&gt;</span> <span class=free>t</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> in_imp_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iMin_equality<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_greater_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_atMost><span class=command>lemma</span></span> iprev_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> iprev <span class=free>t</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>t</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> iMin_atMost<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> Suc_le_lessD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> inext_atMost<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_atMost iprev_inext_fin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_lessThan><span class=command>lemma</span></span> inext_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=free>t</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> Suc <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> Suc_pred<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> lessThan_Suc_atMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_atMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-iprev_lessThan><span class=command>lemma</span></span> iprev_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> iprev <span class=free>t</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lessThan_Suc_atMost iprev_atMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_atLeastAtMost><span class=command>lemma</span></span> inext_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>t</span><span class=main>;</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> inext <span class=free>t</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> Suc <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeastAtMost_def cut_le_Int_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> inext_atLeast inext_cut_le_conv<span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-iprev_atLeastAtMost><span class=command>lemma</span></span> iprev_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>&lt;</span> <span class=free>t</span><span class=main>;</span> <span class=free>t</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=free>t</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>t</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeastAtMost_def cut_le_Int_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> iprev_atLeast iprev_cut_le_conv<span class=main>)</span>
<span class=keyword1 id="SetIntervalStep-iprev_atLeastAtMost'"><span class=command>lemma</span></span> iprev_atLeastAtMost'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>t</span><span class=main>;</span> <span class=free>t</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> iprev <span class=main>(</span>Suc <span class=free>t</span><span class=main>)</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>=</span> <span class=free>t</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_atLeastAtMost<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"Suc <span class=free>t</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_nth_atLeast><span class=command>lemma</span></span> inext_nth_atLeast <span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>n</span><span class=main>..}</span> <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> <span class=free>n</span> <span class=main>+</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_atLeast<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_atLeast<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-inext_nth_atLeastAtMost><span class=command>lemma</span></span> inext_nth_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> <span class=free>m</span> <span class=main>+</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iMin_atLeastAtMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_atLeastAtMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-iprev_nth_atLeastAtMost><span class=command>lemma</span></span> iprev_nth_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>{</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>}</span> <span class=main>←</span> <span class=free>a</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Max_atLeastAtMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_atLeastAtMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-inext_nth_atMost><span class=command>lemma</span></span> inext_nth_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> inext_nth_atLeastAtMost<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atMost_atLeastAtMost_0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-iprev_nth_atMost><span class=command>lemma</span></span> iprev_nth_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>{..</span><span class=free>n</span><span class=main>}</span> <span class=main>←</span> <span class=free>a</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> iprev_nth_atLeastAtMost<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atMost_atLeastAtMost_0_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_lessThan><span class=command>lemma</span></span> inext_nth_lessThan <span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lessThan_Suc_atMost inext_nth_atMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=SetIntervalStep-iprev_nth_lessThan><span class=command>lemma</span></span> iprev_nth_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>{..&lt;</span><span class=free>n</span><span class=main>}</span> <span class=main>←</span> <span class=free>a</span> <span class=main>=</span> <span class=free>n</span> <span class=main>-</span> Suc <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> lessThan_Suc_atMost iprev_nth_atMost<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_UNIV><span class=command>lemma</span></span> inext_nth_UNIV<span class=main>:</span> <span class=quoted><span class=quoted>"UNIV <span class=main>→</span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_atLeast <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> atLeast_0 <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> atLeast_0<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Further result for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>inext_nth›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>iprev_nth›</span></span></span></span>›</span></span>

<span class=keyword1 id=SetIntervalStep-inext_iprev_nth_Suc><span class=command>lemma</span></span> inext_iprev_nth_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span> <span class=main>⟹</span> inext <span class=main>(</span><span class=free>I</span> <span class=main>←</span> Suc <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_iprev<span class=main>)</span>

<span class=keyword1 id=SetIntervalStep-inext_iprev_nth_pred><span class=command>lemma</span></span> inext_iprev_nth_pred<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> iMin <span class=free>I</span> <span class=main>≠</span> <span class=free>I</span> <span class=main>←</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span>
  inext <span class=main>(</span><span class=free>I</span> <span class=main>←</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>←</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_iprev<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_inext_nth_Suc><span class=command>lemma</span></span> iprev_inext_nth_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>→</span> <span class=free>n</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟹</span> iprev <span class=main>(</span><span class=free>I</span> <span class=main>→</span> Suc <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_inext<span class=main>)</span>
<span class=keyword1 id=SetIntervalStep-iprev_inext_nth_pred><span class=command>lemma</span></span> iprev_inext_nth_pred<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>I</span> <span class=main>→</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span> <span class=main>≠</span> Max <span class=free>I</span> <span class=main>∨</span> infinite <span class=free>I</span> <span class=main>⟹</span>
  iprev <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_iMin<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_inext<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-inext_nth_imirror_iprev_nth_conv><span class=command>lemma</span></span> inext_nth_imirror_iprev_nth_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span> <span class=main>=</span> mirror_elem <span class=main>(</span><span class=free>I</span> <span class=main>←</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_iMin mirror_elem_Max<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_imirror_iprev_conv' iprev_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inext_nth_imirror_iprev_nth_conv2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  mirror_elem <span class=main>(</span><span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>←</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=free>I</span> <span class=main>→</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> inext_nth_imirror_iprev_nth_conv<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_finite imirror_not_empty<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_imirror_ident mirror_elem_imirror<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=SetIntervalStep-iprev_nth_imirror_inext_nth_conv><span class=command>lemma</span></span> iprev_nth_imirror_inext_nth_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>←</span> <span class=free>n</span> <span class=main>=</span> mirror_elem <span class=main>(</span><span class=free>I</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_Max mirror_elem_Min<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_imirror_inext_conv' inext_nth_closed<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> iprev_nth_imirror_inext_nth_conv2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  mirror_elem <span class=main>(</span><span class=main>(</span>imirror <span class=free>I</span><span class=main>)</span> <span class=main>→</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> <span class=main>(</span><span class=free>I</span> <span class=main>←</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> iprev_nth_imirror_inext_nth_conv<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_finite imirror_not_empty<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> imirror_imirror_ident mirror_elem_imirror<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_card_greater_iMin><span class=command>lemma</span></span> iprev_nth_card_greater_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>&lt;</span> card <span class=free>I</span> <span class=main>⟹</span> iMin <span class=free>I</span> <span class=main>&lt;</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=quoted><span class=quoted>"finite <span class=free>I</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_gr0_imp_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_gr0_imp_not_empty<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iprev_nth_imirror_inext_nth_conv2<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_Max<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_imirror<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_imirror<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> imirror_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>frule</span> imirror_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> mirror_elem_less_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inext_nth_closed<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_Max<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> Max_in<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_Max<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inext_nth_card_less_Max imirror_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=SetIntervalStep-iprev_nth_card_iMin><span class=command>lemma</span></span> iprev_nth_card_iMin<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>≤</span> Suc <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> iprev_nth_imirror_inext_nth_conv2<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_Max<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_imirror<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mirror_elem_imirror<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> imirror_Max<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> imirror_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>frule</span> imirror_not_empty<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_elem_eq_conv' inext_nth_closed inext_nth_card_Max imirror_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="SetIntervalStep-iprev_nth_card_iMin'"><span class=command>lemma</span></span> iprev_nth_card_iMin'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>;</span> card <span class=free>I</span> <span class=main>-</span> Suc <span class=main>0</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>I</span> <span class=main>←</span> <span class=free>n</span> <span class=main>=</span> iMin <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprev_nth_card_iMin<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=List2><div class=head><h1>Theory List2</h1></div><pre class=source><span class=comment1>(*  Title:      List2.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Additional definitions and results for lists›</span></span>

<span class=keyword1><span class=command>theory</span></span> List2
<span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=SetIntervalCut.html>../CommonSet/SetIntervalCut</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional definitions and results for lists›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Infix syntactical abbreviations for operators <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>take</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>drop</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
  The abbreviations resemble to the operator symbols used later
  for take and drop operators on infinite lists in ListInf.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>f_take'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main><span class=free>↓</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> take <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>f_drop'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↑</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main><span class=free>↑</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> drop <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=List2-append_eq_Cons><span class=command>lemma</span></span> append_eq_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>@</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-length_Cons><span class=command>lemma</span></span> length_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-length_snoc><span class=command>lemma</span></span> length_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Additional lemmata about list emptiness›</span></span>

<span class=keyword1 id=List2-length_greater_imp_not_empty><span class=command>lemma</span></span> length_greater_imp_not_empty<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=List2-length_ge_Suc_imp_not_empty><span class=command>lemma</span></span> length_ge_Suc_imp_not_empty<span class=main>:</span><span class=quoted><span class=quoted>"Suc <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=List2-length_take_le><span class=command>lemma</span></span> length_take_le<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=main>≤</span> length <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-take_not_empty_conv><span class=command>lemma</span></span> take_not_empty_conv<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-drop_not_empty_conv><span class=command>lemma</span></span> drop_not_empty_conv<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=List2-zip_eq_Nil><span class=command>lemma</span></span> zip_eq_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> min_def <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main>)</span>

<span class=keyword1 id=List2-zip_not_empty_conv><span class=command>lemma</span></span> zip_not_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>∧</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_eq_Nil<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Additional lemmata about <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>take</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>drop</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>hd</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>last</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>nth›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>filter›</span></span></span></span>›</span></span>

<span class=keyword1 id=List2-nth_tl_eq_nth_Suc><span class=command>lemma</span></span> nth_tl_eq_nth_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  Suc <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span>tl <span class=free>xs</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> hd_Cons_tl<span class=main><span class=main>[</span></span><span class=operator>OF</span> length_ge_Suc_imp_not_empty<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> subst<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> nth_tl_eq_nth_Suc2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span>tl <span class=free>xs</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_tl_eq_nth_Suc<span class=main>)</span>

<span class=keyword1 id=List2-hd_eq_first><span class=command>lemma</span></span> hd_eq_first<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> hd <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> take_first<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span>  <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free>xs</span> <span class=main>!</span> <span class=main>0</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> take_hd<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span>  <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span>hd <span class=free>xs</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_first hd_eq_first<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> last_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> last <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> last_conv_nth<span class=main>)</span>

<span class=keyword1 id=List2-last_take><span class=command>lemma</span></span> last_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> last <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> last_nth length_greater_imp_not_empty min_eqR<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> last_take2<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> last <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> diff_Suc_less<span class=main><span class=main>[</span></span><span class=operator>THEN</span> order_less_le_trans<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"length <span class=free><span class=free>xs</span></span>"</span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> last_take<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>n</span></span> <span class=main><span class=main>-</span></span> Suc <span class=main><span class=main>0</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nth_0_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=main>!</span> <span class=main>0</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cut_tac</span> nth_drop<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>


<span class=keyword1 id=List2-drop_eq_tl><span class=command>lemma</span></span> drop_eq_tl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>↑</span> <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> tl <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_Suc<span class=main>)</span>

<span class=keyword1 id=List2-drop_take_1><span class=command>lemma</span></span> drop_take_1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span> <span class=main>↓</span> <span class=main>(</span>Suc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_hd hd_drop_conv_nth<span class=main>)</span>

<span class=keyword1 id=List2-upt_append><span class=command>lemma</span></span> upt_append<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>m</span><span class=main>]</span> <span class=main>@</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> upt_add_eq_append<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>n</span></span></span> <span class=main><span class=main><span class=main>-</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=List2-nth_append1><span class=command>lemma</span></span> nth_append1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span>
<span class=keyword1 id=List2-nth_append2><span class=command>lemma</span></span> nth_append2<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>!</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span>


<span class=keyword1 id=List2-list_all_conv><span class=command>lemma</span></span> list_all_conv<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>xs</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> list_all_length<span class=main>)</span>

<span class=keyword1 id=List2-expand_list_eq><span class=command>lemma</span></span> expand_list_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>=</span> length <span class=bound>ys</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>xs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>=</span> <span class=bound>ys</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> list_eq_iff_nth_eq<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> list_eq_iff <span class=main>=</span> expand_list_eq


<span class=keyword1 id=List2-list_take_drop_imp_eq><span class=command>lemma</span></span> list_take_drop_imp_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span><span class=main>;</span>  <span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↑</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> append_take_drop_id<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>OF</span> append_take_drop_id<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>ys</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_take_drop_eq_conv><span class=command>lemma</span></span> list_take_drop_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>↑</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> list_take_drop_imp_eq<span class=main>)</span>

<span class=keyword1 id=List2-list_take_eq_conv><span class=command>lemma</span></span> list_take_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>xs</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"max <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_drop_eq_conv><span class=command>lemma</span></span> list_drop_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>xs</span> <span class=main>↑</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>replicate'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>  <span class=main>(</span><span class=quoted>"_<span class=keyword1>⇗</span>_<span class=keyword1>⇖</span>"</span> <span class=main>[</span>1000<span class=main>,</span>65<span class=main>]</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>x</span></span></span><span class=hidden>⇗</span><sup><span class=free><span class=bound><span class=entity>n</span></span></span></sup><span class=hidden>⇖</span> <span class=main>≡</span> replicate <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span>"</span></span>

<span class=keyword1 id=List2-replicate_snoc><span class=command>lemma</span></span> replicate_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=free>x</span><span class=hidden>⇗</span><sup>Suc <span class=free>n</span></sup><span class=hidden>⇖</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> replicate_app_Cons_same<span class=main>)</span>

<span class=keyword1 id=List2-eq_replicate_conv><span class=command>lemma</span></span> eq_replicate_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>xs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>m</span><span class=hidden>⇗</span><sup>length <span class=free>xs</span></sup><span class=hidden>⇖</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ssubst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"replicate <span class=main><span class=main>(</span></span>length <span class=free><span class=free>xs</span></span><span class=main><span class=main>)</span></span> <span class=free><span class=free>m</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> nth_replicate<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-replicate_Cons_length><span class=command>lemma</span></span> replicate_Cons_length<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>a</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span><span class=main>)</span> <span class=main>=</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=List2-replicate_pred_Cons_length><span class=command>lemma</span></span> replicate_pred_Cons_length<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> length <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>a</span><span class=hidden>⇗</span><sup><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span></sup><span class=hidden>⇖</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-replicate_le_diff><span class=command>lemma</span></span> replicate_le_diff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>m</span></sup><span class=hidden>⇖</span> <span class=main>@</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span> <span class=main>-</span> <span class=free>m</span></sup><span class=hidden>⇖</span> <span class=main>=</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> replicate_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=List2-replicate_le_diff2><span class=command>lemma</span></span> replicate_le_diff2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>k</span> <span class=main>≤</span> <span class=free>m</span><span class=main>;</span> <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>m</span> <span class=main>-</span> <span class=free>k</span></sup><span class=hidden>⇖</span> <span class=main>@</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span> <span class=main>-</span> <span class=free>m</span></sup><span class=hidden>⇖</span> <span class=main>=</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span> <span class=main>-</span> <span class=free>k</span></sup><span class=hidden>⇖</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> replicate_add<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=List2-append_constant_length_induct_aux><span class=command>lemma</span></span> append_constant_length_induct_aux<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  <span class=main>⟦</span> length <span class=bound>xs</span> <span class=keyword1>div</span> <span class=free>k</span> <span class=main>=</span> <span class=free>n</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> length <span class=bound>ys</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>ys</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>xs</span> <span class=bound>ys</span><span class=main>.</span> <span class=main>⟦</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=free>P</span> <span class=bound>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>@</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_eq_0_conv'<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≤</span> length <span class=improper>xs</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> div_gr_imp_gr_divisor<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> atomize_all atomize_imp<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"drop <span class=free>k</span> <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> div_diff_self2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted>undefined</span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"take <span class=free>k</span> <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"drop <span class=free>k</span> <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-append_constant_length_induct><span class=command>lemma</span></span> append_constant_length_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span> <span class=free>k</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> length <span class=bound>ys</span> <span class=main>&lt;</span> <span class=free>k</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>ys</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>xs</span> <span class=bound>ys</span><span class=main>.</span> <span class=main>⟦</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=free>P</span> <span class=bound>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>@</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> append_constant_length_induct_aux<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=keyword1>div</span> <span class=free>k</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=List2-zip_swap><span class=command>lemma</span></span> zip_swap<span class=main>:</span> <span class=quoted><span class=quoted>"map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>y</span><span class=main>,</span><span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>zip <span class=free>ys</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=List2-zip_takeL><span class=command>lemma</span></span> zip_takeL<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> zip <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=List2-zip_takeR><span class=command>lemma</span></span> zip_takeR<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> zip <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> zip_swap<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>ys</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> take_map<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> zip_takeL<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zip_swap<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-zip_take><span class=command>lemma</span></span> zip_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> zip <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> take_zip<span class=main>)</span>

<span class=keyword1 id=List2-hd_zip><span class=command>lemma</span></span> hd_zip<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>;</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟧</span> <span class=main>⟹</span> hd <span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>hd <span class=free>xs</span><span class=main>,</span> hd <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth zip_not_empty_conv<span class=main>)</span>

<span class=keyword1 id=List2-map_id><span class=command>lemma</span></span> map_id<span class=main>:</span> <span class=quoted><span class=quoted>"map id <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> id_def<span class=main>)</span>

<span class=keyword1 id=List2-map_id_subst><span class=command>lemma</span></span> map_id_subst<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>map id <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> map_id<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=List2-map_one><span class=command>lemma</span></span> map_one<span class=main>:</span> <span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>=</span> <span class=main>[</span><span class=free>f</span> <span class=free>x</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-map_last><span class=command>lemma</span></span> map_last<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> last <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> last_map<span class=main>)</span>


<span class=keyword1 id=List2-filter_list_all><span class=command>lemma</span></span> filter_list_all<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=free>P</span> <span class=free>xs</span> <span class=main>⟹</span> filter <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List2-filter_snoc><span class=command>lemma</span></span> filter_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"filter <span class=free>P</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=free>x</span> <span class=keyword1>then</span> <span class=main>(</span>filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=keyword1>else</span> filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>x</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List2-filter_filter_eq><span class=command>lemma</span></span> filter_filter_eq<span class=main>:</span> <span class=quoted><span class=quoted>"list_all <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>Q</span> <span class=bound>x</span><span class=main>)</span> <span class=free>xs</span> <span class=main>⟹</span> filter <span class=free>P</span> <span class=free>xs</span> <span class=main>=</span> filter <span class=free>Q</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List2-filter_nth><span class=command>lemma</span></span> filter_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span><span class=main>.</span>
  <span class=bound>n</span> <span class=main>&lt;</span> length <span class=main>(</span>filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span>filter <span class=free>P</span> <span class=free>xs</span><span class=main>)</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>k</span><span class=main>.</span>
    <span class=bound>k</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>∧</span>
    <span class=bound>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> x xs n<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> filter_snoc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
   t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=main>[</span><span class=improper>x</span><span class=main>]</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
   s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span> <span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>P</span> <span class=improper>x</span>"</span></span>
   <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> Least_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> Suc <span class=main>(</span>length <span class=improper>xs</span><span class=main>)</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=improper>xs</span> <span class=main>@</span> <span class=main>[</span><span class=improper>x</span><span class=main>]</span><span class=main>)</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=main>(</span>card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>+</span>
           <span class=main>(</span><span class=keyword1>if</span> <span class=bound>k</span> <span class=main>≥</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=improper>x</span> <span class=keyword1>then</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> fun_eq_iff <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> k<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq conj_disj_distribL conj_disj_distribR Collect_disj_eq<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> card_Un_disjoint<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bounded_nat_set_is_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> n<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=main>(</span>length <span class=improper>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bounded_nat_set_is_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
   t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=improper>xs</span> <span class=main>@</span> <span class=main>[</span><span class=improper>x</span><span class=main>]</span><span class=main>)</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
   s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
   <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fun_eq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_append1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> add_left_cancel<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
   t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>≤</span> <span class=improper>k</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=improper>xs</span> <span class=main>@</span> <span class=main>[</span><span class=improper>x</span><span class=main>]</span><span class=main>)</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
   s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>≤</span> <span class=improper>k</span> <span class=main>∧</span> <span class=free>P</span> <span class=improper>x</span>"</span></span>
   <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fun_eq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=improper>xs</span> <span class=main>≤</span> <span class=improper>k</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
    t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>≤</span> <span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
    s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>=</span> length <span class=improper>xs</span>"</span></span>
    <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fun_eq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_Suc_eq conj_disj_distribL conj_disj_distribR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span>
           <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>+</span> <span class=main>(</span><span class=keyword1>if</span> length <span class=improper>xs</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=free>P</span> <span class=improper>x</span> <span class=keyword1>then</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span>
           <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>+</span> <span class=main>(</span><span class=keyword1>if</span> length <span class=improper>xs</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=free>P</span> <span class=improper>x</span> <span class=keyword1>then</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span>
           <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>+</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=improper>x</span> <span class=keyword1>then</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>&lt;</span> length <span class=main>(</span>filter <span class=free>P</span> <span class=improper>xs</span><span class=main>)</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
   t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=free>P</span> <span class=improper>x</span> <span class=keyword1>then</span> filter <span class=free>P</span> <span class=improper>xs</span> <span class=main>@</span> <span class=main>[</span><span class=improper>x</span><span class=main>]</span> <span class=keyword1>else</span> filter <span class=free>P</span> <span class=improper>xs</span><span class=main>)</span> <span class=main>!</span> <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
   s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>filter <span class=free>P</span> <span class=improper>xs</span><span class=main>)</span> <span class=main>!</span> <span class=improper>n</span>"</span></span>
   <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>k</span></span><span class=main>&lt;</span>length <span class=improper>xs</span><span class=main>.</span> <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=improper>xs</span> <span class=main>-</span> Suc <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_filter_conv_card less_eq_le_pred<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>k</span></span><span class=main>≤</span>length <span class=improper>xs</span><span class=main>.</span> <span class=improper>n</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> less_imp_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Least_le_imp_le_disj<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> nth_append1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> LeastI2_ex<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=improper>x</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_snoc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> less_Suc_eq_le<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>n</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> order_antisym<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_filter_conv_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>&lt;</span> card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>k</span><span class=main>.</span> False"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> fun_eq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> allI<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> k<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>LEAST</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>=</span> length <span class=improper>xs</span> <span class=main>∧</span>
                 card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span> <span class=main>&lt;</span> Suc <span class=main>(</span>card <span class=main>{</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>≤</span> <span class=bound>k</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=improper>xs</span> <span class=main>∧</span> <span class=free>P</span> <span class=main>(</span><span class=improper>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"length <span class=improper>xs</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Least_equality<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_imp_less_Suc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_mono<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Ordered lists›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>list_ord</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>ord<span class=main>)</span> list <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_ord</span> <span class=free><span class=bound><span class=entity>ord</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x1</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>x2</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ord</span></span></span> <span class=free><span class=bound><span class=entity>x1</span></span></span> <span class=free><span class=bound><span class=entity>x2</span></span></span> <span class=main>∧</span> <span class=free>list_ord</span> <span class=free><span class=bound><span class=entity>ord</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x2</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>list_ord</span> <span class=free><span class=bound><span class=entity>ord</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> True"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>list_asc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>ord<span class=main>)</span> list <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_asc</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> list_ord <span class=main>(≤)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>list_strict_asc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>ord<span class=main>)</span> list <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_strict_asc</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> list_ord <span class=main>(&lt;)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"list_asc  <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span> <span class=numeral>2</span><span class=main>,</span> <span class=numeral>2</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"list_strict_asc  <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span> <span class=numeral>2</span><span class=main>,</span> <span class=numeral>2</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>list_desc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>ord<span class=main>)</span> list <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_desc</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> list_ord <span class=main>(≥)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>list_strict_desc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>ord<span class=main>)</span> list <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>list_strict_desc</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> list_ord <span class=main>(&gt;)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span>"</span></span>

<span class=keyword1 id=List2-list_ord_Nil><span class=command>lemma</span></span> list_ord_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"list_ord <span class=free>ord</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=List2-list_ord_one><span class=command>lemma</span></span> list_ord_one<span class=main>:</span> <span class=quoted><span class=quoted>"list_ord <span class=free>ord</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=List2-list_ord_Cons><span class=command>lemma</span></span> list_ord_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_ord <span class=free>ord</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=main>(</span><span class=free>ord</span> <span class=free>x</span> <span class=main>(</span>hd <span class=free>xs</span><span class=main>)</span> <span class=main>∧</span> list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=List2-list_ord_Cons_imp><span class=command>lemma</span></span> list_ord_Cons_imp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>;</span> <span class=free>ord</span> <span class=free>x</span> <span class=main>(</span>hd <span class=free>xs</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> list_ord <span class=free>ord</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=List2-list_ord_append><span class=command>lemma</span></span> list_ord_append<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span>
  list_ord <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span>list_ord <span class=free>ord</span> <span class=free>xs</span> <span class=main>∧</span>
  <span class=main>(</span><span class=bound>ys</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=main>(</span>list_ord <span class=free>ord</span> <span class=bound>ys</span> <span class=main>∧</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=free>ord</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>hd <span class=bound>ys</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=List2-list_ord_snoc><span class=command>lemma</span></span> list_ord_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_ord <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>∨</span> <span class=main>(</span><span class=free>ord</span> <span class=main>(</span>last <span class=free>xs</span><span class=main>)</span> <span class=free>x</span> <span class=main>∧</span> list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list_ord_append<span class=main>)</span>

<span class=keyword1 id=List2-list_ord_all_conv><span class=command>lemma</span></span> list_ord_all_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>n</span></span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>-</span> <span class=main>1</span><span class=main>.</span> <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> Suc <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_Cons<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> disjE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_Cons<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> meta_mp<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> allI impI<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> n<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_imp><span class=command>lemma</span></span> list_ord_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>ord</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟹</span> <span class=free>ord'</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>;</span> list_ord <span class=free>ord</span> <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  list_ord <span class=free>ord'</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_Cons<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>corollary</span></span> list_strict_asc_imp_list_asc<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_strict_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span> <span class=main>⟹</span> list_asc <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> list_strict_asc_def list_asc_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> list_ord_imp<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(&lt;)</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> order_less_imp_le<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> list_strict_desc_imp_list_desc<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_strict_desc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span> <span class=main>⟹</span> list_desc <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> list_strict_desc_def list_desc_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> list_ord_imp<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(&gt;)</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> order_less_imp_le<span class=main>)</span>

<span class=keyword1 id=List2-list_ord_trans_imp><span class=command>lemma</span></span> list_ord_trans_imp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span><span class=main>.</span>
  <span class=main>⟦</span> transP <span class=free>ord</span><span class=main>;</span> list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>;</span> <span class=free>j</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_all_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>j</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>j</span> <span class=main>&lt;</span> <span class=improper>i</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_less<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>i</span> <span class=main>=</span> <span class=improper>j</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>i</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> meta_spec<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>j</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Suc_less_pred_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> trans_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>!</span> <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main><span class=keyword3>,</span></span> <span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>!</span> <span class=improper>j</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main><span class=keyword3>,</span></span> <span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>!</span> Suc <span class=improper>j</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_trans><span class=command>lemma</span></span> list_ord_trans<span class=main>:</span> <span class=quoted><span class=quoted>"
  transP <span class=free>ord</span> <span class=main>⟹</span>
  <span class=main>(</span>list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> <span class=bound>j</span><span class=main>.</span> <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_trans_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_all_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_trans_refl_le><span class=command>lemma</span></span> list_ord_trans_refl_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> transP <span class=free>ord</span><span class=main>;</span> reflP <span class=free>ord</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>≤</span> <span class=bound>j</span><span class=main>.</span> <span class=free>ord</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> list_ord_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>i</span> <span class=main>=</span> <span class=improper>j</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> refl_on_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_trans_refl_le_imp><span class=command>lemma</span></span> list_ord_trans_refl_le_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> transP <span class=free>ord</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>ord</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟹</span> <span class=free>ord'</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>;</span> reflP <span class=free>ord'</span><span class=main>;</span>
    list_ord <span class=free>ord</span> <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>≤</span> <span class=bound>j</span><span class=main>.</span> <span class=free>ord'</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>i</span> <span class=main>=</span> <span class=improper>j</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> refl_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_trans_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span>
  list_asc_trans<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>≤</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  list_strict_asc_trans<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_strict_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>&lt;</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  list_desc_trans<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_desc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span> <span class=main>≤</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  list_strict_desc_trans<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_strict_desc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>&lt;</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span> <span class=main>&lt;</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> list_asc_def list_strict_asc_def list_desc_def list_strict_desc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> list_ord_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> trans_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_trans order_less_trans<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span>
  list_asc_trans_le<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>≤</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>≤</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  list_desc_trans_le<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_desc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>≤</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span> <span class=main>≤</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> list_asc_def list_strict_asc_def list_desc_def list_strict_desc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> list_ord_trans_refl_le<span class=main><span class=keyword3>,</span></span> <span class=operator>unfold</span> trans_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_trans<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> refl_on_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span>
  list_strict_asc_trans_le<span class=main>:</span> <span class=quoted><span class=quoted>"
    <span class=main>(</span>list_strict_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>j</span></span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>i</span></span> <span class=main>≤</span> <span class=bound>j</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>≤</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> list_strict_asc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> list_ord_trans_refl_le_imp<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> ord<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(≤)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> trans_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> order_trans<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>assumption</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> refl_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> list_ord_imp<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> ord<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(&lt;)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_imp_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_le_sorted_eq><span class=command>lemma</span></span> list_ord_le_sorted_eq<span class=main>:</span> <span class=quoted><span class=quoted>"list_asc <span class=free>xs</span> <span class=main>=</span> sorted <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_asc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> x xs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_Cons<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"list_ord <span class=main>(≤)</span> <span class=improper>xs</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"hd <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bspec<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarify</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> in_set_conv_nth<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>i1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> i2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fold</span> list_asc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> list_asc_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> list_asc_upto<span class=main>:</span> <span class=quoted><span class=quoted>"list_asc <span class=main>[</span><span class=free>m</span><span class=main>..</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_le_sorted_eq<span class=main>)</span>

<span class=keyword1 id=List2-list_strict_asc_upt><span class=command>lemma</span></span> list_strict_asc_upt<span class=main>:</span> <span class=quoted><span class=quoted>"list_strict_asc <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_strict_asc_def list_ord_all_conv<span class=main>)</span>


<span class=keyword1 id=List2-list_ord_distinct_aux><span class=command>lemma</span></span> list_ord_distinct_aux<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> irrefl <span class=main>{</span><span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>)</span><span class=main>.</span> <span class=free>ord</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>}</span><span class=main>;</span> transP <span class=free>ord</span><span class=main>;</span> list_ord <span class=free>ord</span> <span class=free>xs</span><span class=main>;</span>
    <span class=free>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>j</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>i</span> <span class=main>&lt;</span> <span class=free>j</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>xs</span> <span class=main>!</span> <span class=free>i</span> <span class=main>≠</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>j</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>ord</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> irrefl_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_ord_distinct><span class=command>lemma</span></span> list_ord_distinct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> irrefl <span class=main>{</span><span class=main>(</span><span class=bound>a</span><span class=main>,</span><span class=bound>b</span><span class=main>)</span><span class=main>.</span> <span class=free>ord</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>}</span><span class=main>;</span> transP <span class=free>ord</span><span class=main>;</span> list_ord <span class=free>ord</span> <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  distinct <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> distinct_conv_nth<span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> allI impI<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i j<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_distinct_aux<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_ord_distinct_aux<span class=main><span class=main>[</span></span><span class=operator>THEN</span> not_sym<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_strict_asc_distinct><span class=command>lemma</span></span> list_strict_asc_distinct<span class=main>:</span> <span class=quoted><span class=quoted>"list_strict_asc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span> <span class=main>⟹</span> distinct <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> ord<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(&lt;)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> list_ord_distinct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> irrefl_def list_strict_asc_def trans_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> less_trans<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-list_strict_desc_distinct><span class=command>lemma</span></span> list_strict_desc_distinct<span class=main>:</span> <span class=quoted><span class=quoted>"list_strict_desc <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span><span class=main>::</span>preorder list<span class=main>)</span> <span class=main>⟹</span> distinct <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> ord<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(&gt;)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> list_ord_distinct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> irrefl_def list_strict_desc_def trans_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> less_trans<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Additional definitions and results for sublists›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>sublist_list</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sublist_list</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>sublist_list</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>!</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=main>(</span><span class=free>sublist_list</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"sublist_list <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"sublist_list <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=main>1</span><span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=main>[</span>nbe<span class=main>]</span> <span class=quoted><span class=quoted>"sublist_list <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=main>1</span><span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>10</span><span class=main>]</span>"</span></span>

<span class=keyword1 id=List2-sublist_list_length><span class=command>lemma</span></span> sublist_list_length<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span>sublist_list <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> length <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_append><span class=command>lemma</span></span> sublist_list_append<span class=main>:</span> <span class=quoted><span class=quoted>"
 <span class=main>⋀</span><span class=bound>zs</span><span class=main>.</span> sublist_list <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=bound>zs</span><span class=main>)</span> <span class=main>=</span> sublist_list <span class=free>xs</span> <span class=free>ys</span> <span class=main>@</span> sublist_list <span class=free>xs</span> <span class=bound>zs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_Nil><span class=command>lemma</span></span> sublist_list_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"sublist_list <span class=free>xs</span> <span class=main>[]</span> <span class=main>=</span><span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-sublist_list_is_Nil_conv><span class=command>lemma</span></span> sublist_list_is_Nil_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>sublist_list <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> neq_Nil_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-sublist_list_eq_imp_length_eq><span class=command>lemma</span></span> sublist_list_eq_imp_length_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  sublist_list <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> sublist_list <span class=free>xs</span> <span class=free>zs</span> <span class=main>⟹</span> length <span class=free>ys</span> <span class=main>=</span> length <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>length</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_length<span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_nth><span class=command>lemma</span></span> sublist_list_nth<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>ys</span> <span class=main>⟹</span> sublist_list <span class=free>xs</span> <span class=free>ys</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=free>ys</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-take_drop_eq_sublist_list><span class=command>lemma</span></span> take_drop_eq_sublist_list<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↑</span> <span class=free>m</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> sublist_list <span class=free>xs</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>m</span><span class=main>+</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> length_upt<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>m</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>m</span></span><span class=main><span class=main>+</span></span><span class=free><span class=free>n</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_length<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> add_le_imp_le_diff2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>primrec</span></span> <span class=entity>sublist_list_if</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sublist_list_if</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>sublist_list_if</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>then</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>!</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=main>(</span><span class=free>sublist_list_if</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>
     <span class=keyword1>else</span> <span class=main>(</span><span class=free>sublist_list_if</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"sublist_list_if <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"sublist_list_if <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=main>1</span><span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"sublist_list_if <span class=main>[</span><span class=main>0</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>10</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>20</span><span class=main>,</span><span class=numeral>30</span><span class=main>,</span><span class=numeral>40</span><span class=main>,</span><span class=numeral>50</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>nat<span class=main>,</span><span class=main>1</span><span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>10</span><span class=main>]</span>"</span></span>

<span class=keyword1 id=List2-sublist_list_if_sublist_list_filter_conv><span class=command>lemma</span></span> sublist_list_if_sublist_list_filter_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  sublist_list_if <span class=bound>xs</span> <span class=free>ys</span> <span class=main>=</span> sublist_list <span class=bound>xs</span> <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=bound>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> sublist_list_if_sublist_list_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  list_all <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=bound>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>⟹</span>
  sublist_list_if <span class=bound>xs</span> <span class=free>ys</span> <span class=main>=</span> sublist_list <span class=bound>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv filter_list_all<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> sublist_list_if_sublist_list_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  <span class=main>∀</span><span class=bound><span class=bound>n</span></span><span class=main>&lt;</span>length <span class=free>ys</span><span class=main>.</span> <span class=free>ys</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=bound>xs</span> <span class=main>⟹</span>
  sublist_list_if <span class=bound>xs</span> <span class=free>ys</span> <span class=main>=</span> sublist_list <span class=bound>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> sublist_list_if_sublist_list_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> list_all_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_if_Nil_left><span class=command>lemma</span></span> sublist_list_if_Nil_left<span class=main>:</span> <span class=quoted><span class=quoted>"sublist_list_if <span class=main>[]</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=List2-sublist_list_if_Nil_right><span class=command>lemma</span></span> sublist_list_if_Nil_right<span class=main>:</span> <span class=quoted><span class=quoted>"sublist_list_if <span class=free>xs</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-sublist_list_if_length><span class=command>lemma</span></span> sublist_list_if_length<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=main>(</span>sublist_list_if <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> length <span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv sublist_list_length<span class=main>)</span>
<span class=keyword1 id=List2-sublist_list_if_append><span class=command>lemma</span></span> sublist_list_if_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  sublist_list_if <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=free>zs</span><span class=main>)</span> <span class=main>=</span> sublist_list_if <span class=free>xs</span> <span class=free>ys</span> <span class=main>@</span> sublist_list_if <span class=free>xs</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv sublist_list_append<span class=main>)</span>
<span class=keyword1 id=List2-sublist_list_if_snoc><span class=command>lemma</span></span> sublist_list_if_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"
  sublist_list_if <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=main>[</span><span class=free>y</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span> sublist_list_if <span class=free>xs</span> <span class=free>ys</span> <span class=main>@</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>y</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=main>[</span><span class=free>xs</span> <span class=main>!</span> <span class=free>y</span><span class=main>]</span> <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_append<span class=main>)</span>


<span class=keyword1 id=List2-sublist_list_if_is_Nil_conv><span class=command>lemma</span></span> sublist_list_if_is_Nil_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>sublist_list_if <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>list_all <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> length <span class=free>xs</span> <span class=main>≤</span> <span class=bound>i</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv sublist_list_is_Nil_conv filter_empty_conv list_all_iff linorder_not_less<span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_if_nth><span class=command>lemma</span></span> sublist_list_if_nth<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
  sublist_list_if <span class=free>xs</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span><span class=main>(</span>filter <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv sublist_list_nth<span class=main>)</span>

<span class=keyword1 id=List2-take_drop_eq_sublist_list_if><span class=command>lemma</span></span> take_drop_eq_sublist_list_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>+</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↑</span> <span class=free>m</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> sublist_list_if <span class=free>xs</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>m</span><span class=main>+</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_filter_conv take_drop_eq_sublist_list<span class=main>)</span>

<span class=keyword1 id=List2-nths_empty_conv><span class=command>lemma</span></span> nths_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nths <span class=free>xs</span> <span class=free>I</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> length <span class=free>xs</span> <span class=main>≤</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> <span class=main>[</span><span class=main>[</span><span class=operator>hypsubst_thin</span> <span class=main><span class=main>=</span></span> <span class=quasi_keyword>true</span><span class=main>]</span><span class=main>]</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> set_empty<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> set_nths linorder_not_le<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=List2-nths_singleton2><span class=command>lemma</span></span> nths_singleton2<span class=main>:</span> <span class=quoted><span class=quoted>"nths <span class=free>xs</span> <span class=main>{</span><span class=free>y</span><span class=main>}</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>y</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=main>[</span><span class=free>xs</span> <span class=main>!</span> <span class=free>y</span><span class=main>]</span> <span class=keyword1>else</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> nths_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-nths_take_eq><span class=command>lemma</span></span> nths_take_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> nths <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=free>xs</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>@</span> <span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>+</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-nths_drop_eq><span class=command>lemma</span></span> nths_drop_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> iMin <span class=free>I</span> <span class=main>⟹</span> nths <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=main>{</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>+</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>I</span><span class=main>}</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_def filter_empty_conv linorder_not_less<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> a b<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> set_zip_rightD<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=free>xs</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>@</span> <span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=free>I</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nths_empty_conv min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-nths_cut_less_eq><span class=command>lemma</span></span> nths_cut_less_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> nths <span class=free>xs</span> <span class=main>(</span><span class=free>I</span> <span class=main>↓&lt;</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_def cut_less_mem_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>xs</span><span class=main>.</span> map fst <span class=bound>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> filter_filter_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_all_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-nths_disjoint_Un><span class=command>lemma</span></span> nths_disjoint_Un<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>A</span><span class=main>;</span> Max <span class=free>A</span> <span class=main>&lt;</span> iMin <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> nths <span class=free>xs</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=free>A</span> <span class=main>@</span> nths <span class=free>xs</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> iMin <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_cut_less_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"iMin <span class=free><span class=free>B</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_simp</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Un cut_less_Min_empty cut_less_Max_all<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_empty_conv iMin_ge_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=free>xs</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"nths <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span> <span class=main>@</span> <span class=free>xs</span> <span class=main>↑</span> <span class=main>(</span>iMin <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_cut_less_eq<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> xs<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>xs</span></span> <span class=main><span class=main>↓</span></span> iMin <span class=free><span class=free>B</span></span>"</span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword><span class=quasi_keyword>and</span></span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"iMin <span class=free><span class=free>B</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_Un cut_less_Min_empty cut_less_Max_all<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_take_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>+</span> iMin <span class=free>B</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∨</span> <span class=bound>j</span> <span class=main>+</span> iMin <span class=free>B</span> <span class=main>∈</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>+</span> iMin <span class=free>B</span> <span class=main>∈</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> fun_eq_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_drop_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nths_disjoint_insert_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> <span class=free>x</span> <span class=main>&lt;</span> iMin <span class=free>I</span> <span class=main>⟧</span> <span class=main>⟹</span> nths <span class=free>xs</span> <span class=main>(</span>insert <span class=free>x</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>@</span> nths <span class=free>xs</span> <span class=free>I</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"insert <span class=free>x</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>∪</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_disjoint_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nths_disjoint_insert_right<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> finite <span class=free>I</span><span class=main>;</span> Max <span class=free>I</span> <span class=main>&lt;</span> <span class=free>x</span> <span class=main>⟧</span> <span class=main>⟹</span> nths <span class=free>xs</span> <span class=main>(</span>insert <span class=free>x</span> <span class=free>I</span><span class=main>)</span> <span class=main>=</span> nths <span class=free>xs</span> <span class=free>I</span> <span class=main>@</span> nths <span class=free>xs</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> t<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"insert <span class=free>x</span> <span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> s<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>∪</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_disjoint_Un<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-nths_all><span class=command>lemma</span></span> nths_all<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span>length <span class=free>xs</span><span class=main>}</span> <span class=main>⊆</span> <span class=free>I</span> <span class=main>⟹</span> nths <span class=free>xs</span> <span class=free>I</span> <span class=main>=</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>∪</span> <span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cut_less_cut_ge_ident<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓&lt;</span> length <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=main>{..&lt;</span>length <span class=free>xs</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=main>↓≥</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_disjoint_Un<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_lessThan<span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> less_imp_Max_less_iMin<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite_lessThan<span class=main><span class=main>]</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> less_le_trans<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nths_empty_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nths_UNIV<span class=main>:</span> <span class=quoted><span class=quoted>"nths <span class=free>xs</span> UNIV <span class=main>=</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nths_all<span class=main><span class=main>[</span></span><span class=operator>OF</span> subset_UNIV<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=List2-sublist_list_nths_eq><span class=command>lemma</span></span> sublist_list_nths_eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  list_strict_asc <span class=free>ys</span> <span class=main>⟹</span> sublist_list_if <span class=bound>xs</span> <span class=free>ys</span> <span class=main>=</span> nths <span class=bound>xs</span> <span class=main>(</span>set <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_Nil_left<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> rev_induct<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> y ys xs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_singleton2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> list_strict_asc_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_snoc <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> list_ord_append<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nths_disjoint_insert_right<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> i<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>i</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> j<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=improper>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> list_strict_asc_trans<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> list_strict_asc_def<span class=main><span class=main>,</span></span> <span class=operator>THEN</span> iffD1<span class=main><span class=main>,</span></span> <span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append <span class=quasi_keyword>split</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> if_split<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nths_singleton2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-set_sublist_list_if><span class=command>lemma</span></span> set_sublist_list_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span> set <span class=main>(</span>sublist_list_if <span class=bound>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=bound>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>|</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=bound>xs</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-set_sublist_list><span class=command>lemma</span></span> set_sublist_list<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_all <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>⟹</span>
  set <span class=main>(</span>sublist_list <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>|</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=bound>i</span> <span class=main>∈</span> set <span class=free>ys</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> set_sublist_list_if<span class=main>)</span>

<span class=keyword1 id=List2-set_sublist_list_if_eq_set_sublist><span class=command>lemma</span></span> set_sublist_list_if_eq_set_sublist<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span>sublist_list_if <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>nths <span class=free>xs</span> <span class=main>(</span>set <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_nths set_sublist_list_if<span class=main>)</span>

<span class=keyword1 id=List2-set_sublist_list_eq_set_sublist><span class=command>lemma</span></span> set_sublist_list_eq_set_sublist<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_all <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>⟹</span>
  set <span class=main>(</span>sublist_list <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>nths <span class=free>xs</span> <span class=main>(</span>set <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_eq<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> set_sublist_list_if_eq_set_sublist<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Natural set images with lists›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>f_image</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> nat set <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>    <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span>"</span> 90<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1><span class=free>`<span class=hidden>⇧</span><sup>f</sup></span></span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=bound>y</span><span class=main>.</span> <span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>!</span> <span class=bound>n</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>f_range</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>f_range</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>≡</span> f_image <span class=free><span class=bound><span class=entity>xs</span></span></span> UNIV"</span></span>

<span class=keyword1 id=List2-f_image_eqI><span class=command>lemma</span></span> f_image_eqI<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> f_image_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=List2-f_imageI><span class=command>lemma</span></span> f_imageI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-rev_f_imageI><span class=command>lemma</span></span> rev_f_imageI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> f_image_eqI<span class=main>)</span>

<span class=keyword1 id=List2-f_imageE><span class=command>lemma</span></span> f_imageE<span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>;</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> f_image_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=List2-f_image_Un><span class=command>lemma</span></span> f_image_Un<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>∪</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_mono><span class=command>lemma</span></span> f_image_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>==&gt;</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_iff><span class=command>lemma</span></span> f_image_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>∈</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_subset_iff><span class=command>lemma</span></span> f_image_subset_iff<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>∈</span><span class=free>A</span><span class=main>.</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟶</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-subset_f_image_iff><span class=command>lemma</span></span> subset_f_image_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>B</span> <span class=main>⊆</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound><span class=bound>A'</span></span><span class=main>⊆</span><span class=free>A</span><span class=main>.</span> <span class=free>B</span> <span class=main>=</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=bound>A'</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span> <span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> f_image_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-f_image_subsetI><span class=command>lemma</span></span> f_image_subsetI<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_empty><span class=command>lemma</span></span> f_image_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>{}</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_insert_if><span class=command>lemma</span></span> f_image_insert_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span>insert <span class=free>n</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
  <span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> insert <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=List2-f_image_insert_eq1><span class=command>lemma</span></span> f_image_insert_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span>insert <span class=free>n</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> insert <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> f_image_insert_if<span class=main>)</span>

<span class=keyword1 id=List2-f_image_insert_eq2><span class=command>lemma</span></span> f_image_insert_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span>insert <span class=free>n</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> f_image_insert_if<span class=main>)</span>

<span class=keyword1 id=List2-insert_f_image><span class=command>lemma</span></span> insert_f_image<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>∈</span> <span class=free>A</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> insert <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_is_empty><span class=command>lemma</span></span> f_image_is_empty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>}</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_image_Collect><span class=command>lemma</span></span> f_image_Collect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>{</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>n</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>|</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=bound>n</span> <span class=main>∧</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1 id=List2-f_image_eq_set><span class=command>lemma</span></span> f_image_eq_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound><span class=bound>n</span></span><span class=main>&lt;</span>length <span class=free>xs</span><span class=main>.</span> <span class=bound>n</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>=</span> set <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth<span class=main>)</span>
<span class=keyword1 id=List2-f_range_eq_set><span class=command>lemma</span></span> f_range_eq_set<span class=main>:</span> <span class=quoted><span class=quoted>"f_range <span class=free>xs</span> <span class=main>=</span> set <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> f_image_eq_set<span class=main>)</span>

<span class=keyword1 id=List2-f_image_eq_set_nths><span class=command>lemma</span></span> f_image_eq_set_nths<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=free>A</span> <span class=main>=</span> set <span class=main>(</span>nths <span class=free>xs</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> set_nths<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
<span class=keyword1 id=List2-f_image_eq_set_sublist_list_if><span class=command>lemma</span></span> f_image_eq_set_sublist_list_if<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span>set <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>sublist_list_if <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_sublist_list_if_eq_set_sublist f_image_eq_set_nths<span class=main>)</span>
<span class=keyword1 id=List2-f_image_eq_set_sublist_list><span class=command>lemma</span></span> f_image_eq_set_sublist_list<span class=main>:</span> <span class=quoted><span class=quoted>"
  list_all <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=keyword1>`<span class=hidden>⇧</span><sup>f</sup></span> <span class=main>(</span>set <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> set <span class=main>(</span>sublist_list <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sublist_list_if_sublist_list_eq f_image_eq_set_sublist_list_if<span class=main>)</span>


<span class=keyword1 id=List2-f_range_eqI><span class=command>lemma</span></span> f_range_eqI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span><span class=main>;</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> f_range <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_rangeI><span class=command>lemma</span></span> f_rangeI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=main>∈</span> f_range <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=List2-f_rangeE><span class=command>lemma</span></span> f_rangeE<span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>?</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>x</span> <span class=main>∈</span> f_range <span class=free>xs</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>x</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Mapping lists of functions to lists›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>map_list</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span><span class=main>)</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'b</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>map_list</span> <span class=main>[]</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>map_list</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>fs</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span>hd <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=free>map_list</span> <span class=free><span class=bound><span class=entity>fs</span></span></span> <span class=main>(</span>tl <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=List2-map_list_Nil><span class=command>lemma</span></span> map_list_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"map_list <span class=main>[]</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-map_list_Cons_Cons><span class=command>lemma</span></span> map_list_Cons_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  map_list <span class=main>(</span><span class=free>f</span> <span class=main>#</span> <span class=free>fs</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span> <span class=main>#</span> map_list <span class=free>fs</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-map_list_length><span class=command>lemma</span></span> map_list_length<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  length <span class=main>(</span>map_list <span class=free>fs</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>=</span> length <span class=free>fs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> map_list_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>fs</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> length_0_conv <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> map_list_length<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> map_list_not_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>fs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_list_empty_conv<span class=main>)</span>

<span class=keyword1 id=List2-map_list_nth><span class=command>lemma</span></span> map_list_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>xs</span><span class=main>.</span>
  <span class=main>⟦</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>fs</span><span class=main>;</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=bound>xs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=bound>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>fs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_tl_eq_nth_Suc2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-map_list_xs_take><span class=command>lemma</span></span> map_list_xs_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>xs</span><span class=main>.</span>
  length <span class=free>fs</span> <span class=main>≤</span> <span class=bound>n</span> <span class=main>⟹</span>
  map_list <span class=free>fs</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>=</span>
  map_list <span class=free>fs</span> <span class=bound>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> fs n xs<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> tl_take<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-map_list_take><span class=command>lemma</span></span> map_list_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>xs</span><span class=main>.</span>
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map_list <span class=main>(</span><span class=free>fs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=bound>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=List2-map_list_take_take><span class=command>lemma</span></span> map_list_take_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>xs</span><span class=main>.</span>
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map_list <span class=main>(</span><span class=free>fs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_list_take map_list_xs_take<span class=main>)</span>
<span class=keyword1 id=List2-map_list_drop><span class=command>lemma</span></span> map_list_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>xs</span><span class=main>.</span>
  <span class=main>(</span>map_list <span class=free>fs</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>↑</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map_list <span class=main>(</span><span class=free>fs</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>n</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> drop_Suc<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>



<span class=keyword1 id=List2-map_list_append_append><span class=command>lemma</span></span> map_list_append_append<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs1</span> <span class=main>.</span>
  length <span class=free>fs1</span> <span class=main>=</span> length <span class=bound>xs1</span> <span class=main>⟹</span>
  map_list <span class=main>(</span><span class=free>fs1</span> <span class=main>@</span> <span class=free>fs2</span><span class=main>)</span> <span class=main>(</span><span class=bound>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span> <span class=main>=</span>
  map_list <span class=free>fs1</span> <span class=bound>xs1</span> <span class=main>@</span>
  map_list <span class=free>fs2</span> <span class=free>xs2</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>xs1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=List2-map_list_snoc_snoc><span class=command>lemma</span></span> map_list_snoc_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>fs</span> <span class=main>=</span> length <span class=free>xs</span> <span class=main>⟹</span>
  map_list <span class=main>(</span><span class=free>fs</span> <span class=main>@</span> <span class=main>[</span><span class=free>f</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span>
  map_list <span class=free>fs</span> <span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>f</span> <span class=free>x</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_list_append_append<span class=main>)</span>
<span class=keyword1 id=List2-map_list_snoc><span class=command>lemma</span></span> map_list_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  length <span class=free>fs</span> <span class=main>&lt;</span> length <span class=bound>xs</span> <span class=main>⟹</span>
  map_list <span class=main>(</span><span class=free>fs</span> <span class=main>@</span> <span class=main>[</span><span class=free>f</span><span class=main>]</span><span class=main>)</span> <span class=bound>xs</span> <span class=main>=</span>
  map_list <span class=free>fs</span> <span class=bound>xs</span> <span class=main>@</span>  <span class=main>[</span><span class=free>f</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>fs</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_conv_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_tl_eq_nth_Suc2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=List2-map_list_Cons_if><span class=command>lemma</span></span> map_list_Cons_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  map_list <span class=free>fs</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=main>(</span><span class=free>fs</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=keyword1>then</span> <span class=main>[]</span> <span class=keyword1>else</span> <span class=main>(</span>
    <span class=main>(</span><span class=main>(</span>hd <span class=free>fs</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>#</span> map_list <span class=main>(</span>tl <span class=free>fs</span><span class=main>)</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>fs</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=List2-map_list_Cons_not_empty><span class=command>lemma</span></span> map_list_Cons_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>fs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span>
  map_list <span class=free>fs</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>(</span>hd <span class=free>fs</span><span class=main>)</span> <span class=free>x</span><span class=main>)</span> <span class=main>#</span> map_list <span class=main>(</span>tl <span class=free>fs</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_list_Cons_if<span class=main>)</span>

<span class=keyword1 id=List2-map_eq_map_list_take><span class=command>lemma</span></span> map_eq_map_list_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>xs</span><span class=main>.</span>
  <span class=main>⟦</span> length <span class=free>fs</span> <span class=main>≤</span> length <span class=bound>xs</span><span class=main>;</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span><span class=main>)</span> <span class=free>fs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  map_list <span class=free>fs</span> <span class=bound>xs</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>↓</span> length <span class=free>fs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>fs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=List2-map_eq_map_list_take2><span class=command>lemma</span></span> map_eq_map_list_take2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> length <span class=free>fs</span> <span class=main>=</span> length <span class=free>xs</span><span class=main>;</span> list_all <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span><span class=main>)</span> <span class=free>fs</span> <span class=main>⟧</span> <span class=main>⟹</span>
  map_list <span class=free>fs</span> <span class=free>xs</span> <span class=main>=</span> map <span class=free>f</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_eq_map_list_take<span class=main>)</span>
<span class=keyword1 id=List2-map_eq_map_list_replicate><span class=command>lemma</span></span> map_eq_map_list_replicate<span class=main>:</span> <span class=quoted><span class=quoted>"
  map_list <span class=main>(</span><span class=free>f</span><span class=hidden>⇗</span><sup>length <span class=free>xs</span></sup><span class=hidden>⇖</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> map <span class=free>f</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Mapping functions with two arguments to lists›</span></span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>map2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"
  <span class=comment1>― ‹Function taking two parameters›</span>
  <span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>⇒</span> <span class=tfree>'c</span><span class=main>)</span> <span class=main>⇒</span>
  <span class=comment1>― ‹Lists of parameters›</span>
  <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'b</span> list <span class=main>⇒</span>
  <span class=tfree>'c</span> list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>map2</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>[]</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>map2</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>(</span>hd <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span> <span class=main>#</span> <span class=free>map2</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>(</span>tl <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>"</span></span>


<span class=keyword1 id=List2-map2_map_list_conv><span class=command>lemma</span></span> map2_map_list_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span> map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span> <span class=main>=</span> map_list <span class=main>(</span>map <span class=free>f</span> <span class=free>xs</span><span class=main>)</span> <span class=bound>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List2-map2_Nil><span class=command>lemma</span></span> map2_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=main>[]</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1 id=List2-map2_Cons_Cons><span class=command>lemma</span></span> map2_Cons_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>f</span> <span class=free>x</span> <span class=free>y</span><span class=main>)</span> <span class=main>#</span> map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=List2-map2_length><span class=command>lemma</span></span> map2_length<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span> length <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> length <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> map2_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> length_0_conv <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> map2_length<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> map2_not_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_empty_conv<span class=main>)</span>

<span class=keyword1 id=List2-map2_nth><span class=command>lemma</span></span> map2_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>ys</span><span class=main>.</span>
  <span class=main>⟦</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>xs</span><span class=main>;</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=bound>ys</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>=</span>
  <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>ys</span> <span class=main>!</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv map_list_nth<span class=main>)</span>

<span class=keyword1 id=List2-map2_ys_take><span class=command>lemma</span></span> map2_ys_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>ys</span><span class=main>.</span>
  length <span class=free>xs</span> <span class=main>≤</span> <span class=bound>n</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=bound>ys</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv map_list_xs_take<span class=main>)</span>

<span class=keyword1 id=List2-map2_take><span class=command>lemma</span></span> map2_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>ys</span><span class=main>.</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=bound>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv take_map map_list_take<span class=main>)</span>

<span class=keyword1 id=List2-map2_take_take><span class=command>lemma</span></span> map2_take_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>ys</span><span class=main>.</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>ys</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_take map2_ys_take<span class=main>)</span>

<span class=keyword1 id=List2-map2_drop><span class=command>lemma</span></span> map2_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>n</span> <span class=bound>ys</span><span class=main>.</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>↑</span> <span class=bound>n</span> <span class=main>=</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>ys</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv map_list_drop drop_map<span class=main>)</span>


<span class=keyword1 id=List2-map2_append_append><span class=command>lemma</span></span> map2_append_append<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys1</span> <span class=main>.</span>
  length <span class=free>xs1</span> <span class=main>=</span> length <span class=bound>ys1</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span> <span class=main>(</span><span class=bound>ys1</span> <span class=main>@</span> <span class=free>ys2</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs1</span> <span class=bound>ys1</span> <span class=main>@</span>
  map2 <span class=free>f</span> <span class=free>xs2</span> <span class=free>ys2</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv map_list_append_append<span class=main>)</span>

<span class=keyword1 id=List2-map2_snoc_snoc><span class=command>lemma</span></span> map2_snoc_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>@</span> <span class=main>[</span><span class=free>y</span><span class=main>]</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>@</span>
  <span class=main>[</span><span class=free>f</span> <span class=free>x</span> <span class=free>y</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_append_append<span class=main>)</span>

<span class=keyword1 id=List2-map2_snoc><span class=command>lemma</span></span> map2_snoc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span>
  length <span class=free>xs</span> <span class=main>&lt;</span> length <span class=bound>ys</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span><span class=main>)</span> <span class=bound>ys</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span> <span class=main>@</span>
  <span class=main>[</span><span class=free>f</span> <span class=free>x</span> <span class=main>(</span><span class=bound>ys</span> <span class=main>!</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span><span class=main>)</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_map_list_conv map_list_snoc<span class=main>)</span>

<span class=keyword1 id=List2-map2_Cons_if><span class=command>lemma</span></span> map2_Cons_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=keyword1>then</span> <span class=main>[]</span> <span class=keyword1>else</span> <span class=main>(</span>
    <span class=main>(</span><span class=free>f</span> <span class=main>(</span>hd <span class=free>xs</span><span class=main>)</span> <span class=free>y</span><span class=main>)</span> <span class=main>#</span> map2 <span class=free>f</span> <span class=main>(</span>tl <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>xs</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1 id=List2-map2_Cons_not_empty><span class=command>lemma</span></span> map2_Cons_not_empty<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>y</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>(</span>hd <span class=free>xs</span><span class=main>)</span> <span class=free>y</span><span class=main>)</span> <span class=main>#</span> map2 <span class=free>f</span> <span class=main>(</span>tl <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_Cons_if<span class=main>)</span>

<span class=keyword1 id=List2-map2_append1_take_drop><span class=command>lemma</span></span> map2_append1_take_drop<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs1</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs1</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> length <span class=free>xs1</span><span class=main>)</span> <span class=main>@</span>
  map2 <span class=free>f</span> <span class=free>xs2</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↑</span> length <span class=free>xs1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>@</span> <span class=free>xs2</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> length <span class=free>xs1</span> <span class=main>@</span> <span class=free>ys</span> <span class=main>↑</span> length <span class=free>xs1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_append_append <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> append_take_drop_id<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-map2_append2_take_drop><span class=command>lemma</span></span> map2_append2_take_drop<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>ys1</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>ys1</span> <span class=main>@</span> <span class=free>ys2</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> length <span class=free>ys1</span><span class=main>)</span> <span class=free>ys1</span> <span class=main>@</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> length <span class=free>ys1</span><span class=main>)</span> <span class=free>ys2</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span>
  t <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>ys1</span> <span class=main>@</span> <span class=free>ys2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span>
  s <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> length <span class=free>ys1</span> <span class=main>@</span> <span class=free>xs</span> <span class=main>↑</span> length <span class=free>ys1</span><span class=main>)</span> <span class=main>(</span><span class=free>ys1</span> <span class=main>@</span> <span class=free>ys2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> subst<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_append_append <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> append_take_drop_id<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-map2_cong><span class=command>lemma</span></span> map2_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs1</span> <span class=main>=</span> <span class=free>xs2</span><span class=main>;</span> <span class=free>ys1</span> <span class=main>=</span> <span class=free>ys2</span><span class=main>;</span> length <span class=free>xs2</span> <span class=main>≤</span> length <span class=free>ys2</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> set <span class=free>xs2</span><span class=main>;</span> <span class=bound>y</span> <span class=main>∈</span> set <span class=free>ys2</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=free>xs1</span> <span class=free>ys1</span> <span class=main>=</span> map2 <span class=free>g</span> <span class=free>xs2</span> <span class=free>ys2</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_simp</span><span class=main><span class=main>)</span></span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq map2_length map2_nth<span class=main>)</span>

<span class=keyword1 id=List2-map2_eq_conv><span class=command>lemma</span></span> map2_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟹</span>
  <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> map2 <span class=free>g</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>xs</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=main>(</span><span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq map2_length map2_nth<span class=main>)</span>

<span class=keyword1 id=List2-map2_replicate><span class=command>lemma</span></span> map2_replicate<span class=main>:</span> <span class=quoted><span class=quoted>"map2 <span class=free>f</span> <span class=free>x</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span> <span class=free>y</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span> <span class=free>y</span><span class=main>)</span><span class=hidden>⇗</span><sup><span class=free>n</span></sup><span class=hidden>⇖</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=List2-map2_zip_conv><span class=command>lemma</span></span> map2_zip_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span>
  length <span class=free>xs</span> <span class=main>≤</span> length <span class=bound>ys</span> <span class=main>⟹</span>
  map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span> <span class=main>=</span> map <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=List2-map2_rev><span class=command>lemma</span></span> map2_rev<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ys</span><span class=main>.</span>
  length <span class=free>xs</span> <span class=main>=</span> length <span class=bound>ys</span> <span class=main>⟹</span>
  rev <span class=main>(</span>map2 <span class=free>f</span> <span class=free>xs</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>=</span> map2 <span class=free>f</span> <span class=main>(</span>rev <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>rev <span class=bound>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>ys</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map2_Cons_Cons map2_snoc_snoc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>hide_const</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>open</span></span><span class=main>)</span> map2

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=InfiniteSet2><div class=head><h1>Theory InfiniteSet2</h1></div><pre class=source><span class=comment1>(*  Title:      InfiniteSet2.thy
    Date:       Aug 2008
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Set operations with results of type enat›</span></span>

<span class=keyword1><span class=command>theory</span></span> InfiniteSet2
<span class=keyword2><span class=keyword>imports</span></span> <a href=SetInterval2.html>SetInterval2</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Set operations with <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=quoted>enat</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic definitions›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>icard</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> set <span class=main>⇒</span> enat"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>icard</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> finite <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1>then</span> enat <span class=main>(</span>card <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>)</span> <span class=keyword1>else</span> <span class=main>∞</span>"</span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Results for <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>icard›</span></span></span></span>›</span></span>

<span class=keyword1 id=InfiniteSet2-icard_UNIV_nat><span class=command>lemma</span></span> icard_UNIV_nat<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span>UNIV<span class=main>::</span>nat set<span class=main>)</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_def<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_finite_conv><span class=command>lemma</span></span> icard_finite_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>icard <span class=free>A</span> <span class=main>=</span> enat <span class=main>(</span>card <span class=free>A</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> finite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_def<span class=main>)</span>
<span class=keyword1 id=InfiniteSet2-icard_infinite_conv><span class=command>lemma</span></span> icard_infinite_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>icard <span class=free>A</span> <span class=main>=</span> <span class=main>∞</span><span class=main>)</span> <span class=main>=</span> infinite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_def<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> icard_finite<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>⟹</span> icard <span class=free>A</span> <span class=main>=</span> enat <span class=main>(</span>card <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> icard_finite_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> icard_infinite<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span> <span class=main>⟹</span> icard <span class=free>A</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> icard_infinite_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_eq_enat_imp><span class=command>lemma</span></span> icard_eq_enat_imp<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>=</span> enat <span class=free>n</span> <span class=main>⟹</span> finite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1 id=InfiniteSet2-icard_eq_Infty_imp><span class=command>lemma</span></span> icard_eq_Infty_imp<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>=</span> <span class=main>∞</span> <span class=main>⟹</span> infinite <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> icard_infinite_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_the_enat><span class=command>lemma</span></span> icard_the_enat<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>⟹</span> the_enat <span class=main>(</span>icard <span class=free>A</span><span class=main>)</span> <span class=main>=</span> card <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_def<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_eq_enat_imp_card><span class=command>lemma</span></span> icard_eq_enat_imp_card<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>=</span> enat <span class=free>n</span> <span class=main>⟹</span> card <span class=free>A</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>frule</span> icard_eq_enat_imp<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_eq_enat_card_conv><span class=command>lemma</span></span> icard_eq_enat_card_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span>icard <span class=free>A</span> <span class=main>=</span> enat <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>card <span class=free>A</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_eq_enat_imp_card<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> card_gr0_imp_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> icard_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_empty><span class=command>lemma</span></span> icard_empty<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{}</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> finite.emptyI<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1 id=InfiniteSet2-icard_empty_iff><span class=command>lemma</span></span> icard_empty_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>icard <span class=free>A</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> zero_enat_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> icard_eq_enat_imp<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lemmas</span></span> icard_empty_iff_enat <span class=main>=</span> icard_empty_iff<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=InfiniteSet2-icard_not_empty_iff><span class=command>lemma</span></span> icard_not_empty_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> icard <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>≠</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_empty_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> icard_not_empty_iff_enat <span class=main>=</span> icard_not_empty_iff<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>

<span class=keyword1 id=InfiniteSet2-icard_singleton><span class=command>lemma</span></span> icard_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>a</span><span class=main>}</span> <span class=main>=</span> eSuc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite eSuc_enat<span class=main>)</span>
<span class=keyword1><span class=command>lemmas</span></span> icard_singleton_enat<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> icard_singleton<span class=main>[</span><span class=operator>unfolded</span> zero_enat_def<span class=main>]</span>
<span class=keyword1 id=InfiniteSet2-icard_1_imp_singleton><span class=command>lemma</span></span> icard_1_imp_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>=</span> eSuc <span class=main>0</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> icard_eq_enat_imp<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite card_1_imp_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=InfiniteSet2-icard_1_singleton_conv><span class=command>lemma</span></span> icard_1_singleton_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>icard <span class=free>A</span> <span class=main>=</span> eSuc <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>a</span><span class=main>.</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>a</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_1_imp_singleton<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_insert_disjoint><span class=command>lemma</span></span> icard_insert_disjoint<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∉</span> <span class=free>A</span> <span class=main>⟹</span> icard <span class=main>(</span>insert <span class=free>x</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> eSuc <span class=main>(</span>icard <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite eSuc_enat card_insert_disjoint<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_insert<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_insert_if><span class=command>lemma</span></span> icard_insert_if<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span>insert <span class=free>x</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> icard <span class=free>A</span> <span class=keyword1>else</span> eSuc <span class=main>(</span>icard <span class=free>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> insert_absorb<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_insert_disjoint<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> icard_0_eq <span class=main>=</span> icard_empty_iff

<span class=keyword1 id=InfiniteSet2-icard_Suc_Diff1><span class=command>lemma</span></span> icard_Suc_Diff1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> eSuc <span class=main>(</span>icard <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite eSuc_enat in_imp_not_empty not_empty_card_gr0_conv<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Diff_infinite_finite<span class=main><span class=main>[</span></span><span class=operator>OF</span> singleton_finite<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_Diff_singleton><span class=command>lemma</span></span> icard_Diff_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> icard <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> eSuc_inject<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD1<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> in_imp_not_empty<span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> icard_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_Suc_Diff1 eSuc_pred_enat one_eSuc<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_Diff_singleton_if><span class=command>lemma</span></span> icard_Diff_singleton_if<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=keyword1>then</span> icard <span class=free>A</span> <span class=main>-</span> <span class=main>1</span> <span class=keyword1>else</span> icard <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_Diff_singleton<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_insert><span class=command>lemma</span></span> icard_insert<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span>insert <span class=free>x</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> eSuc <span class=main>(</span>icard <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> icard_Diff_singleton_if icard_Suc_Diff1 icard_insert_disjoint insert_absorb<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_insert_le><span class=command>lemma</span></span> icard_insert_le<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>≤</span> icard <span class=main>(</span>insert <span class=free>x</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_insert_if<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_mono><span class=command>lemma</span></span> icard_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟹</span> icard <span class=free>A</span> <span class=main>≤</span> icard <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> subset_finite_imp_finite<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite card_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-not_icard_seteq><span class=command>lemma</span></span> not_icard_seteq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span> <span class=bound>B</span><span class=main>.</span> <span class=main>(</span><span class=bound>A</span> <span class=main>⊆</span> <span class=bound>B</span> <span class=main>∧</span> icard <span class=bound>B</span> <span class=main>≤</span> icard <span class=bound>A</span> <span class=main>∧</span> <span class=main>¬</span> <span class=bound>A</span> <span class=main>=</span> <span class=bound>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>1</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_atLeast<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-not_psubset_icard_mono><span class=command>lemma</span></span> not_psubset_icard_mono<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>A</span> <span class=main>⊂</span> <span class=bound>B</span> <span class=main>∧</span> <span class=main>¬</span> icard <span class=bound>A</span> <span class=main>&lt;</span> icard <span class=bound>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>1</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_atLeast<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_Un_Int><span class=command>lemma</span></span> icard_Un_Int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=free>A</span> <span class=main>+</span> icard <span class=free>B</span> <span class=main>=</span> icard <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>+</span> icard <span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite card_Un_Int<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp_all</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_Un_disjoint><span class=command>lemma</span></span> icard_Un_disjoint<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟹</span> icard <span class=main>(</span><span class=free>A</span> <span class=main>∪</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span> <span class=main>+</span> icard <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_Un_Int<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-not_icard_Diff_subset><span class=command>lemma</span></span> not_icard_Diff_subset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span> <span class=bound>B</span><span class=main>.</span> <span class=bound>B</span> <span class=main>⊆</span> <span class=bound>A</span> <span class=main>∧</span> <span class=main>¬</span> icard <span class=main>(</span><span class=bound>A</span> <span class=main>-</span> <span class=bound>B</span><span class=main>)</span> <span class=main>=</span> icard <span class=bound>A</span> <span class=main>-</span> icard <span class=bound>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>1</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_diff_eq linorder_not_le icard_UNIV_nat eSuc_enat<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-not_icard_Diff1_less><span class=command>lemma</span></span> not_icard_Diff1_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=bound>A</span> <span class=main>∧</span> <span class=main>¬</span> icard <span class=main>(</span><span class=bound>A</span> <span class=main>-</span> <span class=main>{</span><span class=bound>x</span><span class=main>}</span><span class=main>)</span> <span class=main>&lt;</span> icard <span class=bound>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-not_icard_Diff2_less><span class=command>lemma</span></span> not_icard_Diff2_less<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=bound>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=bound>A</span> <span class=main>∧</span> <span class=main>¬</span> icard <span class=main>(</span><span class=bound>A</span> <span class=main>-</span> <span class=main>{</span><span class=bound>x</span><span class=main>}</span> <span class=main>-</span> <span class=main>{</span><span class=bound>y</span><span class=main>}</span><span class=main>)</span> <span class=main>&lt;</span> icard <span class=bound>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_Diff1_le><span class=command>lemma</span></span> icard_Diff1_le<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=main>≤</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> icard_mono<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Diff_subset<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_psubset><span class=command>lemma</span></span> icard_psubset<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>;</span> icard <span class=free>A</span> <span class=main>&lt;</span> icard <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>⊂</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_le psubset_eq<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_partition><span class=command>lemma</span></span> icard_partition<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=main>⋀</span><span class=bound>c</span><span class=main>.</span> <span class=bound>c</span> <span class=main>∈</span> <span class=free>C</span> <span class=main>⟹</span> icard <span class=bound>c</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>c1</span> <span class=bound>c2</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>c1</span> <span class=main>∈</span> <span class=free>C</span><span class=main>;</span> <span class=bound>c2</span> <span class=main>∈</span> <span class=free>C</span><span class=main>;</span> <span class=bound>c1</span> <span class=main>≠</span> <span class=bound>c2</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>c1</span> <span class=main>∩</span> <span class=bound>c2</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span> <span class=main>⟹</span>
  icard <span class=main>(</span><span class=main>⋃</span><span class=free>C</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> icard <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_empty_iff_enat<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> k1<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=improper>k1</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>C</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>c</span><span class=main>.</span> <span class=bound>c</span> <span class=main>∈</span> <span class=free>C</span> <span class=main>⟹</span> card <span class=bound>c</span> <span class=main>=</span> <span class=improper>k1</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> icard_eq_enat_imp_card<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule_tac</span> C<span class=main><span class=main>=</span></span><span class=quoted><span class=free>C</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>and</span></span></span> k<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>k1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> SetInterval2.card_partition<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"finite <span class=main>(</span><span class=main>⋃</span><span class=free>C</span><span class=main>)</span>"</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> card_gr0_imp_finite<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> not_empty_card_gr0_conv<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> icard_infinite<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> finite_UnionD<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> icard_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_infinite_conv<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> not_empty_imp_ex<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> c<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> Union_upper<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> infinite_super<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_image_le><span class=command>lemma</span></span> icard_image_le<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>≤</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite card_image_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_image><span class=command>lemma</span></span> icard_image<span class=main>:</span> <span class=quoted><span class=quoted>"inj_on <span class=free>f</span> <span class=free>A</span> <span class=main>⟹</span> icard <span class=main>(</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite card_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_infinite_conv inj_on_imp_infinite_image<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-not_eq_icard_imp_inj_on><span class=command>lemma</span></span> not_eq_icard_imp_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>f</span><span class=main>::</span>nat<span class=main>⇒</span>nat<span class=main>)</span> <span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span><span class=main>.</span> icard <span class=main>(</span><span class=bound>f</span> <span class=main>`</span> <span class=bound>A</span><span class=main>)</span> <span class=main>=</span> icard <span class=bound>A</span> <span class=main>∧</span> <span class=main>¬</span> inj_on <span class=bound>f</span> <span class=bound>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>if</span> <span class=bound>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> Suc <span class=main>0</span> <span class=keyword1>else</span> <span class=bound>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>0</span><span class=main>..}</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> subst<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span><span class=main><span class=main>1</span></span><span class=main><span class=main>..}</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>(</span></span><span class=main><span class=main>λ</span></span><span class=bound><span class=bound>n</span></span><span class=main><span class=main>.</span></span> <span class=keyword1><span class=keyword1>if</span></span> <span class=bound><span class=bound>n</span></span> <span class=main><span class=main>=</span></span> <span class=main><span class=main>0</span></span> <span class=keyword1><span class=keyword1>then</span></span> Suc <span class=main><span class=main>0</span></span> <span class=keyword1><span class=keyword1>else</span></span> <span class=bound><span class=bound>n</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>`</span></span> <span class=main><span class=main>{</span></span><span class=main><span class=main>0</span></span><span class=main><span class=main>..}</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> set_eq_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> allI<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> n<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>n</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> icard_infinite<span class=main><span class=main>[</span></span><span class=operator>OF</span> infinite_atLeast<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-not_inj_on_iff_eq_icard><span class=command>lemma</span></span> not_inj_on_iff_eq_icard<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=main>(</span><span class=bound>f</span><span class=main>::</span>nat<span class=main>⇒</span>nat<span class=main>)</span> <span class=main>(</span><span class=bound>A</span><span class=main>::</span>nat set<span class=main>)</span><span class=main>.</span> <span class=main>¬</span> <span class=main>(</span>inj_on <span class=bound>f</span> <span class=bound>A</span> <span class=main>=</span> <span class=main>(</span>icard <span class=main>(</span><span class=bound>f</span> <span class=main>`</span> <span class=bound>A</span><span class=main>)</span> <span class=main>=</span> icard <span class=bound>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> not_eq_icard_imp_inj_on<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_inj_on_le><span class=command>lemma</span></span> icard_inj_on_le<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> inj_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span> <span class=main>⟧</span> <span class=main>⟹</span> icard <span class=free>A</span> <span class=main>≤</span> icard <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> icard_image icard_mono<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_bij_eq><span class=command>lemma</span></span> icard_bij_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inj_on <span class=free>f</span> <span class=free>A</span><span class=main>;</span> <span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>⊆</span> <span class=free>B</span><span class=main>;</span> inj_on <span class=free>g</span> <span class=free>B</span><span class=main>;</span> <span class=free>g</span> <span class=main>`</span> <span class=free>B</span> <span class=main>⊆</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span>
  icard <span class=free>A</span> <span class=main>=</span> icard <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> order_eq_iff icard_inj_on_le<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_cartesian_product><span class=command>lemma</span></span> icard_cartesian_product<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=free>A</span> <span class=main>×</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span> <span class=main>*</span> icard <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>∨</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>∧</span> finite <span class=free>B</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> de_Morgan_conj<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> disjE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>
  icard_not_empty_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span>
  cartesian_product_infiniteL_imp_infinite cartesian_product_infiniteR_imp_infinite<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=InfiniteSet2-icard_cartesian_product_singleton><span class=command>lemma</span></span> icard_cartesian_product_singleton<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=main>{</span><span class=free>x</span><span class=main>}</span> <span class=main>×</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_cartesian_product mult_eSuc<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_cartesian_product_singleton_right><span class=command>lemma</span></span> icard_cartesian_product_singleton_right<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span><span class=free>A</span> <span class=main>×</span> <span class=main>{</span><span class=free>x</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> icard <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_cartesian_product mult_eSuc_right<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_lessThan><span class=command>lemma</span></span>
  icard_lessThan<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{..&lt;</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=free>u</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_atMost<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>Suc <span class=free>u</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_atLeastLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>..&lt;</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> <span class=free>l</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_atLeastAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>Suc <span class=free>u</span> <span class=main>-</span> <span class=free>l</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_greaterThanAtMost<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>&lt;..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> <span class=free>l</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_greaterThanLessThan<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>&lt;..&lt;</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> Suc <span class=free>l</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_atLeast><span class=command>lemma</span></span> icard_atLeast<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>nat<span class=main>)</span><span class=main>..}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_atLeast<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_greaterThan><span class=command>lemma</span></span> icard_greaterThan<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>nat<span class=main>)</span><span class=main>&lt;..}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_greaterThan<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_atLeastZeroLessThan_int><span class=command>lemma</span></span>
  icard_atLeastZeroLessThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>nat <span class=free>u</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_atLeastLessThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>..&lt;</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>nat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> <span class=free>l</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_atLeastAtMost_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>nat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> <span class=free>l</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  icard_greaterThanAtMost_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=free>l</span><span class=main>&lt;..</span><span class=free>u</span><span class=main>}</span> <span class=main>=</span> enat <span class=main>(</span>nat <span class=main>(</span><span class=free>u</span> <span class=main>-</span> <span class=free>l</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> icard_finite<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_atLeast_int><span class=command>lemma</span></span> icard_atLeast_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>int<span class=main>)</span><span class=main>..}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_atLeast_int<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_greaterThan_int><span class=command>lemma</span></span> icard_greaterThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>int<span class=main>)</span><span class=main>&lt;..}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_greaterThan_int<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_atMost_int><span class=command>lemma</span></span> icard_atMost_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{..</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>int<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_atMost_int<span class=main>)</span>

<span class=keyword1 id=InfiniteSet2-icard_lessThan_int><span class=command>lemma</span></span> icard_lessThan_int<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>{..&lt;</span><span class=main>(</span><span class=free>u</span><span class=main>::</span>int<span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> infinite_lessThan_int<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=ListInf><div class=head><h1>Theory ListInf</h1></div><pre class=source><span class=comment1>(*  Title:      ListInf.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Additional definitions and results for lists›</span></span>

<span class=keyword1><span class=command>theory</span></span> ListInf
<span class=keyword2><span class=keyword>imports</span></span> <a href=List2.html>List2</a> <span class=quoted>"<a href=InfiniteSet2.html>../CommonSet/InfiniteSet2</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Infinite lists›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We define infinite lists as functions over natural numbers, i. e.,
  we use functions <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=quoted>"nat <span class=main><span class=main>⇒</span></span> <span class=tfree><span class=tfree>'a</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  as infinite lists over elements of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=quoted>"<span class=tfree><span class=tfree>'a</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
  Mapping functions to intervals lists <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>[m..&lt;n]›</span></span></span></span>
  yiels common finite lists.›</span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Appending a functions to a list›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=tfree>'a</span> ilist <span class=main>=</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>i_append</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> ilist <span class=main>⇒</span> <span class=tfree>'a</span> ilist"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>⌢</span>"</span> 65<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main><span class=free>⌢</span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>!</span> <span class=bound>n</span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=bound>n</span> <span class=main>-</span> length <span class=free><span class=bound><span class=entity>xs</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Synonym for the lemma <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>fun_eq_iff›</span></span></span></span>
  from the HOL library to unify lemma names for finite and infinite lists,
  providing <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>list_eq_iff›</span></span></span></span> for finite and
  <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>ilist_eq_iff›</span></span></span></span> for infinite lists.›</span></span>
<span class=keyword1><span class=command>lemmas</span></span> expand_ilist_eq <span class=main>=</span> fun_eq_iff
<span class=keyword1><span class=command>lemmas</span></span> ilist_eq_iff <span class=main>=</span> expand_ilist_eq

<span class=keyword1 id=ListInf-i_append_nth><span class=command>lemma</span></span> i_append_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_def<span class=main>)</span>
<span class=keyword1 id=ListInf-i_append_nth1><span class=command>lemma</span></span> i_append_nth1<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_def<span class=main>)</span>
<span class=keyword1 id=ListInf-i_append_nth2><span class=command>lemma</span></span> i_append_nth2<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_def<span class=main>)</span>
<span class=keyword1 id=ListInf-i_append_Nil><span class=command>lemma</span></span> i_append_Nil<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_assoc><span class=command>lemma</span></span> i_append_assoc<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_def nth_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_append_Cons><span class=command>lemma</span></span> i_append_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_append_eq_i_append_conv><span class=command>lemma</span></span> i_append_eq_i_append_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq expand_list_eq i_append_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI impI allI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> x<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> x<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>x</span> <span class=main>+</span> length <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_append_eq_i_append_conv2_aux><span class=command>lemma</span></span> i_append_eq_i_append_conv2_aux<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>;</span> length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>zs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>@</span> <span class=bound>zs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=bound>zs</span> <span class=main>⌢</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq expand_list_eq nth_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"drop <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>i</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=improper>i</span> <span class=main>&lt;</span> length <span class=free>ys</span>"</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"length <span class=free>xs</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_append_eq_i_append_conv2><span class=command>lemma</span></span> i_append_eq_i_append_conv2<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>zs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=bound>zs</span> <span class=main>∧</span> <span class=bound>zs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span> <span class=main>∨</span> <span class=free>xs</span> <span class=main>@</span> <span class=bound>zs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=bound>zs</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> i_append_eq_i_append_conv2_aux<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> linorder_not_le eq_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> less_imp_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> i_append_eq_i_append_conv2_aux<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-same_i_append_eq><span class=command>lemma</span></span> same_i_append_eq<span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=ListInf-NOT_i_append_same_eq><span class=command>lemma</span></span> NOT_i_append_same_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>¬</span><span class=main>(</span><span class=main>∀</span><span class=bound>xs</span> <span class=bound>ys</span> <span class=bound>f</span><span class=main>.</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=bound>f</span><span class=main>::</span><span class=main>(</span>nat <span class=main>⇒</span> nat<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=bound>ys</span> <span class=main>⌢</span> <span class=bound>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>xs</span> <span class=main>=</span> <span class=bound>ys</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>[]</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>0</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_append_hd><span class=command>lemma</span></span> i_append_hd<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span> <span class=keyword1>then</span> <span class=free>f</span> <span class=main>0</span> <span class=keyword1>else</span> hd <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_eq_first<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_hd2><span class=command>lemma</span></span> i_append_hd2<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> hd <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_hd<span class=main>)</span>

<span class=keyword1 id=ListInf-eq_Nil_i_appendI><span class=command>lemma</span></span> eq_Nil_i_appendI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>⌢</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_append_eq_i_appendI><span class=command>lemma</span></span> i_append_eq_i_appendI<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>@</span> <span class=free>xs'</span> <span class=main>=</span> <span class=free>ys</span><span class=main>;</span> <span class=free>f</span> <span class=main>=</span> <span class=free>xs'</span> <span class=main>⌢</span> <span class=free>g</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=ListInf-o_ext><span class=command>lemma</span></span> o_ext<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span> <span class=main>∈</span> range <span class=free>h</span> <span class=main>⟶</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span> <span class=main>=</span> <span class=free>g</span> <span class=main>∘</span> <span class=free>h</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_o><span class=command>lemma</span></span> i_append_o<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>g</span> <span class=main>∘</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>map <span class=free>g</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>g</span> <span class=main>∘</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-o_eq_conv><span class=command>lemma</span></span> o_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>h</span> <span class=main>=</span> <span class=free>g</span> <span class=main>∘</span> <span class=free>h</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>range <span class=free>h</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-o_cong><span class=command>lemma</span></span> o_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>h</span> <span class=main>=</span> <span class=free>i</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> range <span class=free>i</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=ListInf-ex_o_conv><span class=command>lemma</span></span> ex_o_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>h</span><span class=main>.</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>h</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span>range <span class=free>g</span><span class=main>.</span> <span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>y</span><span class=main>.</span> <span class=free>g</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>y</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> someI_ex<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-o_inj_on><span class=command>lemma</span></span> o_inj_on<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span><span class=main>;</span> inj_on <span class=free>f</span> <span class=main>(</span>range <span class=free>g</span> <span class=main>∪</span> range <span class=free>h</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>g</span> <span class=main>=</span> <span class=free>h</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> expand_ilist_eq<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> fun_cong<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_onD<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-inj_on_o_eq_o><span class=command>lemma</span></span> inj_on_o_eq_o<span class=main>:</span> <span class=quoted><span class=quoted>"
  inj_on <span class=free>f</span> <span class=main>(</span>range <span class=free>g</span> <span class=main>∪</span> range <span class=free>h</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>g</span> <span class=main>=</span> <span class=free>h</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> o_inj_on<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-o_injective><span class=command>lemma</span></span> o_injective<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span><span class=main>;</span> inj <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>g</span> <span class=main>=</span> <span class=free>h</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq inj_on_def<span class=main>)</span>

<span class=keyword1 id=ListInf-inj_o_eq_o><span class=command>lemma</span></span> inj_o_eq_o<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=free>f</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>h</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>g</span> <span class=main>=</span> <span class=free>h</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> o_injective<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-inj_oI><span class=command>lemma</span></span> inj_oI<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=free>f</span> <span class=main>⟹</span> inj <span class=main>(</span><span class=main>λ</span><span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> o_inj_on<span class=main><span class=main>[</span></span><span class=operator>unfolded</span> inj_on_def<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-inj_oD><span class=command>lemma</span></span> inj_oD<span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=main>(</span><span class=main>λ</span><span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>g</span><span class=main>)</span> <span class=main>⟹</span> inj <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_on_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> g h<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=improper>g</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=improper>h</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-inj_o><span class=command>lemma</span></span> inj_o<span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"inj <span class=main>(</span><span class=main>λ</span><span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>g</span><span class=main>)</span> <span class=main>=</span> inj <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_oD<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_oI<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-inj_on_oI><span class=command>lemma</span></span> inj_on_oI<span class=main>:</span> <span class=quoted><span class=quoted>"
  inj_on <span class=free>f</span> <span class=main>(</span><span class=main>⋃</span> <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=bound>f</span><span class=main>.</span> range <span class=bound>f</span><span class=main>)</span> <span class=main>`</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> inj_on <span class=main>(</span><span class=main>λ</span><span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>g</span><span class=main>)</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inj_onI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> o_inj_on<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inj_on_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>force</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-o_idI><span class=command>lemma</span></span> o_idI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> range <span class=free>g</span> <span class=main>⟶</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-o_fun_upd><span class=command>lemma</span></span> o_fun_upd<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>∉</span> range <span class=free>g</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>(</span><span class=free>y</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-range_i_append><span class=command>lemma</span></span> range_i_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> set <span class=free>xs</span> <span class=main>∪</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-set_subset_i_append><span class=command>lemma</span></span> set_subset_i_append<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=free>xs</span> <span class=main>⊆</span> range <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-range_subset_i_append><span class=command>lemma</span></span> range_subset_i_append<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=free>f</span> <span class=main>⊆</span> range <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-range_ConsD><span class=command>lemma</span></span> range_ConsD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>∈</span> range <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>∈</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-range_o><span class=command>lemma</span></span> range_o <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>`</span> range <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_comp<span class=main>)</span>

<span class=keyword1 id=ListInf-in_range_conv_decomp><span class=command>lemma</span></span> in_range_conv_decomp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>x</span> <span class=main>∈</span> range <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>xs</span> <span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=bound>g</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> n<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"map <span class=free>f</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=improper>n</span><span class=main>]</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=bound>i</span> <span class=main>+</span> Suc <span class=improper>n</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth nth_append linorder_not_less less_Suc_eq_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> xs g<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=improper>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>nth›</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-i_append_nth_Cons_0><span class=command>lemma</span></span> i_append_nth_Cons_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_append_nth_Cons_Suc><span class=command>lemma</span></span> i_append_nth_Cons_Suc<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_nth_Cons><span class=command>lemma</span></span> i_append_nth_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free>n</span> <span class=keyword1>of</span> <span class=main>0</span> <span class=main>⇒</span> <span class=free>x</span> <span class=main>|</span> Suc <span class=bound>k</span> <span class=main>⇒</span> <span class=free>f</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_nth<span class=main>)</span>

<span class=keyword1 id="ListInf-i_append_nth_Cons'"><span class=command>lemma</span></span> i_append_nth_Cons'<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=free>x</span> <span class=keyword1>else</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_nth_length><span class=command>lemma</span></span> i_append_nth_length<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_append_nth_length_plus><span class=command>lemma</span></span> i_append_nth_length_plus<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-range_iff><span class=command>lemma</span></span> range_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>y</span> <span class=main>∈</span> range <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=free>y</span> <span class=main>=</span> <span class=free>f</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=ListInf-range_ball_nth><span class=command>lemma</span></span> range_ball_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span><span class=main>∈</span>range <span class=free>f</span><span class=main>.</span> <span class=free>P</span> <span class=bound>y</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=ListInf-all_nth_imp_all_range><span class=command>lemma</span></span> all_nth_imp_all_range<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>;</span><span class=free>y</span> <span class=main>∈</span> range <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>y</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=ListInf-all_range_conv_all_nth><span class=command>lemma</span></span> all_range_conv_all_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>y</span><span class=main>∈</span>range <span class=free>f</span><span class=main>.</span> <span class=free>P</span> <span class=bound>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=ListInf-i_append_update1><span class=command>lemma</span></span> i_append_update1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span><span class=main>[</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_update2><span class=command>lemma</span></span> i_append_update2<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_update><span class=command>lemma</span></span> i_append_update<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=free>xs</span><span class=main>[</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span>
   <span class=keyword1>else</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_update1 i_append_update2<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_update_length><span class=command>lemma</span></span> i_append_update_length<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>:=</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=main>0</span> <span class=main>:=</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_update2<span class=main>)</span>

<span class=keyword1 id=ListInf-range_update_subset_insert><span class=command>lemma</span></span> range_update_subset_insert<span class=main>:</span> <span class=quoted><span class=quoted>"
  range <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>⊆</span> insert <span class=free>x</span> <span class=main>(</span>range <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=ListInf-range_update_subsetI><span class=command>lemma</span></span> range_update_subsetI<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> range <span class=free>f</span> <span class=main>⊆</span> <span class=free>A</span><span class=main>;</span> <span class=free>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟧</span> <span class=main>⟹</span> range <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>⊆</span> <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=ListInf-range_update_memI><span class=command>lemma</span></span> range_update_memI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> range <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>take</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>drop</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> for infinite lists›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>i_take</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> operator takes the first <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> elements of an infinite list,
  i.e. <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>i_take f n = [f 0, f 1, …, f (n-1)]›</span></span></span></span>.
  The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>i_drop</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> operator drops the first <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> elements of an infinite list,
  i.e. <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>(i_take f n) 0 = f n, (i_take f n) 1 = f (n + 1), …›</span></span></span></span>.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>i_take</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span> ilist <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>i_take</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> map <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>i_drop</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'a</span> ilist <span class=main>⇒</span> <span class=tfree>'a</span> ilist"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>i_drop</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>+</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>i_take'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ilist <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⇓</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main><span class=free>⇓</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> i_take <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span>"</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>i_drop'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ilist <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span> ilist"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⇑</span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main><span class=free>⇑</span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> i_drop <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span>"</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>[</span><span class=main>0</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>
<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>x</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=bound>x</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def<span class=main>)</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Basic results for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>i_take</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>i_drop</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-i_take_first><span class=command>lemma</span></span> i_take_first<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>[</span><span class=free>f</span> <span class=main>0</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_i_take_1><span class=command>lemma</span></span> i_drop_i_take_1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>⇓</span> Suc <span class=main>0</span> <span class=main>=</span> <span class=main>[</span><span class=free>f</span> <span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_take_eq1><span class=command>lemma</span></span> i_take_take_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>↓</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def take_map<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_take_eq2><span class=command>lemma</span></span> i_take_take_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>m</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>↓</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def take_map<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_take><span class=command>lemma</span></span> i_take_take<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>↓</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> min <span class=free>n</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_def i_take_take_eq1 i_take_take_eq2<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_nth><span class=command>lemma</span></span> i_drop_nth<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=free>s</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_nth_sub><span class=command>lemma</span></span> i_drop_nth_sub<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>n</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>s</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>s</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> i_take_nth<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>f</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_length><span class=command>lemma</span></span> i_take_length<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_0><span class=command>lemma</span></span> i_take_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=main>0</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_0><span class=command>lemma</span></span> i_drop_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=main>0</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_eq_Nil><span class=command>lemma</span></span> i_take_eq_Nil<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_not_empty_conv><span class=command>lemma</span></span> i_take_not_empty_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-last_i_take><span class=command>lemma</span></span> last_i_take<span class=main>:</span> <span class=quoted><span class=quoted>"last <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> last_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-last_i_take2><span class=command>lemma</span></span> last_i_take2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>n</span> <span class=main>⟹</span> last <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> last_i_take<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>f</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-nth_0_i_drop><span class=command>lemma</span></span> nth_0_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=free>f</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_take_const><span class=command>lemma</span></span> i_take_const<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>i</span> <span class=main>=</span> replicate <span class=free>i</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_const><span class=command>lemma</span></span> i_drop_const<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_take_eq1><span class=command>lemma</span></span> i_append_i_take_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_take_eq2><span class=command>lemma</span></span> i_append_i_take_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>@</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq nth_append<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_take_if><span class=command>lemma</span></span> i_append_i_take_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=keyword1>else</span> <span class=free>xs</span> <span class=main>@</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_i_take_eq1 i_append_i_take_eq2<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_take><span class=command>lemma</span></span> i_append_i_take<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_i_take_if<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_drop_eq1><span class=command>lemma</span></span> i_append_i_drop_eq1<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth less_diff_conv add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=free>n</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_drop_eq2><span class=command>lemma</span></span> i_append_i_drop_eq2<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_drop_if><span class=command>lemma</span></span> i_append_i_drop_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>n</span> <span class=main>&lt;</span> length <span class=free>xs</span> <span class=keyword1>then</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span> <span class=keyword1>else</span> <span class=free>f</span> <span class=main>⇑</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_i_drop_eq1 i_append_i_drop_eq2<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_drop><span class=command>lemma</span></span> i_append_i_drop<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_i_drop_if<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_i_take_i_drop_id><span class=command>lemma</span></span> i_append_i_take_i_drop_id<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-ilist_i_take_i_drop_imp_eq><span class=command>lemma</span></span> ilist_i_take_i_drop_imp_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span>  <span class=main>=</span> <span class=free>g</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>;</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> i_append_i_take_i_drop_id<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>f</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> i_append_i_take_i_drop_id<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>g</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-ilist_i_take_i_drop_eq_conv><span class=command>lemma</span></span> ilist_i_take_i_drop_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇓</span> <span class=bound>n</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>⇑</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇑</span> <span class=bound>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> ilist_i_take_i_drop_imp_eq<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-ilist_i_take_eq_conv><span class=command>lemma</span></span> ilist_i_take_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>⇓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇓</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> i<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Suc <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> f<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>xs</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>!</span> <span class=improper>i</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> arg_cong<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-ilist_i_drop_eq_conv><span class=command>lemma</span></span> ilist_i_drop_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>⇑</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇑</span> <span class=bound>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_take_the_conv><span class=command>lemma</span></span> i_take_the_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>f</span> <span class=main>⇓</span> <span class=free>k</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>xs</span><span class=main>.</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>k</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>g</span><span class=main>.</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>g</span> <span class=main>=</span> <span class=free>f</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the1I2<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ex1I<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> i_append_i_take_i_drop_id<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_drop_the_conv><span class=command>lemma</span></span> i_drop_the_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>f</span> <span class=main>⇑</span> <span class=free>k</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>g</span><span class=main>.</span> <span class=main>(</span><span class=main>∃</span><span class=bound>xs</span><span class=main>.</span> length <span class=bound>xs</span> <span class=main>=</span> <span class=free>k</span> <span class=main>∧</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>g</span> <span class=main>=</span> <span class=free>f</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> sym<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> the1_equality<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> a<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> ex1I<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_take_Suc_append><span class=command>lemma</span></span> i_take_Suc_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=main>(</span><span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> i_take_Suc_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇓</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>x</span> <span class=main>#</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_drop_Suc_append><span class=command>lemma</span></span> i_drop_Suc_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>x</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> i_drop_Suc_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_take_Suc><span class=command>lemma</span></span> i_take_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>0</span> <span class=main>#</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> Suc <span class=main>0</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq nth_Cons'<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_Suc_conv_app_nth><span class=command>lemma</span></span> i_take_Suc_conv_app_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=free>f</span> <span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_i_drop><span class=command>lemma</span></span> i_drop_i_drop<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>⇑</span> <span class=free>a</span> <span class=main>⇑</span> <span class=free>b</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⇑</span> <span class=main>(</span><span class=free>a</span> <span class=main>+</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_def add.assoc<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> i_drop_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> Suc <span class=main>0</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_take_commute><span class=command>lemma</span></span> i_take_commute<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>⇓</span> <span class=free>a</span> <span class=main>↓</span> <span class=free>b</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⇓</span> <span class=free>b</span> <span class=main>↓</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>ac_simps</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_commute><span class=command>lemma</span></span> i_drop_commute<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>⇑</span> <span class=free>a</span> <span class=main>⇑</span> <span class=free>b</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⇑</span> <span class=free>b</span> <span class=main>⇑</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> i_drop_tl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> Suc <span class=main>0</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>⇑</span> Suc <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-nth_via_i_drop><span class=command>lemma</span></span> nth_via_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span> <span class=main>⟹</span> <span class=free>f</span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_drop_Suc_conv_tl><span class=command>lemma</span></span> i_drop_Suc_conv_tl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=free>f</span> <span class=free>n</span><span class=main>]</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_append_nth<span class=main>)</span>

<span class=keyword1 id="ListInf-i_drop_Suc_conv_tl'"><span class=command>lemma</span></span> i_drop_Suc_conv_tl'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>[</span><span class=free>f</span> <span class=free>n</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_Suc_Cons<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_i_drop><span class=command>lemma</span></span> i_take_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=free>m</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>n</span> <span class=main>+</span> <span class=free>m</span><span class=main>)</span> <span class=main>↑</span> <span class=free>m</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Appending an interval of a function›</span></span>
<span class=keyword1 id=ListInf-i_take_int_append><span class=command>lemma</span></span> i_take_int_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>m</span><span class=main>)</span> <span class=main>@</span> map <span class=free>f</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq nth_append<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_drop_map_empty_iff><span class=command>lemma</span></span> i_take_drop_map_empty_iff<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>↑</span> <span class=free>m</span> <span class=main>=</span> <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>n</span> <span class=main>≤</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf-i_take_drop_map><span class=command>lemma</span></span> i_take_drop_map<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>↑</span> <span class=free>m</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> i_take_drop_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>m</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>m</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>↑</span> <span class=free>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_drop_map i_take_int_append<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_drop><span class=command>lemma</span></span> i_take_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>↑</span> <span class=free>m</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>m</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> <span class=free>m</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_take_o><span class=command>lemma</span></span> i_take_o<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-i_drop_o><span class=command>lemma</span></span> i_drop_o<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-set_i_take_subset><span class=command>lemma</span></span> set_i_take_subset<span class=main>:</span> <span class=quoted><span class=quoted>"set <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>⊆</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-range_i_drop_subset><span class=command>lemma</span></span> range_i_drop_subset<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>⊆</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=ListInf-in_set_i_takeD><span class=command>lemma</span></span> in_set_i_takeD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> set_i_take_subset<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-in_range_i_takeD><span class=command>lemma</span></span> in_range_i_takeD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> range <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subsetD<span class=main><span class=main>[</span></span><span class=operator>OF</span> range_i_drop_subset<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_eq_conv_conj><span class=command>lemma</span></span> i_append_eq_conv_conj<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇓</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span> <span class=main>⇑</span> length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq expand_list_eq i_append_nth<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_take_add><span class=command>lemma</span></span> i_take_add<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span><span class=free>i</span> <span class=main>+</span> <span class=free>j</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>i</span><span class=main>)</span> <span class=main>@</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>i</span> <span class=main>⇓</span> <span class=free>j</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq nth_append<span class=main>)</span>

<span class=keyword1 id=ListInf-i_append_eq_i_append_conv_if_aux><span class=command>lemma</span></span> i_append_eq_i_append_conv_if_aux<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↑</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq expand_ilist_eq i_append_nth min_eqR<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarify</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>+</span> <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> spec<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> less_diff_conv add.commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"length <span class=free>xs</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_append_eq_i_append_conv_if><span class=command>lemma</span></span> i_append_eq_i_append_conv_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span>
   <span class=keyword1>then</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> length <span class=free>xs</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↑</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>g</span>
   <span class=keyword1>else</span> <span class=free>xs</span> <span class=main>↓</span> length <span class=free>ys</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↑</span> length <span class=free>ys</span><span class=main>)</span> <span class=main>⌢</span> <span class=free>f</span> <span class=main>=</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split<span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> conjI impI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_append_eq_i_append_conv_if_aux<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> eq_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span><span class=main><span class=main>]</span></span> i_append_eq_i_append_conv_if_aux<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-i_take_hd_i_drop><span class=command>lemma</span></span> i_take_hd_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>@</span> <span class=main>[</span><span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>0</span><span class=main>]</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> Suc <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_Suc_conv_app_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-id_i_take_nth_i_drop><span class=command>lemma</span></span> id_i_take_nth_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span><span class=main>(</span><span class=main>[</span><span class=free>f</span> <span class=free>n</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>⇑</span> Suc <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_drop_Suc_Cons<span class=main>)</span>

<span class=keyword1 id=ListInf-upd_conv_i_take_nth_i_drop><span class=command>lemma</span></span> upd_conv_i_take_nth_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>f</span> <span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> Suc <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq nth_append i_append_nth<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> i_take_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=main>0</span><span class=main>)</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>f</span> <span class=main>⇓</span> Suc <span class=bound>n</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat.induct<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> take_induct<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↓</span> <span class=main>0</span><span class=main>)</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span>  <span class=main>⟦</span> Suc <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>s</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↓</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>s</span> <span class=main>↓</span> Suc <span class=bound>n</span><span class=main>)</span><span class=main>;</span>
    <span class=free>i</span> <span class=main>&lt;</span> length <span class=free>s</span><span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↓</span> <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> i_drop_induct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=main>0</span><span class=main>)</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>f</span> <span class=main>⇑</span> Suc <span class=bound>n</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nat.induct<span class=main>)</span>

<span class=keyword1><span class=command>theorem</span></span> f_drop_induct<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↑</span> <span class=main>0</span><span class=main>)</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>n</span><span class=main>.</span>  <span class=main>⟦</span> Suc <span class=bound>n</span> <span class=main>&lt;</span> length <span class=free>s</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↑</span> <span class=bound>n</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span> <span class=free>s</span> <span class=main>↑</span> Suc <span class=bound>n</span><span class=main>)</span><span class=main>;</span>
    <span class=free>i</span> <span class=main>&lt;</span> length <span class=free>s</span><span class=main>⟧</span>
  <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>s</span> <span class=main>↑</span> <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>i</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>


<span class=keyword1 id=ListInf-i_take_drop_eq_map><span class=command>lemma</span></span> i_take_drop_eq_map<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=free>m</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> map <span class=free>f</span> <span class=main>[</span><span class=free>m</span><span class=main>..&lt;</span><span class=free>m</span><span class=main>+</span><span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq<span class=main>)</span>

<span class=keyword1 id=ListInf-o_eq_i_append_imp><span class=command>lemma</span></span> o_eq_i_append_imp<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>i</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound>xs</span> <span class=bound>h</span><span class=main>.</span> <span class=free>g</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>h</span> <span class=main>∧</span> map <span class=free>f</span> <span class=bound>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>h</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>g</span> <span class=main>⇓</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>g</span> <span class=main>⇑</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>⇓</span></span> length <span class=free><span class=free>ys</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>λ</span></span><span class=bound><span class=bound>x</span></span><span class=main><span class=main>.</span></span> <span class=bound><span class=bound>x</span></span> <span class=main><span class=main>⇑</span></span> length <span class=free><span class=free>ys</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> o_eq_i_append_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>f</span> <span class=main>∘</span> <span class=free>g</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>xs</span> <span class=bound>h</span><span class=main>.</span> <span class=free>g</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>h</span> <span class=main>∧</span> map <span class=free>f</span> <span class=bound>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>h</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> o_eq_i_append_imp<span class=main>)</span>
<span class=keyword1><span class=command>corollary</span></span> i_append_eq_o_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>ys</span> <span class=main>⌢</span> <span class=free>i</span> <span class=main>=</span> <span class=free>f</span> <span class=main>∘</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>xs</span> <span class=bound>h</span><span class=main>.</span> <span class=free>g</span> <span class=main>=</span> <span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>h</span> <span class=main>∧</span> map <span class=free>f</span> <span class=bound>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>∘</span> <span class=bound>h</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> o_eq_i_append_imp<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>zip</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> for infinite lists›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>i_zip</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ilist <span class=main>⇒</span> <span class=tfree>'b</span> ilist <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> ilist"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>i_zip</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>g</span></span></span> <span class=main>≡</span> <span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>n</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>g</span></span></span> <span class=bound>n</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf-i_zip_nth><span class=command>lemma</span></span> i_zip_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=free>n</span><span class=main>,</span> <span class=free>g</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_zip_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_swap><span class=command>lemma</span></span> i_zip_swap<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>y</span><span class=main>,</span> <span class=bound>x</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>)</span> <span class=main>∘</span> i_zip <span class=free>g</span> <span class=free>f</span> <span class=main>=</span> i_zip <span class=free>f</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_i_take><span class=command>lemma</span></span> i_zip_i_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span> zip <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_i_drop><span class=command>lemma</span></span> i_zip_i_drop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span> i_zip <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-fst_o_izip><span class=command>lemma</span></span> fst_o_izip<span class=main>:</span> <span class=quoted><span class=quoted>"fst <span class=main>∘</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-snd_o_i_zip><span class=command>lemma</span></span> snd_o_i_zip<span class=main>:</span> <span class=quoted><span class=quoted>"snd <span class=main>∘</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-update_i_zip><span class=command>lemma</span></span> update_i_zip<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>xy</span><span class=main>)</span> <span class=main>=</span> i_zip <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> fst <span class=free>xy</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>g</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> snd <span class=free>xy</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_Cons_Cons><span class=command>lemma</span></span> i_zip_Cons_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_zip <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span><span class=main>[</span><span class=free>y</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span><span class=main>]</span> <span class=main>⌢</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_i_append1><span class=command>lemma</span></span> i_zip_i_append1<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_zip <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=free>g</span> <span class=main>=</span> zip <span class=free>xs</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇓</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>⌢</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=main>(</span><span class=free>g</span> <span class=main>⇑</span> length <span class=free>xs</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_i_append2><span class=command>lemma</span></span> i_zip_i_append2<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_zip <span class=free>f</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> zip <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> length <span class=free>ys</span><span class=main>)</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=main>(</span>i_zip <span class=main>(</span><span class=free>f</span> <span class=main>⇑</span> length <span class=free>ys</span><span class=main>)</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_append><span class=command>lemma</span></span> i_zip_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>=</span> length <span class=free>ys</span> <span class=main>⟹</span>
  i_zip <span class=main>(</span><span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⌢</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> zip <span class=free>xs</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth i_append_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_range><span class=command>lemma</span></span> i_zip_range<span class=main>:</span> <span class=quoted><span class=quoted>"range <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span> <span class=main>(</span><span class=free>f</span> <span class=bound>n</span><span class=main>,</span> <span class=free>g</span> <span class=bound>n</span><span class=main>)</span><span class=main>|</span> <span class=bound>n</span><span class=main>.</span> True <span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> i_zip_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_update><span class=command>lemma</span></span> i_zip_update<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_zip <span class=main>(</span><span class=free>f</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>x</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>g</span><span class=main>(</span><span class=free>n</span> <span class=main>:=</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>i_zip <span class=free>f</span> <span class=free>g</span><span class=main>)</span><span class=main>(</span> <span class=free>n</span> <span class=main>:=</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> update_i_zip<span class=main>)</span>

<span class=keyword1 id=ListInf-i_zip_const><span class=command>lemma</span></span> i_zip_const<span class=main>:</span> <span class=quoted><span class=quoted>"i_zip <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_ilist_eq i_zip_nth<span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Mapping functions with two arguments to infinite lists›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>i_map2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"
  <span class=comment1>― ‹Function taking two parameters›</span>
  <span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'b</span> <span class=main>⇒</span> <span class=tfree>'c</span><span class=main>)</span> <span class=main>⇒</span>
  <span class=comment1>― ‹Lists of parameters›</span>
  <span class=tfree>'a</span> ilist <span class=main>⇒</span> <span class=tfree>'b</span> ilist <span class=main>⇒</span>
  <span class=tfree>'c</span> ilist"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>i_map2</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>≡</span> <span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=bound>n</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=bound>n</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf-i_map2_nth><span class=command>lemma</span></span> i_map2_nth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_map2_def<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_Cons_Cons><span class=command>lemma</span></span> i_map2_Cons_Cons<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=main>[</span><span class=free>y</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>[</span><span class=free>f</span> <span class=free>x</span> <span class=free>y</span><span class=main>]</span> <span class=main>⌢</span> <span class=main>(</span>i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth i_append_nth_Cons'<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_take_ge><span class=command>lemma</span></span> i_map2_take_ge<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> <span class=free>n1</span> <span class=main>⟹</span>
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇓</span> <span class=free>n1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> expand_list_eq map2_length i_map2_nth map2_nth<span class=main>)</span>
<span class=keyword1 id=ListInf-i_map2_take_take><span class=command>lemma</span></span> i_map2_take_take<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇓</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> i_map2_take_ge<span class=main><span class=main>[</span></span><span class=operator>OF</span> le_refl<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_drop><span class=command>lemma</span></span> i_map2_drop<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⇑</span> <span class=free>n</span> <span class=main>=</span>
  <span class=main>(</span>i_map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇑</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_append_append><span class=command>lemma</span></span> i_map2_append_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs1</span> <span class=main>=</span> length <span class=free>ys1</span> <span class=main>⟹</span>
  i_map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>⌢</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>ys1</span> <span class=main>⌢</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs1</span> <span class=free>ys1</span> <span class=main>⌢</span> i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth i_append_nth map2_length map2_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_Cons_left><span class=command>lemma</span></span> i_map2_Cons_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=main>(</span><span class=main>[</span><span class=free>x</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span>
  <span class=main>[</span><span class=free>f</span> <span class=free>x</span> <span class=main>(</span><span class=free>ys</span> <span class=main>0</span><span class=main>)</span><span class=main>]</span> <span class=main>⌢</span> i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇑</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth i_append_nth_Cons'<span class=main>)</span>
<span class=keyword1 id=ListInf-i_map2_Cons_right><span class=command>lemma</span></span> i_map2_Cons_right<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=main>[</span><span class=free>y</span><span class=main>]</span> <span class=main>⌢</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>[</span><span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>0</span><span class=main>)</span> <span class=free>y</span><span class=main>]</span> <span class=main>⌢</span> i_map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇑</span> Suc <span class=main>0</span><span class=main>)</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth i_append_nth_Cons'<span class=main>)</span>


<span class=keyword1 id=ListInf-i_map2_append_take_drop_left><span class=command>lemma</span></span> i_map2_append_take_drop_left<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs1</span> <span class=main>⌢</span> <span class=free>xs</span><span class=main>)</span> <span class=free>ys</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=free>xs1</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇓</span> length <span class=free>xs1</span><span class=main>)</span> <span class=main>⌢</span>
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⇑</span> length <span class=free>xs1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff map2_nth i_map2_nth i_append_nth map2_length<span class=main>)</span>
<span class=keyword1 id=ListInf-i_map2_append_take_drop_right><span class=command>lemma</span></span> i_map2_append_take_drop_right<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=main>(</span><span class=free>ys1</span> <span class=main>⌢</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇓</span> length <span class=free>ys1</span><span class=main>)</span> <span class=free>ys1</span> <span class=main>⌢</span>
  i_map2 <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⇑</span> length <span class=free>ys1</span><span class=main>)</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff map2_nth i_map2_nth i_append_nth map2_length<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_cong><span class=command>lemma</span></span> i_map2_cong<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs1</span> <span class=main>=</span> <span class=free>xs2</span><span class=main>;</span> <span class=free>ys1</span> <span class=main>=</span> <span class=free>ys2</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>x</span> <span class=main>∈</span> range <span class=free>xs2</span><span class=main>;</span> <span class=bound>y</span> <span class=main>∈</span> range <span class=free>ys2</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>f</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span> <span class=bound>y</span> <span class=main>⟧</span> <span class=main>⟹</span>
  i_map2 <span class=free>f</span> <span class=free>xs1</span> <span class=free>ys1</span> <span class=main>=</span> i_map2 <span class=free>g</span> <span class=free>xs2</span> <span class=free>ys2</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_eq_conv><span class=command>lemma</span></span> i_map2_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> i_map2 <span class=free>g</span> <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>f</span> <span class=main>(</span><span class=free>xs</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>g</span> <span class=main>(</span><span class=free>xs</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free>ys</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_replicate><span class=command>lemma</span></span> i_map2_replicate<span class=main>:</span> <span class=quoted><span class=quoted>"i_map2 <span class=free>f</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>x</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>y</span><span class=main>)</span>  <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=free>x</span> <span class=free>y</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth<span class=main>)</span>

<span class=keyword1 id=ListInf-i_map2_i_zip_conv><span class=command>lemma</span></span> i_map2_i_zip_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  i_map2 <span class=free>f</span> <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span><span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>)</span> <span class=main>∘</span> <span class=main>(</span>i_zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fun_eq_iff i_map2_nth i_zip_nth<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Generalised lists as combination of finite and infinite lists›</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Basic definitions›</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=main>(</span>gset<span class=main>:</span> <span class=tfree>'a</span><span class=main>)</span> glist <span class=main>=</span> FL <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list"</span></span> <span class=main>|</span> IL <span class=quoted><span class=quoted>"<span class=tfree>'a</span> ilist"</span></span> <span class=keyword2><span class=keyword>for</span></span> map<span class=main>:</span> gmap

<span class=keyword1><span class=command>definition</span></span> <span class=entity>glength</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> glist <span class=main>⇒</span> enat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>glength</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    FL <span class=bound>xs</span> <span class=main>⇒</span> enat <span class=main>(</span>length <span class=bound>xs</span><span class=main>)</span> <span class=main>|</span>
    IL <span class=bound>f</span>  <span class=main>⇒</span> <span class=main>∞</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gCons</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> glist <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span>"</span> 65<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1><span class=free>#<span class=hidden>⇩</span><sub>g</sub></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    FL <span class=bound>xs</span> <span class=main>⇒</span> FL <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>#</span> <span class=bound>xs</span><span class=main>)</span> <span class=main>|</span>
    IL <span class=bound>g</span>  <span class=main>⇒</span> IL <span class=main>(</span><span class=main>[</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>]</span> <span class=main>⌢</span> <span class=bound>g</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gappend</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> glist <span class=main>⇒</span> <span class=tfree>'a</span> glist <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixr</span></span> <span class=quoted>"<span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span>"</span> 65<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>gappend</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    FL <span class=bound>xs</span> <span class=main>⇒</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=keyword1>of</span> FL <span class=bound>ys</span> <span class=main>⇒</span> FL <span class=main>(</span><span class=bound>xs</span> <span class=main>@</span> <span class=bound>ys</span><span class=main>)</span> <span class=main>|</span> IL <span class=bound>f</span> <span class=main>⇒</span> IL <span class=main>(</span><span class=bound>xs</span> <span class=main>⌢</span> <span class=bound>f</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span>
    IL <span class=bound>f</span>  <span class=main>⇒</span> IL <span class=bound>f</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gtake</span> <span class=main>::</span> <span class=quoted><span class=quoted>"enat <span class=main>⇒</span> <span class=tfree>'a</span> glist <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>gtake</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=keyword1>of</span>
    enat <span class=bound>m</span> <span class=main>⇒</span> FL <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
      FL <span class=bound>xs</span> <span class=main>⇒</span> <span class=bound>xs</span> <span class=main>↓</span> <span class=bound>m</span> <span class=main>|</span>
      IL <span class=bound>f</span>  <span class=main>⇒</span> <span class=bound>f</span> <span class=main>⇓</span> <span class=bound>m</span><span class=main>)</span> <span class=main>|</span>
    <span class=main>∞</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>a</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gdrop</span> <span class=main>::</span> <span class=quoted><span class=quoted>"enat <span class=main>⇒</span> <span class=tfree>'a</span> glist <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>gdrop</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=keyword1>of</span>
    enat <span class=bound>m</span> <span class=main>⇒</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
      FL <span class=bound>xs</span> <span class=main>⇒</span> FL <span class=main>(</span><span class=bound>xs</span> <span class=main>↑</span> <span class=bound>m</span><span class=main>)</span> <span class=main>|</span>
      IL <span class=bound>f</span>  <span class=main>⇒</span> IL <span class=main>(</span><span class=bound>f</span> <span class=main>⇑</span> <span class=bound>m</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span>
    <span class=main>∞</span> <span class=main>⇒</span> FL <span class=main>[]</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gnth</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> glist <span class=main>⇒</span> nat <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span>"</span> 100<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1><span class=free>!<span class=hidden>⇩</span><sub>g</sub></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span>
    FL <span class=bound>xs</span> <span class=main>⇒</span> <span class=bound>xs</span> <span class=main>!</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>|</span>
    IL <span class=bound>f</span>  <span class=main>⇒</span> <span class=bound>f</span> <span class=free><span class=bound><span class=entity>n</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>g_take'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> glist <span class=main>⇒</span> enat <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1><span class=free>↓<span class=hidden>⇩</span><sub>g</sub></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> gtake <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>g_drop'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> glist <span class=main>⇒</span> enat <span class=main>⇒</span> <span class=tfree>'a</span> glist"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span>"</span> 100<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1><span class=free>↑<span class=hidden>⇩</span><sub>g</sub></span></span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=main>≡</span> gdrop <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span>"</span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>glength›</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-glength_fin><span class=command>lemma</span></span> glength_fin<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span>FL <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> enat <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> glength_def<span class=main>)</span>

<span class=keyword1 id=ListInf-glength_infin><span class=command>lemma</span></span> glength_infin<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span>IL <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>∞</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> glength_def<span class=main>)</span>

<span class=keyword1 id=ListInf-gappend_glength><span class=command>lemma</span></span> gappend_glength<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> glength <span class=free>a</span> <span class=main>+</span> glength <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gmap_glength><span class=command>lemma</span></span> gmap_glength<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span>gmap <span class=free>f</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> glength <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-glength_0_conv><span class=command>lemma</span></span> glength_0_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>glength <span class=free>a</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-glength_greater_0_conv><span class=command>lemma</span></span> glength_greater_0_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span> <span class=main>&lt;</span> glength <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≠</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> glength_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-glength_gSuc_conv><span class=command>lemma</span></span> glength_gSuc_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>glength <span class=free>a</span> <span class=main>=</span> eSuc <span class=free>n</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>x</span> <span class=bound>b</span><span class=main>.</span> <span class=free>a</span> <span class=main>=</span> <span class=bound>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=bound>b</span> <span class=main>∧</span> glength <span class=bound>b</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gCons_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> a'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> n'<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"hd <span class=improper>a'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"FL <span class=main>(</span>tl <span class=improper>a'</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subgoal_tac</span> <span class=quoted><span class=quoted>"<span class=improper>a'</span> <span class=main>≠</span> <span class=main>[]</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>prefer</span></span></span></span> 2
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rename_tac</span> f<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>f</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"IL <span class=main>(</span><span class=improper>f</span> <span class=main>⇑</span> Suc <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> i_take_first<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rename_tac</span> x b<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>b</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>b</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-gSuc_glength_conv><span class=command>lemma</span></span> gSuc_glength_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span>eSuc <span class=free>n</span> <span class=main>=</span> glength <span class=free>a</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>∃</span><span class=bound>x</span> <span class=bound>b</span><span class=main>.</span> <span class=free>a</span> <span class=main>=</span> <span class=bound>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=bound>b</span> <span class=main>∧</span> glength <span class=bound>b</span> <span class=main>=</span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted>"glength <span class=free>a</span>"</span></span><span class=main><span class=main>]</span></span> glength_gSuc_conv<span class=main>)</span>



<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>@›</span></span></span></span>\ensuremath{{}_g} -- gappend›</span></span>

<span class=keyword1 id=ListInf-gappend_Nil><span class=command>lemma</span></span> gappend_Nil<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>FL <span class=main>[]</span><span class=main>)</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gappend_Nil2><span class=command>lemma</span></span> gappend_Nil2<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>FL <span class=main>[]</span><span class=main>)</span><span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gappend_is_Nil_conv><span class=command>lemma</span></span> gappend_is_Nil_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-Nil_is_gappend_conv><span class=command>lemma</span></span> Nil_is_gappend_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>FL <span class=main>[]</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span> <span class=main>∧</span> <span class=free>b</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"FL <span class=main>[]</span>"</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gappend_assoc><span class=command>lemma</span></span> gappend_assoc<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>c</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>c</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>c</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gappend_infin><span class=command>lemma</span></span> gappend_infin<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"IL <span class=free>f</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=main>=</span> IL <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> gappend_def<span class=main>)</span>

<span class=keyword1 id=ListInf-same_gappend_eq_disj><span class=command>lemma</span></span> same_gappend_eq_disj<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>glength <span class=free>a</span> <span class=main>=</span> <span class=main>∞</span> <span class=main>∨</span> <span class=free>b</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>c</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> gappend_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>c</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=ListInf-same_gappend_eq><span class=command>lemma</span></span> same_gappend_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  glength <span class=free>a</span> <span class=main>&lt;</span> <span class=main>∞</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span> <span class=main>=</span> <span class=free>c</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>gmap›</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-gmap_gappend><span class=command>lemma</span></span> gmap_gappend<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"gmap <span class=free>f</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> gmap <span class=free>f</span> <span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> gmap <span class=free>f</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>induct</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>induct</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> gmap_gmap<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> glist.map_comp

<span class=keyword1 id=ListInf-gmap_eq_conv><span class=command>lemma</span></span> gmap_eq_conv<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>gmap <span class=free>f</span> <span class=free>a</span> <span class=main>=</span> gmap <span class=free>g</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span>gset <span class=free>a</span><span class=main>.</span> <span class=free>f</span> <span class=bound>x</span> <span class=main>=</span> <span class=free>g</span> <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> o_eq_conv<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> gmap_cong <span class=main>=</span> glist.map_cong

<span class=keyword1 id=ListInf-gmap_is_Nil_conv><span class=command>lemma</span></span> gmap_is_Nil_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>gmap <span class=free>f</span> <span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> glength_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gmap_eq_imp_glength_eq><span class=command>lemma</span></span> gmap_eq_imp_glength_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  gmap <span class=free>f</span> <span class=free>a</span> <span class=main>=</span> gmap <span class=free>f</span> <span class=free>b</span> <span class=main>⟹</span> glength <span class=free>a</span> <span class=main>=</span> glength <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> arg_cong<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> f<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>glength</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>gset›</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-gset_gappend><span class=command>lemma</span></span> gset_gappend<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  gset <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>case</span> <span class=free>a</span> <span class=keyword1>of</span> FL <span class=bound>a'</span> <span class=main>⇒</span> set <span class=bound>a'</span> <span class=main>∪</span> gset <span class=free>b</span> <span class=main>|</span> IL <span class=bound>a'</span>  <span class=main>⇒</span> range <span class=bound>a'</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gset_gappend_if><span class=command>lemma</span></span> gset_gappend_if<span class=main>:</span> <span class=quoted><span class=quoted>"
  gset <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> glength <span class=free>a</span> <span class=main>&lt;</span> <span class=main>∞</span> <span class=keyword1>then</span> gset <span class=free>a</span> <span class=main>∪</span> gset <span class=free>b</span> <span class=keyword1>else</span> gset <span class=free>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gappend_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gset_empty><span class=command>lemma</span></span> gset_empty<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>gset <span class=free>a</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>=</span> FL <span class=main>[]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> gset_gmap<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> glist.set_map

<span class=keyword1 id=ListInf-icard_glength><span class=command>lemma</span></span> icard_glength<span class=main>:</span> <span class=quoted><span class=quoted>"icard <span class=main>(</span>gset <span class=free>a</span><span class=main>)</span> <span class=main>≤</span> glength <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> icard_def glength_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> card_length<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>!›</span></span></span></span>\ensuremath{{}_g} -- gnth›</span></span>

<span class=keyword1 id=ListInf-gnth_gCons_0><span class=command>lemma</span></span> gnth_gCons_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>0</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gCons_def gnth_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gnth_gCons_Suc><span class=command>lemma</span></span> gnth_gCons_Suc<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> Suc <span class=free>n</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gCons_def gnth_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gnth_gappend><span class=command>lemma</span></span> gnth_gappend<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>a</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=main>=</span>
  <span class=main>(</span><span class=keyword1>if</span> enat <span class=free>n</span> <span class=main>&lt;</span> glength <span class=free>a</span> <span class=keyword1>then</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>
  <span class=keyword1>else</span> <span class=free>b</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>n</span> <span class=main>-</span> the_enat <span class=main>(</span>glength <span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gappend_def gCons_def gnth_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-gnth_gappend_length_plus><span class=command>lemma</span></span> gnth_gappend_length_plus<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>FL <span class=free>xs</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>b</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> gnth_gappend<span class=main>)</span>

<span class=keyword1 id=ListInf-gmap_gnth><span class=command>lemma</span></span> gmap_gnth<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"enat <span class=free>n</span> <span class=main>&lt;</span> glength <span class=free>a</span> <span class=main>⟹</span> gmap <span class=free>f</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gnth_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-in_gset_cong_gnth><span class=command>lemma</span></span> in_gset_cong_gnth<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=main>∈</span> gset <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span><span class=main>.</span> enat <span class=bound>i</span> <span class=main>&lt;</span> glength <span class=free>a</span> <span class=main>∧</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=bound>i</span> <span class=main>=</span> <span class=free>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> gnth_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> in_set_conv_nth<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>gtake›</span></span></span></span> and <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>gdrop›</span></span></span></span>›</span></span>

<span class=keyword1 id=ListInf-gtake_0><span class=command>lemma</span></span> gtake_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>0</span> <span class=main>=</span> FL <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gdrop_0><span class=command>lemma</span></span> gdrop_0<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>0</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gdrop_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gtake_Infty><span class=command>lemma</span></span> gtake_Infty<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>∞</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gdrop_Infty><span class=command>lemma</span></span> gdrop_Infty<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>∞</span> <span class=main>=</span> FL <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gdrop_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gtake_all><span class=command>lemma</span></span> gtake_all<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gdrop_all><span class=command>lemma</span></span> gdrop_all<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=free>a</span> <span class=main>≤</span> <span class=free>n</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=main>=</span> FL <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gdrop_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-gtake_eSuc_gCons><span class=command>lemma</span></span> gtake_eSuc_gCons<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def gCons_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>

<span class=keyword1 id=ListInf-gdrop_eSuc_gCons><span class=command>lemma</span></span> gdrop_eSuc_gCons<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span><span class=main>)</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gdrop_def gCons_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>

<span class=keyword1 id=ListInf-gtake_eSuc><span class=command>lemma</span></span> gtake_eSuc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> FL <span class=main>[]</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>0</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=main>0</span><span class=main>)</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def gdrop_def gnth_def gCons_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat take_Suc hd_eq_first take_drop i_take_Suc<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_eq_first drop_eq_tl i_drop_Suc_conv_tl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-gdrop_eSuc><span class=command>lemma</span></span> gdrop_eSuc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>eSuc <span class=main>0</span><span class=main>)</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> gtake_def gdrop_def gnth_def gCons_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eSuc_enat<span class=main>)</span>

<span class=keyword1 id=ListInf-gnth_via_grop><span class=command>lemma</span></span> gnth_via_grop<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>b</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> gdrop_def gnth_def gCons_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> nth_via_drop<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>b</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> nth_via_i_drop<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-gtake_eSuc_conv_gapp_gnth><span class=command>lemma</span></span> gtake_eSuc_conv_gapp_gnth<span class=main>:</span> <span class=quoted><span class=quoted>"
  enat <span class=free>n</span> <span class=main>&lt;</span> glength <span class=free>a</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> enat <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span> <span class=keyword1>@<span class=hidden>⇩</span><sub>g</sub></span> FL <span class=main>[</span><span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span><span class=main>]</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gtake_def gappend_def gnth_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> take_Suc_conv_app_nth i_take_Suc_conv_app_nth<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-gdrop_eSuc_conv_tl><span class=command>lemma</span></span> gdrop_eSuc_conv_tl<span class=main>:</span> <span class=quoted><span class=quoted>"
  enat <span class=free>n</span> <span class=main>&lt;</span> glength <span class=free>a</span> <span class=main>⟹</span> <span class=free>a</span> <span class=keyword1>!<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span> <span class=keyword1>#<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> enat <span class=main>(</span>Suc <span class=free>n</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> enat <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gdrop_def gappend_def gnth_def gCons_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Cons_nth_drop_Suc i_drop_Suc_conv_tl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf-glength_gtake><span class=command>lemma</span></span> glength_gtake<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span><span class=free>a</span> <span class=keyword1>↓<span class=hidden>⇩</span><sub>g</sub></span> <span class=free>n</span><span class=main>)</span> <span class=main>=</span> min <span class=main>(</span>glength <span class=free>a</span><span class=main>)</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gtake_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf-glength_drop><span class=command>lemma</span></span> glength_drop<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"glength <span class=main>(</span><span class=free>a</span> <span class=keyword1>↑<span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> glength <span class=free>a</span> <span class=main>-</span> <span class=main>(</span>enat <span class=free>n</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> glength_def gdrop_def<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=free>n</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=ListInf_Prefix><div class=head><h1>Theory ListInf_Prefix</h1></div><pre class=source><span class=comment1>(*  Title:      ListInf_Prefix.thy
    Date:       Oct 2006
    Author:     David Trachtenherz
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Prefices on finite and infinite lists›</span></span>

<span class=keyword1><span class=command>theory</span></span> ListInf_Prefix
<span class=keyword2><span class=keyword>imports</span></span> <span class=quoted>"<a href=../../HOL/HOL-Library/Sublist.html>HOL-Library.Sublist</a>"</span> <a href=ListInf.html>ListInf</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Additional list prefix results›</span></span>

<span class=keyword1 id=ListInf_Prefix-prefix_eq_prefix_take_ex><span class=command>lemma</span></span> prefix_eq_prefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> prefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>↑</span> <span class=improper>n</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-prefix_take_eq_prefix_take_ex><span class=command>lemma</span></span> prefix_take_eq_prefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> min_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefix_eq_prefix_take><span class=command>lemma</span></span> prefix_eq_prefix_take<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> prefix_eq_prefix_take_ex prefix_take_eq_prefix_take_ex<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-strict_prefix_take_eq_strict_prefix_take_ex><span class=command>lemma</span></span> strict_prefix_take_eq_strict_prefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  <span class=main>(</span><span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> prefix_take_eq_prefix_take_ex<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-strict_prefix_eq_strict_prefix_take_ex><span class=command>lemma</span></span> strict_prefix_eq_strict_prefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"strict_prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>ys</span> <span class=main>↓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> strict_prefix_def prefix_eq_prefix_take_ex<span class=main>)</span>
<span class=keyword1 id=ListInf_Prefix-strict_prefix_eq_strict_prefix_take><span class=command>lemma</span></span> strict_prefix_eq_strict_prefix_take<span class=main>:</span> <span class=quoted><span class=quoted>"strict_prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>∧</span> <span class=free>xs</span> <span class=main>≠</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> strict_prefix_eq_strict_prefix_take_ex strict_prefix_take_eq_strict_prefix_take_ex<span class=main>)</span>



<span class=keyword1 id=ListInf_Prefix-take_imp_prefix><span class=command>lemma</span></span> take_imp_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> take_is_prefix<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-eq_imp_prefix><span class=command>lemma</span></span> eq_imp_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span><span class=main>::</span><span class=tfree>'a</span> list<span class=main>)</span> <span class=main>⟹</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=ListInf_Prefix-le_take_imp_prefix><span class=command>lemma</span></span> le_take_imp_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≤</span> <span class=free>b</span> <span class=main>⟹</span> prefix <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_eq_prefix_take_ex min_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-take_prefix_imp_le><span class=command>lemma</span></span> take_prefix_imp_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>a</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>;</span> prefix <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>a</span> <span class=main>≤</span> <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>drule</span> prefix_length_le<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-take_prefixeq_le_conv><span class=command>lemma</span></span> take_prefixeq_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>a</span> <span class=main>≤</span> length <span class=free>xs</span> <span class=main>⟹</span> prefix <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=free>xs</span> <span class=main>↓</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> take_prefix_imp_le<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_take_imp_prefix<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1 id=ListInf_Prefix-append_imp_prefix><span class=command>lemma</span></span> append_imp_prefix<span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>a</span> <span class=main>(</span><span class=free>a</span> <span class=main>@</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> prefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefix_imp_take_eq><span class=command>lemma</span></span> prefix_imp_take_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>;</span> prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefix_length_le_eq_conv><span class=command>lemma</span></span> prefix_length_le_eq_conv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>∧</span> length <span class=free>ys</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> conjE<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> prefix_length_le<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> prefix_eq_prefix_take<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-take_length_prefix_conv><span class=command>lemma</span></span> take_length_prefix_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟹</span> prefix <span class=main>(</span><span class=free>ys</span> <span class=main>↓</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_eq_prefix_take<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-append_eq_imp_take><span class=command>lemma</span></span> append_eq_imp_take<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>k</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>;</span> length <span class=free>r1</span> <span class=main>=</span> <span class=free>k</span><span class=main>;</span> <span class=free>r1</span> <span class=main>@</span> <span class=free>r2</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>r1</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=ListInf_Prefix-take_the_conv><span class=command>lemma</span></span> take_the_conv<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>xs</span> <span class=main>↓</span> <span class=free>k</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> length <span class=free>xs</span> <span class=main>≤</span> <span class=free>k</span> <span class=keyword1>then</span> <span class=free>xs</span> <span class=keyword1>else</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>r</span><span class=main>.</span> length <span class=bound>r</span> <span class=main>=</span> <span class=free>k</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>r2</span><span class=main>.</span> <span class=bound>r</span> <span class=main>@</span> <span class=bound>r2</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> linorder_not_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> the1I2<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Ex1_def<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>↓</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI<span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> min_eqR<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>↑</span> <span class=free>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1 id=ListInf_Prefix-prefix_refl><span class=command>lemma</span></span> prefix_refl<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=main>(</span><span class=free>xs</span><span class=main>::</span><span class=tfree>'a</span> list<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> prefix_order.order_refl<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefix_trans><span class=command>lemma</span></span> prefix_trans<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> prefix <span class=free>xs</span> <span class=free>ys</span><span class=main>;</span> prefix <span class=main>(</span><span class=free>ys</span><span class=main>::</span><span class=tfree>'a</span> list<span class=main>)</span> <span class=free>zs</span> <span class=main>⟧</span> <span class=main>⟹</span> prefix <span class=free>xs</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> prefix_order.order_trans<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefixeq_antisym><span class=command>lemma</span></span> prefixeq_antisym<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> prefix <span class=free>xs</span> <span class=free>ys</span><span class=main>;</span> prefix <span class=main>(</span><span class=free>ys</span><span class=main>::</span><span class=tfree>'a</span> list<span class=main>)</span> <span class=free>xs</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> prefix_order.antisym<span class=main>)</span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Counting equal pairs›</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Counting number of equal elements in two lists›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mirror_pair</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'b</span> <span class=main>×</span> <span class=tfree>'a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>mirror_pair</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> <span class=main>(</span>snd <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>,</span> fst <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-zip_mirror><span class=command>lemma</span></span> zip_mirror<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>i</span> <span class=main>&lt;</span> min <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span><span class=main>;</span>
    <span class=free>p1</span> <span class=main>=</span> <span class=main>(</span>zip <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>i</span><span class=main>;</span> <span class=free>p2</span> <span class=main>=</span> <span class=main>(</span>zip <span class=free>ys</span> <span class=free>xs</span><span class=main>)</span> <span class=main>!</span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span>
  mirror_pair <span class=free>p1</span> <span class=main>=</span> <span class=free>p2</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_pair_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>equal_pair</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>equal_pair</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>=</span> snd <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-mirror_pair_equal><span class=command>lemma</span></span> mirror_pair_equal<span class=main>:</span> <span class=quoted><span class=quoted>"equal_pair <span class=main>(</span>mirror_pair <span class=free>p</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>equal_pair <span class=free>p</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> mirror_pair_def equal_pair_def<span class=main>)</span>

<span class=keyword1><span class=command>primrec</span></span>
  <span class=entity>equal_pair_count</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'a</span><span class=main>)</span> list <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>equal_pair_count</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>equal_pair_count</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>#</span> <span class=free><span class=bound><span class=entity>ps</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>
    <span class=keyword1>if</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>=</span> snd <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>
      <span class=keyword1>then</span> Suc <span class=main>(</span><span class=free>equal_pair_count</span> <span class=free><span class=bound><span class=entity>ps</span></span></span><span class=main>)</span>
      <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-equal_pair_count_le><span class=command>lemma</span></span> equal_pair_count_le<span class=main>:</span> <span class=quoted><span class=quoted>"equal_pair_count <span class=free>xs</span> <span class=main>≤</span> length <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-equal_pair_count_0><span class=command>lemma</span></span> equal_pair_count_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  fst <span class=main>(</span>hd <span class=free>ps</span><span class=main>)</span> <span class=main>≠</span> snd <span class=main>(</span>hd <span class=free>ps</span><span class=main>)</span> <span class=main>⟹</span> equal_pair_count <span class=free>ps</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=free>ps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-equal_pair_count_Suc><span class=command>lemma</span></span> equal_pair_count_Suc<span class=main>:</span> <span class=quoted><span class=quoted>"
  equal_pair_count <span class=main>(</span><span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>a</span><span class=main>)</span> <span class=main>#</span> <span class=free>ps</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>equal_pair_count <span class=free>ps</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=ListInf_Prefix-equal_pair_count_eq_pairwise><span class=command>lemma</span></span> equal_pair_count_eq_pairwise<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> length <span class=free>ps1</span> <span class=main>=</span> length <span class=free>ps2</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>ps2</span><span class=main>.</span> equal_pair <span class=main>(</span><span class=free>ps1</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> equal_pair<span class=main>(</span><span class=free>ps2</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> equal_pair_count <span class=free>ps1</span> <span class=main>=</span> equal_pair_count <span class=free>ps2</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> list_induct2<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-equal_pair_count_mirror_pairwise><span class=command>lemma</span></span> equal_pair_count_mirror_pairwise<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> length <span class=free>ps1</span> <span class=main>=</span> length <span class=free>ps2</span><span class=main>;</span>
    <span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>&lt;</span>length <span class=free>ps2</span><span class=main>.</span> <span class=free>ps1</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>=</span> mirror_pair <span class=main>(</span><span class=free>ps2</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span> <span class=main>⟧</span>
  <span class=main>⟹</span> equal_pair_count <span class=free>ps1</span> <span class=main>=</span> equal_pair_count <span class=free>ps2</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> equal_pair_count_eq_pairwise<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mirror_pair_equal<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* The lemma states that all pairs with index &lt; equal_pair_count ps
  are equal. It does not deal with maximality of equal_pair_count *)</span>
<span class=keyword1 id=ListInf_Prefix-equal_pair_count_correct><span class=command>lemma</span></span> equal_pair_count_correct<span class=main>:</span><span class=quoted><span class=quoted>"
  <span class=main>⋀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> equal_pair_count <span class=free>ps</span> <span class=main>⟹</span> equal_pair <span class=main>(</span><span class=free>ps</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ps</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>split</span> if_split_asm<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>i</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* For @{text "i = equal_pair_count ps"} holds:
  either @{text "ps ! i"} not an equal pair,
  or all pairs are equal (@{text "equal_pair_count = length ps"}) *)</span>
<span class=keyword1 id=ListInf_Prefix-equal_pair_count_maximality_aux><span class=command>lemma</span></span> equal_pair_count_maximality_aux<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span><span class=main>.</span>
  <span class=bound>i</span> <span class=main>=</span> equal_pair_count <span class=free>ps</span> <span class=main>⟹</span> length <span class=free>ps</span> <span class=main>=</span> <span class=bound>i</span> <span class=main>∨</span> <span class=main>¬</span> equal_pair <span class=main>(</span><span class=free>ps</span> <span class=main>!</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>ps</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> equal_pair_count_maximality1a<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  equal_pair_count <span class=free>ps</span> <span class=main>=</span> length <span class=free>ps</span> <span class=main>∨</span> <span class=main>¬</span> equal_pair <span class=main>(</span><span class=free>ps</span><span class=main>!</span>equal_pair_count <span class=free>ps</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_maximality_aux<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"equal_pair_count <span class=free><span class=free>ps</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>ps</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> equal_pair_count_maximality1b<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  equal_pair_count <span class=free>ps</span> <span class=main>≠</span> length <span class=free>ps</span> <span class=main>⟹</span>
  <span class=main>¬</span> equal_pair <span class=main>(</span><span class=free>ps</span><span class=main>!</span>equal_pair_count <span class=free>ps</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_maximality1a<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>ps</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-equal_pair_count_maximality2a><span class=command>lemma</span></span> equal_pair_count_maximality2a<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  equal_pair_count <span class=free>ps</span> <span class=main>=</span> length <span class=free>ps</span> <span class=main>∨</span> <span class=comment1>― ‹either all pairs are equal›</span>
  <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>≥</span>equal_pair_count <span class=free>ps</span><span class=main>.</span><span class=main>(</span><span class=main>∃</span><span class=bound><span class=bound>j</span></span><span class=main>≤</span><span class=bound>i</span><span class=main>.</span> <span class=main>¬</span>equal_pair <span class=main>(</span><span class=free>ps</span> <span class=main>!</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"equal_pair_count <span class=free>ps</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_count_maximality1b equal_pair_count_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> equal_pair_count_maximality2b<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  equal_pair_count <span class=free>ps</span> <span class=main>≠</span> length <span class=free>ps</span> <span class=main>⟹</span>
  <span class=main>∀</span><span class=bound><span class=bound>i</span></span><span class=main>≥</span>equal_pair_count <span class=free>ps</span><span class=main>.</span><span class=main>(</span><span class=main>∃</span><span class=bound><span class=bound>j</span></span><span class=main>≤</span><span class=bound>i</span><span class=main>.</span> <span class=main>¬</span>equal_pair <span class=main>(</span><span class=free>ps</span><span class=main>!</span><span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_maximality2a<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>ps</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> equal_pair_count_maximality <span class=main>=</span>
  equal_pair_count_maximality1a equal_pair_count_maximality1b
  equal_pair_count_maximality2a equal_pair_count_maximality2b


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Prefix length›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Length of the prefix infimum›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inf_prefix_length</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> nat"</span></span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>inf_prefix_length</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>≡</span> equal_pair_count <span class=main>(</span>zip <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"int <span class=main>(</span>inf_prefix_length <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>7</span><span class=main>,</span><span class=numeral>8</span><span class=main>,</span><span class=numeral>15</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>7</span><span class=main>,</span><span class=numeral>15</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"int <span class=main>(</span>inf_prefix_length <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>7</span><span class=main>,</span><span class=numeral>15</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"int <span class=main>(</span>inf_prefix_length <span class=main>[]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>7</span><span class=main>,</span><span class=numeral>15</span><span class=main>]</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>value</span></span> <span class=quoted><span class=quoted>"int <span class=main>(</span>inf_prefix_length <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>5</span><span class=main>]</span> <span class=main>[</span><span class=main>1</span><span class=main>::</span>int<span class=main>,</span><span class=numeral>2</span><span class=main>,</span><span class=numeral>3</span><span class=main>,</span><span class=numeral>4</span><span class=main>,</span><span class=numeral>5</span><span class=main>]</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_commute><span class=command>lemma</span></span> inf_prefix_length_commute<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> inf_prefix_length <span class=free>ys</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_mirror_pairwise<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"zip <span class=free><span class=free>xs</span></span> <span class=free><span class=free>ys</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"zip <span class=free><span class=free>ys</span></span> <span class=free><span class=free>xs</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_count_mirror_pairwise<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"zip <span class=free>xs</span> <span class=free>ys</span>"</span></span> <span class=quoted><span class=quoted>"zip <span class=free>ys</span> <span class=free>xs</span>"</span></span><span class=main><span class=main>]</span></span> mirror_pair_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_leL><span class=command>lemma</span></span> inf_prefix_length_leL<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≤</span> length <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"zip <span class=free><span class=free>xs</span></span> <span class=free><span class=free>ys</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_length_leR<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≤</span> length <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>xs</span></span><span class=main><span class=main>]</span></span> inf_prefix_length_leL<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> inf_prefix_length_le <span class=main>=</span>
  inf_prefix_length_leL
  inf_prefix_length_leR

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_le_min><span class=command>lemma</span></span> inf_prefix_length_le_min<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≤</span> min <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_le<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-hd_inf_prefix_length_0><span class=command>lemma</span></span> hd_inf_prefix_length_0<span class=main>:</span> <span class=quoted><span class=quoted>"
  hd <span class=free>xs</span> <span class=main>≠</span> hd <span class=free>ys</span> <span class=main>⟹</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_count_0 hd_zip<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_NilL><span class=command>lemma</span></span> inf_prefix_length_NilL<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"inf_prefix_length <span class=main>[]</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_NilR><span class=command>lemma</span></span> inf_prefix_length_NilR<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_Suc><span class=command>lemma</span></span> inf_prefix_length_Suc<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  inf_prefix_length <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> Suc <span class=main>(</span>inf_prefix_length <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_correct><span class=command>lemma</span></span> inf_prefix_length_correct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>i</span> <span class=main>&lt;</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ inf_prefix_length_leL<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_less_le_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ inf_prefix_length_leR<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> equal_pair_count_correct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> equal_pair_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> nth_neq_imp_inf_prefix_length_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>xs</span> <span class=main>!</span> <span class=free>i</span> <span class=main>≠</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>i</span> <span class=main>⟹</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≤</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_correct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_maximality1><span class=command>lemma</span></span> inf_prefix_length_maximality1<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≠</span> min <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=free>xs</span> <span class=main>!</span> <span class=main>(</span>inf_prefix_length <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span> <span class=main>≠</span> <span class=free>ys</span> <span class=main>!</span> <span class=main>(</span>inf_prefix_length <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> equal_pair_count_maximality1b<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"zip <span class=free><span class=free>xs</span></span> <span class=free><span class=free>ys</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>folded</span> inf_prefix_length_def<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>drule</span> neq_le_trans<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_le<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  inf_prefix_length_def equal_pair_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_length_maximality2<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≠</span> min <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span> <span class=main>(</span>length <span class=free>ys</span><span class=main>)</span><span class=main>;</span>
    inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>≤</span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=main>∃</span><span class=bound><span class=bound>j</span></span><span class=main>≤</span><span class=free>i</span><span class=main>.</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>ys</span> <span class=main>!</span> <span class=bound>j</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inf_prefix_length <span class=free>xs</span> <span class=free>ys</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_maximality1 inf_prefix_length_le_min<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lemmas</span></span> inf_prefix_length_maximality <span class=main>=</span>
  inf_prefix_length_maximality1 inf_prefix_length_maximality2

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_append><span class=command>lemma</span></span> inf_prefix_length_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  inf_prefix_length <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>xs</span><span class=main>)</span> <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span>
  length <span class=free>zs</span> <span class=main>+</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>zs</span></span><span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_length_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_take_correct><span class=command>lemma</span></span> inf_prefix_length_take_correct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ inf_prefix_length_leL<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>frule</span> order_trans<span class=main><span class=main>[</span></span><span class=operator>OF</span> _ inf_prefix_length_leR<span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_eq_iff inf_prefix_length_correct<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_length_0_imp_hd_neq><span class=command>lemma</span></span> inf_prefix_length_0_imp_hd_neq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>;</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>;</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟧</span> <span class=main>⟹</span> hd <span class=free>xs</span> <span class=main>≠</span> hd <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>insert</span> inf_prefix_length_maximality2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>ys</span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_eq_first<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Prefix infimum›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inf_prefix</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⊓</span>"</span> 70<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main><span class=free>⊓</span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>↓</span> <span class=main>(</span>inf_prefix_length <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=free><span class=bound><span class=entity>ys</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-length_inf_prefix><span class=command>lemma</span></span> length_inf_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> inf_prefix_length <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_def min_eqR inf_prefix_length_leL<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_commute><span class=command>lemma</span></span> inf_prefix_commute<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>⊓</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_def inf_prefix_length_commute<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>ys</span></span><span class=main><span class=main>]</span></span> inf_prefix_length_take_correct<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_takeL><span class=command>lemma</span></span> inf_prefix_takeL<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>↓</span> <span class=main>(</span>inf_prefix_length <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_takeR><span class=command>lemma</span></span> inf_prefix_takeR<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=main>(</span>inf_prefix_length <span class=free>xs</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> inf_prefix_commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> inf_prefix_length_commute<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> inf_prefix_takeL<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_correct><span class=command>lemma</span></span> inf_prefix_correct<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_inf_prefix inf_prefix_length_correct<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_correctL<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_takeL<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_correctR<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>!</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>!</span> <span class=free>i</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_takeR<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_take_correct><span class=command>lemma</span></span> inf_prefix_take_correct<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>n</span> <span class=main>≤</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>↓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_inf_prefix inf_prefix_length_take_correct<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-is_inf_prefix><span class=command>lemma</span></span> is_inf_prefix<span class=main>[</span><span class=operator>rule_format</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> length <span class=free>zs</span> <span class=main>=</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>&lt;</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>zs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>∧</span> <span class=free>zs</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>!</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span>
  <span class=free>zs</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> list_eq_iff inf_prefix_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-hd_inf_prefix_Nil><span class=command>lemma</span></span> hd_inf_prefix_Nil<span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=free>xs</span> <span class=main>≠</span> hd <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_def hd_inf_prefix_length_0<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_Nil_imp_hd_neq><span class=command>lemma</span></span> inf_prefix_Nil_imp_hd_neq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>;</span> <span class=free>ys</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>;</span> <span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span> <span class=main>⟧</span> <span class=main>⟹</span> hd <span class=free>xs</span> <span class=main>≠</span> hd <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_def inf_prefix_length_0_imp_hd_neq<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-length_inf_prefix_append><span class=command>lemma</span></span> length_inf_prefix_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"
  length <span class=main>(</span><span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⊓</span> <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
  length <span class=free>zs</span> <span class=main>+</span> length <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_inf_prefix<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_append><span class=command>lemma</span></span> inf_prefix_append<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⊓</span> <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>zs</span> <span class=main>@</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> is_inf_prefix<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> nth_append<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>intro</span> conjI inf_prefix_correctL inf_prefix_correctR<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-hd_neq_inf_prefix_append><span class=command>lemma</span></span> hd_neq_inf_prefix_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  hd <span class=free>xs</span> <span class=main>≠</span> hd <span class=free>ys</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⊓</span> <span class=main>(</span><span class=free>zs</span> <span class=main>@</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>zs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hd_inf_prefix_Nil<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_NilL><span class=command>lemma</span></span> inf_prefix_NilL<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>⊓</span> <span class=free>ys</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> length_0_conv <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> length_0_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> length_inf_prefix<span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_NilR<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊓</span> <span class=main>[]</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_commute<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> inf_prefix_Nil <span class=main>=</span> inf_prefix_NilL inf_prefix_NilR

<span class=keyword1 id=ListInf_Prefix-inf_prefix_Cons><span class=command>lemma</span></span> inf_prefix_Cons<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⊓</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>#</span> <span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>insert</span> inf_prefix_append<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>[</span></span></span><span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>]</span></span></span>"</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>xs</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>ys</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>corollary</span></span> inf_prefix_hd<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"hd <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>xs</span><span class=main>)</span> <span class=main>⊓</span> <span class=main>(</span><span class=free>a</span> <span class=main>#</span> <span class=free>ys</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=ListInf_Prefix-inf_prefix_le1><span class=command>lemma</span></span> inf_prefix_le1<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_takeL take_imp_prefix<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-inf_prefix_le2><span class=command>lemma</span></span> inf_prefix_le2<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=main>(</span><span class=free>xs</span> <span class=main>⊓</span> <span class=free>ys</span><span class=main>)</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_prefix_takeR take_imp_prefix<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-le_inf_prefix_iff><span class=command>lemma</span></span> le_inf_prefix_iff<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>x</span> <span class=main>(</span><span class=free>y</span> <span class=main>⊓</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>prefix <span class=free>x</span> <span class=free>y</span> <span class=main>∧</span> prefix <span class=free>x</span> <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> prefix_order.order_trans inf_prefix_le1 inf_prefix_le2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-le_imp_le_inf_prefix><span class=command>lemma</span></span> le_imp_le_inf_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> prefix <span class=free>x</span> <span class=free>y</span><span class=main>;</span> prefix <span class=free>x</span> <span class=free>z</span> <span class=main>⟧</span> <span class=main>⟹</span> prefix <span class=free>x</span> <span class=main>(</span><span class=free>y</span> <span class=main>⊓</span> <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_inf_prefix_iff<span class=main><span class=main>[</span></span><span class=operator>THEN</span> iffD2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>interpretation</span></span> prefix<span class=main>:</span>
  semilattice_inf
    <span class=quoted><span class=quoted>"<span class=main>(⊓)</span> <span class=main>::</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> list"</span></span>
    <span class=quoted><span class=quoted>"prefix"</span></span>
    <span class=quoted><span class=quoted>"strict_prefix"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>intro_locales</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> class.semilattice_inf_axioms.intro<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inf_prefix_le1<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> inf_prefix_le2<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> le_imp_le_inf_prefix<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Prefices for infinite lists›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>iprefix</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> list <span class=main>⇒</span> <span class=tfree>'a</span> ilist <span class=main>⇒</span> bool"</span></span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>⊑</span>"</span> 50<span class=main>)</span>
  <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main><span class=free>⊑</span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>≡</span> <span class=main>∃</span><span class=bound>g</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>xs</span></span></span> <span class=main>⌢</span> <span class=bound>g</span>"</span></span>

<span class=keyword1 id=ListInf_Prefix-iprefix_eq_iprefix_take><span class=command>lemma</span></span> iprefix_eq_iprefix_take<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> length <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>unfold</span> iprefix_def<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇑</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> i_append_i_take_i_drop_id<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> n<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"length <span class=free><span class=free>xs</span></span>"</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-iprefix_take_eq_iprefix_take_ex><span class=command>lemma</span></span> iprefix_take_eq_iprefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> length <span class=free>xs</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>⇓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"length <span class=free>xs</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>assumption</span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>clarsimp</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-iprefix_eq_iprefix_take_ex><span class=command>lemma</span></span> iprefix_eq_iprefix_take_ex<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>n</span><span class=main>.</span> <span class=free>f</span> <span class=main>⇓</span> <span class=bound>n</span> <span class=main>=</span> <span class=free>xs</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take iprefix_take_eq_iprefix_take_ex<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-i_take_imp_iprefix><span class=command>lemma</span></span> i_take_imp_iprefix<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-i_take_prefix_le_conv><span class=command>lemma</span></span> i_take_prefix_le_conv<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span> <span class=main>≤</span> <span class=free>b</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_eq_prefix_take list_eq_iff<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-i_append_imp_iprefix><span class=command>lemma</span></span> i_append_imp_iprefix<span class=main>[</span><span class=operator>simp</span><span class=main>,</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊑</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_def<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefix_imp_take_eq><span class=command>lemma</span></span> iprefix_imp_take_eq<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>n</span> <span class=main>≤</span> length <span class=free>xs</span><span class=main>;</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>↓</span> <span class=free>n</span> <span class=main>=</span> <span class=free>f</span> <span class=main>⇓</span> <span class=free>n</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take_ex min_eqR<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefixeq_iprefix_trans><span class=command>lemma</span></span> prefixeq_iprefix_trans<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> prefix <span class=free>xs</span> <span class=free>ys</span><span class=main>;</span> <span class=free>ys</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take_ex prefix_eq_prefix_take_ex<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-i_take_length_prefix_conv><span class=command>lemma</span></span> i_take_length_prefix_conv<span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=main>(</span><span class=free>f</span> <span class=main>⇓</span> length <span class=free>xs</span><span class=main>)</span> <span class=free>xs</span> <span class=main>=</span> <span class=main>(</span><span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take prefix_length_le_eq_conv<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefixI><span class=command>lemma</span></span> iprefixI<span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>?</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>g</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> iprefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefixE><span class=command>lemma</span></span> iprefixE<span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>?</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>g</span><span class=main>.</span> <span class=free>f</span> <span class=main>=</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=bound>g</span> <span class=main>⟹</span> <span class=free>C</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>C</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> iprefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-Nil_iprefix><span class=command>lemma</span></span> Nil_iprefix<span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>[]</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> iprefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-same_prefix_iprefix><span class=command>lemma</span></span> same_prefix_iprefix<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span> <span class=main>⊑</span> <span class=free>xs</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>ys</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-prefix_iprefix><span class=command>lemma</span></span> prefix_iprefix<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> prefix_def iprefix_def i_append_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> i_append_assoc<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-append_iprefixD><span class=command>lemma</span></span> append_iprefixD<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>@</span> <span class=free>ys</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprefix_def i_append_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> i_append_assoc<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefix_length_le_imp_prefix><span class=command>lemma</span></span> iprefix_length_le_imp_prefix<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>;</span> length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take_ex take_is_prefix<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefix_i_append><span class=command>lemma</span></span> iprefix_i_append<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>(</span><span class=free>xs</span> <span class=main>⊑</span> <span class=free>ys</span> <span class=main>⌢</span> <span class=free>f</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>zs</span><span class=main>.</span> <span class=free>xs</span> <span class=main>=</span> <span class=free>ys</span> <span class=main>@</span> <span class=bound>zs</span> <span class=main>∧</span> <span class=bound>zs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> iprefix_length_le_imp_prefix<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjI2<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>⇓</span> <span class=main>(</span>length <span class=free>xs</span> <span class=main>-</span> length <span class=free>ys</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
 <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take<span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-i_append_one_iprefix><span class=command>lemma</span></span> i_append_one_iprefix<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟹</span> <span class=free>xs</span> <span class=main>@</span> <span class=main>[</span><span class=free>f</span> <span class=main>(</span>length <span class=free>xs</span><span class=main>)</span><span class=main>]</span> <span class=main>⊑</span> <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take i_take_Suc_conv_app_nth<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefix_same_length_le><span class=command>lemma</span></span> iprefix_same_length_le<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>;</span> <span class=free>ys</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>;</span> length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span> <span class=main>⟧</span> <span class=main>⟹</span> prefix <span class=free>xs</span> <span class=free>ys</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> iprefix_eq_iprefix_take_ex i_take_prefix_le_conv<span class=main>)</span>

<span class=keyword1 id=ListInf_Prefix-iprefix_same_cases><span class=command>lemma</span></span> iprefix_same_cases<span class=main>:</span> <span class=quoted><span class=quoted>"
  <span class=main>⟦</span> <span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span><span class=main>;</span> <span class=free>ys</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟧</span> <span class=main>⟹</span> prefix <span class=free>xs</span> <span class=free>ys</span> <span class=main>∨</span> prefix <span class=free>ys</span> <span class=free>xs</span>"</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"length <span class=free>xs</span> <span class=main>≤</span> length <span class=free>ys</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> iprefix_same_length_le<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=ListInf_Prefix-set_mono_iprefix><span class=command>lemma</span></span> set_mono_iprefix<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>xs</span> <span class=main>⊑</span> <span class=free>f</span> <span class=main>⟹</span> set <span class=free>xs</span> <span class=main>⊆</span> range <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold</span> iprefix_def<span class=main><span class=keyword3>,</span></span> <span class=operator>fastforce</span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=ListInfinite><div class=head><h1>Theory ListInfinite</h1></div><pre class=source><span class=keyword1><span class=command>theory</span></span> ListInfinite
<span class=keyword2><span class=keyword>imports</span></span> 
  <span class=quoted>"<a href=SetIntervalStep.html>CommonSet/SetIntervalStep</a>"</span>
  <span class=quoted>"<a href=ListInf_Prefix.html>ListInf/ListInf_Prefix</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword2><span class=keyword>end</span></span>
</pre></div></main></div></div></body></html>